gsl_stats March24,2009
Modeling with Data
gsl_stats March 24,2009
gsl_stats March24,2009
Modeling with Data
Tools and Techniques for Scientiﬁc Computing
Ben Klemens
PRINCETON UNIVERSITY PRESS
PRINCETON AND OXFORD
gsl_stats March 24,2009
Copyright ©2009 byPrinceton UniversityPress
Publishedby PrincetonUniversityPress
41WilliamStreet,Princeton, New Jersey08540
Inthe UnitedKingdom: Princeton UniversityPress
6OxfordStreet,Woodstock, Oxfordshire, OX201TW
AllRights Reserved
Klemens, Ben.
Modeling withdata :tools and techniques for scientiﬁccomp uting /BenKlemens.
p. cm.
Includes bibliographical references and index.
ISBN978-0-691-13314-0 (hardcover :alk. paper)
1. Mathematical statistics.2. Mathematical models. I. Tit le.
QA276.K546 2009
519.5–dc22 2008028341
BritishLibraryCataloging-in-Publication Datais availa ble
Thisbook has beencomposed inLATEX
The publisher would like to acknowledge the author of this vo lume for providing the camera-ready
copy from whichthis book was printed.
Printedon acid-free paper. ∞
press.princeton.edu
Printedinthe UnitedStatesof America
10987654321
gsl_stats March24,2009
We believe that noone should be deprived of books for any reas on.
—Russell Wattenberg,founder of the Book Thing
Theauthorpledgesto donate25%ofhisroyaltiesto the BookT hing
ofBaltimore,anon-proﬁtthatgivesbooksto schools,stude nts,
libraries,andotherreadersofallkinds.
gsl_stats March 24,2009
gsl_stats March24,2009
CONTENTS
Preface xi
Chapter 1. Statistics in the modern day 1
PART I COMPUTING 15
Chapter 2. C 17
2.1 Lines 18
2.2 Variables and their declarations 28
2.3 Functions 34
2.4 The debugger 43
2.5 Compiling and running 48
2.6 Pointers 53
2.7 Arrays and other pointer tricks 59
2.8 Strings 65
2.9 /F4Errors 69
Chapter 3. Databases 74
3.1 Basic queries 76
3.2 /F4Doing more with queries 80
3.3 Joins and subqueries 87
3.4 On database design 94
3.5 Folding queries into C code 98
gsl_stats March24,2009
viii CONTENTS
3.6 Maddening details 103
3.7 Some examples 108
Chapter 4. Matrices and models 113
4.1 The GSL ’s matrices and vectors 114
4.2 /CP/D4/D3/D4/CN/CS/CP/D8/CP 120
4.3 Shunting data 123
4.4 Linear algebra 129
4.5 Numbers 135
4.6 /F4 /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC and /CV/D7/D0/CN/DA/CT/D8/D3/D6 internals 140
4.7 Models 143
Chapter 5. Graphics 157
5.1 /D4/D0/D3/D8 160
5.2 /F4Some common settings 163
5.3 From arrays to plots 166
5.4 A sampling of special plots 171
5.5 Animation 177
5.6 On producing good plots 180
5.7 /F4Graphs—nodes and ﬂowcharts 182
5.8 /F4Printing and LATEX 185
Chapter 6. /F4More coding tools 189
6.1 Function pointers 190
6.2 Data structures 193
6.3 Parameters 203
6.4 /F4Syntactic sugar 210
6.5 More tools 214
PART II STATISTICS 217
Chapter 7. Distributions for description 219
7.1 Moments 219
7.2 Sample distributions 235
7.3 Using the sample distributions 252
7.4 Non-parametric description 261
Chapter 8. Linear projections 264
8.1 /F4Principal component analysis 265
8.2 OLS and friends 270
8.3 Discrete variables 280
8.4 Multilevel modeling 288
gsl_stats March24,2009
CONTENTS ix
Chapter 9. Hypothesis testing with the CLT 295
9.1 The Central Limit Theorem 297
9.2 Meet the Gaussian family 301
9.3 Testing a hypothesis 307
9.4 ANOVA 312
9.5 Regression 315
9.6 Goodness of ﬁt 319
Chapter 10. Maximum likelihood estimation 325
10.1 Log likelihood and friends 326
10.2 Description: Maximum likelihood estimators 337
10.3 Missing data 345
10.4 Testing with likelihoods 348
Chapter 11. Monte Carlo 356
11.1 Random number generation 357
11.2 Description: Finding statistics for a distribution 364
11.3 Inference: Finding statistics for a parameter 367
11.4 Drawing a distribution 371
11.5 Non-parametric testing 375
Appendix A: Environments and makeﬁles 381
A.1 Environment variables 381
A.2 Paths 385
A.3 Make 387
Appendix B: Text processing 392
B.1 Shell scripts 393
B.2 Some tools for scripting 398
B.3 Regular expressions 403
B.4 Adding and deleting 413
B.5 More examples 415
Appendix C: Glossary 419
Bibliography 435
Index 443
gsl_stats March 24,2009
gsl_stats March24,2009
PREFACE
Mathematics provides a framework for dealing precisely wit h notions of “what is.”
Computation provides a framework for dealingprecisely wit hnotions of “how to.”
—AlanJ Perlis,inAbelson et al.(1985, pxvi)
SHOULD YOU USE THIS BOOK ?This book is intended to be a complement to the
standardstatstextbook,in threeways.
First,descriptiveandinferentialstatisticsarekeptsep aratebeginningwiththeﬁrst
sentenceof the ﬁrst chapter. I believethat the fusing of the two is the numberone
causeofconfusionamongstatisticsstudents.
Once descriptive modeling is given its own space, and models do not necessarily
haveto be just preparation for a test, the options blossom. T here are myriad ways
to convert a subjective understanding of the world into a mat hematical model,
including simulations, models like the Bernoulli/Poisson distributions from tradi-
tionalprobabilitytheory, ordinaryleastsquares,andwho knowswhatelse.
If those options aren’t enough, simple models can be combine d to form multi-
levelmodelstodescribesituationsofarbitrarycomplexit y.Thatis,thebasiclinear
model or the Bernoulli/Poisson models may seem too simple fo r many situations,
buttheyarebuildingblocksthatletusproducemoredescrip tivemodels.Theover-
allapproachconcludeswith multilevelmodelsasin, e.g.,E liason(1993),Pawitan
(2001)orGelman& Hill (2007).
gsl_stats March24,2009
xii PREFACE
Second,manystats textsaim to be ascompleteaspossible,be causecompleteness
and a thick spine give the impression of value-for-money:yo u get a textbook and
areferencebook,soeverythingyouneedisguaranteedto bei n theresomewhere.
Butit’shardtolearnfromareferencebook.SoIhavemadeaso lidefforttoprovide
anarrativetotheimportantpointsaboutstatistics,event houghthatdirectlyimplies
thatthis bookis incompleterelative to the more encyclopæd ictexts.Forexample,
momentgeneratingfunctionsareaninterestingnarrativeo ntheirown,buttheyare
tangentialto thestory here,soI donotmention them.
Computation The third manner in which this book complements the traditio nal
stats textbook is that it acknowledges that if you are workin g with
data full time, then you are working on a computer full time. T he better you un-
derstandcomputing,themoreyouwill beabletodowith yourd ata,andthefaster
youwillbe ableto do it.
Thepolitics ofsoftware
All of the software in this book is free software ,
meaning that it may be freely downloaded and dis-
tributed. This is because the book focuses on porta-
bility and replicability, and if you need to purchase a
licenseeverytimeyouswitchcomputers,thenthecode
isnot portable.
If you redistribute a functioning program that you
wrote based on the GSL or Apophenia, then you need
toredistributeboththecompiledﬁnalprogramandthe
source code you used to write the program. If you are
publishinganacademicwork,youshouldbedoingthis
anyway. If you are in a situation where you will dis-
tributeonlytheoutputofananalysis,therearenoobli-
gations atall.
This book is also reliant on POSIX-compliant sys-
tems,becausesuchsystemswerebuiltfromtheground
up for writing and running replicable and portable
projects. This does not exclude any current operating
system (OS): current members of the Microsoft Win-
dows family of OSes claim POSIX compliance, as do
allOSesending inX (Mac OSX, Linux, UNIX,...).People like to characterize comput-
ingasfast-pacedandever-changing,
butmuchofthatis justchurnonthe
syntactic surface. The fundamental
concepts, conceived by mathemati-
cians with an eye toward the sim-
plicity and elegance of pencil-and-
paper math, have been around for
as long as anybody can remember.
Time spent learning those funda-
mentals will pay off no matter what
exciting new language everybody
happensto beusingthismonth.
I spent much of my life ignor-
ing the fundamentals of computing
and just hacking together projects
using the package or language of
the month: C++, Mathematica, Oc-
tave,Perl, Python,Java,Scheme,S-
PLUS, Stata, R, and probably a few
others that I’ve forgotten. Albee (1960, p 30) explains that “sometimes it’s neces-
sary to go a long distance out of the way in order to come back a s hort distance
correctly;”thisisthedistanceI’vegonetoarriveatwriti ngabookondata-oriented
computingusingageneralandbasiccomputinglanguage.For thepurposeofmod-
elingwithdata,IhavefoundCtobeaneasierandmorepleasan tlanguagethanthe
purpose-builtalternatives—especiallyafter I worked out that I could ignore much
of the advice from books written in the 1980s and apply the tec hniques I learned
from the scriptinglanguages.
gsl_stats March24,2009
PREFACE xiii
WHAT IS THE LEVEL OF THIS BOOK ?The short answer is that this is intended
forthegraduatestudentorindependentre-
searcher,eitherasasupplementto astandardﬁrst-yearsta tstextorforlaterstudy.
Hereare afewmore waysto answerthatquestion:
•Ease of use versus ease of initial use : The majority of statistics students are just
trying to slog through their department’s stats requiremen t so they can neverlook
atanotherdatasetagain.Ifthatisyou,thenyoursoleconce rniseaseofinitialuse,
andyouwantastatspackageandatextbookthatfocuslessonf ullproﬁciencyand
moreon immediateintuition.1
Conversely, this book is not really about solving today’s pr oblem as quickly as
physicallypossible,butaboutgettingabetterunderstand ingofdatahandling,com-
puting,andstatistics.Easeoflong-term usewill follow th erefrom.
•Level of computing abstraction : This book takes the fundamentals of computing
seriously, but it is not about reinventing the wheels of stat istical computing. For
example, NumericalRecipesinC (Pressetal.,1988)isaclassictextdescribingthe
algorithms for seeking optima, efﬁciently calculating det erminants, and making
random draws from a Normal distribution. Being such a classi c, there are many
packages that implement algorithms on its level, and this bo ok will build upon
thosepackagesratherthanreplicatetheireffort.
•Computing experience :You may have nevertaken a computersciencecourse,but
do have some experience in both the basics of dealing with a co mputer and in
writingscriptsineitherastatspackageorascriptinglang uagelikePerlorPython.
•Computational detail : This book includes about 80 working sample programs.
Code clariﬁes everything: English text may have a few ambigu ities, but all the
details have to be in place for a program to execute correctly . Also, code rewards
the curious, becausereaders can explore the data, ﬁnd out to what changes a pro-
cedureis robust,andotherwiseproductivelybreakthe code .
Thatmeansthatthisbookisnotcomputing-system-agnostic .Soifyouareadevo-
tee of a stats package not used here, then why look at this book ? Although I do
not shy away from C-speciﬁc details of syntax, most of the boo k focuses on the
conceptualissues common to all computing environments. If you never look at C
code again after you ﬁnish this book, you will still have a bet ter grounding for
effectivelyworking in yourpreferredprogramminglanguag e.
•Linear algebra : You are reasonably familiar with linear algebra, such that an ex-
pression like X−1is not foreign to you. There are a countably inﬁnite number of
linear algebra tutorials in books, stats text appendices, a nd online, so this book
doesnotincludeyetanother.
•Statistical topics : The book’s statistical topics are not particularly advanc ed or
trendy: OLS, maximum likelihood, or bootstrapping are all s taples of ﬁrst-year
grad-level stats. But by creatively combining building blo cks such as these, you
will beableto modeldataandsituationsofarbitrary comple xity.
1I myself learned afew things from theexcellently written na rrative in Gonick & Smith (1994).
gsl_stats March 24,2009
gsl_stats March24,2009
Modeling with Data
gsl_stats March 24,2009
gsl_stats March24,2009
1
STATISTICS IN THE MODERN DAY
Retake the fallingsnow: each driftingﬂake
Shapeless andslow, unsteady and opaque,
A dull darkwhite against the day’s pale white
And abstract larches inthe neutral light.
—Nabokov (1962, lines 13–16)
Statistical analysis has two goals, which directly conﬂict . The ﬁrst is to ﬁnd pat-
terns in static: given the inﬁnite number of variables that o ne could observe, how
can one discover the relations and patterns that make human s ense? The second
goalisaﬁghtagainst apophenia ,thehumantendencytoinventpatternsinrandom
static. Given that someone has found a pattern regarding a ha ndful of variables,
how can one verify that it is not just the product of a lucky dra w or an overactive
imagination?
Or, consider the complementary dichotomy of objective vers us subjective. The
objectivesideisoftencalled probability ;e.g.,giventheassumptionsoftheCentral
Limit Theorem, its conclusion is true with mathematical cer tainty. The subjective
side is often called statistics; e.g., our claim that observed quantity Ais a linear
function of observedquantity Bmay be very useful, but Nature has no interest in
it.
This book is about writing down subjective models based on ou r human under-
standing of how the world works, but which are heavily advise d by objective in-
formation, includingbothmathematicaltheoremsandobser veddata.1
1Of course, human-gathered data is never perfectly objectiv e, but weall try our best to make itso.
gsl_stats March24,2009
2 CHAPTER 1
Thetypicalschemebeginsbyproposingamodeloftheworld, t henestimatingthe
parametersofthemodelusingthe observeddata,andtheneva luatingtheﬁtofthe
model. This schemeincludes both a descriptivestep (descri bing a pattern) and an
inferential step (testing whether there are indications th at the pattern is valid). It
beginswith asubjectivemodel,butis heavilyadvisedbyobj ectivedata.
Figure 1.1 shows a model in ﬂowchart form. First, the descrip tive step: data and
parameters are fed into a function—which may be as simple as ais correlated
tob, or may be a complex set of interrelations—and the function s pits out some
output.Thencomesthetestingstep:evaluatingtheoutputb asedonsomecriterion,
typically regarding how well it matches some portion of the d ata. Our goal is to
ﬁndthoseparametersthatproduceoutputthatbestmeetsour evaluationcriterion.
ParametersData Data
Function Output Evaluation
Figure 1.1 A ﬂowchart for distribution ﬁtting, linear regre ssion, maximum likelihood methods,
multilevel modeling, simulation (including agent-based m odeling), data mining, non-
parametric modeling, and various other methods. [Online so urce for the diagram:/D1/D3/CS/CT/D0/D7/BA/CS/D3/D8 .]
The Ordinary LeastSquares (OLS) model is a popular and famil iar example, pic-
tured in Figure 1.2. [If it is not familiar to you, we will cove rit in Chapter 8.] Let
Xindicatetheindependentdata, βtheparameters,and ythedependentdata.Then
the function box consists of the simple equation yout=Xβ, and the evaluation
stepseeksto minimize squarederror, (y−yout)2.
βX y
Xβ yout (y−yout)2
Figure 1.2 The OLSmodel: a special case of Figure 1.1.
Fora simulation,the function boxmaybea complexﬂowcharti n whichvariables
are combined non-linearly with parameters, then feed back u pon each other in
unpredictableways. Theﬁnal stepwould evaluatehow wellth e simulation output
correspondsto thereal-world phenomenonto beexplained.
Thekeycomputationalproblemofstatisticalmodelingis to ﬁndtheparametersat
gsl_stats March24,2009
STATISTICS IN THE MODERN DAY 3
the beginningof the ﬂowchartthat will outputthe bestevalu ationat the end.That
is, for a given function and evaluation in Figure 1.1, we seek a routine to take in
dataandproducetheoptimalparameters,asinFigure1.3.In theOLSmodelabove,
there is a simple, one-equation solution to the problem: βbest= (X′X)−1X′y.
Butformorecomplexmodels,suchassimulationsormanymult ilevelmodels,we
muststrategicallytry differentsetsofparametersto hunt forthe bestones.
Data Estimation Parameters
X,y (X′X)−1X′y βbest
Figure 1.3 Top: theparameters whicharetheinput forthe mod el inFigure1.1are theoutput forthe
estimation routine.
Bottom: the estimationof the OLSmodel is a simple equation.
And that’s the whole book: develop models whose parameters a nd tests may dis-
coverand verify interesting patterns in the data. But the se tup is incredibly versa-
tile,andwithdifferentfunctionspeciﬁcations,thesetup takesmanyforms.Among
afewminorasides,thisbookwillcoverthefollowingtopics ,allofwhicharevari-
antsofFigure1.1:
• Probability:howwell-knowndistributionscanbeusedto m odeldata
• Projections:summarizingmany-dimensionaldatain two or threedimensions
• Estimating linearmodelssuchasOLS
• Classical hypothesis testing: using the Central Limit The orem (CLT) to ferret out
apophenia
• Designing multilevel models, where one model’s output is t he input to a parent
model
• Maximumlikelihood estimation
• Hypothesistestingusinglikelihoodratio tests
• MonteCarlo methodsfor describingparameters
• “Nonparametric”modeling(whichcomfortablyﬁtsintothe parametricformhere),
suchassmoothingdatadistributions
• Bootstrappingto describeparametersandtesthypotheses
gsl_stats March24,2009
4 CHAPTER 1
THESNOWFLAKE PROBLEM ,OR A BRIEF
HISTORY OF STATISTICAL COMPUTINGThe simplest models in the above list
have only one or two parameters, like
a Binomial (n,p)distribution which is
built from nidentical draws, each of which is a success with probability p[see
Chapter 7]. But draws in the real world are rarely identical— no two snowﬂakes
areexactlyalike.Itwouldbeniceifanoutcomevariable,li keannualincome,were
determinedentirelybyonevariable(likeeducation),butw eknowthatafewdozen
moreenterinto the picture(like age,race,marital status, geographicallocation,et
cetera).
The problem is to design a model that accommodates that sort o f complexity, in
a mannerthat allows us to actually compute results. Before c omputerswere com-
mon, the best we could do was analysis of variance methods (AN OVA), which
ascribedvariationto afew potentialcauses[seeSections7 .1.3and9.4].
The ﬁrst computational milestone, circa the early 1970s, ar rived when civilian
computers had the power to easily invert matrices, a process that is necessary for
mostlinearmodels.Thelinearmodelssuchasordinaryleast squaresthenbecame
dominant[seeChapter8].
Thesecondmilestone,circathemid1990s,arrivedwhendesk topcomputingpower
wassufﬁcienttoeasilygatherenoughlocalinformationtop indowntheglobalop-
timumofacomplexfunction—perhapsthousandsormillionso fevaluationsofthe
function.Thefunctionsthatthesemethodscanhandlearemu chmoregeneralthan
the linear models: you can now write and optimize models with millions of inter-
acting agents or functions consisting of the sum of a thousan d sub-distributions
[seeChapter10].
The ironic result of such computational power is that it allo ws us to return to the
simple models like the Binomial distribution. But instead o f specifying a ﬁxed n
andpfortheentirepopulation,everyobservationcouldtakeona valueof nthatis
afunctionoftheindividual’sage,race,etcetera,andaval ueofpthatisadifferent
functionofage,race,etcetera[seeSection8.4].
Themodelsin PartII arelisted more-or-less in orderofcomp lexity.Theinﬁnitely
quotableAlbert Einstein advised,“make everythingas simp le as possible, but not
simpler.” The Central Limit Theorem tells us that errors oft en are Normally dis-
tributed, andit is often the casethat the dependentvariabl e is basicallya linearor
log-linear function of severalvariables. If such descript ions do no violence to the
reality from whichthe datawereculled,then OLSis the metho dto use,andusing
moregeneraltechniqueswillnotbeanymorepersuasive.But iftheseassumptions
do not apply, we no longer need to assume linearity to overcom e the snowﬂake
problem.
gsl_stats March24,2009
STATISTICS IN THE MODERN DAY 5
THE PIPELINE Astatisticalanalysisisaguidedseriesoftransformation softhedata
from its raw form as originally written down to a simple summa ry
regardingaquestionofinterest.
Theﬂowabove,in the statisticstextbooktradition, picked uphalfway throughthe
analysis:itassumesadatasetthatisin thecorrectform.Bu tthefullpipelinegoes
from the original messy data set to a ﬁnal estimation of a stat istical model. It is
built from functions that each incrementally transform the data in some manner,
likeremovingmissingdata,selectingasubsetofthedata,o rsummarizingitintoa
singlestatistic like ameanorvariance.
Thus, you can think of this book as a catalog of pipe sections a nd ﬁlters, plus
a discussion of how to ﬁt elements together to form a stream fr om raw data to
ﬁnal publishable output. As well as the pipe sections listed above, such as the
ordinary least squares or maximum likelihood procedures, t he book also covers
severaltechniquesfordirectlytransformingdata,comput ingstatistics,andwelding
allthesesectionsinto afull program:
• Structuring programsusingmodularfunctionsandthe stackofframes
• Programmingtools likethe debuggerandproﬁler
• Methodsfor reliability testingfunctionsandmakingthem morerobust
• Databases,andhowto getthemto producedatain theformat y ouneed
• Talking to external programs, like graphics packagesthat will generate visualiza-
tionsofyourdata
• Finding and using pre-existing functions to quickly estim ate the parameters of a
modelfrom data.
• Optimization routines:howtheyworkandhowto usethem
• MonteCarlo methods:gettinga pictureofamodelvia millio ns ofrandomdraws
To make things still more concrete, almost all of the sample c ode in this book
is available from the book’s Web site, linked from /CW/D8/D8/D4/BM/BB/BB/D4/D6/CT/D7/D7/BA/D4/D6/CX/D2/CT/D8/D3/D2/BA/CT/CS/D9/BB/D8/CX/D8/D0/CT/D7/BB/BK/BJ/BC/BI/BA/CW/D8/D1/D0 . This means that you can learn by running and modify-
ing the examples, or you can cut, paste, and modify the sample code to get your
ownanalysesrunningmorequickly.Theprogramsarelisteda ndgivenacomplete
discussionon thepagesofthis book,soyoucanreadit ontheb usoratthe beach,
but you are very much encouragedto read through this book whi le sitting at your
computer, where you can run the sample code, see what happens given different
settings,andotherwiseexplore.
Figure1.4givesatypicalpipelinefromrawdatatoﬁnalpape r.Itworksatanumber
of different layersof abstraction :some segmentsinvolve manipulating individual
numbers, some segments take low-level numerical manipulat ion as given and op-
gsl_stats March24,2009
6 CHAPTER 1
Input 
Data SQL
Database Appendix BC Matrix Ch 3 Output 
parameters Part II
Plots
and graphs Ch 5 
Figure1.4 Filteringfrom input data tooutputs. [Online sou rce: /CS/CP/D8/CP/CU/CX/D0/D8/CT/D6/CX/D2/CV/BA/CS/D3/D8 ]
erateondatabasetablesormatrices,andsomesegmentstake matrix operationsas
givenandrunhigher-levelhypothesistests.
The lowest level Chapter 2 presents a tutorial on the C programming language i t-
self. Thework hereis at the lowestlevelof abstraction,cov ering
nothingmoredifﬁcultthanaddingcolumnsofnumbers.Thech apteralsodiscusses
howCfacilitatesthedevelopmentanduseof libraries:setsoffunctionswrittenby
past programmers that provide the tools to do work at higher a nd higher levels of
abstraction(andthusignore detailsatlowerlevels).2
Fora numberof reasonsto be discussedbelow, the bookrelies on the C program-
ming language for most of the pipe-ﬁtting, but if there is a ce rtain section that
youﬁnd useful(the appendicesand the chapteron databasesc omesto mind)then
thereisnothingkeepingyoufromweldingthatpipesectiont oothersusinganother
programminglanguageorsystem.
Dealing with large data sets Computerstodayareableto crunchnumbersahun-
dredtimesfastertheydidadecadeago—butthedata
sets they have to crunch are a thousand times larger. Genetic ists routinely pull
550,000 genetic markers each from a hundred or a thousand pat ients. The US
Census Bureau’s 1% sample covers almost 3 million people. Th us, the next layer
of abstraction provides specialized tools for dealing with data sets: databases and
a query languagefor organizing data. Chapter 3 presents a ne w syntax for talking
to a database, Structured Query Language (SQL). You will ﬁnd that many types
ofdatamanipulationandﬁltering thataredifﬁcultintradi tional languagesorstats
packagesare trivial—evenpleasant—viaSQL.
2Why does the book omit a linear algebra tutorial but include a n extensive C tutorial? Primarily because the
use of linear algebra has not changed much this century, whil e the use of C has evolved as more libraries have
become available. If you were writing C code in the early 1980 s, you were using only the standard library and
thus writing at a very low level. In the present day, the proce ss of writing code is more about joining together
libraries than writing fromscratch. I feltthat existing Ct utorials and books focused too heavily on theprocess of
writing from scratch, perpetuating the myth that C is approp riate only for low-level bit shifting. The discussion
of C here introduces tools like package managers, the debugg er, and the /D1/CP/CZ/CTutility as early as possible, so you
can start calling existing libraries as quickly and easily a s possible.
gsl_stats March24,2009
STATISTICS IN THE MODERN DAY 7
AsHuber(2000,p619)explains:“Largereal-life problemsa lwaysrequireacom-
bination of databasemanagementand data analysis....Neit her databasemanage-
mentsystemsnortraditionalstatisticalpackagesareupto thetask.”Thesolutionis
tobuildapipeline,asperFigure1.4,thatincludesbothdat abasemanagementand
statistical analysis sections. Much of graceful data handl ing is in knowing where
along the pipeline to place a ﬁltering operation. The databa se is the appropriate
placetoﬁlteroutbaddata,jointogetherdatafrommultiple sources,andaggregate
dataintogroupmeansandsums.Cmatricesareappropriatefo rﬁlteringoperations
like thosefrom earlierthattookindata,appliedafunction like(X′X)−1X′y, and
thenmeasured (yout−y)2.
Because your data probably did not come pre-loaded into a dat abase, Appendix
B discussestextmanipulation techniques,so whenthe datab aseexpectsyourdata
set to use commas but your data is separated by erratic tabs, y ou will be able to
quicklysurmounttheproblemandmoveonto analysis.
Computation The GNU Scientiﬁc Library works at the numerical computatio n
layer of abstraction. It includes tools for all of the proced ures com-
monly used in statistics, such as linear algebra operations , looking up the value
ofF,t,χ2distributions, and ﬁnding maxima of likelihood functions. Chapter 4
presentssomebasicsfordata-orienteduseofthe GSL.
The Apophenia library, primarily covered in Chapter 4, buil ds upon these other
layersofabstractiontoprovidefunctionsatthelevelofda taanalysis,modelﬁtting,
andhypothesistesting.
Pretty pictures Goodpictures canbe essentialto goodresearch.Theyoften r eveal
patterns in data that look like mere static when that data is p re-
sented as a table of numbers, and are an effective means of com municating with
peersandpersuadinggrantmakers.Consistentwiththerest ofthisbook,Chapter5
willcovertheuseofGnuplotandGraphviz,twopackagesthat arefreelyavailable
for the computer you are using right now. Both are entirely au tomatable, so once
you have a graph or plot you like, you can have your C programs a utogenerate
it or manipulate it in amusing ways, or can send your program t o your colleague
in Madras and he will have no problem reproducing and modifyi ng your plots.3
Once you have the basicsdown, animation and real-time graph ics for simulations
areeasy.
3Following a suggestion by Thomson (2001), I have chosen the g ender of representative agents in this book
by ﬂipping acoin.
gsl_stats March24,2009
8 CHAPTER 1
WHYC?You may be surprised to see a book about modern statistical co mputing
based on a language composed in 1972. Why use C instead of a spe cial-
ized language or package like SAS, Stata, SPSS, S-Plus, SAGE , SIENA, SU-
DAAN, SYSTAT, SST, SHAZAM, J, K, GAUSS, GAMS, GLIM, GENSTAT,
GRETL, EViews, Egret, EQS, PcGive, MatLab, Minitab, Mupad, Maple, Mplus,
Maxima, MLn, Mathematica, WinBUGS, TSP, HLM, R, RATS, LISRE L, Lisp-
Stat, LIMDEP, BMDP, Octave, Orange, OxMetrics, Weka, or Yor ick? This may
be the only book to advocate statistical computing with a gen eral computing lan-
guage,soIwilltakesometimetogiveyouabetterideaofwhym odernnumerical
analysisis bestdonein anoldlanguage.
Oneofthesideeffectsofaprogramminglanguagebeingstabl eforsolongisthata
mythologybuilds aroundit. Sometimesthe mythology is outd atedor false:I have
seen professionalcomputer programmers and writers claim t hat simple structures
like linked lists always need to be written from scratch in C ( see Section 6.2 for
proofotherwise),thatit takesten to ahundredtimes aslong to write a programin
Cthaninamorerecently-writtenlanguagelikeR,orthatbec ausepeoplehaveused
C to write devicedriversorotherlow-levelwork, it cannotb eusedfor high-level
work.4Thissectionis partly intendedto dispelsuchmyths.
Is C a hard language? Cwasa hard language. With nothing but a basic 80s-era
compiler, you could easily make many hard-to-catch mis-
takes.Butprogrammershavehadafewdecadestoidentifytho sepitfallsandbuild
toolstocatchthem.Moderncompilerswarnyouoftheseissue s,anddebuggerslet
youinteractwith yourprogramasit runsto catchmorequirks .C’s reputationasa
hardlanguagemeansthetoolsaroundithaveevolvedtomakei taneasylanguage.
Computational speed—really Using a stats package sure beats inverting matri-
ces by hand, but as computation goes, many stats
packages are still relatively slow, and that slowness can ma ke otherwise useful
statisticalmethodsinfeasible.
R and Apopheniausethe sameC codefor doing the Fisherexactt est, so it makes
a good basis for a timing test.5Listings 1.5 and 1.6 show programs in C and R
(respectively) that will run a Fisher exact test ﬁve million times on the same data
set. You can see that the C program is a bit more verbose:the st eps taken in lines
3–8 of the C code and lines 1–6 of the R code are identical, but t hose lines are
4Out of courtesy, citations are omitted. This section makes f requent comparisons to R partly because it is a
salient and common stats package, and partly because I know i t well, having used it on a daily basis for several
years.
5That is, if you download the source code for R’s /CU/CX/D7/CW/CT/D6/BA/D8/CT/D7/D8 function, you will ﬁnd a set of procedures
written in C. Save for a few minor modiﬁcations, the code unde rlying the /CP/D4/D3/D4/CN/D8/CT/D7/D8/CN/CU/CX/D7/CW/CT/D6/CN/CT/DC/CP/D8 function
is line-for-line identical.
gsl_stats March24,2009
STATISTICS IN THE MODERN DAY 9
1#include <apop.h>
2intmain(){
3inti, test_ct =5e6;
4doubledata[]= { 30, 86,
5 24, 38};
6apop_data *testdata = apop_line_to_data(data,0,2,2);
7for(i= 0; i< test_ct;i++)
8 apop_test_ﬁsher_exact(testdata);
9 }
Listing1.5 CcodetotimeaFisherexacttest.Itrunsthesame testﬁvemilliontimes.Onlinesource:/D8/CX/D1/CT/CU/CX/D7/CW/CT/D6/BA .
1 test_ct <−5e6
2 data <−c( 30, 86,
3 24, 38)
4 testdata<−matrix(data,nrow=2)
5for(i in1:test_ct){
6 ﬁsher.test(testdata)
7 }
Listing1.6 R code todothe same testas Listing1.5. Online so urce: /CA/D8/CX/D1/CT/CU/CX/D7/CW/CT/D6 .
longer in C, and the C program has some preliminary code that t he R script does
nothave.
On my laptop, Listing 1.5 runs in under three minutes, while L isting 1.6 does the
samework in 89minutes—aboutthirty times aslong.So the inv estmentof alittle
more verbosity and a few extra stars and semicolons returns a thirty-fold speed
gain.6Nor is this an isolated test case:I can’t count how many times people have
told me stories about an analysis or simulation that took day s or weeks in a stats
packagebutranin minutesaftertheyrewroteit in C.
Evenformoderately-sizeddatasets,realcomputingspeedo pensupnewpossibili-
ties,becausewecandropthe(typicallyfalse)assumptions neededforclosed-form
solutions in favor of maximum likelihood or Monte Carlo meth ods. The Monte
Carlo examples in Section 11.2 were produced using over a bil lion draws from t
distributions; if your stats package can’t produce a few hun dred thousand draws
persecond(somecan’t), suchwork will beunfeasiblyslow.7
6These timings are actually based on a modiﬁed version of /CU/CX/D7/CW/CT/D6/BA/D8/CT/D7/D8 that omits some additional R-side
calculations. If you had to put a Fisher test in a /CU/D3/D6loop without ﬁrst editing R’s code, the R-to-C speed ratio
would bebetween ﬁfty and ahundred.
7If you can produce random draws from tdistributions as abatch ( /CS/D6/CP/DB/D7 /BO/B9 /D6/D8/B4/BH/CT/BI/B8 /CS/CU/B5), then R takes a
mere3.5timesaslongascomparableCcode.Butifyouneedtop roducethemindividually ( /CU/D3/D6 /B4/CX /CX/D2 /BD/BM/BH/CT/BI/B5/DF/CS/D6/CP/DB /BO/B9 /D6/D8/B4/BD/B8 /CS/CU/B5/DH), then R takes about ﬁfteen times as long as comparable C code . On my laptop, R in
gsl_stats March24,2009
10 CHAPTER 1
Simplicity C is a super-simple language. Its syntax has no special trick s for poly-
morphic operators, abstract classes, virtual inheritance , lexical scoping,
lambda expressions, or other such arcana, meaning that you h ave less to learn.
Thosefeatures are certainly helpfulin their place,but wit houtthem C hasalready
proven to be sufﬁcient for writing some impressive programs , like the Mac and
Linuxoperatingsystemsandmostofthestatspackagesliste dabove.
Simplicity affords stability—C is among the oldest program ming languages in
common use today8—and stability brings its own beneﬁts. First, you are reason -
ably assured that you will be able to verify and modify your wo rk ﬁve or even
ten years from now. Since C was written in 1972, countless sta ts packages have
come and gone, while others are still around but have made so m any changes in
syntaxthattheyareeffectivelynewlanguages.Eitherway, thosewhotrytofollow
the trends have on their hard drives dozensof scripts that th ey can’t run anymore.
Meanwhile,correctlywritten C programsfrom the1970swill compileandrun on
newPCs.
Second, people have had a few decades to write good libraries , and libraries that
builduponthoselibraries.Itisnotthesyntaxofalanguage thatallowsyoutoeasily
handlecomplexstructures and tasks,but the vocabulary,wh ich in the caseof C is
continually being expanded by new function libraries. With a statistics library on
hand,theCcodeinListing1.5andtheRcodeinListing1.6wor katthesamehigh
levelofabstraction.
Alternatively, if you needmore precision,you canuseC’s lo w-levelbit-twiddling
to shunt individual elements of data. There is nothing more e mbarrassing than a
presenter who answers a question about an anomaly in the data or analysis with
‘Stata didn’t have a function to correct that.’ [Yes, I have h eard this in a real live
presentation by a real live researcher.] But since C’s highe r-level and lower-level
libraries are equally accessible, you can work at the level o f laziness or precision
calledforin anygivensituation.
Interacting with C scripts Manyofthestatspackageslistedaboveprovideapleas-
inginterfacethatletyourunregressionswithjustafew
mouse-clicks. Such systems are certainly useful for certai n settings, such as ask-
ing a few quick questions of a new data set. But an un-replicab le analysis based
on clicking an arbitrary sequence of on-screen buttons is as useful as no analysis
at all. In the context of building a repeatable script that ta kes the data as far as
possible along the pipeline from raw format to ﬁnal publishe d output, developing
batch modeproduced draws at arate ≈424,000/sec,while C produced draws atarate ≈1,470,000/sec.
8However, it is not the oldest, an honor that goes to FORTRAN. T his is noteworthy because some claim that
C is in common use today merely because of inertia, path depen dency, et cetera. But C displaced a number of
other languages such as ALGOL and PL/I which had more inertia behind them, by making clear improvements
over the incumbents.
gsl_stats March24,2009
STATISTICS IN THE MODERN DAY 11/D7/D6/CX/D4/D8/BA/CS/D3 for an interpreter and developing /D4/D6/D3/CV/D6/CP/D1/BA for a compiler become
about equivalent—especially since compilation on a modern computer takes on
theorderof0.0seconds.
With a debugger, the distance is even smaller, becauseyou ca n jump around your
C code,changeintermediate values,andotherwiseinteract with yourprogramthe
way you would with a stats package. Graphical interfaces for stats packages and
forC debuggerstendto havea similardesign.
But C is ugly! C is by no means the best language for all possible purposes. D if-
ferent systems have specialized syntaxes for communicatin g with
otherprograms,handlingtext,building Webpages,orprodu cingcertaingraphics.
But for data analysis, C is very effective. It has its syntact ic ﬂaws: you will for-
get to append semicolons to every line, and will be frustrate d that /BF/BB/BE/BP/BP/BDwhile/BF/BB/BE/BA/BP/BP/BD/BA/BH .Butthen,Perlalsorequiressemicolonsaftereveryline,a nd /BF/BB/BEisone
inPerl,Python,andRubytoo.Typedeclarationsareonemore detailtoremember,
but the alternatives have their own warts: Perl basically re quires that you declare
thetype ofyourvariable( , /B0, or /AZ)with everyuse,andRwill guessthe typeyou
meant to use, but will often guess wrong, such as thinking tha t a one-element list
like /DF/BD/BG/DHis really just an integer. C’s /D4/D6/CX/D2/D8/CUstatements look terribly confusing
at ﬁrst, but the authors of Ruby and Python, striving for the m ost programmer-
friendly syntax possible, chose to use C’s /D4/D6/CX/D2/D8/CUsyntax over many alternatives
thatareeasierontheeyesbutharderto use.
Inshort,Cdoesnotdoverywellwhenmeasuredbyinitialease -of-use.Butthereis
alogictoitsmessofstarsandbraces,andoverthecourseofd ecades,Chasproven
to be very well suited for designing pipelines for data analy sis, linking together
libraries from disparate sources,and describing detailed or computation-intensive
models.
TYPOGRAPHY Here are some notes on the typographic conventions used by th is
book./F4Seeing the forest for the trees On the one hand, a good textbook should be a
narrative that plots a deﬁnite course through a
ﬁeld. On the other hand, most ﬁelds have countless interesti ng and useful digres-
sions and side-paths. Sections marked with a /F4coverdetails that may be skipped
on a ﬁrst reading. They are not necessarily advanced in the se nse of being some-
how more difﬁcult than unmarked text, but they may be distrac tions to the main
narrative.
gsl_stats March24,2009
12 CHAPTER 1
Q1.1Questions and exercises are marked like this paragraph. The exercises are
notthoughtexperiments.Ithappenstoallofusthatwethink weunderstand
something until we sit down to actually do it, when a host of ha iry details
turn up. Especially at the outset, the exercises are relativ ely simple tasks
thatletyoufacethehairydetailsbeforeyourownreal-worl dcomplications
enter the situation. Exercises in the later chapters are mor e involved and
requirewriting ormodifyinglongersegmentsofcode.
Notation
X:boldface,capitallettersarematrices.Withfewexceptio ns,datamatricesinthis
bookareorganizedsothattherowsareeachasingleobservat ion,andeachcolumn
isa variable.
x: lowercase boldface indicates a vector. Vectors are genera lly a column of num-
bers,andtheirtranspose, x′,isarow. yistypicallyavectorofdependentvariables
(the exception being when we just need two generic data vecto rs, in which case
onewill be xandone y).
x:A lowercasevariable,notbold,is a scalar,i.e.,asingler ealnumber.
X′is thetransposeofthematrix X. Someauthorsnotatethis as XT.
Xisthedatamatrix Xwiththemeanofeachcolumnsubtracted,meaningthateach
column of Xhas mean zero. If Xhas a column of ones (as per most regression
techniques),thenthe constantcolumnis leftunmodiﬁedin X.
n: the number of observations in the data set under discussion , which is typically
thenumberofrowsin X. Whenthere is ambiguity, nwill besubscripted.
I: Theidentity matrix . A square matrix with ones along its diagonal and zeros
everywhereelse.
β: Greek letters indicate parametersto be estimated; if bold face,they are a vector
ofparameters.Themostcommonletteris β, butothersmayslipin, suchas...
σ,µ:the standarddeviationandthe mean.Thevarianceis σ2.
ˆσ,ˆβ: a carat over a parameter indicates an empirical estimate of the parameter
derivedfrom data.Typicallyreadas,e.g., sigmahat ,betahat.
ǫ∼N(0,1): Read this as epsilon is distributed as a Normal distribution with
parameters0 and1.
gsl_stats March24,2009
STATISTICS IN THE MODERN DAY 13
P(·): A probability densityfunction.
LL(·): Theloglikelihood function, ln(P(·)).
S(·): TheScore,whichisthe vectorofderivativesof LL(·).
I(·): Theinformation matrix, which isthe matrix ofsecondderiv ativesof LL(·).
E(·): Theexpectedvalue,akathe mean,oftheinput.
P(x|β): Theprobability of xgiventhat βis true.
P(x,β)|x:Theprobabilitydensityfunction,holding xﬁxed.Mathematically,this
is simply P(x,β), but in the given situation it should be thought of as a functi on
onlyof β.9
Ex(f(x,β)):Readas theexpectationover xofthegivenfunction,whichwilltake
a form like/integraltext
∀xf(x,β)P(x)dx. Because the integral is over all x,Ex(f(x,β))is
notitself afunction of x./D8/CT/D0/CT/D8/DD/D4/CT /D8/DD/D4/CT/CU/CP/CT indicates text that can be typed directly into a text ﬁle and
understoodasavalidshellscript, C commands,SQLqueries, etcetera./CP/D8 /D7/CP/D1/D4/D0/CT/CN/CU/CX/D0/CT : Slanted teletype text indicates a placeholderfor text you will
insert—a variable name rather than text to be read literally . You could read the
code here as, ‘let /D7/CP/D1/D4/D0/CT/CN/CU/CX/D0/CT be the name of a ﬁle on your hard drive. Then
type /CP/D8 /D7/CP/D1/D4/D0/CT/CN/CU/CX/D0/CT atthe commandprompt’.
a≡b:Readas‘ ais equivalentto b’ or‘ais deﬁnedas b’.
a∝b:Readas‘ ais proportionalto b’.
2.3 /CT6: Engineers often write scientiﬁc notation using so-called exponential orE
notation, such as 2.3×106≡2.3e6. Many computing languages (including C,
SQL,andGnuplot)recognizeE-notatednumbers.
9Others use a different notation. For example, Efron & Hinkle y (1978, p 458): “The log likelihood function
lθ(x)...isthelogofthedensity function, thought ofasafunctio n ofθ.”Seepage329formoreonthephilosoph-
ical considerations underlying the choice of notation.
gsl_stats March24,2009
14 CHAPTER 1
Every section ends with a summary of the main points, set like this para-
graph. There is much to be said for the strategy of ﬂipping ahe ad to the
summaryatthe endofthe sectionbeforereadingthesectioni tself.
Thesummaryforthe introduction:
®This book will discuss methods of estimating and testing the param-
etersofamodelwith data.
®Itwillalsocoverthemeansofwritingforacomputer,includ ingtech-
niques to manage data, plot data sets, manipulate matrices, estimate
statisticalmodels,andtestclaimsabouttheirparameters .
Credits Thanks to the following people, who added higher quality and richness to
the book:
• AnjeanetteAgro forgraphicdesignsuggestions.
• AmberBaumforextensivetesting andcritique.
• The Brookings Institution’s Center on Social and Economic Dynamics, includ-
ing Rob Axtell, Josh Epstein, Carol Graham, Emily Groves, Ro ss Hammond, Jon
Parker,MatthewRaifman,andPeytonYoung.
• DorothyGambrel, authorof CatandGirl , for theLonelyPlanetdata.
• Rob Goodspeed and the National Center for Smart Growth Rese arch and Educa-
tion atthe UniversityofMaryland,for theWashingtonMetro data.
• DerrickHiggins forcomments,critique, andthe Perlcomma ndsonpage414.
• Lucy Day Hobor and Vickie Kearn for editorial assistance an d making working
with PrincetonUniversityPressa pleasantexperience.
• GuyKlemens,fora widerangeofsupportonallfronts.
• AnneLaumannforthe tattoo dataset(Laumann& Derick,2006 ).
• AbigailRudmanfor herdeftlibrarianship.
gsl_stats March24,2009
I
COMPUTING
gsl_stats March 24,2009
gsl_stats March24,2009
2
C
ThischapterintroducesCandsomeofthegeneralconceptsbe hindgoodprogram-
ming that script writers often overlook. The function-base d approach, stacks of
frames,debugging,testfunctions,andoverallgoodstylea reimmediatelyapplica-
ble to virtually everyprogramming languagein usetoday.Th us,this chapteron C
mayhelpyouto becomeabetterprogrammerwith anyprogrammi nglanguage.
As for the syntax of C, this chapter will cover only a subset. C has 32 keywords
and this book will only use 18 of them.1Some of the other keywords are basi-
cally archaic, designed for the days when compilers needed h elp from the user to
optimize code. Other elements, like bit-shifting operator s, are useful only if you
are writing an operating system or a hardware device driver. With all the parts of
C that directly manipulate hexadecimal memory addresses om itted, you will ﬁnd
that C is a rather simple language that is well suited for simu lations and handling
large datasets.
An outline This chapter divides into three main parts. Sections 2.1 and 2.2 start
small, covering the syntax of individual lines of code to mak e assign-
ments, do arithmetic, and declare variables. Sections 2.3 t hrough 2.5 introduce
functions,describinghowCisbuiltontheideaofmodularfu nctionsthatareeach
independentlybuiltandevaluated.Sections2.6through2. 8coverpointers,asome-
whatC-speciﬁcmeansofhandlingcomputermemorythatcompl ementsC’smeans
ofhandlingfunctionsandlargedatastructures.Theremain derofthechapteroffers
sometipson writing bug-freecode.
1For comparison, C++has 62 keywords as of this writing, and Java has an even 50.
gsl_stats March24,2009
18 CHAPTER 2
ToolsYouwillneedanumberoftoolsbeforeyoucanwork,including aCcompiler,
adebugger ,themakefacility, andafew libraries offunctions.Somesystems
have them all pre-installed, especially if you have a benevo lent system adminis-
trator taking care of things. If you are not so fortunate, you will need to gather
thetools yourself.Theonline appendixto this book,atthes ite linkedfrom /CW/D8/D8/D4/BM/BB/BB/D4/D6/CT/D7/D7/BA/D4/D6/CX/D2/CT/D8/D3/D2/BA/CT/CS/D9/BB/D8/CX/D8/D0/CT/D7/BB/BK/BJ/BC/BI/BA/CW/D8/D1/D0 , will guide you through the pro-
cessofputtingtogetheracompleteCdevelopmentenvironme ntandusingthetools
forgatheringthe requisitelibraries.2
Q2.1CheckyourCenvironmentbycompilingandrunning“Hello,wo rld,”aclas-
sicﬁrstprogramadaptedfrom Kernighan& Ritchie (1988).
• Download the sample code for this book from the link at /CW/D8/D8/D4/BM/BB/BB/D4/D6/CT/D7/D7/BA/D4/D6/CX/D2/CT/D8/D3/D2/BA/CT/CS/D9/BB/D8/CX/D8/D0/CT/D7/BB/BK/BJ/BC/BI/BA/CW/D8/D1/D0 .
• Decompressthe /BA/DE/CX/D4ﬁle,gointothedirectorythuscreated,andcom-
piletheprogramwiththecommand /CV /CW/CT/D0/D0/D3/CN/DB/D3/D6/D0/CS/BA .Ifyouare
usinganIDE,seeyourmanualforcompilationinstructions.
• Ifall wentwell, youwill nowhaveaprogramin thedirectory named
either /CP/BA/D3/D9/D8or /CW/CT/D0/D0/D3/CN/DB/D3/D6/D0/CS . From the command line, you can ex-
ecuteit using /BA/BB/CP/BA/D3/D9/D8 or /BA/BB/CW/CT/D0/D0/D3/CN/DB/D3/D6/D0/CS .
• You may also want to try the /D1/CP/CZ/CT/CU/CX/D0/CT , which you will also ﬁnd in
thecodedirectory.Seetheinstructionsattheheadofthatﬁ le.
If you need troubleshooting help, see the online appendix, a sk your local
computing guru, or copy and paste your error messages into yo ur favorite
searchengine.
2.1 L INESThe story begins at the smallest level: a single line of code. Most
of the work on this level will be familiar to anyone who has wri tten
programs in any language, including instructions like assi gnments, basic arith-
metic, if-then conditions, loops, and comments. For such co mmon programming
elements, learning C is simply a question of the details of sy ntax. Also, C is a
typedlanguage,meaningthat you will needto specify whetherever yvariable and
functionisaninteger,areal,avector,orwhatever.Thus,m anyofthelineswillbe
simpletypedeclarations,whosesyntaxwill becoveredin th enextsection.
2A pedantic note on standards: this book makes an effort to com ply with the ISO C99 standard and the IEEE
POSIXstandard.TheC99standard includes somefeatures tha tdonotappear inthegreatmajority ofCtextbooks
(like designated initializers), but if your compiler does n ot support the features of C99 used here, then get a new
compiler—it’s been a long while since 1999. The POSIX standa rd deﬁnes features that are common to almost
every modern operating system, the mostnotable ofwhich is t hepipe; seeAppendix Bfor details.
The focus is on /CV, because that is what I expect most readers will be using. The command-line switches
for the /CVcommand are obviously speciﬁc to that compiler, and users of other compilers will need to check
the compiler manual for corresponding switches. However, a ll C code should compile for any C99- and POSIX-
compliant compiler. Finally, the /CVswitch most relevant to this footnote is /B9/D7/D8/CS/BP/CV/D2/D9/BL/BL , which basically puts
the compiler in C99 +POSIXmode.
gsl_stats March24,2009
C 19
ASSIGNMENT Most of the work you will be doing will be simple assignments. For
example,
ratio= a /b;
will ﬁnd the value of /CPdivided by /CQand put the value in /D6/CP/D8/CX/D3. The /BPindicates
anassignment,notanassertionaboutequality;onpaper,co mputerscientistsoften
write this as /D6/CP/D8/CX/D3← /CP/BB/CQ, which nicely gets across an image of /D6/CP/D8/CX/D3taking
on the value of /CP/BB/CQ. There is a semicolon at the end of the line; you will need a
semicolonatthe endof everythingbut the few exceptionsbel ow.3You canuseall
of the usual operations: /B7, /B9, /BB, and /B6. As per basic algebraic custom, /B6and /BBare
evaluatedbefore /B7and /B9,so /BG /B7 /BI /BB /BEis seven,and /B4/BG /B7 /BI/B5/BB/BEis ﬁve./F4TWO TYPES OF DIVISION There are two ways to answer the question, “What is
11dividedby3?”Thecommonansweristhat 11/3 =
3.66,butsomesaythatitisthreewitharemainderoftwo.Manypro gramminglan-
guages, including C, take the second approach. Dividing an i nteger by an integer
givestheanswerwiththefractionalpartthrownout,whilet hemodulooperator, /B1,
ﬁndsthe remainder.So /BD/BD/BB/BFis /BFand /BD/BD/B1/BFis /BE.
Iskanevennumber?Ifit is, then /CZ /B1 /BEis zero.4
Splitting the process into two parts provides a touch of addi tional precision, be-
cause the machine can write down integers precisely, but can only approximate
real numbers like 3.66. Thus, the machine’s evaluation of /B4/BD/BD/BA/BC/BB/BF/BA/BC/B5/B6/BF/BA/BC may
be ever-so-slightly different from /BD/BD/BA/BC. But with the special handling of division
forintegers,youareguaranteedthatforanyintegers /CPand /CQ(where /CQisnotzero),/B4/CP/BB/CQ/B5/B6/CQ /B7 /CP/B1/CQis exactly /CP.
But in most cases, you just want 11/3 = 3 .66. The solution is to say when you
meananintegerandwhenyoumeanarealnumberthathappensto takeonaninte-
gervalue,byaddingadecimalpoint. /BD/BD/BB/BFis /BF,asabove,but /BD/BD/BA/BB/BFis /BF/BA/BI/BI/BA/BA/BA as
desired. Get into the habit of adding decimalpoints now, bec auseinteger division
isafamoussourceofhard-to-debugerrors.Page33coversth esituationinslightly
more detail, andin the meantime we canmoveon to the more conv enientparts of
thelanguage.
3Thenumber one cause ofcompiler complaints like “line 41:sy ntax error” is amissing semicolon on line 40.
4In practice, you can check evenness with /BZ/CB/C4/CN/C1/CB/CN/BX/CE/BX/C6 or /BZ/CB/C4/CN/C1/CB/CN/C7/BW/BW :/AZ/CX/D2/D0/D9/CS/CT < /CV/D7/D0/BB/CV/D7/D0/CN/D1/CP/D8/CW/BA/CW >
.../CX/CU /B4/BZ/CB/C4/CN/C1/CB/CN/BX/CE/BX/C6/B4/CZ/B5/B5/CS/D3/CN/D7/D3/D1/CT/D8/CW/CX/D2/CV/B4/B5/BN
gsl_stats March24,2009
20 CHAPTER 2
INCREMENTING Itis incrediblycommonto haveanoperationofthe form/CP /BP /CP /B7 /CQ/BN—socommonthatC hasaspecialsyntaxforit:
a += b;
This is slightly less readable,but involvesless redundanc y.All of the abovearith-
meticoperatorscantakethisform, soeachofthefollowing l inesshowtwoequiv-
alentexpressions:
a−= b;/*is equivalent to */a = a−b;
a*= b;/*is equivalent to */a = a*b;
a /= b; /*is equivalent to */a = a / b;
a %= b; /*is equivalent to */a = a % b;
Themostcommonoperationamongtheseisincrementingordec rementingbyone,
andsoC offers thefollowing syntaxforstill lesstyping:5
a++;/*is equivalent to */a = a + 1;
a−−;/*is equivalent to */a = a−1;
CONDITIONS C hasnoneedfor /BY/BT/C4/CB/BXand /CC/CA/CD/BXkeywordsforBooleanoperations:
if an expression is zero, then it is false, and otherwise it is true. The
standard operations for comparison and Boolean algebra all appear in somewhat
familiar form:
(a > b) //ais greater than b
(a < b) //ais lessthan b
(a >= b) //ais greater than or equal tob
(a <= b) //ais lessthan or equal tob
(a == b) //aequals b
(a != b) //ais not equal tob
(a && b) //aand b
(a || b) //aor b
(!a) //not a
• Alloftheseevaluatetoeitheraoneorazero,dependingonw hethertheexpression
in parensis trueorfalse.
5There is also the pre-increment form, /B7/B7/CPand /B9/B9/CP. Pre- and post-incrementing differ only when they are
being used in situations that are bad style and should be avoi ded. Leave these operations on a separate line and
stick to whichever formlooks nicer to you.
gsl_stats March24,2009
C 21
• The comparison for equality involves twoequals signs in a row. One equals sign/B4/CP /BP /CQ/B5will assign the value of /CQto the variable /CP, which is not what you had
intended.Yourcompilerwillwarnyouinmostofthecaseswhe reyouareprobably
usingthewrongone,andyoushouldheedits warnings.
• The /B2/B2and /DG /DGoperators have a convenient feature: if /CPis sufﬁcient to determine
whethertheentireexpressionistrue,thenitwon’tbotherw ith /CQatall.Forexample,
this codefragment—
((a < 0) ||(sqrt(a) < 3))
—will nevertake the square root of a negativenumber. If /CPis less than zero, then
theevaluationoftheexpressionisdoneaftertheﬁrsthalf( itistrue),andevaluation
stops.If /CP/BQ/BP/BC, then the ﬁrst part ofthis expressionis not sufﬁcientto eva luatethe
wholeexpression,sothesecondpartisevaluatedtodetermi newhether√a<3.
Why all the parentheses? First, parentheses indicate the or der of operations, as
they do in pencil-and-paper math. Since all comparisons eva luate to a zero or a
one, both /B4/B4/CP/BQ/CQ/B5/DG /DG/B4/BQ/CS/B5/B5 and /B4/CP/BQ/B4/CQ/DG /DG/B5/BQ/CS/B5make sense to C. You probably
meant the ﬁrst, but unless you have the order-of-operations table memorized, you
won’tbesurewhichofthe two Cthinksyoumeanby /B4/CP/BQ/CQ/DG /DG/BQ/CS/B5.6
Second, the primary use of these conditionals is in ﬂow contr ol: causing the pro-
gramtorepeatsomelineswhileaconditionistrue,orexecut esomelinesonlyifa
condition is false. In all of the cases below, you will need pa rentheses around the
conditions,andifyouforget, youwill getaconfusingcompi lererror.
IF-ELSE STATEMENTS Hereisafragmentofcode(whichwillnotcompilebyitself)
showingthesyntaxforconditionalevaluations:
1if(a > 0)
2 {b= sqrt(a); }
3else
4 {b= 0; }
If /CPis positive, then /CQwill be given the value of /CP’s square root; if /CPis zero or
negative,then /CQis giventhe valuezero.
• Theconditiontobeevaluatedisalwaysinparenthesesfoll owingthe /CX/CUstatement,
and there should be curly braces around the part that will be e valuated when the
6The order-of-operations table is available online, but you are encouraged to not look it up. [If you must, try/D1/CP/D2 /D3/D4/CT/D6/CP/D8/D3/D6 from the command prompt]. Most people remember only the basi cs like how multiplication and
division comebefore addition and subtraction; ifyourely o ntheorder-of-operations tableforany other ordering,
then you will merely besending future readers (perhaps your self) to check thetable.
gsl_stats March24,2009
22 CHAPTER 2
condition is true, and around the part that will be evaluated when the condition is
false.
• You can exclude the curly braces on lines two and four if they surround exactly
one line, but this will at some point confuse you and cause you to regret leaving
themout.
• You can excludethe /CT/D0/D7/CTpart on lines three and four if you don’t need it (which
iscommon,andmuchlesslikely to causetrouble).
• The /CX/CUstatement and the line following it are smaller parts of one l arger ex-
pression, so there is no semicolon between the /CX/CU/B4/BA/BA/BA/B5 clause and what hap-
pens should it be true; similarly with the /CT/D0/D7/CTclause. If you do put a semicolon
after an /CX/CUstatement— /CX/CU /B4/CP> /BC/B5/BN—then your /CX/CUstatement will execute the
null statement— /BB/B6/CS/D3 /D2/D3/D8/CW/CX/D2/CV/B6/BB/BN —when /CP /BQ /BC. Your compiler will warn you
ofthis.
Q2.2Modify /CW/CT/D0/D0/D3/CN/DB/D3/D6/D0/CS/BA to print its greeting if the expression/B4/BD /DG /DG /BC /B2/B2 /BC/B5is true, and print a different message of your choos-
ingifitisfalse.DidCthinkyoumeant /B4/B4/BD /DG /DG /BC/B5 /B2/B2 /BC/B5(whichevaluates
to0)or /B4/BD /DG /DG /B4/BC /B2/B2 /BC/B5/B5(which evaluatesto 1)?
LOOPSListing 2.1showsthreetypesofloop,whichareslightly red undant.
1#include <stdio.h>
2intmain(){
3inti = 0;
4while(i < 5){
5 printf("Hello.\n");
6 i++;
7 }
8
9for(i=0; i < 5;i++){
10 printf("Hi.\n");
11 }
12
13 i= 0;
14 do{
15 printf("Hello.\n");
16 i++;
17 } while(i< 5);
18
19 return0;
20 }
Listing2.1 C provides three types of loop: the /DB/CW/CX/D0/CTloop, the /CU/D3/D6loop, and the /CS/D3/B9/DB/CW/CX/D0/CT loop.
Online source: /CU/D0/D3/DB/BA.
gsl_stats March24,2009
C 23
The simplest is a /DB/CW/CX/D0/CTloop. The interpretation is rather straightforward: while
the expressionin parentheseson line four is true (mustn’t f orget the parentheses),
executetheinstructionsin brackets,lines ﬁveandsix.
Loopsbasedon a counter( i= 0,i= 1,i= 2, ...)are so commonthat they get
theirownsyntax,the /CU/D3/D6loop.The /CU/D3/D6loopinlines9–11isexactlyequivalentto
the /DB/CW/CX/D0/CTloopinlines3–7,butgathersalltheinstructionsaboutinc rementingthe
counterontoasingleline.
Youcancomparethe /CU/D3/D6and /DB/CW/CX/D0/CTlooptoseewhenthethreesubelementsinthe
parenthesesareevaluated:theﬁrstpart( /CX/BP/BC)isevaluatedbeforetheloopruns;the
secondpart ( /CX/BO/BH) is tested at the beginningof each iteration of the loop; the third
part ( /CX/B7/B7) is evaluated at the end of each loop. After the section on arr ays, you
will be very used to the /CU/D3/D6 /B4/CX/BP/BC/BN /CX/BO/D0/CX/D1/CX/D8/BN /CX/B7/B7/B5form, and will recognize it
tomeanstepthroughthearray .Theremayevenbeawaytogetyourtexteditorto
producethis form with oneortwo keystrokes.
Finally, if you want to guarantee that the loop will run at lea st once, you can use
a /CS/D3/B9/DB/CW/CX/D0/CT loop (with a semicolon at the end of the /DB/CW/CX/D0/CTline to conclude the
thought). The /CS/D3/B9/DB/CW/CX/D0/CT loop in Listing 2.1 is equivalent to the /DB/CW/CX/D0/CTand /CU/D3/D6
loops.But saythatyou wantto iteratively evaluatea functi onuntil it convergesto
within 1×10−3. Naturally, you would wantto run the function at leastonce. The
form would besomethinglike:
do{
error =evaluate_function();
}while(error> 1e−3);
Example: the birthday paradox Thebirthdayparadoxisastapleofundergraduate
statisticsclasses.7Theprofessorwritesdownthe
birth date of every student in the class, and ﬁnds that even th ough there is a 1 in
365 chance that any given pair of students have the same birth day, the odds are
goodthatthere isa matchin theclassoverall.
Listing 2.2 shows code to ﬁnd the likelihood that another stu dent shares the ﬁrst
person’sbirthday,andthelikelihood thatanytwo students sharea birthday.
• Most of the world’s programs never need to take a square root , so functions like/D4/D3/DBand /D7/D5/D6/D8are not included in the standard C library. They are in the sep arate
math library, which you must refer to on the command line. Thu s, compile the
programwith
7Iteven mystiﬁes TVtalk show hosts,according to Paulos (198 8, p 36).
gsl_stats March24,2009
24 CHAPTER 2
1#include <math.h>
2#include <stdio.h>
3
4intmain(){
5doubleno_match = 1;
6doublematches_me;
7intct;
8 printf("People\t Matches me\t Anymatch\n");
9for(ct=2; ct<=40; ct ++){
10 matches_me = 1 −pow(364/365., ct−1);
11 no_match *= (1−(ct−1)/365.);
12 printf("%i\t %.3f\t\t %.3f\n", ct,matches_me,(1 −no_match));
13 }
14 return0;
15 }
Listing2.2 Print the odds that other students share my birth day, and that any two students in the
room share a birthday. Online source: /CQ/CX/D6/D8/CW/CS/CP/DD/BA .
gcc birthday.c−lm−obirthday
where /B9/D0/D1indicatesthemathlibraryand /B9/D3indicatesthattheoutputprogramwill
benamed /CQ/CX/D6/D8/CW/CS/CP/DD (ratherthanthedefault /CP/BA/D3/D9/D8).Moreonlinkingandlibraries
will follow below.
• Lines 1–7 are introductory material, to be discussed below , including a preface/AZ/CX/D2/D0/D9/CS/CT -ing a few external ﬁles, and a list of the dramatis personæ: v ariables
named /D2/D3/CN/D1/CP/D8/CW , /D1/CP/D8/CW/CT/D7/CN/D1/CT ,and /D8.
• Line 8 prints a header line labeling the columns of numbers t he /CU/D3/D6loop will be
producing; it is easy to read once you know that \ /D8meansprint a tab and\ /D2
meansnewline.
• Line9tellsusthatthecounter /D8willstartattwo,andcountupuntilitreaches40.
• As for the math itself, it is easier to calculate the complem ent—the odds that no-
body shares a birthday. The odds that one person does not shar e the ﬁrst person’s
birthday is 364/365; the odds that two people both do not share the ﬁrst person’s
birthdayis (364/365)2,etcetera.8Thus,theoddsthatamong /D8/B9/BDadditionalpeo-
ple,nonehavethesamebirthdayastheﬁrstpersonis 1−(364/365)ct−1.Youcan
seethis calculationonline ten.
• Asabove,theoddsthatthesecondpersondoesnotsharetheﬁ rstperson’sbirthday
is/parenleftbig364
365/parenrightbig. The odds that an additional person shares no birthday with t he ﬁrst two
given that the ﬁrst two do not share a birthday is/parenleftbig363
365/parenrightbig
, so the odds that the ﬁrst
8We assume away leap years, and the fact that the odds of being b orn on any given day are not exactly
1/365—more children are born in the summer.
gsl_stats March24,2009
C 25
threedonotshareabirthdayis
/parenleftbigg364
365/parenrightbigg/parenleftbigg363
365/parenrightbigg
. (2.1.1)
Thisexpressionisbestproducedincrementally.Intheintr oductorymaterial, /D2/D3/CN/B9/D1/CP/D8/CWwasinitializedat1,andonline11,anotherelementofthese quenceheaded
byExpression2.1.1getsmultiplied into /D2/D3/CN/D1/CP/D8/CW ateachstepofthe /CU/D3/D6loop.
• Line 12 prints the results.The ﬁrst inputto the /D4/D6/CX/D2/D8/CUfunction will be discussed
in detail below, but the next inputs indicate what is to be pri nted: the counter,/D1/CP/D8/CW/CT/D7/CN/D1/CT ,and /BD/B9/B4/D2/D3/CN/D1/CP/D8/CW/B5 .
Q2.3Modify the /CU/D3/D6loopto verify thattheprogramprints the correctvaluesfor
aclassofonestudent.
COMMENTS Put a long block of comments at the head of a ﬁle and at the head o f
eachfunctiontodescribewhattheﬁleorfunctiondoes,usin gcomplete
sentences. Describe what the function expects to come in, an d what the function
will put out. The common wisdom indicates that these comment s should focus
on why your code is doing what it is doing, rather than how, whi ch will be self-
explanatoryinclearly-written code.9
The primary audience of your comment should be you, six month s from now.
When you are shopping for black boxes to plug in to your next pr oject, or re-
auditingyourdataafterthe referee ﬁnallygotthepaperbac kto you,anote to self
attheheadofeachfunction will payimmensedividends.
/*Longcomments begin withaslash −star,
continue as long as youwant,and end
at the ﬁrst star−slash.
*/
The stars and slashes are also useful for commenting out code. If you would like
to temporarily remove a few lines from your program to see wha t would happen,
but don’t want to delete them entirely, simply put a /BB/B6and a /B6/BBaround the code,
andthecompilerwillthink it isa commentandignoreit.
However,there is a slight problem with this approach:what i f there is a comment
inwhatyouhadjustcommentedout?Youwouldhaveasequencel ikethisinyour
code:
9Thesamplecode for this book attempts to bean example ofgood code in mostrespects, butithas much less
documentation than real-world code should have, because th is book is thedocumentation.
gsl_stats March24,2009
26 CHAPTER 2
/*LineA;
/*LineB*/
Line C;
*/
We had hoped that all three lines would be commented out now, b ut the compiler
will ignore everything from the ﬁrst /BB/B6until it sees the ﬁrst /B6/BB. That means Line
A andLineB will beignored,but
LineC;
*/
will bereadascode—andmalformed codeatthat.10
You will always need to watch out for this when commenting out large blocks of
code.Butforsmallblocks,thereisanothersyntaxforcomme ntingindividuallines
ofcodethatdeserveanote.
this_is_code; //Everythingon aline
//after twoslashes
//willbe ignored.
Later, we will meet the preprocessor, which modiﬁes the prog ram’s text before
compilation. It provides another solution for commenting o ut large blocks that
mayhavecommentsembedded.Thecompilerwillseenoneofthe followingcode,
because the preprocessor will skip everything between the /AZ/CX/CUstatement which
evaluatesto zeroandthe /AZ/CT/D2/CS/CX/CU:
#if0
/*This functiondoes nothing. */
voiddo_nothing(){ }
#endif
PRINTING C prints to anything—the screen, a string of text in memory, a ﬁle—
using the same syntax. The formatting works much like the Mad Libs
party game (Price & Stern, 1988). First, there is a format spe ciﬁer, showing what
theoutputwill be,butwith blanksto beﬁlled in:
10Q:IfCdidn’thavethisquirk,andallowed commentsinsidecom ments,whatdifferentquirkwouldyouhave
to watch outfor instead?
gsl_stats March24,2009
C 27
My is very .
noun adjective
Then,theuserprovidesaspeciﬁcinstanceofthenounandadj ectiveto beﬁlled in
(which in this caseis left asan exercisefor the reader).Sin ceC is a programming
languageandnotaparty game,thesyntaxis alittle moreters e.Insteadof
isnumber in line./D7/D8/D6/CX/D2/CV /CX/D2/D8/D4/D6/CX/D2/D8/CUuses:
%sis number%iin line.
Hereis acompleteexample:
1#include <stdio.h>
2
3intmain(){
4intposition= 3;
5charname[]= "Steven";
6 printf("%s is number %iinline\n",name,position);
7return0;
8 }
The /D4/D6/CX/D2/D8/CUfunction is not actually deﬁned by default—its deﬁnition in the stan-
dard input/output headermust be /AZ/CX/D2/D0/D9/CS/CT d, which is what line one does. Lines
four and ﬁve are variable declarations, deﬁning the types of the variables; these
linesforeshadowthenextsection.
Finally,linesixistheactualprintstatement,whichwilli nsert /CB/D8/CT/DA/CT/D2intotheﬁrst
placeholder ( /B1/D7), and insert /BFinto the second placeholder ( /B1/CX). It will thus print/CB/D8/CT/DA/CT/D2 /CX/D7 /D2/D9/D1/CQ/CT/D6 /BF /CX/D2 /D0/CX/D2/CT(plus aninvisiblenewline).
Hereare theoddcharactersyouwill needforalmostall ofyou rwork./B1/CXinsertanintegerhere/B1/CVinsertarealnumberingeneralformathere/B1/D7insertastring oftexthere/B1/B1aplain percentsign
\ /D2begina newline
\ /D8tab
\ Ꜽaquotethatwon’tendthetextstring
\(newline) continuethe textstring onthe nextline
gsl_stats March24,2009
28 CHAPTER 2
Therearemanymoreformatspeciﬁers,whichwillgiveyouagr eatdealofcontrol;
you may want them when printing tables, for example, and can r efer to any of a
numberof detailed referenceswhen you needthese, such as /D1/CP/D2 /BF /D4/D6/CX/D2/D8/CUfrom
yourcommandline.
At this point, you may want to ﬂip through this book to ﬁnd a few examples of/D4/D6/CX/D2/D8/CUandverify thattheywill indeedprint whattheypromiseto.
®Assignmentusesasingleequalssign: /CP/D7/D7/CX/CV/D2/CT/CT /BP /DA/CP/D0/D9/CT/BN.
®Theusualarithmetic works: /D8/CT/D2 /BP /BE/B6/BF/B7/BK/BB/BE/BN .
®Conditions such as /B4/CP /BQ /CQ/B5, /B4/CP /BO/BP /CQ/B5, and /B4/CP /BP/BP /CQ/B5(two equals
signs)canbeusedto controlﬂow.
®Conditional ﬂow uses the form: /CX/CU /B4/D3/D2/CS/CX/D8/CX/D3/D2/B5 /DF/CS/D3/CN/CX/CU/CN/D8/D6/D9/CT/BN/DH/CT/D0/D7/CT /DF/CS/D3/CN/CX/CU/CN/CU/CP/D0/D7/CT/BN/DH .
®The basic loop is a /DB/CW/CX/D0/CTloop: /DB/CW/CX/D0/CT /B4/D8/CW/CX/D7/CN/CX/D7/CN/D8/D6/D9/CT/B5 /DF/CS/D3/CN/B9/D8/CW/CX/D7/BN/DH.
®When iterating through an array, a /CU/D3/D6loop makes the iteration
clearer: /CU/D3/D6 /B4/CY/BP/BC/BN /CY/BO /D0/CX/D1/CX/D8/BN /CY/B7/B7/B5 /DF/D4/D6/CX/D2/D8/CU/B4Ꜽ/D4/D6/D3/CT/D7/D7/CX/D2/CV/CX/D8/CT/D1 /B1/CX\ /D2Ꜽ/B8 /CY/B5/BN/DH.
®Write commentsforyourfuture self.
2.2 V ARIABLES AND THEIR
DECLARATIONSHavingcoveredtheverbsthatalineofcodewill
execute,we moveonto thenouns—variables.
You would never use xorzin a paper without ﬁrst declaring, say, ‘let x∈R2
andz∈C’. You could leave the reader to guess at what you mean by xby its
ﬁrst use, but some readers would misunderstand, and your ref eree would wonder
whyyoudidnotjustcomeoutanddeclare x.Cisastrictreferee,andrequiresthat
you declare the type of every variable before using it. The de claration consists of
listing thetypeofthe variableandthenthe variablename,e .g.
inta_variable, counter=0;
doublestuff;
• Thissnippetdeclaredthreevariablesin two lines.
• Wecouldinitialize /D3/D9/D2/D8/CT/D6 to zeroasitis declared.
gsl_stats March24,2009
C 29
• The other variables (such as /CP/CN/DA/CP/D6/CX/CP/CQ/D0/CT ) have unknown values right now. As-
sumenothingaboutwhatiscontainedin adeclaredbutuninit ialized value.11
• Since the ﬁrst step in using a variable is typically an assig nment, and you can
declare and initialize on the same line, the burden of declar ing types basically
means putting a type at the head of the ﬁrst line where the vari able is used, as on
linesfourandﬁveofthesamplecodeonpage27.
Hereis acomprehensivelist oftheusefulbasictypesfor C./CX/D2/D8aninteger:−1,0,3/CS/D3/D9/CQ/D0/CT arealnumber: 2.4,−1.3e8,27/CW/CP/D6acharacter:‘a’, ‘b’, ‘C’
An /CX/D2/D8can only count to about 232≈4.3billion; you may have a simulation
thatinvolvesﬁvebillionagentsorothersuchusesforcount ingintothetrillions, in
whichcaseyoucanusethe /D0/D3/D2/CV /CX/D2/D8type.12
There are ways to extend or shrink the size of the numbers, whi ch are basically
not worth caring about. A /CS/D3/D9/CQ/D0/CTcounts up to about ±1e308, which is already
signiﬁcantlymore than common estimatesof the numberofato ms in the universe
(circa 1e80), but there is a /D0/D3/D2/CV /CS/D3/D9/CQ/D0/CTtype in caseyou needmore precision or
size.13Section4.5offers detailednotesabouthownumbersare repr esented.
Finally, notice that the variable names used throughout are words, not letters.14
Using English variable names is the number one best thing you could do to make
your code readable. Imagine how much of your life you have spe nt ﬂipping back
through journal articles trying to remember what µ,M, andmstood for. Why
imposethaton yourself?
11Iamreluctanttomentionthis,butlateryouwillseethedist inction betweenglobal,static,andlocalvariables.
Global and static variables are automatically initialized to zero (or /C6/CD/C4/C4), while local variables are not. But you
will suffer fewer painful debugging sessions if you ignore t his fact and get into the habit of explicitly initializing
everything that needs initialization.
12The /CX/D2/D8type on most 64-bit systems is still 32 bits. Though this norm will no doubt change in the future,
the safebet is to write code under the assumption that an /CX/D2/D8counts to 232.
13The /CS/D3/D9/CQ/D0/CTname is short for “double-precision ﬂoating-point number, ” and the /CU/D0/D3/CP/D8thus has half the
precision and range of a /CS/D3/D9/CQ/D0/CT. Whyﬂoating point ? The computer represents a real using a form comparable
to scientiﬁc notation: n×10k, where nrepresents the number with the decimal point in a ﬁxed locati on, and k
represents the location of the decimal point. Multiplying b y ten doesn’t change the number n, it just causes the
decimal point to ﬂoat to adifferent position.
The /CU/D0/D3/CP/D8type is especially not worth bothering with because the GSL’ s matrices and vectors default to
holding /CS/D3/D9/CQ/D0/CTs, and C’sﬂoating-point functions internally operate ondo ubles. For example, the /CP/D8/D3/CUfunction
(ASCII text to ﬂoating-point number) actually returns a /CS/D3/D9/CQ/D0/CT.
14Theexception areindices for counters and /CU/D3/D6loops, which arealmost always /CX, /CY, or /CZ.
gsl_stats March24,2009
30 CHAPTER 2
Arrays Much ofthe art of describingthe realworld consistsof build ing aggregates
of these few basic types into larger structures. The simples t such aggregate
is anarray,which is simply a numberedlist of items ofthe sametype. To d eclare
alist ofahundredintegers,youwoulduse:
inta_list[100];
Then,to referto theitemsofthelist, youwouldusethesames quarebrack-
ets. For example, to assign the value seven to the last elemen t of the array,
youwould use: /CP/CN/D0/CX/D7/D8/CJ/BL/BL℄/BP /BJ/BN. Whyis99the lastelementofthelist? Because
the index is an offsetfrom the ﬁrst element. The ﬁrst element is zero items away
fromitself,soitis /CP/CN/D0/CX/D7/D8/CJ/BC℄ ,not /CP/CN/D0/CX/D7/D8/CJ/BD℄ (whichisthesecondelement).The
reasoningbehindthis systemwill becomeevidentinthe sect ionon pointers.
2-D arrayssimplyrequire more indices— /CX/D2/D8 /CP/CN/BE/CS/CN/D0/CX/D7/D8/CJ/BD/BC/BC℄/CJ/BD/BC/BC℄ .Butthere
are details in implementation that make 2-D arrays difﬁcult to use in practice;
Chapter 4 will introduce the /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC , which provides many advantages over
theraw 2-Darray.
Justas you can initialize a scalarwith a value at declaratio n, you can do the same
with anarray,e.g.:
doubledata[] = {2,4,8,16,32,64};
You do not have to bother counting how many elements the array has; C is smart
enoughto dothis for you.
Q2.4Write a program to create an array of 100 integers, and then ﬁl l the array
with the squares (so /D8/CW/CT/CN/CP/D6/D6/CP/DD/CJ/BJ℄ will hold 49). Then, print a message
like “7 squared is 49.” for each element of the array. Use the H ello World
programasatemplatefrom whichto start.
Q2.5The ﬁrst element of the Fibonacci sequence is deﬁned to be 0, t he second
is deﬁned to be 1, and then element nis deﬁned to be the sum of elements
n−1andn−2. Thus,thethird elementis 0+1=1,the fourth is1+1=2,the
ﬁfth is1+2=3,then2+3=5,then3+5=8,etcetera.
Theratioofthe nthelementoverthe (n−1)stelementconvergestoavalue
knownasthegoldenratio.
Demonstratethis convergenceby producing a table of the ﬁrs t 20 elements
ofthesequenceandtheratioofthe nthoverthe (n−1)stelementforeach
n.
gsl_stats March24,2009
C 31
DECLARING TYPES You can deﬁne your own types. For example, these lines will
ﬁrst declare a new type, /D8/D6/CX/D4/D0/CT/D8, and then declare two such
triplets, /D8/D6/CX/BDand /D8/D6/CX/BE:
typedefdoubletriplet [3];
triplettri1,tri2;
This is primarily useful for designing complex data types th at are collections of
manysubelements,in conjunctionwith the /D7/D8/D6/D9/D8keyword. Forexample:
typedefstruct {
doublereal;
doubleimaginary;
}complex;
complex a,b;
Younowhavetwo variablesoftype /D3/D1/D4/D0/CT/DC andcannowuse /CP/BA/D6/CT/CP/D0or /CQ/BA/CX/D1/CP/B9/CV/CX/D2/CP/D6/DDto referto theappropriateconstituentsofthesecomplexnu mbers.
Listing 2.3 repeats the birthday example, but stores each cl ass size’s data in a/D7/D8/D6/D9/D8.
• Lines 4–7 deﬁne the structure: it will hold one variable ind icating the probabil-
ity of somebody matching the ﬁrst person’s birthday, and one variable giving the
probability thatno twopeoplesharea birthday.
• Those lines only deﬁned a type; line 11 declares a variable, /CS/CP/DD/D7, which will be
of this type. Since there is a number in brackets after the nam e, this is an array of/CQ/CS/CP/DD/CN/D7/D8/D6/D9/D8 s.
• In line 12,the /D2/D3/D2/CT/CN/D1/CP/D8/CW elementof /CS/CP/DD/D7/CJ/BD℄ is givena value.Lines 14and15
assign values to the elements of /CS/CP/DD/D7/CJ/BE℄ through /CS/CP/DD/D7/CJ/BG/BC℄ . Having calculated
the values and stored them in an organized manner, it is easy f or lines 18–20 to
printthe values.
Initializing As with an array, you can initialize most or all of the element s of a
struct to a value on the declaration line. The ﬁrst option, co mparable to
the array syntax above, is to remember the order of the /D7/D8/D6/D9/D8’s elements and
maketheassignmentsin thatorder.Forexample,
complex one = {1, 0};
complex pioverfour = {1, 1};
gsl_stats March24,2009
32 CHAPTER 2
1#include <math.h>
2#include <stdio.h>
3
4typedefstruct {
5doubleone_match;
6doublenone_match;
7 }bday_struct ;
8
9intmain(){
10intct,upto = 40;
11bday_struct days[upto+1];
12 days[1].none_match = 1;
13 for(ct=2; ct<=upto;ct ++){
14 days[ct].one_match = 1 −pow(364/365., ct−1);
15 days[ct].none_match = days[ct −1].none_match *(1−(ct−1)/365.);
16 }
17 printf("People\t Matches me\t Anymatch\n");
18 for(ct=2; ct<=upto;ct ++){
19 printf("%i\t %.3f\t\t %.3f\n", ct,days[ct].one_match , 1−days[ct].none_match);
20 }
21 return0;
22 }
Listing2.3 The birthday example (Listing 2.2) rewritten us ing a /D7/D8/D6/D9/D8to hold each day’s data.
Online source: /CQ/CS/CP/DD/D7/D8/D6/D9/D8/BA .
would initialize /D3/D2/CTto1 + 0iand /D4/CX/D3/DA/CT/D6/CU/D3/D9/D6 to1 + 1i. This is probably the
bestwaytoinitializea /D7/D8/D6/D9/D8wheretherearefewelementsandtheyhaveawell-
knownorder.
Theotheroptionistouse designatedinitializers , whicharebestdeﬁnedbyexam-
ple.Theabovetwo initializations areequivalentto:
complex one ={.real =1};
complex pioverfour = {.imaginary = 1,.real = 1};
In the ﬁrst case, the imaginary part is not given, so it is init ialized to zero. In
thesecondcase,theelementsareoutoforder,whichisnotap roblem.Designated
initializerswillprovetobeinvaluablewhendealingwiths tructureslikethe /CP/D4/D3/D4/CN/B9/D1/D3/CS/CT/D0,whichhasalarge numberofelementsin noparticularorder.
Two ﬁnal notes on designated initializers. They can also be u sed for arrays, and
theycanbeinterspersedwith unlabeledelements.Theline
intisprime[] ={[1]=1, 1, 1, [5]=1, [7]=1, [11]=1};
gsl_stats March24,2009
C 33
initializes an array from zero to eleven (the length is deter mined by the last ini-
tialized element), settingthe elementswhoseindexis a pri me numberto one.The
twooneswithnolabelwillgointothe2and3slot,becausethe irindexwillfollow
sequentiallyafterthe lastindexgiven.
Structs are syntactically simple, so there is little to say a bout them, but much of
good programming goes in to designing structs that make sens e and are a good
reﬂection of reality. This book will be ﬁlled with them, incl uding both purpose-
built structures like the /CQ/CS/CP/DD/CN/D7/D8/D6/D9/D8 and structures deﬁned by libraries like the
GSL,suchasthe /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC mentionedabove./F4TYPE CASTING There are a few minor complications when assigning a value of
one type to a variable of a different type. When you assign a/CS/D3/D9/CQ/D0/CTvalue to an integer, such as /CX/D2/D8 /CX /BP /BF/BA/BE, everything after the decimal
point would be dropped. Also, the range of /CU/D0/D3/CP/D8s, /CS/D3/D9/CQ/D0/CTs, and /CX/D2/D8s do not
necessarily match, so you may get unpredictable results wit h large numbers even
whenthereis nothingafterthedecimalpoint.
If you are conﬁdentthat you want to assigna variable of one ty pe to a variable of
another,thenyoucandosobyputtingthetypetore-castinto inparenthesesbefore
the variable name. For example, if /D6/CP/D8/CX/D3is a /CS/D3/D9/CQ/D0/CT, /B4/CX/D2/D8/B5 /D6/CP/D8/CX/D3will cast it
to an integer. If you want to accept the truncation and assign a ﬂoating-point real
toaninteger,say /CX/D2/D8 /D2,thenexplicitlytell thecompilerthatyoumeanttodothis
bymakingthecastyourself;e.g., /D2 /BP /B4/CX/D2/D8/B5 /D6/CP/D8/CX/D3/BN.
Type casting solves the division-by-integers problem from the head of this chap-
ter. If /D2/D9/D1and /CS/CT/D2are both /CX/D2/D8s, then /D6/CP/D8/CX/D3 /BP /B4/CS/D3/D9/CQ/D0/CT/B5 /D2/D9/D1 /BB /CS/CT/D2does the
divisionofarealbyaninteger,whichwill producea realnum berasexpected.
There are two otherways of getting the sameeffect: /B4/D2/D9/D1 /B7 /BC/BA/BC/B5is an /CX/D2/D8plus
a /CS/D3/D9/CQ/D0/CT, which is a /CS/D3/D9/CQ/D0/CT. Then /B4/D2/D9/D1 /B7 /BC/BA/BC/B5/BB/CS/CT/D2 is division of a real by an
integer,whichagainworksasexpected(butdon’tforgetthe parens).Andasabove,
if one of the numbers is a constant, then just add a decimal poi nt, because /BEis an/CX/D2/D8, while /BE/BAis aﬂoating-pointrealnumber.
Finally, note that when casting from /CS/D3/D9/CQ/D0/CTto /CX/D2/D8, numbers are truncated, not
rounded. As a lead-in to the discussion of functions, here is a function that uses
typecastingtocorrectly roundoffnumbers:15
15Intherealworld,use /D6/CX/D2/D8(in /D1/CP/D8/CW/BA/CW)toroundtointeger: /D6/D3/D9/D2/CS/CT/CS/CN/DA/CP/D0 /BP /D6/CX/D2/D8/B4 /D9/D2/D6/D3/D9/D2/CS/CT/CS/CN/D2/D9/D1/CQ/CT/D6 /B5.
gsl_stats March24,2009
34 CHAPTER 2
intround(doubleunrounded){
/*Input areal number andoutput the number
rounded tothe nearest integer. */
if(unrounded > 0)
return(int) (unrounded + 0.5);
else
return(int) (unrounded−0.5);
}
®Allvariablesmustbedeclaredbeforethe ﬁrstuse.
®Untila variableisgivena value,youknownothingaboutits v alue.
®Youcanassignaninitial valueto thevariableonthe declara tionline,
suchas /CX/D2/D8 /CX /BP /BF/BN.
®Arrays are simply declared by including a size in brackets af ter the
variable name: /CX/D2/D8 /CP/D6/D6/CP/DD/CJ/BD/BC/BC℄/BN . Refer to the elements using an
offset, sotheﬁrstelementis /CP/D6/D6/CP/DD/CJ/BC℄ andthe lastis /CP/D6/D6/CP/DD/CJ/BL/BL℄ .
®You can declare new types, including structures that amalga mate
simpler types: /D8/DD/D4/CT/CS/CT/CU /D7/D8/D6/D9/D8 /DF/CS/D3/D9/CQ/D0/CT /D0/CT/D2/CV/D8/CW/B8 /DB/CP/CX/D7/D8/BN /CX/D2/D8/D0/CT/CV/CN/D8/BN/DH /D4/CP/D2/D8/D7/BN.
®After declaring a variable as a structure, say /D4/CP/D2/D8/D7 /D9/D8/D3/CU/CU/D7/BN , refer
to structureelementsusinga dot: /D9/D8/D3/CU/CU/D7/BA/D0/CT/CV/CN/D8 /BP /BD/BN.
®Anintegerdividedbyanintegerisaninteger: /BL/BB/BG /BP/BP /BE.Byputting
a decimal after a whole number, it becomes a real number, and d ivi-
sionworksasexpected: /BL/BA/BB/BG /BP/BP /BE/BA/BE/BH.
2.3 F UNCTIONS Theinstruction taketheinverseofthematrix issixwordslong,
but refers to a sequenceof steps that typically require seve ral
pagestofully describe.
Likemanyﬁelds,mathematicsprogressesthroughthedevelo pmentofnewvocab-
ulary like the phrase take the inverse . We can comprehensibly express a complex
statement like the variance is σ2(X′X)−1because we didn’t need to write out
exactlyhowto doasquaring,a transposition (X′)andaninverse.
Similarly, most of the process of writing code is not about de scribing the pro-
cedures involved, but building a specialized vocabulary to make describing the
gsl_stats March24,2009
C 35
procedurestrivial.Addingnewnounstothevocabularyisas impletask,discussed
aboveusingbothbasicnounsand /D7/D8/D6/D9/D8sthataggregatethemtolargerconcepts.
Thissectioncoversfunctions,whicharesingleverbsthate ncapsulatealargerpro-
cedure.
1#include <math.h>
2#include <stdio.h>
3
4typedefstruct {
5doubleone_match;
6doublenone_match;
7 }bday_struct ;
8
9intupto =40;
10voidcalculate_days( bday_struct days[]);
11voidprint_days( bday_struct days[]);
12
13intmain(){
14 bday_struct days[upto+1];
15 calculate_days(days);
16 print_days(days);
17 return0;
18 }
19
20voidcalculate_days( bday_struct days[]){
21intct;
22 days[1].none_match = 1;
23 for(ct=2; ct<=upto;ct ++){
24 days[ct].one_match = 1 −pow(364/365., ct−1);
25 days[ct].none_match =days[ct −1].none_match *(1−(ct−1)/365.);
26 }
27 }
28
29voidprint_days( bday_struct days[]){
30intct;
31 printf("People\t Matches me\tAnymatch\n");
32 for(ct=2; ct<=upto;ct ++){
33 printf("%i\t %.3f\t\t %.3f\n",ct,days[ct].one_match , 1−days[ct].none_match);
34 }
35 }
Listing2.4 The birthday example broken intological functi ons. Online source: /CQ/CS/CP/DD/CU/D2/D7/BA .
Thesecondbirthdayexample,Listing2.3canbehardtoread, withitsmessofmul-
tiple /CU/D3/D6loops. Listing 2.4 re-presents the program using one functi on to do the
math and one to print the output. The /D1/CP/CX/D2function (lines 13–18) now describes
the procedurewith greatclarity:declarean array of /CQ/CS/CP/DD/CN/D7/D8/D6/D9/D8 s,calculateval-
uesforthedays,printthevalues,andexit.Thefunctionsto which /D1/CP/CX/D2refers—on
lines20–27and29–35—areshort,andsoareeasiertoreadtha nthelongstring of
gsl_stats March24,2009
36 CHAPTER 2
codeinListing2.3.Simplyput,thefunctionsprovidestruc turetowhathadbeena
relativelyunstructuredmess.
Structure takes up space—you can see that this listing is mor e lines of code than
theunstructuredversion.Butconsidertheformatoftheboo kyouarereadingright
now: it uses such stylistic features as paragraphs, chapter headings, and indenta-
tion, even though they take up space. Brevity is a good thing, which means that
it is typically worth the effort to minimize redundancy and s earch for simple and
briefalgorithms.Butbrevityshouldnevercomeatthecosto fclarity.Byeliminat-
ing intermediate variables and not using subfunctions, you can sometimes reduce
an entire program into a single line of code, but that one-lin er may be virtually
impossible to debug, modify, or simply understand. No trees have to be killed to
add a few lines of white space or a few function headers to your on-screen code,
and the additional structure will save you time when dealing with your code later
on.
Functional form Have a look at the function headers—the ﬁrst line of each func -
tion, on lines 13, 20 and 29. In parens are the inputs to the fun c-
tion (aka the arguments ),andthey looklike the familiar declarationsfrom before.
The /D1/CP/CX/D2functiontakesnoarguments,whileyouwillseethatmanyfun ctionstake
severalarguments,inwhichcasetheargumentdeclarations areacomma-separated
list.
Orconsiderthe functiondeclarationfor the /D6/D3/D9/D2/CSfunctionabove:
intround (doubleunrounded)
If we ignore the argument list in parens, /CX/D2/D8 /D6/D3/D9/D2/CSlooks like a declaration as
well—and it is. It indicates that this function will return a n integer value, that can
beusedanywherewe needan integer. Forexample,you couldas signthe function
outputto avariable,via /CX/D2/D8 /CT/CX/CV/CW/D8 /BP /D6/D3/D9/D2/CS/B4/BK/BA/BF/B5 .
Declaring a function You can declare the existence of a function separately from
the function itself, as per lines 10 and 11 of Listing 2.3. The/D1/CP/CX/D2functionthushasanideaofwhattoexpectwhenitcomesacros sthesefunc-
tions on lines 15 and 16, even though the functions themselve s appear later. You
will see below that the compiler gets immense mileage out of t he declaration of
functions,becauseitcancompile /D1/CP/CX/D2knowingonlywhattheotherfunctionstake
in andreturn, leavingtheinnerworkingsasablackbox./F4The /DA/D3/CX/CStypeIf a function returns nothing, declareit as type /DA/D3/CX/CS. Such func-
tions will be useful for side effects such as changing the val ues
of the inputs (like /CP/D0/D9/D0/CP/D8/CT/CN/CS/CP/DD/D7 ) or printing data to the screen or an external
gsl_stats March24,2009
C 37
ﬁle (like /D4/D6/CX/D2/D8/CN/CS/CP/DD/D7 ). You can also have functions which take no inputs, so any
ofthefollowing arevalid declarationsforfunctions:
voiddo_something( doublea);
doubledo_something_else( void);
doubledo_something_else();
Thelasttwoareequivalent,butyoucan’tforgettheparenth esesentirely—thenthe
compilerwould thinkyouaredeclaringavariableinsteadof afunction.
Q2.6Write a function with header /DA/D3/CX/CS /D4/D6/CX/D2/D8/CN/CP/D6/D6/CP/DD/B4/CX/D2/D8 /CX/D2/CN/CP/D6/D6/CP/DD/CJ ℄/B8/CX/D2/D8 /CP/D6/D6/CP/DD/CN/D7/CX/DE/CT/B5 that takes in an integer array and the size of the array,
and prints the array to the screen. Modify your square-print ing program
from earlierto usethisfunction foroutput.
How to write a program Givenablankscreenandaprogramtowrite,howshould
youbegin?Write anoutline,basedonfunctionheaders.
For example, in the birthday example, you could begin by writ ing the /D1/CP/CX/D2func-
tion, which describesthe broad outline of calculating prob abilities and then print-
ing to the screen. In writing the outline, you will need to wri te down the inputs,
outputs, and intent of a number of functions. Then you can beg in ﬁlling in each
function. When writing a function’s body, you can putthe res t of the program out
of your mind and focus on making sure that the black box you are working on
does exactly what it should to produce the right output. When all of the functions
correctly do their job, and the main outline is fully ﬂeshed o ut, you will have a
workingprogram.
You want your black boxes to be entirely predictable and erro r-free, and the best
way to do this is to keep them small and autonomous. Flip throu gh this book and
have a look at the structure of the longer sample programs. Yo u will notice that
few functions run for more than about ﬁfteen lines, especial ly after discounting
theintroductory materialaboutdeclaringvariablesandch eckinginputs.
FRAMES The manner in which the computer evaluatesfunctions also ab ides by the
principle of encapsulatingfunctions, focusing on the cont ext of one func-
tion at a time. When a function is called, the computer create s aframefor that
function.Intothatframeareplacedanyvariablesthatared eclaredatthetopofthe
ﬁle in which the function is deﬁned,including thosein ﬁles t hat were /AZ/CX/D2/D0/D9/CS/CT d
(seebelow);andcopiesofvariablesthatarepassedasargum ents.
The function is then run, using the variables it has in that fr ame, blithely ignorant
of the rest of the program. It does its math, making a note of th e return value it
gsl_stats March24,2009
38 CHAPTER 2
calculates (if any), and then destroys itself entirely, era sing all of the variables
created in the frame and copies of variables that had been put in to the frame.
Variables that were not passed as an argument but were put in t he frame anyway
(globalvariables ;seebelow)comeoutunscathed,asdoesthereturn value,whi ch
issentbackto thefunctionwhichhadcalledtheframe into ex istence.
1#include <stdio.h> //printf
2doubleglobe=1; //aglobal variable.
3
4doublefactorial ( inta_c){
5while(a_c){
6 globe *= a_c;
7 a_c−−;
8 }
9 returnglobe;
10 }
11
12intmain(void){
13 inta = 10;
14 printf("%i factorial is%f.\n", a,factorial(a));
15 printf("a= %i\n",a);
16 printf("globe= %f\n",globe);
17 return0;
18 }
Listing2.5 A program tocalculate factorials.Online sourc e: /CP/D0/D0/CQ/DD/DA/CP/D0/BA .
One way to think aboutthis is in terms of a stackof frames. The baseof the stack
isalwaysthefunctionnamed /D1/CP/CX/D2.Forexample,intheprograminListing2.5,the
computerat ﬁrst ignores the function /CU/CP/D8/D3/D6/CX/CP/D0 , instead starting its work at line
twelve, where it ﬁnds the /D1/CP/CX/D2function. It creates a /D1/CP/CX/D2frame and then starts
working,readingthedeclarationof /CP,andcreatingthatvariableinthe /D1/CP/CX/D2frame.
Theglobalvariabledeclaredonline twois alsoputinto the /D1/CP/CX/D2frame.
Then, on line 14, it is told to print the value of /CU/CP/D8/D3/D6/CX/CP/D0/B4/CP/B5 , which means that
it will have to evaluate that expression. This is a function call , which commands
the program to halt whateverit is doing and start working on e valuating the func-
tion /CU/CP/D8/D3/D6/CX/CP/D0 . So the system freezes the /D1/CP/CX/D2frame, generates a frame for the/CU/CP/D8/D3/D6/CX/CP/D0 function, and jumps to line four. Think of the new frame as bei ng put
on top of the ﬁrst, leaving only the topmost frame visible and active. The value
of /CP /BP /BD/BCwill becopiedinto /CP/CN, the global variable /CV/D0/D3/CQ/CTwill be put into the
frame,andthefunction doesits math andreturns thecalcula tedvalueof /CV/D0/D3/CQ/CT.16
16Why is /CV/D0/D3/CQ/CTa /CS/D3/D9/CQ/D0/CT, when the factorial is always an integer? Because the /CS/D3/D9/CQ/D0/CTuses exponential
notation when necessary, so its range is much larger than tha t of the /CX/D2/D8, which does not. You could also try
usinga /D0/D3/D2/CV /CX/D2/D8(and replacing printf’s /CX/D2/D8placeholder /B1/CXwiththe /D0/D3/D2/CV /CX/D2/D8placeholder /B1/D0/CX),buteven that
fails after about /CP/BP/BF/BD.
gsl_stats March24,2009
C 39
Having returned a value, the /CU/CP/D8/D3/D6/CX/CP/D0 frame and its contents are discarded.
Since a copy of the value /CP /BP /BD/BCwas sent into the frame, /CPstill has the value/BD/BCwhenthefunctionreturns,eventhoughthecopy /CP/CNwasdecrementedto zero.
The /D1/CP/CX/D2frame is now at the top of the stack, so it can pick up where it ha d left
off, printing the value of /CPand10!to the screen, using the calls to the /D4/D6/CX/D2/D8/CU
function—which each create their own frames in turn. Finall y, the /D1/CP/CX/D2function
ﬁnishesits work,andits frame isdestroyed,leavinganempt ystackandaﬁnished
program.
Call-by-value A commonerroris to forgetthatglobalvariablesare putin al lfunc-
tion frames, but only copiesof the variables in the function’s argu-
mentlist areputin theframe.
Whenthe /CU/CP/D8/D3/D6/CX/CP/D0 functioniscalled,thesystemputsacopyof /CPinto /CP/CN,and
thenthefunctionmodiﬁesthecopy, /CP/CN.Meanwhile, /CV/D0/D3/CQ/CTisnotacopyofitself,
but the real thing, so when it is changed inside the function, it changes globally.
Thisis whytheoutputyougotwhenyouranthe programshowed /CP/BP/BD/BC,not /CP/BP/BC.
Ontheonehand,the /CU/CP/D8/D3/D6/CX/CP/D0 functioncouldmangle /CP/CNwithoutaffectingthe
original; on the other hand, we sometimes want functions to c hange their inputs.
Thismaymakeglobalvariablestemptingtoyou,butresist.S ection2.6willgivea
betteralternative(andexplainwhythe /CQ/CS/CP/DD/CN/D7/D8/D6/D9/D8 examplesworked)./F4Static variables There is one exception to the rule that all local variables ar e
destroyed with their frame: you can deﬁne a /D7/D8/CP/D8/CXvariable.
When the function’s frame is destroyed,the program makesa n ote of the value of
the static variable, and when the function is called again, t he static variable will
startoffwith thesamevalueasbefore.Thisprovidescontin uitywithin afunction,
butonlythatfunctionknowsaboutthevariable.
Static variable declarations look just like other declarat ions but with the word/D7/D8/CP/D8/CXbefore them. You can also put an initialization on the declar ation line,
which will be taken into consideration only the ﬁrst time the function is called.
Here is a sample function to enter data points into an array. I t assumes that the
calling functionknowsthe lengthof /D7/D9/D6/DA/CT/DD/CN/CS/CP/D8/CP anddoesbounds-checkingac-
cordingly.
voidadd_a_point( doublenumber,doublesurvey_data[]){
static int count_so_far = 0;
survey_data[count_so_far]= number;
count_so_far++;
}
gsl_stats March24,2009
40 CHAPTER 2
Theﬁrsttime thisfunctioniscalled, /D3/D9/D2/D8/CN/D7/D3/CN/CU/CP/D6 willbeinitializedatzero,the
numberpassedin willbeputin /D7/D9/D6/DA/CT/DD/CN/CS/CP/D8/CP/CJ/BC℄ ,and /D3/D9/D2/D8/CN/D7/D3/CN/CU/CP/D6 will bein-
crementedtoone.Thesecondtimethefunctioniscalled,the programwillremem-
ber that /D3/D9/D2/D8/CN/D7/D3/CN/CU/CP/D6 is one, and will thus put the second value in /D7/D9/D6/DA/CT/DD/CN/B9/CS/CP/D8/CP/CJ/BD℄,wherewewould wantit to be./F4The /D1/CP/CX/D2function All programs must have one and only one function named/D1/CP/CX/D2,whichiswheretheprogramwillbeginexecuting—the
base of the stack of frames. The consistency checks are now wi th the operating
system that called the program, which will expect /D1/CP/CX/D2to be declared in one of
two forms:
intmain(void);
intmain(intargc,char**argv);
#include <stdlib.h>
#include <stdio.h>
intmain(intargc,char**argv){
if(argc==1){
printf("Give me a command torun.\n");
return1;
}
intreturn_value = system(argv[1]);
printf("The program returned%i.\n",return_value);
returnreturn_value;
}
Listing2.6 A shellis a program that is primarily intended for the running of oth er programs; this is
a veryrudimentary one. Online source: /D7/CX/D1/D4/D0/CT/D7/CW/CT/D0/D0/BA .
The secondform will be discussedon page206, but for now, Lis ting 2.6 provides
aquickexampleoftheuseofinputsto /D1/CP/CX/D2. ItusesC’s /D7/DD/D7/D8/CT/D1functionto calla
program.Theusageofthis programwould besomethinglike
./simpleshell "ls /a_directory"
Conceptually, there is little difference between calling a function that you wrote
andcalling the /D1/CP/CX/D2function ofa foreignprogram.In thiscase,the /D7/DD/D7/D8/CT/D1func-
tion would call /D0/D7, effectively putting the /D0/D7program’s /D1/CP/CX/D2function on top of
the current stack. More generally, you can think of your comp uter’s entire func-
tioning, from boot to shutdown, as the evaluation of a set of s tacks of frames. At
boot, the system starts a C program named /CX/D2/CX/D8, and every other program is a
childof /CX/D2/CX/D8(orachildofachildofinit,orachildofachildofachild,et cetera).
gsl_stats March24,2009
C 41
There is also a /CU/D3/D6/CZfunction that generatesa secondstack that runs concurrent ly
with the parent,whichis howasystemrunsseveralprogramsa tonce.
The /D7/DD/D7/D8/CT/D1function will pass back the return value of the subprogram’s /D1/CP/CX/D2.
The general custom is that if /D1/CP/CX/D2returns 0 then all went well, while a positive
integerindicatesatypeoferror.17Becausesomanypeoplearenotconcernedwith
the return value of /D1/CP/CX/D2, the current C standardassumesthat /D1/CP/CX/D2returns zero if
no indication is given otherwise, which is how most of the pro grams in this book
getawaywith nothavinga /D6/CT/D8/D9/D6/D2statementin their /D1/CP/CX/D2function.
SCOPEWhenonefunctionisrunning,onlythevariablesinthatfram earevisible:all
ofthevariablesintherestoftheprogramaredormantandina ccessible.This
is a good thing, since you don’t want to have to always bear in m ind the current
stateofallthevariablesinyourprogram,theGNUScientiﬁc Library,thestandard
library, andwhoknowswhatelse.
Blockscope
Youcan declare variables inside a loop.
• /DB/CW/CX/D0/CT/B4/BA/BA/BA/B5/DF/CX/D2/D8 /CX/BN/BA/BA/BA /DHworks as you expect,
declaring /CXonly once.
• /DB/CW/CX/D0/CT/B4/BA/BA/BA/B5/DF/CX/D2/D8 /CX/BP/BD/BN/BA/BA/BA /DHwill re-set /CXto one
forevery iterationof the loop.
• /CU/D3/D6 /B4/CX/D2/D8 /CX/BP/BC/BN /CX/BO/D1/CP/DC/BN /CX/B7/B7/B5/DF/BA/BA/BA/DH works, but/CVmay complain about it unless you specify the/B9/D7/D8/CS/BP/BL/BL or /B9/D7/D8/CS/BP/CV/D2/D9/BL/BL ﬂags forthe compiler.
•A variable declared inside a bracketed block (or at
the header for a pair of curly braces, like a /CU/D3/D6loop)
is destroyed at the end of the bracketed code. This is
known as block scope . Function-level scope could be
thought of aspecial case of blockscope.
Block scope is occasionally convenient—especially
the /CU/D3/D6 /B4/CX/D2/D8 /CX/BN/BA/BA/BA/B5form—but bear in mind that
you won’t be able to refer to a block-internal variable
afterthe loop ends.Avariable’s scopeisthesetoffunc-
tions that can see the variable. A
variable declared inside a function
is visible only inside that function.
If avariableis declaredatthetop of
a ﬁle, then that variable is globalto
the ﬁle, and any function in that ﬁle
canseethatvariable.Ifdeclaredina
header ﬁle (see below, including an
important caveat on page 50), then
anyfunctioninaﬁlethat /AZ/CX/D2/D0/D9/CS/CT s
thatheadercanseethevariable.
The strategy behinddeciding on the
scope of a variable is to keep it as
smallaspossible.
• If only one function uses a variable, then by all means decla re the variable inside
thefunction (possiblyasa /D7/D8/CP/D8/CXvariable).
• If a variable is usedby only a few functions, then declare th e variable in the /D1/CP/CX/D2
functionandpassit asanargumenttothe functionsthatusei t.
• Ifavariableisusedthroughoutasingleﬁleandisinfreque ntlychanged,thenletit
begloballyavailablethroughoutthe ﬁle,byputtingit atth etop ofthe ﬁle,outside
allthe functionbodies.
17In the bash shell (the default on many POSIX systems), the ret urn value from the last program run is stored
in /B0/BR, so /CT/CW/D3 /B0/BRwill print its value.
gsl_stats March24,2009
42 CHAPTER 2
• Finally,ifavariableisusedthroughoutallpartsofaprog ramconsistingofmultiple
ﬁles, then declare it in a header ﬁle, so that it will be global ly available in every
ﬁlewhich /AZ/CX/D2/D0/D9/CS/CT sthatheaderﬁle (seepage50).18
Thereisoftenthetemptationtodeclareeveryvariableasgl obal,andjustnotworry
aboutscopeissues.Thismakesmaintainingandwriting thec odedifﬁcult:areyou
sure a tweak you made to the black box named /CU/D9/D2/D8/CX/D3/D2/CN/CP won’t change the
workings inside the black box named /CU/D9/D2/D8/CX/D3/D2/CN/CQ ? Next month, when you want
touse /CU/D9/D2/D8/CX/D3/D2/CN/CP inanewprogramyouhavejustwritten,youwillhavetoverify
thatnothingintherestoftheprogramaffectsit,sowhatcou ldhavebeenaquestion
ofjustcuttingandpastingablackboxfromoneﬁletoanother hasnowbecomean
involvedanalysisofthe originalprogram.
®Good coding form involves breaking problems down into funct ions
andwriting eachfunction asan independententity.
®The header of a function is of the form /CU/D9/D2/D8/CX/D3/D2/CN/D8/DD/D4/CT/CU/D9/D2/D8/CX/D3/D2/CN/D2/CP/D1/CT/B4/D4/BD/CN/D8/DD/D4/CT /D4/BD/CN/D2/CP/D1/CT/B8 /D4/BE/CN/D8/DD/D4/CT /D4/BE/CN/D2/CP/D1/CT/B8 /BA/BA/BA/B5.
®The computer evaluates each function as an independent enti ty. It
maintains a stack of frames, and all activity is only in the cu rrent
topframe.
®When a program starts, it will ﬁrst build a frame for the funct ion
named /D1/CP/CX/D2; therefore a complete program must have one and only
onesuchfunction.
®Global variables are passed into a new frame, but only copies of pa-
rameters are passed in. If a variable is not in the frame, it is out of
scopeandcannotbe accessed.
18This is the appropriate time to answer a common intro-to-C qu estion: What is the difference between C
and C++? There is much confusion due to the almost-compatibl e syntax and similar name—when explaining
the nameC-double-plus, thelanguage’s author references t he Newspeak language used in George Orwell’s 1984
(Orwell, 1949;Stroustrup, 1986, p 4).
The key difference is that C++ adds a second scope paradigm on top of C’s ﬁle- and function-based scope:
object-oriented scope. In this system, functions are bound to objects, where an object is effectively a /D7/D8/D6/D9/D8
holding several variables and functions. Variables that ar eprivateto the object are in scope only for functions
bound to theobject, while those that are publicarein scopewhenever the object itself isin scope.
In C, think of one ﬁle as an object: all variables declared ins ide the ﬁle are private, and all those declared in a
header ﬁle are public. Only those functions that have a decla ration in the header ﬁle can be called outside of the
ﬁle.
But the real difference between C and C++ is in philosophy: C+ + is intended to allow for the mixing of
various styles ofprogramming,ofwhich object-oriented co ding isone.C++therefore includes anumberofother
features, such as yet another type of scope called namespaces , templates and other tools for representing more
abstract structures, and a large standard library of templa tes. Thus, C represents a philosophy of keeping the
language as simple and unchanging as possible, even if it mea ns passing up on useful additions; C++ represents
an all-inclusive philosophy, choosing additional feature s and conveniences over parsimony.
gsl_stats March24,2009
C 43
2.4 T HE DEBUGGER Thedebugger is somewhat mis-named. A better name
would perhaps be the interrogator , because it lets you
interact with and ask questions of your program: you can look at every line as it
is beingexecuted,pauseto checkthevalueofvariables,bac kuporjump aheadin
the program, or insert an extra commandor two. The main use of these powers is
to ﬁnd and ﬁx bugs, but even when you are not actively debuggin g, you may still
wantto run yourprogramfrom insidethedebugger.
The joy of segfaults There are a few ways in which your program can break. For
example, if you attempt to calculate /BD/BB/BC, there is not much
forthe computerto dobuthalt.
Or, say that you have declared an array, /CX/D2/D8 /CS/CP/D8/CP/CJ/BD/BC/BC℄ and you attempt to read
to /CS/CP/D8/CP/CJ/BD/BC/BC/BC℄ .Thisisalocationsomewherein memory,901 /CX/D2/D8s’distancepast
the end of the space allocated for the array. One possibility is that /CS/CP/D8/CP/CJ/BD/BC/BC/BC℄
happensto fall ona spacethathassomethingthatcanbe inter pretedasaninteger,
and the computer processes whatever junk is at that location as if nothing were
wrong. Or, /CS/CP/D8/CP/CJ/BD/BC/BC/BC℄ could point to an area of protected memory, such as the
memory that is being used for the operating system or your dis sertation. In this
case, referring to /CS/CP/D8/CP/CJ/BD/BC/BC/BC℄ will halt the program with the greatest of haste,
before it destroys something valuable. This is a segmentation fault (segfaultfor
short), since you attempted to refer to memory outside of the segment that had
been allocated for your program. Below, in the section on poi nters, you will en-
counter the null pointer , which by deﬁnition points to nothing. Mistakenly trying
to read the data a null pointer is pointing to halts the progra m with the complaint
attemptingto dereferencea nullpointer .
A segfault is by far the clearest way for the computer to tell y ou that you mis-
coded something and need to ﬁre up the debugger.19It is much like refusing to
compile when you refer to an undeclaredvariable. If you decl ared /D6/CT/CT/CX/D4/D8/D7 and/CS/CP/D8/CP/CJ/BD/BC/BC℄ ,thensetting /D6/CT/CX/CT/D4/D8/D7 or /CS/CP/D8/CP/CJ/BL/BL/BL℄ toavalueisprobablyanerror.A
languagethatsavesyou the trouble ofmaking declarationsa ndrefusesto segfault
will just produce a new variable, expand the array, and thus i nsert errors into the
outputthatyoumayormaycatch.
19In fact, you will ﬁnd that the worst thing that can happen with an error like the above read of /CS/CP/D8/CP/CJ/BD/BC/BC/BC℄
would befor the program to notsegfault, butto continue with bad data and then break ahundr ed lines later. This
is rare, but when such an event becomes evident, you will need to use a memory debugger to ﬁnd the error; see
page 214.
gsl_stats March24,2009
44 CHAPTER 2
The debugging process To debug the program /D6/D9/D2/CN/D1/CTunder the debugger, type/CV/CS/CQ /D6/D9/D2/CN/D1/CTatthe commandline.You will begiventhe
gdbprompt.20
You need to tell the compiler to include the names of the varia bles and functions
in the compiled ﬁle, by adding the /B9/CVﬂag on the compiler command line. For
example, instead of /CV /CW/CT/D0/D0/D3/BA, use /CV /B9/CV /CW/CT/D0/D0/D3/BA. If the debugger com-
plains that it can’t ﬁnd any debugging symbols, then that mea ns that you forgot
the /B9/CVswitch. Because /B9/CVdoesnot slow down the program but makes debugging
possible,youshoulduseiteverytime youcompile.
If you know the program will segfault or otherwise halt, then just start /CV/CS/CQas
above, run the program by typing /D6/D9/D2at /CV/CS/CQ’s prompt, and wait for it to break.
When it does, you will be returned to gdb’s prompt, so you can i nterrogate the
program.
The ﬁrst thing you will want to know is where you are in the prog ram. You can
do this with the /CQ/CP/CZ/D8/D6/CP/CT command, which you can abbreviate to either /CQ/D8or/DB/CW/CT/D6/CT. It will show you the stack of function calls that were pendin g when the
program stopped. The ﬁrst frame is always /D1/CP/CX/D2, where the program started. If/D1/CP/CX/D2called another function, then that will be the next frame, et cetera. Often,
your program will break somewhere in the internals of a piece of code you did
not write, such as in a call to /D1/CP/D0/D0/D3/D4/D8. Ignore those. You did not ﬁnd a bug in/D1/CP/D0/D0/D3/D4/D8.Find thetopmostframe thatis inthe codethatyouwrote.
Atthispoint,thebestthingtodoislookatalistingofyourc odeinanotherwindow
and look at the line the debugger pointed out. Often, simply k nowing which line
failed isenoughto maketheerrorpainfully obvious.
If the error is still not evident, then go back to the debugger and look at the vari-
ables. You need to be aware of which frame you are working in, s o you know
whichsetofvariablesyouhaveatyourdisposal.Youwilldef aultto thelastframe
inthestack;tochangetoframenumberthree,givethecomman d /CU/D6/CP/D1/CT /BF(or /CU /BF
for short). You can also traverse the stack via the /D9/D4and /CS/D3/DB/D2commands, where/D9/D4goesto aparentfunctionand /CS/D3/DB/D2goesto thechild function.
Once you are in the frame you want, get information about the v ariables. You
can get a list of the local variables using /CX/D2/CU/D3 /D0/D3/CP/D0/D7, or information about the
arguments to the function using /CX/D2/CU/D3 /CP/D6/CV/D7(though the argument information is
already in the frame description). Or, you can print any vari able that you think
may be in the frame using /D4/D6/CX/D2/D8 /DA/CP/D6/CN/D2/CP/D1/CT , or more brieﬂy, /D4 /DA/CP/D6/CN/D2/CP/D1/CT . You
20Asking your favorite search engine for gdb guiwill turn up a number of graphical shells built around gdb.
Some are stand-alone programs like /CS/CS/CSand others are integrated into IDEs. They will not be discuss ed here
because they work exactly like gdb, except that they involve using the mousemore.
Also,GDB itself offers many conveniences not described her e. SeeStallman etal.(2002) for the full story.
gsl_stats March24,2009
C 45
can print the value of any expressionin scope: /D4 /D7/D5/D6/D8/B4/DA/CP/D6/B5 or /D4 /CP/D4/D3/D4/CN/D7/CW/D3/DB/CN/B9/D1/CP/D8/D6/CX/DC/B4/D1/B5 will display the square root of /DA/CP/D6and the matrix /D1, provided the
variables and functions are available to the scope in which y ou are working. Or,/D4 /D7/D8/CS/CS/CT/DA /BP /D7/D5/D6/D8/B4/DA/CP/D6/B5 willsetthevariable /D7/D8/CS/CS/CT/DAtothegivenvalueandprint
the result. Generally, you can execute any line of C code that makes sense in the
givencontextvia the /D4/D6/CX/D2/D8command.
GDB has a specialsyntaxfor viewing severalelementsof an ar ray atonce.If you
wouldliketoseetheﬁrstﬁveelementsofthearray /CX/D8/CT/D1/D7,thenuse: /D4 /B6/CX/D8/CT/D1/D7/BH .
Breaking and stepping If your program is doing things wrong but is not kind
enough to segfault, then you will need to ﬁnd places to
halt the program yourself. Do this with the /CQ/D6/CT/CP/CZcommand. For a program with
only oneﬁle of code,simply givea line number: /CQ/D6/CT/CP/CZ /BF/BHwill stop the program
justbeforeline 35is evaluated.
• For programs based on many ﬁles, you may need to specify a ﬁle name: /CQ/D6/CT/CP/CZ/CU/CX/D0/CT/BE/BA/BM/BF/BH .
• Or, you can specify a function name, and the debugger will st op at the ﬁrst line
afterthe function’sheader.E.g, /CQ/D6/CT/CP/CZ /CP/D0/D9/D0/CP/D8/CT/CN/CS/CP/DD/D7 .
• You may also want the program to break only under certain con ditions, such as
whenaniteratorreaches10,000.I.e., /CQ/D6/CT/CP/CZ /BF/BH /CX/CU /D3/D9/D2/D8/CT/D6 /BQ /BD/BC/BC/BC/BC.21
• Allbreakpointsaregivenanumber,whichyoucanlistwith /CX/D2/CU/D3 /CQ/D6/CT/CP/CZ.Youcan
deletebreakpointnumberthreewith thecommand /CS/CT/D0 /BF.
Once you have set the breakpoints, /D6/D9/D2(or just /D6) will run the program until it
reachesa break point, and then you can apply the interrogati on techniquesabove.
Youmaywanttocarefully stepthroughfrom there:
• /D7will step to the next line to be evaluated, which could mean ba cking up in the
currentfunction orgoingto a subfunction.
• /D2/CT/DC/D8or /D2willstepthroughthefunction(whichmayinvolvebacktrack ing)butwill
run withoutstoppingin anysubframeswhichmay becreated(i .e., if subfunctions
arecalled).
• /D9/D2/D8/CX/D0or /D9will keep going until you get to the next line in the function, so the
debugger will run through subfunctions and loops until forw ard progress is made
in thecurrentfunction.
• will continuealonguntilthe nextbreakpointorthe endofth e program.22
21Youcanalsoset watchpoints , whichtellgdbtowatchavariableandhaltifthatvariable c hanges,e.g., /DB/CP/D8/CW/D1/DD/DA/CP/D6. Watchpoints arenot as commonly used as breakpoints, and so metimes suffer from scopeissues.
22A mnemonic device for remembering which is which: /D7is the slowest means of stepping, /D2slightly faster,/D9still faster, and the fastest. In this order, they spell /D7/D2/D9, which is almost an English word with implications
of stepping slowly.
gsl_stats March24,2009
46 CHAPTER 2
• /CY/D9/D1/D4 /D0/CX/D2/CT/D2/D3will jump to the given line number, so you can repeat a line wit h
some variables tweaked, or skip over a few lines. Odd things w ill happen if you
jump out of the frame in which you are working, so use this only to jump around
asinglefunction.
• /D6/CT/D8/D9/D6/D2will exit the given frame and resume in the parent frame. You c an give a
return value,like /D6/CT/D8/D9/D6/D2 /DA/CP/D6.
• Just hitting <enter>will repeat the last command, so you won’t have to keep
hitting /D2to stepthroughmanylines.
Q2.7Break /CQ/CS/CP/DD/CU/D2/D7/BA (from Listing 2.4)anddebugit.
• Modify line13 from /CS/CP/DD/D7/CJ/BD℄ to /CS/CP/DD/D7/CJ/B9/BD℄ .
• Recompile.Be sureto includethe /B9/CVﬂag.
• Runtheprogram andobservetheoutput(if any).
• Start the debugger. If the program segfaulted, just type /D6/D9/D2and wait
for failure; otherwise, insert a breakpoint, /CQ/D6/CT/CP/CZ /CP/D0/D9/D0/CP/D8/CT/CN/CS/CP/DD/D7 ,
andthen /D6/D9/D2.
• Checkthebacktracetoseewhereyouareonthestack.Whatev idence
canyouﬁndthatthingsarenotright?
A note on debugging strategy Especially for numeric programs, the strategy in
debugging is to ﬁnd the ﬁrst point in the chain of
logic where things look askew. Below, you will see that your c ode can include
assertions that check that things have not gone astray, and the debugger ’s break-
and-inspect system provides another means of searching for the earliest misstep.
But if there are no intermediate steps to be inspected, debug ging becomes very
difﬁcult.
Say you are writing out the roots of the quadratic equation, x=−b±√b2−4ac
2a, and
erroneouslycodetheﬁrstrootas:
ﬁrstroot=−b+ sqrt(b *b−4*a*c)/2*a;//this iswrong.
There are basically no intermediate steps: you put in /CP, /CQ, and , and the system
spitsoutabadvaluefor /CU/CX/D6/D7/D8/D6/D3/D3/D8 . Nowsaythatyouinsteadwrote:
1 ﬁrstroot=−b;
2 ﬁrstroot+= sqrt(b *b−4*a*c);
3 ﬁrstroot= ﬁrstroot/2 *a;//stillwrong.
gsl_stats March24,2009
C 47
If you know that the output is wrong, you can interrogate this sequence for clues
about the error. Say that /CP/BP/BE. As you step through, you ﬁnd that the value of/CU/CX/D6/D7/D8/D6/D3/D3/D8 doesnotchangeafterline threeruns.Fromthere,theerrori sobvious:
thelineshouldhavebeeneither /CU/CX/D6/D7/D8/D6/D3/D3/D8 /BP /CU/CX/D6/D7/D8/D6/D3/D3/D8/BB/B4/BE/B6/CP/B5 or /CU/CX/D6/D7/D8/D6/D3/D3/D8/BB/BP /BE/B6/CP. Such a chain of logic would be impossible with the one-line v ersion of
theroutine.23
However,for the typical reader, the secondversionis unatt ractively over-verbose.
A ﬁrst draft of code should err on the side of inelegant verbos ity and easy de-
bugability. You can then incrementally tighten the code as i t earns your trust by
repeatedlyproducingcorrectresults.
Q2.8A triangular number is a number like 1 (·), 1+2=3 (···), 1+2+3=6/parenleftig······/parenrightig
,
1+2+3+4=10/parenleftbigg··········/parenrightbigg
,etcetera.Fermat’spolygonalnumbertheoremstates
thatany naturalnumbercan be expressedas the sum of atmost t hree trian-
gular numbers. For example,13 = 10+3 and 19=15+3+1.Demonst rate this
via a program that ﬁnds up to three triangular numbers for eve ry number
from 1 to 100.
• Writeafunction /CX/D2/D8 /D8/D6/CX/CP/D2/CV/D9/D0/CP/D6/B4/CX/D2/D8 /CX/B5thattakesinanindexand
returnsthe ithtriangularnumber.E.g., /D8/D6/CX/CP/D2/CV/D9/D0/CP/D6/B4/BH/B5 wouldreturn
1+2+3+4+5=15.Write a /D1/CP/CX/D2to testit.
• Use that function to write a function /CX/D2/D8 /CU/CX/D2/CS/CN/D2/CT/DC/D8/CN/B9/D8/D6/CX/CP/D2/CV/D9/D0/CP/D6/B4/CX/D2/D8 /CX/D2/B5that returns the index of the smallest
triangularnumberlargerthanits input. Modify /D1/CP/CX/D2to testit.
• Write a function /DA/D3/CX/CS /CU/CX/D2/CS/CN/D8/D6/CX/D4/D0/CT/D8/B4/CX/D2/D8 /CX/D2/B8 /CX/D2/D8 /D3/D9/D8/CJ℄/B5that
takes in a number and puts three triangular numbers that sum t o it in/D3/D9/D8.Youcanuse /CU/CX/D2/CS/CN/D2/CT/DC/D8/CN/D8/D6/CX/CP/D2/CV/D9/D0/CP/D6 toﬁndthelargesttriangu-
lar numberto try, andthen write three nested /CU/D3/D6loopsto searchthe
range from zero to the maximum you found. If the loop-in-a-lo op-
in-a-loop ﬁnds three numbers that sum to /CX/D2, then the function can/D6/CT/D8/D9/D6/D2, thuscuttingoutoftheloops.
• Finally,writea /D1/CP/CX/D2functionthatﬁrstdeclaresanarrayofthree /CX/D2/D8s
that will be ﬁlled by /CU/CX/D2/CS/CN/D8/D6/CX/D4/D0/CT/D8 , and then runs a /CU/D3/D6loop that
calls /CU/CX/D2/CS/CN/D8/D6/CX/D4/D0/CT/D8 for each integer from 1 to 100 and prints the
result.
23Theone-line version also has asecond error; spotting itis l eft as aquick exercise for the reader.
gsl_stats March24,2009
48 CHAPTER 2
®Thedebuggerwillallowyoutoviewintermediateresultsata nypoint
alongaprogram’sexecution.
®Youcaneitherwaitfortheprogramtosegfaultbyitself,oru se /CQ/D6/CT/CP/CZ
to insertbreakpoints.
®You can execute and print any expression or variable using /D4/DA/CP/D6/CX/CP/CQ/D0/CT .
®Once the program has stopped, use /D7, /D2, and /D9to step through the
programatvariousspeeds.
2.5 C OMPILING AND RUNNING Theprocessofcompilingprogramtextinto
machine-executableinstructions relies hea-
vily on the system of frames. If function A calls function B, t he compiler can
writedowntheinstructionsforcreatingandexecutingfunc tionAwithoutknowing
anythingaboutfunctionBbeyonditsdeclaration.Itwillsi mplycreateaframewith
a series of instructions, one of which is a call to function B. Since the two frames
arealwaysseparate,thecompilercanfocusoncreatingonea tatime,andthenlink
themlateron.
What to type To this point, you havebeenusing a minimal commandline to co m-
pileprograms,butyoucanspecifymuchmore.Saythatwewant the
compilerto
• includesymbolsfordebugging( /B9/CV),
• warnusofallpotentialcodingerrors ( /B9/CF/CP/D0/D0),
• usethe C99andPOSIX standards( /B9/D7/D8/CS/BP/CV/D2/D9/BL/BL ),
• compileusingtwosourceﬁles, /CU/CX/D0/CT/BD/BA and /CU/CX/D0/CT/BE/BA,plus
• thesqlite3 andstandardmath library ( /B9/D0/D7/D5/D0/CX/D8/CT/BF /B9/D0/D1), andﬁnally
• outputtheresulting programto aﬁle named /D6/D9/D2/CN/D1/CT( /B9/D3 /D6/D9/D2/CN/D1/CT).
Youcouldspecifyallofthis ononecommandline:
gcc−g−Wall−std=gnu99 ﬁle1.c ﬁle2.c −lsqlite3−lm−orun_me
This is a lot to type, so there is a separate program, /D1/CP/CZ/CT, which is designed to
facilitate compiling. After setting up a makeﬁle to describ e your project, you will
be able to simply type /D1/CP/CZ/CTinstead of the mess above. You may beneﬁt from
readingAppendixA atthis point. Or, if you decideagainstus ing /D1/CP/CZ/CT, you could
gsl_stats March24,2009
C 49
writeyourselfanaliasinyourshell,writeabatchﬁle,orus eanIDE’scompilation
features.
Multiple windows also come in handy here: put your code in one window and
compileinanother,soyoucanseetheinevitablecompilatio nerrorsandthesource
code at the same time. Some text editors and IDEs even have fea tures to compile
from within theprogramandthenstepyouthroughtheerrors r eturned.
The components Eventhoughwerefertotheprocessaboveas compilation ,itac-
tuallyembodiesthreeseparateprograms:apreprocessor,a com-
piler, andalinker.24
The three sub-programs embody the steps in developing a set o f frames: the pre-
processor inserts header ﬁles declaring functions to be use d, the compilation step
uses the declarations to convert C code into machine instruc tions about how to
buildandexecuteastandaloneframe, andthelinkingsteplo catesallthedisparate
frames,sothe systemknowswhereto lookwhenafunctioncall is made.
THE PREPROCESSING STEP Thepreprocessor doesnothingbuttaketextyouwrote
andconvertit into more text. Thereare a dozentypes
oftextsubstitutionsthepreprocessorcando,butitsnumbe roneuseisdumpingthe
contentsofheaderﬁlesintoyoursourceﬁles.Whentheprepr ocessorisprocessing
theﬁle /D1/CP/CX/D2/BAandseesthe lines
#include <gsl/gsl_matrix.h>
#include "a_ﬁle.h"
it ﬁnds the /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/BA/CW and the /CP/CN/CU/CX/D0/CT/BA/CW header ﬁles , and puts their entire
contentsverbatimatthatpointintheﬁle.Youwillneversee theexpansion(unless
you run /CVwith the /B9/BXﬂag); the preprocessor just passes the expanded code
to the compiler. For example, the /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/BA/CW header ﬁle declares the /CV/D7/D0/CN/B9/D1/CP/D8/D6/CX/DCtype anda few dozenfunctionsthatacton it, andthe preproce ssorinserts
thosedeclarationsintoyourprogram,soyoucanusethestru ctureanditsfunctions
asifyou’d written them yourself.
Theangle-bracketform, /AZ/CX/D2/D0/D9/CS/CT /BO/CV/D7/D0/BB/CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/BA/CW/BQ indicatesthatthe pre-
processor should look at a pre-speciﬁed include path for the header; use this for
the headers of library ﬁles, and see Appendix A for details. T he /AZ/CX/D2/D0/D9/CS/CT Ꜽ/CP/CN/B9/CU/CX/D0/CT/BA/CWꜼ form searches the current directory for the header; use this for header
ﬁlesyouwrote yourself.25
24Asatechnical detail which youcangenerally ignoreinpract ice, thepreprocessor andcompiler aretypically
oneprogram, and the linker is typically aseparate program.
25The /AZ/CX/D2/D0/D9/CS/CT Ꜽ/CP/CN/CU/CX/D0/CT/BA/CWꜼ form searches the include path as well, so you could actually use it for both
home-grown and system /AZ/CX/D2/D0/D9/CS/CT s. In practice, the two forms serve as an indication of where o ne can ﬁnd the
given header ﬁle, so mostauthors usethe <>form even though it is redundant.
gsl_stats March24,2009
50 CHAPTER 2
Headeraggregation
The Apophenia library provides a convenience
header that aggregates almost every header you will
likelybe using. Byplacing/AZ/CX/D2/D0/D9/CS/CT < /CP/D4/D3/D4/BA/CW >
at the top of your ﬁle, you should not need to in-
cludeanyoftheotherstandardheaders thatone would
normally include in a program for numerical analysis
( /D7/D8/CS/CX/D3/BA/CW, /D7/D8/CS/D0/CX/CQ/BA/CW , /D1/CP/D8/CW/BA/CW, /CV/D7/D0/CN/CP/D2/DD/D8/CW/CX/D2/CV/BA/CW ).
This means that you could ignore the headers at the
topof allof the code snippets inthis chapter.
Of course, you will still need to include any headers
you have written, and if the compiler complains about
anundeclaredfunction,thenitsheaderisevidentlynot
included in /CP/D4/D3/D4/BA/CW.Manyprogramminglanguageshave
a way to declare variables as hav-
ingglobal scope , meaning that ev-
ery function everywhere can make
use of the variable. Technically, C
hasnosuchmechanism.Instead,the
best you can do is what I will call
ﬁle-global scope , meaning that ev-
ery function in a single ﬁle can see
anyvariabledeclaredaboveitinthat
ﬁle.
Header ﬁles allow you to simulate
truly global scope, but with ﬁner
control if you want it. If some vari-
ablesshouldbeglobaltoyourentireprogram,thencreateaﬁ lenamed /CV/D0/D3/CQ/CP/D0/D7/BA/CW ,
andputalldeclarationsinthatﬁle(butseebelowfordetail s).Byputting /AZ/CX/D2/D0/D9/CS/CTꜼ/CV/D0/D3/CQ/CP/D0/D7/BA/CWꜼ atthetopofeveryﬁlein yourproject,allvariablesdeclare dtherein
are now project-global. If the variables of /D4/D6/D3/CT/D7/D7/BA are usedin only one ortwo
other code ﬁles, then project-global scope is overkill: /AZ/CX/D2/D0/D9/CS/CT Ꜽ/D4/D6/D3/CT/D7/D7/BA/CWꜼ
onlyin thosefew codeﬁlesthatneedit.
Q2.9In prior exercises, you wrote a program with one function to c reate an ar-
rayofnumbersandtheirsquares(page30), andanotherfunct ion, /D4/D6/CX/D2/D8/CN/B9/CP/D6/D6/CP/DD,to printthosevalues(page37).
• Move /D4/D6/CX/D2/D8/CN/CP/D6/D6/CP/DD toa newtextﬁle, /D9/D8/CX/D0/CX/D8/DD/CN/CU/D2/D7/BA .
• Write thecorrespondingone-lineﬁle /D9/D8/CX/D0/CX/D8/DD/CN/CU/D2/D7/BA/CW with /D4/D6/CX/D2/D8/CN/B9/CP/D6/D6/CP/DD’sheader.
• /AZ/CX/D2/D0/D9/CS/CT Ꜽ/D9/D8/CX/D0/CX/D8/DD/CN/CU/D2/D7/BA/CWꜼ in themain square-printingprogram.
• Modify thesquare-calculatingcodeto call /D4/D6/CX/D2/D8/CN/CP/D6/D6/CP/DD .
• Compile both ﬁles at once, e.g., /CV /DD/D3/D9/D6/CN/D1/CP/CX/D2/BA /D9/D8/CX/D0/CX/D8/DD/CN/B9/CU/D2/D7/BA.
• Runthecompiledprogramandverify thatit doeswhatitshou ld./F4Variables in headers The system of putting ﬁle-scope variables in the base /BA
ﬁle and global-scope variables in the /BA/CWﬁle has one ugly
detail. A function declaration is merely advice to the compi ler that your function
gsl_stats March24,2009
C 51
has certain inputs and outputs, so when multiple ﬁles reread the declaration, the
program suffers only harmless redundancy. But a variable de claration is a com-
mand to the compiler to allocate space as listed. If /CW/CT/CP/CS/BA/CWincludes a declaration/CX/D2/D8 /DC/BN, and /CU/CX/D0/CT/BD/BA includes /CW/CT/CP/CS/BA/CW, it will set aside an /CX/D2/D8’s worth of mem-
oryandnameit /DC;if /CU/CX/D0/CT/BE/BA includesthesameheader,itwillalsosetasidesome
memory named /DC. So which bit of memory are you referring to when you use /DC
laterin yourcode?
C’s solution is the /CT/DC/D8/CT/D6/D2keyword, which tells the compiler that the declaration
thatfollowsisnotformemoryallocation,butispurelyinfo rmative.Simplyputitin
front of the normal declaration: /CT/DC/D8/CT/D6/D2 /CX/D2/D8 /DC/BN /CT/DC/D8/CT/D6/D2 /D0/D3/D2/CV /CS/D3/D9/CQ/D0/CT /DD/BNwill
bothwork.Then,inoneandonlyone /BAﬁle,declarethevariablesthemselves,e.g.,/CX/D2/D8 /DC/BN /D0/D3/D2/CV /CS/D3/D9/CQ/D0/CT /DD /BP /BJ/BA/BC. Thus, all ﬁles that /AZ/CX/D2/D0/D9/CS/CT the header know
what to make of the variable /DC, so /DC’s scope is all ﬁles with the given header, but
thevariableis allocatedonly once.
To summarize: function declarations and /D8/DD/D4/CT/CS/CT/CUs can go into a header ﬁle that
will be includedin multiple /BAﬁles.Variablesneedto be declaredasusualin one
andonlyone /BAﬁle,andif youwantother /BAﬁlesto seethem,re-declarethemin
aheaderﬁlewith the /CT/DC/D8/CT/D6/D2keyword.
THE COMPILATION STEP Thecompilation stage consists of taking each /BAﬁle
in turn and writing a machine-readable object ﬁle , so/CU/CX/D0/CT/BD/BA will result in /CU/CX/D0/CT/BD/BA/D3, and /CU/CX/D0/CT/BE/BA will compile to /CU/CX/D0/CT/BE/BA/D3. These
objectﬁlesareself-encapsulatedﬁlesthatincludeatable ofallofthesymbolsde-
claredinthatﬁle(functions,variables,andtypes),andth eactualmachinecodethat
tells the computerhow to allocate memory when it sees a varia ble and how to set
upandrunaframewhenitseesafunctioncall.Thepreprocess orinserteddeclara-
tions for all external functions and variables, so the compi ler can run consistency
checksasit goes.
Theinstructionsforafunctionmayincludeaninstructionl ikeatthispoint,createa
framefor /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/CP/CS/CS with theseinputvariables ,but executingthat instruc-
tiondoesnotrequireanyknowledgeofwhat /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/CP/CS/CS lookslike—thatis
aseparateframe in whichthecurrentframe hasnobusinessme ddling.
THE LINKING STEP Afterthecompilationstep,youwillhaveonhandanumberof
standalone frames. Some are in /BA/D3ﬁles that the compiler just
created, and some are in libraries elsewhere on the system. T helinkercollects all
oftheseelementsintoasingleexecutable,sowhenonefunct ion’sinstructionstell
thecomputertogoevaluate /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/CP/CS/CS ,thecomputerwillhavenoproblem
locatingandloadingthatfunction.Yourprimaryinteracti onwiththelinkerwillbe
gsl_stats March24,2009
52 CHAPTER 2
in telling it where to ﬁnd libraries, via /B9/D0commands on the compiler command
line ( /B9/D0/CV/D7/D0 /B9/D0/CV/D7/D0/CQ/D0/CP/D7 /B9/D0/D1,etcetera).
Note well that a library’s header ﬁle and its object ﬁle are se parate entities—
meaning that there are two distinct ways in which a call to a li brary function can
gowrong.Toincludeafunctionfromthestandardmathlibrar ylike /D7/D5/D6/D8,youwill
needto(1)tellthepreprocessortoincludetheheaderﬁlevi a /AZ/CX/D2/D0/D9/CS/CT /BO/D1/CP/D8/CW/BA/CW/BQ
in the code, and (2) tell the linker to link to the math library via a /B9/D0ﬂag on the
commandline,inthiscase /B9/D0/D1.AppendixAhasmoredetailonhowtodebugyour/AZ/CX/D2/D0/D9/CS/CT statementsand /B9/D0ﬂags./F4Finding libraries AnimportantpartoftheartofCprogrammingisknowinghow
toﬁndlibrariesthatwilldoyourworkforyou,bothonlinean d
onyourharddrive.
• The ﬁrst library to know is the standardlibrary. Being stan dard, this was installed
on your computer along with the compiler. If the documentati on is not on your
hard drive (try /CX/D2/CU/D3 /CV/D0/CX/CQ), you can easily ﬁnd it online. It is worth giving the
documentationa skimsoyouknowwhichwheelsto notreinvent .
• The GNU/UNESCO website ( /CV/D2/D9/BA/D3/D6/CV) holds a hefty array of libraries, all of
whicharefree fordownload.
• /D7/D3/D9/D6/CT/CU/D3/D6/CV/CT/BA/D2/CT/D8 hostson the orderof 100,000projects(ofvaryingquality). To
be hosted on Sourceforge, a project must agree to make its cod e public, so you
mayfold anythingyouﬁndthereinto yourownwork.
• Finally, you can start writing your own library, since next month’s project will
probably havesome overlapwith the one you are working on now . Simply put all
of your functions relating to /D8/D3/D4/CXinto a ﬁle named /D8/D3/D4/CX/BA, and put the useful
declarations into a separate header ﬁle named /D8/D3/D4/CX/BA/CW. You already have a start
oncreatingautility library from theexerciseonpage50.
®Compilation is athree-stepprocess.Theﬁrststepconsists oftextex-
pansions like replacing /AZ/CX/D2/D0/D9/CS/CT /BO /CW/CT/CP/CS/CT/D6/BA/CW /BQwith the entire con-
tentsof /CW/CT/CP/CS/CT/D6/BA/CW .
®Therefore, put public variable declarations (with the /CT/DC/D8/CT/D6/D2key-
word)andfunctiondeclarationsin headerﬁles.
®The next step consists of compilation, in which each source ( /BA) ﬁle
is convertedto anobject( /BA/D3) ﬁle. ≫
gsl_stats March24,2009
C 53
≫
®Therefore,eachsourceﬁleshouldconsistofasetofstandal onefunc-
tions that depend only on the ﬁle’s contents and any declarat ions in-
cludedvia theheaders.
®The ﬁnal step is linking, in which references to functions in other
libraries orobjectﬁlesarereconciled.
®Therefore, you can ﬁnd and use libraries of functions for any set of
tasksyoucanimagine.
2.6 P OINTERS Pointers will change your life. If you have never dealt with
thembefore,youwillspendsomequantityoftimepuzzlingov er
them, wondering why anybody would need to bother with them. A nd then, when
you are ﬁnally comfortable with the difference between data and the location of
data,youwillwonderhowyoueverwrote codewithoutthem.
Pointers embody the concept of the location of data —a concept with which we
dealallthetime.Iknowthelocation /CW/D8/D8/D4/BM/BB/BB/D2/DD/D8/CX/D1/CT/D7/BA/D3/D1 ,andexpectthatifIgo
to that location, I will get information about today’s event s. I gave my colleagues
an email address years ago, and when they have new informatio n, they send it
to that location. When so inclined, I can then check that same location for new
information.Somelibrariesareveryregimentedaboutwher ebooksarelocated,so
if you need a book on probability (Library of Congress classi ﬁcation QA273) the
librarianwilltellyoutogoupstairstothethirdbookshelf ontheleft.Thelibrarian
did not have to know any information about probability, just the location of such
information.
Returning to the computerfor a moment, when you declare /CX/D2/D8 /CZ, then the com-
puter is going to put /CZsomewhere in memory. Perhaps with a microscope, you
could even ﬁnd it: there on the third chip, two hundred transi stors from the bot-
tom. Youcouldpointto it.
Lacking a ﬁnger with which to point, the computer will use an i llegible hexadec-
imal location, but you will never have to deal with the hexade cimal directly, and
losenothingbyignoringtheimplementationandthinkingof pointersasjustavery
preciseﬁnger,ora book’scallnumber.
The confusing part is that the location of data is itself data . After all, you could
write “QA273” on as slip of paper as easily as “ P(A∩B) =P(A|B)P(B).”
gsl_stats March24,2009
54 CHAPTER 2
Further, the location of information may itself have a locat ion. Before computers
took over, there was a card catalog somewhere in the library, so you would have
to go to the card catalog—the place where location data is sto red—and then look
up the location of your book. It sometimes happens that you ar rive at the QA273
shelfandﬁndawoodblockwithamessagetapedtoitsaying“ov ersizedbooksare
attheendoftheaisle.”
In these situations, we have no problem distinguishing betw een information that
is just the location of data and data itself. But in the comput ing context, there
is less to guide us. Is 8,049,588 just a large integer (data), or a memory address
(the location of data)?26C’s syntaxwill do little to clear up the confusion,since a
variablelike /CZcouldbeintegerdata orthe locationof integerdata. ButC us esthe
location of data to solve a number of problems, key among them being function
callsthatallowinputsto bemodiﬁedandtheimplementation ofarrays.
Call-by-address v call-by-value First,aquickreviewofhowfunctionsarecalled:
when you call a function, the computer sets up
a separate frame for the function, and puts into that frame copiesof all of the
variables that have been passed to the function. The functio n then does its thing
and produces a return value. Then, the entire frame is destro yed, including all of
the copies of variables therein. A copy of the return value ge ts sent back to the
mainprogram,andthatis allthatremainsofthe defunctfram e.
This setup, known as call-by-value since only values are pas sed to the function,
allows for a more stable implementation of the paradigm of st andalone frames.
But if /CZis an array of a million /CS/D3/D9/CQ/D0/CTs, then making a copy every time you call
a common function could take a noticeable amount of time. Als o, you will often
wantyourfunction to changethevariablesthatgetsentto it .
Pointersﬁxtheseproblems.Thetrickisthatinsteadofsend ingthefunctionacopy
of the variable, we send in a copy of the location of the variab le: we copy the
book’s call number onto a slip of paper and hand that to the fun ction. In Figure
2.7, thebeforepicture shows the situation before the function call, in the main
program:thereisapointertoalocationholdingthenumbers ix.Then,inthe during
picture, a function is called with the pointer as an argument , via a form like /CU/D2/CN/B9/CP/D0/D0/B4/D4/D3/CX/D2/D8/CT/D6/B5 . There are now two ﬁngers, original and copy, pointing to the
samespot, but the function knowsonly aboutthe copy.Giveni ts copyof a ﬁnger,
itiseasyforthefunctiontochangethevaluepointedtotose ven.Whenthefunction
returns, in the afterpicture, the copy of a ﬁnger is destroyed but the changes are
notundone.Theoriginalﬁnger(which hasn’tchangedandis p ointingto thesame
placeit wasalwayspointing to)will nowbepointingto amodi ﬁedvalue.
26Thisnumberisactually anaddressliftedfrommydebugger,w hereitislistedas /BC/DC/BC/BK/BC/BG/BL/BH/BK/BK . The /BC/DCpreﬁx
indicates that thenumber is represented in hexadecimal.
gsl_stats March24,2009
C 55
Figure 2.7 Before,during, andafter a functioncall that mod iﬁes a pointed-to value
Returningto C syntax,herearethe rulesforusingpointers:
• Todeclarea pointerto aninteger, use /CX/D2/D8 /B6 /CZ.
• Outsidethedeclarations,to referto the integerbeingpoi ntedto, use /B6 /CZ.
• Outsidethedeclarations,to referto the pointeritself, u se /CZ.
The declaration /CX/D2/D8 /B6/D4/B8 /CXmeans that /D4will be a pointer to an integer and /CXis
aninteger, butin a non-declarationline like /CX /BP /B6/D4, /B6/D4refersto the integervalue
that /D4pointsto.Thereisactuallyalogicaljustiﬁcationforthes yntax,whichIwill
not present here because it tends to confuse more often than i t clariﬁes. Instead,
justbearinmindthatthestareffectivelymeanssomethingd ifferentindeclarations
thanin non-declarationuse.
To give another example, let us say that we are declaring a new pointer /D4/BEthat
willbeinitializedtopointtothesameaddressas /D4.Thenthedeclarationwouldbe/CX/D2/D8 /B6/D4/BE /BP /D4, because /D4/BEis beingdeclaredas a pointer, and /D4is beingusedas a
pointer.
Thespacesaroundourstarsdonotmatter,sousewhicheverof /CX/D2/D8 /B6/CZ, /CX/D2/D8/B6 /CZ,or/CX/D2/D8 /B6 /CZyoulikebest.Generalcustompreferstheﬁrstform,because itminimizes
thechancethatyouwillwrite /CX/D2/D8 /B6 /CZ/B8 /CQ(allocateapointernamed /CZandan /CX/D2/D8
named /CQ) when youmeant /CX/D2/D8 /B6/CZ/B8 /B6/CQ(allocate two pointers). Thestar also still
meansmultiply. Thereis neverambiguity,butifthisbother syou,useparentheses.
Listing2.8showsasampleprogram thatusesC’s pointersynt axto implementthe
call-by-addresstrick from Figure 2.7.
gsl_stats March24,2009
56 CHAPTER 2
1#include <stdio.h> //printf
2#include <malloc.h> //malloc
3
4intglobe=1; //aglobal variable.
5
6intfactorial ( int*a_c){
7while(*a_c){
8 globe *=*a_c;
9 ( *a_c)−−;
10 }
11 returnglobe;
12 }
13
14intmain(void){
15int*a= malloc( sizeof(int));
16 *a = 10;
17 printf("%i factorial ...", *a);
18 printf(" is%i.\n", factorial(a));
19 printf(" *a= %i\n", *a);
20 printf("globe= %i\n", globe);
21 free(a);
22 return0;
23 }
Listing2.8 A versionof the factorial program using call-by -address. Online source: /CP/D0/D0/CQ/DD/CP/CS/CS/BA .
• Inthe /D1/CP/CX/D2function, /CPisapointer—theaddressofaninteger—asindicatedbythe
starin its declarationonline 15;the /D1/CP/D0/D0/D3partis discussedbelow.
• Toprinttheintegerbeingpointedto, asonline 19,weuse /B6/CP.
• The header for a function is a list of declarations, so on lin e 6, /CU/CP/D8/D3/D6/CX/CP/D0/B4/CX/D2/D8/B6/CP/CN/B5tells us thatthe function takes a pointer to an integer, whic h will be named/CP/CN.
• Thus,in non-declarationuselike lines eightandnine, /B6/CP/CNisaninteger.
Nowforthecall-by-addresstrick,asperFigure2.7.Whenth ecallto /CU/CP/D8/D3/D6/CX/CP/D0 is
madeonLine 18,the pointer /CPgetspassedin. Thecomputerbuilds itself a frame,
usingacopyof /CP—thatis,acopyofthelocationofaninteger.Both /CP(inthe /D1/CP/CX/D2
frame) and /CP/CN(in the /CU/CP/D8/D3/D6/CX/CP/D0 frame) now point to the same piece of data.
Line 9, /B4/B6/CP/CN/B5/B9/B9 , tells the computer to go to the address /CP/CNand decrement the
value it ﬁnds there. When the frame is destroyed (and /CP/CNgoes with it), this will
notbeundone:thatslotofmemory will still hold thedecreme ntedvalue.Because/B6/CP—theinteger /CPpointsto—haschangedasasideeffecttocallingthe /CU/CP/D8/D3/D6/CX/CP/D0
function,yousawthatline 19printed /B6/CP/BP/BCwhenyourantheprogram.
gsl_stats March24,2009
C 57
Dealing with memory Finally, we must contend with the pointer initialization on
line15:
int*a = malloc( sizeof(int));
Malloc, a function declared in /D7/D8/CS/D0/CX/CQ/BA/CW , is short for memory allocate . By the
library metaphor, /D1/CP/D0/D0/D3builds bookshelves that will later hold data. Just as we
haveno idea whatis in an /CX/D2/D8variable before it is givena value,we haveno idea
what address /CPpoints to until we initialize it. The function /D1/CP/D0/D0/D3/B4/B5 will do the
low-levelworkofﬁndinga freeslotofmemory,claimingit so nothingelseonthe
computer uses it, and returning that address. The input to /D1/CP/D0/D0/D3is the quantity
ofmemoryweneed,whichin this caseis thesizeofoneinteger : /D7/CX/DE/CT/D3/CU/B4/CX/D2/D8/B5 .
Theampersand
Every variable has an address, whether you declared
it as a pointer or not. The ampersand ﬁnds that ad-
dress: if /D3/D9/D2/D8is an integer, then /B2/D3/D9/D2/D8is a pointer
to an integer. The ampersand and star are inverses:/B6/B4/B2/D3/D9/D2/D8/B5 /BP/BP /D3/D9/D2/D8, which may imply that they
are symmetric, but the star will appear much more of-
teninyourcodethantheampersand,andanampersand
willneverappear inadeclarationorafunctionheader.
As a mnemonic, ampersand ,and sign, andaddress of
allbegin withthe letterA.There are actually three character-
istics to a given pointer: the lo-
cation (where the ﬁnger is point-
ing), the type (here, /CX/D2/D8), and
the amount of memory which
has been reserved for the pointer
( /D7/CX/DE/CT/D3/CU/B4/CX/D2/D8/B5 bytes—enough for
one integer). The location is up
to the computer—you should never
have to look at hexadecimal ad-
dresses. But you need to bear in
mind the type and size of your pointer. If you treat the data po inted to by an /CX/D2/D8
pointer as if it is pointing to a /CS/D3/D9/CQ/D0/CT, then the computer will read good data as
garbage, and if you read twenty variables from a space alloca ted for ﬁfteen, then
theprogram will eitherreadgarbageorsegfault.
By the way, /CX/D2/D8 /B6/CZ /BP /BJwill fail—the initialization on the declaration line is for
the pointer, not the value the pointer holds. Given that k is a pointer to an integer,
alloftheselines arecorrect:
int*k =malloc( sizeof(int));
*k=7;
k= malloc( sizeof(int));
Oneconveniencethatwill helpwith allocatingpointers is /CP/D0/D0/D3, which youcan
read asclear and allocate : it will run /D1/CP/D0/D0/D3and return the appropriate address,
andwillalsoseteverythinginthatspacetozero,running /B6/CZ /BP /BCforyou.Sample
usage:
int*k =calloc(1, sizeof(int));
gsl_stats March24,2009
58 CHAPTER 2
The syntax requires that we explicitly state that we want one space, the size of
an integer. You need to give more information than /D1/CP/D0/D0/D3because the process
of putting a zero in a /CS/D3/D9/CQ/D0/CTpointer may be different from putting a zero in
a /CX/D2/D8pointer. Thus /CP/D0/D0/D3requires two arguments: /CP/D0/D0/D3/B4 /CT/D0/CT/D1/CT/D2/D8/CN/D3/D9/D2/D8 /B8/D7/CX/DE/CT/D3/CU/B4 /CT/D0/CT/D1/CT/D2/D8/CN/D8/DD/D4/CT /B5/B5.
Finally, both allocation and de-allocation are now your res ponsibility. The de-
allocation comes simply by calling /CU/D6/CT/CT/B4/CZ/B5 when you are done with the pointer/CZ. When the program ends, the operating system will free all me mory; some peo-
plefreeallpointersattheendof /D1/CP/CX/D2asapointofgoodform,andsomeleavethe
computerto do thefreeing.
Q2.10Write a function named /D7/DB/CP/D4that takes two pointers to /CX/D2/D8variables and
exchangestheir values.
• First,write a /D1/CP/CX/D2functionthatsimplydeclarestwo /CX/D2/D8s(notpoint-
ers) /CU/CX/D6/D7/D8and /D7/CT/D3/D2/CS, gives them values, prints the values and re-
turns.Checkthatit compiles.
• Then,write a /D7/DB/CP/D4functionthatacceptstwo pointers,butdoesnoth-
ing.Thatis, write outtheheaderbutlet thebodybe /DF /DH.
• Call your empty function from /D1/CP/CX/D2. Do you need to use /B2/CU/CX/D6/D7/D8
(as per the box on page 57), /B6/CU/CX/D6/D7/D8, or just /CU/CX/D6/D7/D8? Check that the
programstill compiles.
• Finally, write the swap function itself. ( Hint: include a local variable/CX/D2/D8 /D8/CT/D1/D4.)Add a /D4/D6/CX/D2/D8/CUto the end of /D1/CP/CX/D2to makesure thatyour
functionworked.
Q2.11Modifyyourswapprogramsothatthetwovariablesin /D1/CP/CX/D2arenowpoint-
ersto /CX/D2/D8s.
• Add allocations via /D1/CP/D0/D0/D3, either in the declaration itself or on an-
otherline.
• Which of /B2/CU/CX/D6/D7/D8, /B6/CU/CX/D6/D7/D8, or /CU/CX/D6/D7/D8will you need to send to /D7/DB/CP/D4
now?Do youneedto modifythe /D7/DB/CP/D4function itself?
Q2.12Modify /CP/D0/D0/CQ/DD/CP/CS/CS/BA sothatthedeclarationonline15isforaninteger,not
a pointer. That is, replace the current /CX/D2/D8 /B6/CP /BP /D1/CP/D0/D0/D3/B4/BA/BA/BA/B5/BN with /CX/D2/D8/CP/BN. Make the necessary modiﬁcations to /D1/CP/CX/D2to get the program running.
Donotmodifythe /CU/CP/D8/D3/D6/CX/CP/D0 function.
gsl_stats March24,2009
C 59
®A variablecanholdthe addressofa locationin memory.
®By passing that address to a function, the function can modif y that
location in memory, even though only copies of variables are passed
into functions.
®A star in a declaration means the variable is a pointer, e.g., /CX/D2/D8 /B6/CZ.
A star in a non-declaration line indicates the data at the loc ation to
whichthe pointerpoints,e.g., /D8/DB/D3/CN/D8/CX/D1/CT/D7 /BP /B6/CZ /B7 /B6/CZ.
®The space to which a pointer is pointing needs to be
prepared using /D1/CP/D0/D0/D3, e.g., /CX/D2/D8 /B6 /CX/D2/D8/CT/CV/CT/D6/CN/CP/CS/CS/D6/CT/D7/D7 /BP/D1/CP/D0/D0/D3/B4/D7/CX/DE/CT/D3/CU/B4/CX/D2/D8/B5/B5/BN .
®When you are certain a pointer will not be used again, free it, e.g.,/CU/D6/CT/CT/B4 /CX/D2/D8/CT/CV/CT/D6/CN/CP/CS/CS/D6/CT/D7/D7 /B5.
2.7 A RRAYS AND OTHER POINTER
TRICKSYou can use a pointer as an array: in-
steadofpointingto a singleinteger,for
example, you can point to the ﬁrst of a
sequenceof integers.Listing 2.9showssomesamplecodeto d eclarean array and
ﬁllit with squarenumbers:
#include <stdlib.h>
#include <stdio.h>
intmain(){
intarray_length=1000;
int*squares = malloc (array_length *sizeof(int));
for(inti=0;i < array_length; i++)
squares[i] = i *i;
}
Listing2.9 Allocate an arrayandﬁllitwithsquares. Online source: /D7/D5/D9/CP/D6/CT/D7/BA .
The syntax for declaring the array exactly matches that of al locating a single
pointer, except we needed to allocate a block of size /BD/BC/BC/BC /B6 /D7/CX/DE/CT/D3/CU/B4/CX/D2/D8/B5 in-
stead of just a single /D7/CX/DE/CT/D3/CU/B4/CX/D2/D8/B5 . Referring to an element of /D7/D5/D9/CP/D6/CT/D7 uses
identicalsyntaxtotheautomatically-declaredarraysatt hebeginningofthischap-
ter.Internally,bothtypesofarrayarejustasequenceofbl ocksofmemoryholding
acertain datatype.
gsl_stats March24,2009
60 CHAPTER 2
Q2.13The listing in /D7/D5/D9/CP/D6/CT/D7/BA is not very exciting, since it has no output. Add
a second /CU/D3/D6loop to print a table of squares to the screen, by printing the
index /CXandthe valuein the /D7/D5/D9/CP/D6/CT/D7 array atposition /CX.
Q2.14After the /CU/D3/D6loop, /D7/D5/D9/CP/D6/CT/D7/CJ/BJ℄ holds a plain integer (49). Thus, you can
refer to that integer’s address by putting a /B2before it. Extend your version
of /D7/D5/D9/CP/D6/CT/D7/BA touseyourswapfunctiontoswapthevaluesof /D7/D5/D9/CP/D6/CT/D7/CJ/BJ℄
and /D7/D5/D9/CP/D6/CT/D7/CJ/BK℄ .
But despite their many similarities, arrays and pointers ar e not identical: one is
automatically allocated memory and the other is manually al located. Given the
declarations
doublea_thousand_doubles[1000];
//and
double*a_thousand_more_doubles = malloc(1000 *sizeof(double));
theﬁrstdeclaresanautomaticallyallocatedarray,justas /CX/D2/D8 /CXisautomaticallyal-
located,andthereforetheallocationandde-allocationof thevariableistherespon-
sibility of the compiler. The second allocates memory that w ill be at the location/CP/CN/D8/CW/D3/D9/D7/CP/D2/CS/CN/CS/D3/D9/CQ/D0/CT/D7 untilyoudecideto free it.
In functionarguments,youcaninterchangetheirsyntaxes. Theseareequivalent:
inta_function( double*our_array);
//and
inta_function( doubleour_array[]);
But be careful: if your function /CU/D6/CT/CTs an automatically allocated array passed in
from the parent, or assigns it a new value with /D1/CP/D0/D0/D3, then you are stepping on
C’sturf, andwill getasegfault.
ARRAYS OF STRUCTS Before, when we used the /D7/D8/D6/D9/D8for complex numbers,
we referred to its elements using a dot, such as /CP/BA/D6/CT/CP/D0or/CQ/BA/CX/D1/CP/CV/CX/D2/CP/D6/DD . For a pointer to a structure, use /B9/BQinsteadof a dot. Here are some
examplesusingthedeﬁnitionofthe /D3/D1/D4/D0/CT/DC structure from page31.
complex *ptr_to_cplx = malloc ( sizeof(complex));
ptr_to_cplx−>real = 2;
ptr_to_cplx−>imaginary =−2;
complex *array_of_cplxes =malloc (30 *sizeof(complex));
array_of_cplexes[15] −>real= 3;
gsl_stats March24,2009
C 61
If you get an error like request for member ‘real’ in something not a structure or
unionthen you are using a dot where you should be using /B9/BQor vice versa. Use
thatfeedbackto understandwhatyou misunderstood,then sw itchto the otherand
try again.
REALLOCATING Ifyouknowhowmanyitemsyouwillhaveinyourarray,thenyou
probably won’t botherwith pointers, andwill insteaduse th e /CX/D2/D8/CU/CX/DC/CT/CS/CN/D0/CX/D7/D8/CJ/BF/BC/BC℄ declaration, so you can leave the memory allocation issues t o
thecomputer.Butif youtry toput301elementsin thelist(wh ich, youwill recall,
means putting something in /CU/CX/DC/CT/CS/CN/D0/CX/D7/D8/CJ/BF/BC/BC℄ ), then you will be using memory
thatthemachinehadn’tallocatedfor you—asegfault.
If you are not sure about the size of your array, then you will n eed to expand
the array as you go. Listing 2.10 is a program to ﬁnd prime numbers , with a few
amusingtricksthrownin.Sincewedon’tknowhowmanyprimes wewillﬁnd,we
need to use /D6/CT/CP/D0/D0/D3. The program runs until you hit <ctrl-c>, and then dumps
outthe completelistto thatpoint.
• Line 13: /CB/C1/BZ/C1/C6/CCis the signal that hitting <ctrl-c>sends to your program. By
default, it halts your program immediately, but line 13 tell s the system to call the
one-line function on line 9 when it receives this signal. Thu s, the /DB/CW/CX/D0/CTloop be-
ginning at line 14 will keeprunning until you hit <ctrl-c>; then the program will
continueto line 26.
• Lines 16–17: Check whether /D8/CT/D7/D8/D1/CTis evenly divisible by /D4/D6/CX/D1/CT/D7/CJ/CX℄ . The sec-
ond element of the /CU/D3/D6loop, the run-while condition, includes severalcondition s
atonce.
• Line 19: Computers in TV and movies always have fast-moving counters on the
screen giving the impression that something important is ha ppening, and line 19
showshowitisdone.Thenewline \ /D2isactuallytwosteps:acarriagereturn(goto
beginningof line) plus a line feed (go to nextline). The \ /D6characteris a carriage
return with no line feed, so the current line will be rewritte n at the next /D4/D6/CX/D2/D8/CU.
The /CU/CU/D0/D9/D7/CWfunctiontellsthesystemtomakesurethateverythinghasbe enwritten
to thescreen.
• Lines20–24:Havingfoundaprimenumber,weadditto thelis t, whichisathree-
step process: reallocate the list to be one item larger, put t he element in the last
space,andadd one to the counterholding the size of the array . Theﬁrst argument
to /D6/CT/CP/D0/D0/D3 is the pointerwhosespaceneedsresizing,andthe secondarg umentis
the new size. The ﬁrst part of this new block of memory will be t he /D4/D6/CX/D1/CT/D7array
so far, and the end will be an allocated butgarbage-ﬁlledspa ceready for us to ﬁll
with data.
gsl_stats March24,2009
62 CHAPTER 2
1#include <math.h>
2#include <stdio.h>
3#include <signal.h>
4#include <malloc.h>
5
6intct =0,keepgoing =1;
7int*primes = NULL;
8
9voidbreakhere(){ keepgoing = 0; }
10
11intmain(){
12inti,testme = 2, isprime;
13 signal(SIGINT,breakhere);
14 while(keepgoing){
15 isprime = 1;
16 for(i=0; isprime && i< sqrt(testme) && i<ct;i++)
17 isprime= testme % primes[i];
18 if(isprime){
19 printf("%i \r",testme); fﬂush(NULL);
20 primes =realloc(primes, sizeof(int)*(ct+1));
21 primes[ct]= testme;
22 ct++;
23 }
24 testme ++;
25 }
26 printf("\n");
27 for(i=0; i< ct;i++)
28 printf("%i\t", primes[i]);
29 printf("\n");
30 }
Listing2.10 Findprime numbers andput them inanarray. Onli ne source: /D4/D6/CX/D1/CT/D7/BA .
SOME COMMON FAUX PAS Figure 2.11 shows two errors in pointer handling. The
ﬁrst step picks up from the second step of Figure 2.7:
a function has beencalled with a pointeras an argument. Then , the function frees
what the copy of a pointer is pointing to—and thus frees what t he original ﬁnger
waspointing to. Next, it allocatesnewspace,movingthe cop yofa ﬁngerto point
to a new location. But when the function ﬁnishes, depicted in the ﬁnal step, the
copyofapointerisdestroyed,sothereisnowaytorefertoth e /D1/CP/D0/D0/D3edspacein
the main program. We now have a pointer in the main frame with n o space and a
spacewith nopointer.
Returning to the library metaphor for a moment, the calling f unction wrote down
a call number on a slip of paper, handed it to the function, and the function then
went into the shelves and moved things around. But since the f unction has no
mechanismoftelling thecallerwhereitputthings,theshel vesarenowamess.
Listing2.12isarepeatoftheprime-ﬁndingcode,withthecu tetricksremovedand
gsl_stats March24,2009
C 63
Figure 2.11 How tomess upyour pointers
1#include <math.h>
2#include <stdio.h>
3#include <malloc.h>
4
5voidadd_a_prime( intaddme,int*ct,int**primes){
6*primes = realloc( *primes,sizeof(int)*(*ct+1));
7 ( *primes)[*ct] = addme;
8 ( *ct)++;
9 }
10
11intmain(){
12intct =0, i,j,testme = 2,isprime,max= 1000;
13int*primes = NULL;
14 for(j=0; j< max;j++){
15 isprime = 1;
16 for(i=0; isprime && i<sqrt(testme) && i<ct;i++)
17 isprime =testme % primes[i];
18 if(isprime)
19 add_a_prime(testme,&ct, &primes);
20 testme ++;
21 }
22 for(i=0;i<ct; i++)
23 printf("%i\t", primes[i]);
24 printf("\n");
25 }
Listing2.12 Findprime numbers and put them inanarray. Onli ne source: /D4/D6/CX/D1/CT/D7/BE/BA .
theprocessofaddingaprimerelegatedtoaseparatefunctio n(asitshouldbe).The
wrongwayto implementthefunctionin lines5–9wouldbe
voidadd_a_prime_incorrectly( intaddme,int*ct,int*primes){
primes = realloc(primes, sizeof(int)*(*ct+1));
primes[*ct] = addme;
(*ct)++;
}
gsl_stats March24,2009
64 CHAPTER 2
Thiscommitstheabovefauxpasofchangingthevalueofthe copyof /D4/D6/CX/D1/CT/D7and
allocating new data at the new location—but whatevercalled that function has no
idea about these changes in /D4/D6/CX/D1/CT/D7, and will keep on pointing to what may now
beaninvalidlocation.
The correct method is shown in Listing 2.12. It passes a point er to the /D4/D6/CX/D1/CT/D7
pointer—the location of the location of data. The calling fu nction sends in the
location of the card catalog, and the called function can the n revise the locations
listedin the cardcatalogwhenit makeschangesontheshelve s.
Thesyntax may seemconfusing,butcompare it to how /D8is treated. Becausethe
function will modify it, line 19 sends in its location, /B2/D8, and the function header
has an extra star: instead of /CX/D2/D8 /D8, it refers to the address /CX/D2/D8 /B6/D8. Similarly,
the function call sends in the array’s address, /B2/D4/D6/CX/D1/CT/D7, and the function adds a
starto the header, /CX/D2/D8 /B6/B6/D4/D6/CX/D1/CT/D7 .
Q2.15Kernighan & Pike (1999) point out that /D6/CT/CP/D0/D0/D3 can be slow, so you are
betteroffnotcallingiteverytimeanarrayisextended.Ins tead,theysuggest
thateverytimeanarrayoflength nis /D6/CT/CP/D0/D0/D3ed,itssizebedoubledto 2n.
Thus, if an array will eventually have ten elements, it will b e /D6/CT/CP/D0/D0/D3ed
when adding the ﬁrst, second, fourth, and eighth data points , for a total of
fourreallocationsinsteadoften.
Rewrite the code in ﬁgure /D4/D6/CX/D1/CT/D7/BE to implement this method of selective
reallocation.
®Arraysareinternallyrepresentedaspointers.The /CX/D2/D8 /D7/CP/D6/D6/CP/DD /CJ/BD/BC/BC℄
form creates an automatically-allocated array, where the c om-
puter creates and destroys the array; the /CX/D2/D8 /B6 /CW/CP/D6/D6/CP/DD /BP/D1/CP/D0/D0/D3/B4/D7/CX/DE/CT/D3/CU/B4/CX/D2/D8/B5 /B6 /BD/BC/BC/B5/BNform creates a manually-allocated
arraythatis yourstoallocateanddeallocate.
®Referto array elementsin both casesusingthe samesquare-b rackets
notation,suchas /CW/CP/D6/D6/CP/DD/CJ/BD/BG℄ .
®Arraysofstructscanbedeclaredjustaswitharraysofbasic variables.
Refertothe elementsin a pointer-to-structusing /B9/BQ.
®Youcanexpandamanually-allocatedarrayusing /D6/CT/CP/D0/D0/D3.
®Just as copies of normal variables are passed to functions, c opies of
pointers are sent in. Therefore, be careful when modifying a pointer
in asubfunction.
gsl_stats March24,2009
C 65
2.8 STRINGS C’s handling of text stringsis simple, elegant, unpleasant and
awkward. Although this book is oriented toward programs abo ut
manipulating numbers rather than building Web pages or othe r such text, words
and phrases are inevitable in even the mathiest of programs. So this section will
coverthebasicsofhowasystemdealswith variable-lengtht ext.
There are three approaches to dealing with C’s awkwardness r egarding text. You
can (and should) skim the standard library documentation, t o get to know what
functions are always available for the most common string op erations. You can
useahigher-levellibrary-provideddatatypefortext,suc hasGlib’s /BZ/CB/D8/D6/CX/D2/CV type
(see Chapter 6 on Glib). Or, you can leave C entirely and do tex t manipulation
via a number of command-line tools or a text-focused languag elike Ruby or Perl
(see Appendix B). Nonetheless,all of these methods are base d on C’s raw string-
handling at their core, and the raw C methods are always at han d, so it is worth
gettingto knowC’sstring-handlingevenif youpreferhighe r-levelmethods.
C implements lines of text such as Ꜽ/CW/CT/D0/D0/D3Ꜽ as arrays of individual characters,
followedbyaninvisiblenullcharacter,writtenas \ /BC.Thatis,youmaythinkofthe
above single word as a shorthand for the array /DF/B3/CW/B3/B8 /B3/CT/B3/B8 /B3/D0/B3/B8 /B3/D0/B3/B8 /B3/D3/B3/B8/B3\ /BC/B3/DH. This means that you have to think in terms of arrays when deal ing with
stringsofcharacters.
The ﬁrst implication of the elegant use of arrays to represen t text is that your
expectationsaboutassignmentwon’t work.Hereare someexa mples:
1charhello[30];
2charhello2[]= "Hi.";
3 hello= hello2; //Thisis probably not what you meant.
4 hello= "Hithere"; //Nor isthis.
• Lineoneshowsthatstringsaredeclaredwitharray-styled eclarations,eitherofthe
static form hereorvia /D1/CP/D0/D0/D3.
• Line two shows that, as with arrays of integers, we can speci fy a list to put in to
thearray whenwe initialize the array,butnotlater.
• But it is a common error to think that line three will copy the text Ꜽ/C0/CX/BAꜼinto/CW/CT/D0/D0/D3,butaswithpointerstointegers,theactualfunctionofthi rdlineisapointer
operation:insteadofcopyingthedatapointedtoby /CW/CT/D0/D0/D3/BEtothelocationpointed
to by /CW/CT/D0/D0/D3, it simply copies the location of /CW/CT/D0/D0/D3/BE. When you change the text
at one pointer later on, the other (now pointing to the same lo cation) will change
as well. Along a similar vein,line four also doesnot behavea s you may expect.27
27Line four will compile, because the string Ꜽ/C0/CX /D8/CW/CT/D6/CT/BAꜼ is held in memory somewhere, so the pointer/CW/CT/D0/D0/D3can point to it. However, a pointer to literal text is a /D3/D2/D7/D8pointer, meaning that the ﬁrst time you try to
change /CW/CT/D0/D0/D3, the program will crash.
gsl_stats March24,2009
66 CHAPTER 2
Instead, there are a series of functions that take in strings to copy and otherwise
handlestrings./D7/D8/D6/D0/CT/D2 There are two lengths associatedwith a string pointer: the ﬁ rst is the space/D1/CP/D0/D0/D3ed for the pointer, and the second is the number of characters until
the string-terminating /B3\ /BC/B3character appears. Size of free memory is your re-
sponsibility,but /D7/D8/D6/D0/CT/D2/B4 /DD/D3/D9/D6/CN/D7/D8/D6/CX/D2/CV /B5will return thenumberoftextcharacters
in /DD/D3/D9/D6/CN/D7/D8/D6/CX/D2/CV ./D7/D8/D6/D2/D4/DD Continuing the above example, this is the right way to copy da ta into/CW/CT/D0/D0/D3:
#include <string.h>
strncpy(hello,"Hi there.", 30);
strncpy(hello,hello2,30);
Thethird argumentis thetotalspace /D1/CP/D0/D0/D3edto /CW/CT/D0/D0/D3,not /D7/D8/D6/D0/CT/D2/B4 /CW/CT/D0/D0/D3 /B5./D7/D8/D6/D2/CP/D8 Ratherthanoverwritingonestringwithanother,youcanals oappend(i.e.,
concatenate)onestring to another,using
strncat(base_string, addme,freespace);
For example, /D7/D8/D6/D2/CP/D8/B4/CW/CT/D0/D0/D3/B8 /CW/CT/D0/D0/D3/BE/B8 /BF/BC/B5will leave Ꜽ/C0/CX /D8/CW/CT/D6/CT/BA /C0/CT/D0/D0/D3/BAꜼ
in /CW/CT/D0/D0/D3.
Q2.16The key problem with pointers-as-strings is that editing a s tring often be-
comes a three-step problem: measure the length the string wi ll have after
beingchanged,then /D6/CT/CP/D0/D0/D3 thestring to the appropriatesize,thenﬁnally
makethe changeto thestring.
Write a function /CP/D7/D8/D6/D2/D4/DD/B4/CW/CP/D6 /B6/B6/CQ/CP/D7/CT/B8 /CW/CP/D6 /B6/D3/D4/DD/D1/CT/B5 , that will
copy /D3/D4/DD/D1/CTto /B6/CQ/CP/D7/CT. Internally, it will use /D7/D8/D6/D0/CT/D2, /D6/CT/CP/D0/D0/D3, and/D7/D8/D6/D2/D4/DD toexecutethethreestepsofstringextension.Alloftheabo vedis-
cussionregardingre-pointingpointersinsideafunctiona pplieshere,which
iswhythefunctionneedstotakeinapointer-to-pointerasi tsﬁrstargument.
Oncethis function is working, write a function /CP/D7/D8/D6/D2/CP/D8 that executesthe
sameprocedureforstringconcatenation.Afteryou’vetest edbothfunctions,
addthem to yourlibrary ofutilities.
gsl_stats March24,2009
C 67/D7/D2/D4/D6/CX/D2/D8/CU The /D7/D2/D4/D6/CX/D2/D8/CU functionworksjustlikethe /D4/D6/CX/D2/D8/CUstatementsabove,but
prints its output to a string insteadof the screen.28The ﬁll-in-the-blanks
syntaxfor /D4/D6/CX/D2/D8/CUworksin exactlythe samemannerwith strings.
#include <string.h>
...
intstring_length = 1000;
charwrite_to_me[string_length];
charname[]= "Steven";
intposition =3;
snprintf(write_to_me, string_length,"person %s isnumbe r %i inline\n", name,position);
However, the three-step process of measuring the new string , calling /D6/CT/CP/D0/D0/D3,
and then ﬁnally modifying the string is especially painful f or /D7/D2/D4/D6/CX/D2/D8/CU , because
it is hard to know how long the /D4/D6/CX/D2/D8/CU-style format speciﬁer will be after all its
blanks are ﬁlled in. One way to make sure there is enough room f or adding more
text would be to simply allocate an absurd amount of space for each string, like
just undera megabyteof memory: /CW/CP/D6 /CW/CT/D0/D0/D3/CJ/BD/BC/BC/BC/BC/BC/BC℄ . You won’t notice the
wasted memory on a modern computer, but this method is also er ror-prone: what
if youhavea brilliant idea abouta /CU/D3/D6loop that will add a little text for eachof a
million datapointsinto thestring?/CP/D7/D4/D6/CX/D2/D8/CU If you are using the GNU C library, BSD’s standard C library, o r Apo-
phenia,youcoulduse /CP/D7/D4/D6/CX/D2/D8/CU ,whichallocatesastring thatisjustbig
enough to handle the inputs, and then runs /D7/D2/D4/D6/CX/D2/D8/CU . Here is a simple example,
with nomemory allocationinsight, to printto /D0/CX/D2/CT.
char*line;
asprintf(&line,"%sis number %i inline.","Steven", 7);
Once again, because /CP/D7/D4/D6/CX/D2/D8/CU will probably move /D0/CX/D2/CTin memory, we need to
sendthe locationofthepointer, notthe pointeritself.
You can comfortably put /CP/D7/D4/D6/CX/D2/D8/CU into a /CU/D3/D6loop without worrying aboutover-
ﬂow.Hereis asnippetto write a stringthatcountstoa hundre d:29
28The other nice feature of /D7/D2/D4/D6/CX/D2/D8/CU is that it is more secure: other common functions like /D7/D8/D6/D4/DDand/D7/D4/D6/CX/D2/D8/CU do not check the length of the input, and so make it easy for you to inadvertently overwrite important
bits of memory with the input string, including the location of the next instruction to be executed. Unsafe string-
handling functions are thus acommon security risk, allowin g the execution of malicious code.
29Because /CP/D7/D4/D6/CX/D2/D8/CU doesnotfreethecurrent spacetaken upby /D7/D8/D6/CX/D2/CVbeforereallocating thenew version,
this /CU/D3/D6loop isamemory leak. In many situations itisn’tenough of al eak to matter, butif it is,you willneed to
use:/CU/D3/D6 /B4/CX/D2/D8 /CX /BP/BC/BN /CX/BO /BD/BC/BC/BN /CX/B7/B7/B5/DF/CW/CP/D6 /B6/D8/D1/D4 /BP /D7/D8/D6/CX/D2/CV/BN/CP/D7/D4/D6/CX/D2/D8/CU/B4/B2/D7/D8/D6/CX/D2/CV/B8 Ꜽ/B1/D7 /B1/CXꜼ/B8 /D7/D8/D6/CX/D2/CV/B8 /CX/B5/BN/CU/D6/CT/CT/B4/D8/D1/D4/B5/BN/DH
gsl_stats March24,2009
68 CHAPTER 2
char*string= NULL;
asprintf(&string,""); //initializetoempty, non −NULLstring.
for(inti=0; i< 100; i++)
asprintf(&string,"%s %i", string,i);
If you don’t have /CP/D7/D4/D6/CX/D2/D8/CU on hand, you can hack your way through by guess-
ing the ﬁnal length of the ﬁlled-in string and running the mea sure/ /D6/CT/CP/D0/D0/D3/write
proceduredirectly,e.g.:30
char*string= NULL;
charint_as_string[10000];
for(inti=0; i< 100; i++){
intnewlen = strlen(string) +10000;
string= realloc(string,newlen);
snprintf(int_as_string,10000, " %i",i);
strncat(string,int_as_string, newlen);
}
• The C standard deﬁnes /D7/CX/DE/CT/D3/CU/B4/CW/CP/D6/B5/BP/BP/BD , so it is safe to write /D2/CT/DB/D0/CT/D2in the
placeof /D7/CX/DE/CT/D3/CU/B4/CW/CP/D6/B5/B6/D2/CT/DB/D0/CT/D2 .31
SeeListing3.7,page112,foranotherexampleofextendinga string insidealoop.
Q2.17Modify /D4/D6/CX/D1/CT/D7/BE/BA to write to a string named /D4/D6/CX/D1/CT/D7/CN/D7/D3/CN/CU/CP/D6 rather than
printing to the screen. As the last step of the program, /D4/D6/CX/D2/D8/CU/B4/D4/D6/CX/D1/CT/D7/CN/B9/D7/D3/CN/CU/CP/D6/B5.
Q2.18Modifytheprograminthelastexercisetoprintonlyprimesw hoselastdigit
isseven.( Hint: ifyouhavewritten anumberto /D4/D7/D8/D6/CX/D2/CV, youcancompare
the last element in /D4/D7/D8/D6/CX/D2/CV’s array of characters to the single character/B3/BJ/B3.)/D7/D8/D6/D1/D4 Because strings are arrays, the form /CX/CU/B4Ꜽ/C2/D3/CTꜼ/BP/BPꜼ/C2/CP/D2/CTꜼ/B5 does not make
sense.Instead,the /D7/D8/D6/D1/D4function goesthrough the two arraysof charac-
tersyouinput, anddeterminescharacter-by-characterwhe thertheyareequal.
You are encouraged to notuse /D7/D8/D6/D1/D4. If /D7/BDand /D7/BEare identical strings, then/D7/D8/D6/D1/D4/B4/D7/BD/B8 /D7/BE/B5/BP/BP/BC; if they are different, then /D7/D8/D6/D1/D4/B4/D7/BD/B8 /D7/BE/B5/AX/BP/BC. There is
30It would be nice if we could use /D7/D2/D4/D6/CX/D2/D8/CU/B4/D7/D8/D6/CX/D2/CV/B8 /D2/CT/DB/D0/CT/D2/B8 Ꜽ/B1/D7 /B1/CXꜼ/B8 /D7/D8/D6/CX/D2/CV/B8 /CX/B5, but using/D7/D2/D4/D6/CX/D2/D8/CU to insert /D7/D8/D6/CX/D2/CVinto /D7/D8/D6/CX/D2/CVbehaves erratically. This is one more reason to ﬁnd a system w ith/CP/D7/D4/D6/CX/D2/D8/CU .
31ISOC standard, Committee Draft, ISO/IEC 9899:TC2, §6.5.3. 4,par 3.
gsl_stats March24,2009
C 69
a rationale for this: the /D7/D8/D6/D1/D4function effectively subtracts one string from the
other,sowhentheyareequal,thenthedifferenceiszero;wh entheyarenotequal,
thedifferenceisnonzero.Butthegreatmajorityofhumansr ead /CX/CU /B4/D7/D8/D6/D1/D4/B4/D7/BD/B8/D7/BE/B5/B5to mean ‘if /D7/BDand /D7/BEare the same, do the following.’ To translate that En-
glish sentiment into C, you would need to use /CX/CU /B4/AX/D7/D8/D6/D1/D4/B4/D7/BD/B8 /D7/BE/B5/B5. Experi-
encedprogrammerstheworld overregularlygetthis wrong.
Q2.19Add a function to your library of convenience functions to co mpare two
stringsandreturnanonzerovalueifthestringsareidentic al,andzeroifthe
stringsare notidentical.Feelfree to use /D7/D8/D6/D1/D4internally.
®Strings are actually arrays of /CW/CP/D6s, so you must think in pointer
terms whendealingwith them.
®There are a number of functions that facilitate copying,add ing to, or
printing to strings, but before you can use them, you need to k now
howlongthestring will beafterthe edit.
2.9 /F4ERRORS Thecompilerwillwarnyouofsyntaxerrors,andyouhaveseen
howthedebuggerwillhelpyouﬁndruntimeerrors,butthebes t
approach to errors is to make sure they neverhappen. This sec tion presents a few
methodstomakeyourcodemorerobustandreliable.Theydove tailwiththenotes
aboveabout writing one function at a time and making sure tha t function does its
taskwell.
TESTING THE INPUTS Here is a simple function to take the mean of an input ar-
ray.32
doubleﬁnd_means( double*in,intlength){
doublemean =in[0];
for(inti=1;i < length,i++)
mean += in[i];
returnmean/length;
}
What happens if the user calls the function with a /C6/CD/C4/C4pointer? It crashes. What
happens if /D0/CT/D2/CV/D8/CW/BP/BP/BC ? It crashes. You would have an easy enough time pulling
32Normally, we’d just assign /CS/D3/D9/CQ/D0/CT /D1/CT/CP/D2/BP/BCat ﬁrst and loop beginning with /CX/BP/BC; I used this slightly odd
initialization for the sake of the example. How would the two approaches differ for azero-length array?
gsl_stats March24,2009
70 CHAPTER 2
out the debuggerand drilling down to the point where you sent in bad values, but
itwould beeasierif theprogram told youwhentherewasanerr or.
Below is a version of /CU/CX/D2/CS/CN/D1/CT/CP/D2/D7 that will save you trips to the debugger. It
introduces a new member of the /D4/D6/CX/D2/D8/CUfamily: /CU/D4/D6/CX/D2/D8/CU, which prints to ﬁles
andstreams. Streams are discussed further in Appendix B; for now it sufﬁ ces to
note that writing to the /D7/D8/CS/CT/D6/D6stream with /CU/D4/D6/CX/D2/D8/CU is the appropriate means of
displayingerrors.
doubleﬁnd_means( double*in,intlength){
if(in==NULL){
fprintf(stderr,"Yousent a NULLpointer toﬁnd_means.\n") ;
returnNAN;
}
if(length<=0){
fprintf(stderr,"Yousent aninvalid lengthtoﬁnd_means.\ n");
returnNAN;
}
doublemean = in[0];
for(inti=1; i < length, i++)
mean += in[i];
returnmean/length;
}
This took more typing, and does not display the brevity that m athematicians ad-
mire, butitgainsin clarity andusability.Listingconditi onsontheinputsprovides
atouchofadditionaldocumentationonwhatthefunctionexp ectsandthuswhatit
will do.Ifyoumisusethefunction,youwill knowthe errorin aheartbeat.
The /B2/B2and /DG /DGare perfect for inserting quick tests, because the left-han d side can
testforvalidityandtheright-handsidewillexecuteonlyi fthevaliditytestpasses.
Forexample,letussaythattheusergivesusalistofelement indexes,andwewill
add them to a counter only if the chosen array elements are eve n. The quick way
to dothis isto simply usethe %operator:
if(!(array[i] % 2))
evens += array[i];
Butifthearrayindexisinvalid,thiswillbreak.So,wecana ddtestsbeforetesting
forevenness:
if(i > 0&& i< array_len && !(array[i]%2))
evens += array[i];
gsl_stats March24,2009
C 71
If /CXis out of bounds, then the program just throws /CXout and moves on. When
failing silently is OK, these types of tests are perfect; whe n the system should
complainloudly whenit encountersafailure, thenmoveonto the nexttool in our
list: /CP/D7/D7/CT/D6/D8./CP/D7/D7/CT/D6/D8 The /CP/D7/D7/CT/D6/D8macro makes a claim, and if the claim is false, the program
haltsatthatpoint.Thiscanbeusedforbothmathematicalas sertionsandfor
housekeeping like checking for /C6/CD/C4/C4pointers. Here is the above input-checking
functionrewritten using /CP/D7/D7/CT/D6/D8:
#include <assert.h>
doubleﬁnd_means( double*in,intlength){
assert (in!=NULL);
assert (length>0);
doublemean = in[0];
for(inti=1;i < length,i++)
mean += in[i];
returnmean/length;
}
If your assertion fails, then the program will halt, and a not ice of the failure will
print to the screen. On a gcc-based system, the error message would look some-
thing like
assert: your_program.c:4: ﬁnd_means: Assertion‘length> 0’ failed.
Aborted
Somepeoplecommentouttheassertionswhentheyfeelthepro gramisadequately
debugged, but this typically saves no time, and defeats the p urpose of having the
assertionstobeginwith—areyou sureyou’llneverﬁndanotherbug?Ifyou’dlike
to compare timing with and without assertions,the - /BW/C6/BW/BX/BU/CD/BZ ﬂag to the compiler
(just add it to the command line) will compile the program wit h all the /CP/D7/D7/CT/D6/D8
statementsskippedover.
Q2.20The method above for taking a mean runs risks of overﬂow error s: for an
array of a million elements, /D1/CT/CP/D2will grow to a million times the average
valuebeforebeingdivideddownto its naturalscale.
Rewrite thefunctionsothatit calculatesanincrementalme anasafunction
ofthemeantodateandthenextelement.Giventhesequence x1,x2,x3,...,
the ﬁrst mean would be µ1=x1, the second would be µ2=µ1
2+x2
2, the
third would be µ3=2µ2
3+x3
3, et cetera. Be sure to make the appropriate
assertionsabouttheinputs. Fora solution,seethe GSL /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/D1/CT/CP/D2
function,orthecodein /CP/D4/D3/D4/CN/CS/CQ/CN/D7/D5/D0/CX/D8/CT/BA .
gsl_stats March24,2009
72 CHAPTER 2
TEST FUNCTIONS Thebestwaytoknowwhetherafunctionisworkingcorrectlyi s
totestit,viaaseparatefunctionwhosesolepurposeistote stthe
mainfunction.
Agoodtestfunctiontriestocoverboththeobviousandstran gepossibilities:what
if the vector is only one element, or has unexpectedvalues? D o thecorner cases ,
such as when the input counter is zero or already at the maximu m, cause the
function to fail? It may also be worth checking that the absol utely wrong inputs,
like /CU/CX/D2/CS/CN/D1/CT/CP/D2/D7/B4/CP/D6/D6/CP/DD/BG/B8 /B9/BF/B5will fail appropriately. Here is a function to run/CU/CX/D2/CS/CN/D1/CT/CP/D2/D7 throughits paces:
voidtest_ﬁnd_means(){
doublearray1[]= {1,2,3,4};
intlength =4;
assert(ﬁnd_means(array1,length) ==2.5);
doublearray2[]= {INFINITY,2,3,4};
assert(ﬁnd_means(array2,length) ==INFINITY);
doublearray3[]= {−9,2,3,4};
assert(ﬁnd_means(array3,length) ==0);
doublearray4[]= {2.26};
assert(ﬁnd_means(array4,1) == 2.26);
}
Writing test functions for numerical computing can be signi ﬁcantly harder than
writing them for general computing, but this is no excuse for skipping the testing
stage. Say you had to write a function to invert a ten-by-ten m atrix. It would take
atallheapofscrappaperto manuallychecktheanswerforthe typicalmatrix. But
you do know the inverse of the identity matrix (itself), and t he inverse of the zero
matrix(NaN).Youknowthat X·X−1=1forany XwhereX−1isdeﬁned.Errors
maystillslipthroughteststhatonlylookatbroadproperti esandspecialcases,but
that may be the best you can do with an especially ornery compu tation, and such
simplediagnosticscanstill ﬁnda surprisingnumberoferro rs.
Someprogrammersactuallywritethetestfunctionsﬁrst.Th isisonemoremanner
ofwritinganoutlinebeforeﬁllinginthedetails.Writeaco mmentblockexplaining
what the function will do, then write a test program that give s examples of what
thecommentblockdescribedinprose.Finally,writetheact ualfunction.Whenthe
functionpassesthe tests,youare done.
Once you have a few test functions, you can run them all at once , via a supple-
mentary test program. Right now, it would be a short program t hat just calls the/D8/CT/D7/D8/CN/CU/CX/D2/CS/CN/D1/CT/CP/D2/D7 function, but as you write more functions and their tests, th ey
canbeaddedtotheprogramasappropriate.Then,whenyouadd anothertest, you
will re-run all your old tests at the same time. Peace of mind w ill ensue. For ulti-
matepeaceofmind,youcancallyourtestfunctionsatthebeg inningofyourmain
gsl_stats March24,2009
C 73
analysis.Theyshould take only a microsecondto run, andif o ne everfails, it will
be much easier to debug than if the function failed over the co urse of the main
routine.
Q2.21Writeatestfunctionfortheincrementalmeanprogramyou’d writtenabove.
Did yourfunctionpassonthe ﬁrsttry?
Someprogrammers(DonaldKnuthisthemostfamousexample)k eepabug
log listing errors they have committed. If your function did n’t pass its test
theﬁrsttime, younowhaveyourﬁrstentry foryourbuglog.
®Before you have even written a function, you will have expect ations
abouthow it will behave;expressthosein a setoftests thatt he func-
tion will haveto pass.
®You also have expectations about your function’s behavior a t run
time, so /CP/D7/D7/CT/D6/D8yourexpectationsto ensurethattheyaremet.
Q2.22Thischapterstuckto thestandardlibrary, whichisinstall edbydefaultwith
any C compiler. The remainder of the book will rely on a number of li-
brariesthatarecommonlyavailablebutarenotpartofthePO SIXstandard,
and must therefore be installed separately, including Apop henia, the GNU
ScientiﬁcLibrary,andSQLite.Ifyouarewritingsimulatio ns,youwillneed
theGLib library forthe datastructurespresentedinChapte r6.
Now that you have compiled a number of programs and C source is not so
foreign, this is a good time to install these auxiliary libra ries. Most will be
availableviayourpackagemanager,andsomemayhavetobein stalledfrom
C source code. See the online appendix (linked from the book’ s web site,/CW/D8/D8/D4/BM/BB/BB/D4/D6/CT/D7/D7/BA/D4/D6/CX/D2/CT/D8/D3/D2/BA/CT/CS/D9/BB/D8/CX/D8/D0/CT/D7/BB/BK/BJ/BC/BI/BA/CW/D8/D1/D0 ) for notes on ﬁnd-
ing and installing these packages, and Appendix A for notes o n preparing
yourenvironment.
gsl_stats March 24,2009
3
DATABASES
There isa way betweenvoice and presence
Where informationﬂows.
—Rumi (2004, p32)
StructuredQuery Language (SQL1) is a specialized languagethat deals only with
the ﬂow of information. Some things, like joining together m ultiple data sets, are
a pain using traditional techniques of matrix manipulation , but are an easy query
inadatabaselanguage.Meanwhile,operationslike matrixm ultiplication orinver-
sion just can not be done via SQL queries. With both database t ables and C-side
matrices,yourdataanalysistechniquewill beunstoppable .
As a broad rule, try to do data manipulation, like pulling sub sets from the data
or merging together multiple data tables, using SQL. Then, a s a last step, pull the
perfectlyformatted datainto anin-memory matrix anddothe statisticalanalysis.
Because SQL is a specialized language that deals only with in formation ﬂows, it
is not nearly as complex as C. Here is some valid SQL: /D7/CT/D0/CT/D8 /CP/CV/CT/B8 /CV/CT/D2/CS/CT/D6/B8/DD/CT/CP/D6 /CU/D6/D3/D1 /D7/D9/D6/DA/CT/DD.That’salmostproperEnglish.Itgoesdownhillfrom therei n
termsofproperness,butatits worst,itis stillnotdifﬁcul tto lookatanSQLquery
and have some idea of what the rows and columns of the output ta ble will look
like.
1Some people pronounce SQL as sequeland some as ess queue ell . The ofﬁcial ISO/IEC standard has no
comment on which is correct.
gsl_stats March24,2009
DATABASES 75
Like C, SQL is merely a language, and it is left to the programm ers of the world
to write code that can parse SQL and return data from SQL queri es. Just as this
book leans toward /CVto interpret C code, it recommends the SQLite library, by
D Richard Hipp, to interpret code written in SQL. SQLite prov ides a library of
functions that parse SQL queries and uses those instruction s to read and write a
speciﬁc format of ﬁle [see binary trees in Chapter 6]. Any pro gram that uses the
SQLitefunctionlibraryisreadingandwritingthesameﬁlef ormat,soSQLiteﬁles
canbetradedamongdozensofprograms.
As with C utilities, the only problem is selecting which SQLi te database viewer
to use among the many options. The SQLite library comes with a command-line
program, /D7/D5/D0/CX/D8/CT/BF,buttherearemanyotheralternativesthataremorereminis cent
of the table view in the standard stats package or spreadshee t; ask your search
engine for sqlite browser orsqlite GUI . These programs will give you immediate
feedback about any queries you input, and will let you verify that the tables you
arecreatingvia Ccodeareasyouhadexpected.
WhyisSQLite lite?BecausemostSQL-orienteddatabasesaredesignedtobeuse d
by multiple users, such as a ﬁrm’s customers and employees. W ith multiple users
comeissuesof simultaneousaccessandsecurity,that addco mplicationson top of
the basic process of querying data. SQLite is designed to be u sed by one user at
a time, which is exactly right for the typical data analysis p roject. If you hope to
useanotherdatabasesystem,youwillneedtolearnthe(typi cally vendor-speciﬁc)
commandsfor lockingandpermissions.
This chapter will primarily consist of an overview of SQL, wi th which you can
followalongusinganyoftheabovetools.Section3.5willde scribetheApophenia
library functions that facilitate using an SQL database suc h as SQLite or mySQL
from within aC program.
Q3.1Check that both the SQLite executable and development libra ries are cor-
rectly installed. In the online code supplement, you will ﬁn d an SQLite-
formatted database named /CS/CP/D8/CP/B9/DB/CQ/BA/CS/CQ listing the 2005 GDP and popula-
tion for the countries of the world. Verify that you can open t he database
using one of the above tools (e.g., /D7/D5/D0/CX/D8/CT/BF /CS/CP/D8/CP/B9/DB/CQ/BA/CS/CQ from the com-
mand prompt), and that you can execute and view the results of the query/D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /D4/D3/D4/BN.
Once you have a working query interpreter, you can follow alo ng with the
discussion in this chapter. For your cutting and pasting con venience, most
ofthe queriesin this chapterare alsoin the /D5/D9/CT/D6/CX/CT/D7 ﬁle in the onlinecode
supplement.
gsl_stats March24,2009
76 CHAPTER 3
Data format A database holds one or more tables. Each column in a table rep re-
sents a distinct variable. For example, a health survey woul d include
columnssuchassubject’sage,weight, andheight.Expectth eunits to bedifferent
from columnto column.
Eachrowinatabletypicallyrepresentsoneobservation.Fo rexample,inasurvey,
eachrow would be dataabouta singleperson. Thereis no mecha nismin SQL for
namingarow,althoughitiscommonenoughtohaveaplaincolu mnnamed /D6/D3/DB/CN/B9/D2/CP/D1/CT,oranotheridentiﬁersuchas /D7/D3/CX/CP/D0/CN/D7/CT/D9/D6/CX/D8/DD/CN/D2/D3 thatservesthispurpose.
The asymmetry between columns and rows will be very evident i n the syntax for
SQL below. You will select columns using the column name, and there is no real
mechanism for selecting an arbitrary subset of columns; you will select rows by
theircharacteristics,andthereis norealmechanismtosel ectrowsbyname.2
YourC-sidematriceswillgenerallybeexpectedtohaveasim ilarformat;seepage
147forfurthernotes.
Most of the world’s data sets are already in this format. If yo ur data set is not,
your best bet is to convert it rather than ﬁghting SQL’s desig n; see the notes on
crosstabs,page101,fortipsonconvertingfrom themostcom monalternativedata
format.
3.1 B ASIC QUERIES SQL’s greatest strength is selecting subsets of a data set.
IfyouneedallofthedataforthosecountriesintheWorld
Bankdataset( /CS/CP/D8/CP/B9/DB/CQ/BA/CS/CQ )with populationsunder50million, youcanaskforit
thusly:
select*
frompop
wherepopulation <= 50;
Youcanreadthis like English(onceyouknowthat /B6means‘allcolumns’):itwill
ﬁnd all of the rows in a table named /D4/D3/D4where /D4/D3/D4/D9/D0/CP/D8/CX/D3/D2 in that row is less
thanorequalto 50,andreturn allthecolumnsforthoserows.
2If there is a /D6/D3/DB/CN/D2/CP/D1/CT variable, then you could select rows /DB/CW/CT/D6/CT /D6/D3/DB/CN/D2/CP/D1/CT /BP /B3/C2/D3/CT/B3, but that is simply
selecting rows with the characteristic of having a /D6/D3/DB/CN/D2/CP/D1/CT variable whose value is /B3/C2/D3/CT/B3. That is, column
names are bona ﬁde names;row names are justdata.
gsl_stats March24,2009
DATABASES 77
Commasandsemicolons
InSQL,semicolons are terminators foragivencom-
mand. You can send two SQL commands at once,
each ending with a semicolon. Many SQLite-based
programs will forgive you for omitting the ﬁnal semi-
colon.
Commas are separators , meaning that the last ele-
mentinacomma-separatedlistmustnothaveacomma
afterit.For example, if you writea query like /D7/CT/D0/CT/D8/D3/D9/D2/D8/D6/DD/B8 /D4/D3/D4/B8 /CU/D6/D3/D1 /D4/D3/D4/D9/D0/CP/D8/CX/D3/D2 then you will
get an error like “syntax error near /CU/D6/D3/D1” which is re-
ferringtothecomma justbefore /CU/D6/D3/D1thatisnotsepa-
ratingtwocolumns.Generally, the /D7/CT/D0/CT/D8 statement
gives a list of columns that the
output table will have; the /CU/D6/D3/D1
clause declares where the source
data comes from; and the /DB/CW/CT/D6/CT
clause lists restrictions on the rows
to be output. And that’s it. Every
query you run will have these three
parts in this order: column speciﬁ-
cation, data source, row speciﬁca-
tion.3Thissimplemeansofspecify-
ing rows, columns, and source data
allowsforahugerangeofpossibili-
ties.
Select The /D7/CT/D0/CT/D8clausewillspecifythecolumnsofthe tablethatwill beoutp ut.
Theeasiestlist is /B6, whichmeans‘all thecolumns’.Otheroptions:
• Explicitly list thecolumns:/D7/CT/D0/CT/D8 /D3/D9/D2/D8/D6/DD/B8 /D4/D3/D4/D9/D0/CP/D8/CX/D3/D2
• Explicitly mentionthe table(s)from whichyouarepulling data:/D7/CT/D0/CT/D8 /D4/D3/D4/BA/D4/D3/D4/D9/D0/CP/D8/CX/D3/D2/B8 /CV/CS/D4/BA/D3/D9/D2/D8/D6/DD
This is unnecessary now, but will become essential when deal ing with multiple
tablesbelow.
• Renametheoutputcolumns:/D7/CT/D0/CT/D8 /D4/D3/D4/BA/D3/D9/D2/D8/D6/DD /CP/D7 /D3/D9/D2/D8/D6/DD/B8 /CV/CS/D4 /CP/D7 /CV/CS/D4/CN/CX/D2/CN/D1/CX/D0/D0/CX/D3/D2/D7/CN/D9/D7/CS
Ifyoudonotalias /D4/D3/D4/BA/D3/D9/D2/D8/D6/DD /CP/D7 /D3/D9/D2/D8/D6/DD,thenyouwillneedtousethename/D4/D3/D4/CK/BA/D3/D9/D2/D8/D6/DD in future queries,whichisa bitannoying.
• Generateyourown newcolumns.Forexample,to convertGDP i n dollars to GDP
in British poundsusingtheconversionrateasofthis writin g:/D7/CT/D0/CT/D8 /D3/D9/D2/D8/D6/DD/B8 /CV/CS/D4/B6/BC/BA/BH/BC/BI /CP/D7 /CV/CS/D4/CN/CX/D2/CN/BZ/BU/C8
The /CP/D7 /CV/CS/D4/CN/CX/D2/CN/BZ/BU/C8 subclauseisagainmore-or-lessessentialifyouhopetoref er
to this columnin the future.
FromThe /CU/D6/D3/D1clausespeciﬁesthetablesfromwhichyouwillbepullingdat a.The
simplestcaseisasingletable: /CU/D6/D3/D1 /CS/CP/D8/CP/CN/D8/CP/CQ ,butyoucanspecifyasmany
tablesasnecessary: /CU/D6/D3/D1 /CS/CP/D8/CP/CN/D8/CP/CQ/BD/B8 /CS/CP/D8/CP/CN/D8/CP/CQ/BE .
You can alias the tables, for easier reference. The clause /CU/D6/D3/D1 /CS/CP/D8/CP/CN/D8/CP/CQ/BD /CS/BD/B8
3You may have no row restrictions, in which case your query wil l just have the ﬁrsttwo parts and a null third
part.
gsl_stats March24,2009
78 CHAPTER 3/CS/CP/D8/CP/CN/D8/CP/CQ/BE /CS/BEgives short names to both tables, which can be used for lines l ike/D7/CT/D0/CT/D8 /CS/BD/BA/CP/CV/CT/B8 /CS/BE/BA/CW/CT/CX/CV/CW/D8 .
Anotheroptionis to takedatafrom subqueries;seebelow.
BorrowingC’sannoyances
SQL accepts C-style block comments of the form/BB/B6 /BA/BA/BA /B6/BB. It has the same trouble withnested block
comments as C (see p 25). With one-line comments,
everything after two dashes, /B9/B9, is ignored, compara-
ble to the two slashes, /BB/BB, in C. [mySQL users will
needtwodashes and a space: /B9/B9.]
Also following C’s lead, dividing two integers
produces an integer, not the real number we hu-
mans expect. Thus, rather than calculating, say,/D3/D9/D2/D8/BD/BB/D3/D9/D2/D8/BE , cast one of the columns to a real
number by adding /BC/BA/BC: /B4/D3/D9/D2/D8/BD/B7/BC/BA/BC/B5/BB/D3/D9/D2/D8/BE will
return the real number it should. The add-zero trick
also works to turn the string Ꜽ/BD/BL/BL/BCꜼinto the number/BD/BL/BL/BC. [SQLhas a /CP/D7/D8keyword, butitis mucheasier
tojust use the trickof adding /BC/BA/BC.]Aliasing is generally optional but
convenient, but one case where it
is necessary arises when you are
joining a table to itself. For now,
simply note the syntax: /CU/D6/D3/D1 /CS/CP/D8/CP/D8/BD/B8 /CS/CP/D8/CP /D8/BEwill let you refer to
the /CS/CP/D8/CPtable as if it were two en-
tirely independenttables.
Notice, by the way, that when we
aliased something in the /D7/CT/D0/CT/D8
section, the form was /D7/CT/D0/CT/D8/D0/D3/D2/CV/CN/D3/D0/CN/CS/CT/D7/D6/CX/D4/D8/CX/D3/D2 /CP/D7 /D0/CS,
while in the /CU/D6/D3/D1section there
is noas: /CU/D6/D3/D1 /D0/D3/D2/CV/CN/CU/CX/D0/CT/CN/D2/CP/D1/CT/D0/CU/D2.4
Where The /DB/CW/CT/D6/CTclause is your chance to pick out only those rows that interes t
you. With no /DB/CW/CT/D6/CTclause, the query will return one line for every line
in youroriginal table (and the columnsreturned will match t hose you speciﬁedin
the /D7/CT/D0/CT/D8clause).Forexample,try /D7/CT/D0/CT/D8 /BD /CU/D6/D3/D1 /CV/CS/D4usingthe /CS/CP/D8/CP/B9/DB/CQ/BA/CS/CQ
database.
YoucanusetheBooleanoperatorsyouknowandloveasusual: /DB/CW/CT/D6/CT /B4/B4/CS/BD/BA/CP/CV/CT/BQ /BD/BF/B5 /D3/D6 /B4/CS/BE/BA/CW/CT/CX/CV/CW/D8 /BQ/BP /BD/BJ/BH/B5/B5 /CP/D2/CS /B4/CS/BD/BA/DB/CT/CX/CV/CW/D8 /BP /BJ/BC/B5. SQL does not re-
ally do assignments to variables, so the clause /B4/CS/BD/BA/DB/CT/CX/CV/CW/D8 /BP /BJ/BC/B5is a test for
equality,notanassignment.SQLiteiseasygoing,andwilla lsoaccepttheC-format/B4/CS/BD/BA/DB/CT/CX/CV/CW/D8 /BP/BP /BJ/BC/B5;otherSQLparsers(likemySQL)arelessforgivingandcon-
siderthe double-equalsto beanerror.
• Youcanselectbasedontextthesamewayyouselectona numbe r,suchas /DB/CW/CT/D6/CT/D3/D9/D2/D8/D6/DD /BP /B3/CD/D2/CX/D8/CT/CS /CB/D8/CP/D8/CT/D7/B3. Any string that is not an SQL keyword or the
nameofa tableorcolumnmustbein ‘single-tick’quotationm arks.5
4The /CP/D7is actually optional in the /D7/CT/D0/CT/D8clause, but itimproves readability.
5Again, SQLite is forgiving, and will also accept C-style “do uble-tick” quotation marks. However, it is
beneﬁcial that SQL uses single-ticks while C uses double-ti cks, because /D7/D2/D4/D6/CX/D2/D8/CU/B4/D5/B8 /BD/BC/BC/B8 Ꜽ/D7/CT/D0/CT/D8 /B6/DB/CW/CT/D6/CT /D3/D9/D2/D8/D6/DD /BP /B3/C9/CP/D8/CP/D6/B3Ꜽ/B5 requires no unsightly backslashes, while double-tick quot ation marks do:/D7/D2/D4/D6/CX/D2/D8/CU/B4/D5/B8 /BD/BC/BC/B8 Ꜽ/D7/CT/D0/CT/D8 /B6 /DB/CW/CT/D6/CT /D3/D9/D2/D8/D6/DD /BP\ Ꜽ/C9/CP/D8/CP/D6 \ ꜼꜼ/B5.
gsl_stats March24,2009
DATABASES 79
• Case matters: /B3/CD/D2/CX/D8/CT/CS /CB/D8/CP/D8/CT/D7/B3 /AX/BP /B3/D9/D2/CX/D8/CT/CS /D7/D8/CP/D8/CT/D7/B3. However, there is an
out should you need to be case-insensitive:the /D0/CX/CZ/CTkeyword. The clause /DB/CW/CT/D6/CT/D3/D9/D2/D8/D6/DD /D0/CX/CZ/CT /B3/D9/D2/CX/D8/CT/CS /D7/D8/CP/D8/CT/D7/B3 willmatchthefully-capitalizedcountryname
as well as the lower case version. The /D0/CX/CZ/CTkeyword will even accept two wild
cards: /CNwill match any single character, and /B1will match any set of characters.
Both /D3/D9/D2/D8/D6/DD /D0/CX/CZ/CT /B3/D9/D2/CX/D8/B1/CP/D8/CT/D7/B3 and /D3/D9/D2/D8/D6/DD /D0/CX/CZ/CT /B3/D9/D2/CX/D8/CT/CS/CN/D7/D8/CP/D8/CT/D7/B3 will
match /B3/CD/D2/CX/D8/CT/CS /CB/D8/CP/D8/CT/D7/B3.
• The /DB/CW/CT/D6/CTclause refers to the root data, not the output, meaning that y ou can
readilyrefer tocolumnsthatyoudo notmentionin the /D7/CT/D0/CT/D8clause.
Q3.2Use a /DB/CW/CT/D6/CTclause and the /D4/D3/D4/D9/D0/CP/D8/CX/D3/D2 table to ﬁnd the current popula-
tion of your home country. Once you know this amount, select a ll of the
countriesthatare morepopulousthanyourcountry.
Generalizingfrom equalityandinequalities,youmaywanta groupofelementsor
a range. For this, there are the /CX/D2and /CQ/CT/D8/DB/CT/CT/D2 keywords. Say that we want only
the United States and China in our output. Then we would ask on ly for columns
wherethecountrynameis inthatshortlist:
select*
fromgdp
wherecountryin("UnitedStates","China")
The /CX/D2keywordtypicallymakessensefortextdata;fornumericdat ayouprobably
wanta range.Here arethecountrieswith GDP between$10and$ 20billion:
select*
fromgdp
wheregdpbetween10000and20000
Q3.3Write a query using /BO/BPand /BQ/BPto replicate the above query that used/CQ/CT/D8/DB/CT/CT/D2.
®A query consists of three parts: the columns to be output, the data
source,andtherowsto beoutput.
®The columns are speciﬁed in the /D7/CT/D0/CT/D8statement. You can pull all
the columns from the data using /D7/CT/D0/CT/D8 /B6, or you can specify indi-
vidualcolumnslike /D7/CT/D0/CT/D8 /CP/B8 /CQ/B8 /B4/CP/B7/BC/BA/BC/B5/BB/CQ /CP/D7 /D6/CP/D8/CX/D3.≫
gsl_stats March24,2009
80 CHAPTER 3
≫
®The data source is in the /CU/D6/D3/D1clause, which is typically a list of
tables.
®The row speciﬁcation,generally in the /DB/CW/CT/D6/CTclause,is a list of con-
ditionsthatall rowsmustmeet. Itcanbemissing(and soallp ossible
rowsarereturned)orit canincludeaseriesofconditions,l ike /DB/CW/CT/D6/CT/B4/CP /BP /CQ/B5 /CP/D2/CS /B4/CQ /BO/BP /B5.
3.2 /F4DOING MORE WITH QUERIES Beyond the basic /D7/CT/D0/CT/D8 /B9 /CU/D6/D3/D1 /B9/DB/CW/CT/D6/CTformat, a /D7/CT/D0/CT/D8querycanin-
clude several auxiliary clauses to reﬁne the output further . Here is the complete
formatofa /D7/CT/D0/CT/D8query,whichthissectionwill exploreclauseby clause.
select[distinct] columns
fromtables
whereconditions
groupby columns
havinggroup_conditions
order by columns
limitnoffsetn
PRUNING ROWS WITH /CS/CX/D7/D8/CX/D2/D8 The /CS/CP/D8/CP/B9/D1/CT/D8/D6/D3/BA/CS/CQ ﬁleincludesalisting ofall
stations and the color of the subway line(s) on
which the station lies. The query /D7/CT/D0/CT/D8 /D0/CX/D2/CT /CU/D6/D3/D1 /D0/CX/D2/CT/D7produces massive
redundancy, because there are a few dozen stations on every l ine, so each color
appearsa fewdozentimes in thetable.
The /CS/CX/D7/D8/CX/D2/D8 keyword will tell the SQL engine that if several rows would be
exactduplicates,to return onlyonecopyofthatrow.In this case,try
select distinct line
fromlines
The /CS/CX/D7/D8/CX/D2/D8 word prunes the rows, but is placed in the /D7/CT/D0/CT/D8portion of the
program. This reads more like English, but it breaks the stor y above that the/D7/CT/D0/CT/D8statement speciﬁes the columns and the /DB/CW/CT/D6/CTstatement speciﬁes the
rows.
gsl_stats March24,2009
DATABASES 81
AGGREGATION Hereishowtogetthenumberofrowsinthe /CV/CS/D4tableof /CS/CP/D8/CP/B9/DB/CQ/BA/CS/CQ :
select count (*)asrow_ct
fromgdp;
This produces a table with one column and one row, listing the total number of
rowsin the /CS/CP/D8/CPtable.
Q3.4How many rows does /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /D4/D3/D4/B8 /CV/CS/D4produce? The explana-
tion fortheanswerwill appearin thesectionon joins,below.
Youprobablywantmorereﬁnementthanthat;ifyouwouldlike toknowhowmuch
datayouhavein eachregion,then usethe /CV/D6/D3/D9/D4 /CQ/DDclauseto sayso:
selectclass,count(*)ascountries_per_class
fromclasses
group by class;
After /D3/D9/D2/D8,thetwomostcommonaggregationcommandsare /D7/D9/D1/B4/B5and /CP/DA/CV/B4/B5.
These take an existing row as an argument. For example, the /CS/CP/D8/CP/B9/D8/CP/D8/D8/D3/D3/BA/CS/CQ
database has a single table representing a telephone survey regarding tattoos. To
get the average numberof tattoos per person broken down by ra ce, you could use
this query:
selectrace,avg(tattoos.’cttattoos ever had’)
fromtattoos
group by race;
Feel free to specify multiple /CV/D6/D3/D9/D4 /CQ/DDclauses. For example, you could modify
the above query to sort by race and age by changing /CV/D6/D3/D9/D4 /CQ/DD /D6/CP/CTto /CV/D6/D3/D9/D4/CQ/DD /D6/CP/CT/B8 /D8/CP/D8/D8/D3/D3/D7/BA/B3/DD/CT/CP/D6 /D3/CU /CQ/CX/D6/D8/CW/B3. When you want to analyze the output,
youwill beveryinterestedin the /CP/D4/D3/D4/CN/CS/CQ/CN/D8/D3/CN/D6/D3/D7/D7/D8/CP/CQ function;seepage101.
Q3.5Inthe /D4/D6/CT/CX/D4tableofthe /CS/CP/D8/CP/B9/D0/CX/D1/CP/D8/CT/BA/CS/CQ database,the /DD/CT/CP/D6/D1/D3/D2/D8/CW col-
umnencodesdatesinformslike /BD/BL/BL/BI/BC/BKtomeanAugust,1996.Fortunately,
the SQL-standard /D6/D3/D9/D2/CS/B4/B5 function can be used to produce a plain year:/D6/D3/D9/D2/CS/B4/BD/BL/BL/BI/BC/BK/BA/BB/BD/BC/BC/BA/B5 /BP/BP /BD/BL/BL/BI/BA/BC. Use /D6/D3/D9/D2/CS, /CV/D6/D3/D9/D4 /CQ/DD, and /CP/DA/CVto
ﬁndtheaverageprecipitation( /D4/D4) in eachyear.
Youcanuse /D3/D9/D2/D8withthe /CS/CX/D7/D8/CX/D2/D8 keywordtoﬁndouthowmanyofeachrow
youhaveinatable.Thisisusefulforproducingweightsfore achobservationtype,
gsl_stats March24,2009
82 CHAPTER 3
Function Standard
SQLmySQL SQLite via
Apophenia
abs,avg,count,max,min,round,asum◦ ◦ ◦
acos, asin, atan, cos, exp, ln, log10,
pow, rand, sin, sqrt, stddev s, tan,
variance p, stdp, stddev_pop p, stddev_-
samp s,var_samp s, var_pop p◦ ◦
ran, var s,skew s,kurtosis s, kurt s ◦
aRound is not part of the SQL standard, which instead
provides /CU/D0/D3/D3/D6and /CT/CX/D0.
Table 3.1 StandardSQLoffersveryfewmathematical functio ns,sodifferentsystems offerdifferent
extensions. The pandssubscripts indicate functions for populations or for sampl es (see
box onpage 222.
asin this queryto producea tabulationofrespondentsto the tattoo surveybyrace
andbirth year:
select distinct race,tattoos.’year of birth’ asbirthyear, count(*)asweight
fromtattoos
groupby race, birthyear
With a /CV/D6/D3/D9/D4 /CQ/DDcommand, you have two levels of elements, items and groups,
and you may want subsets of each. As above, you can get a subset of the items
with a /DB/CW/CT/D6/CTclause. Similarly, you can exclude some groups from your que ry
using the /CW/CP/DA/CX/D2/CVkeyword. For example, the above query produced a lot of low-
weightedgroups.Whatgroupshavea /D3/D9/D2/D8/B4/B6/B5 /BQ /BG?Wecan’tanswerthisusing/DB/CW/CT/D6/CT /DB/CT/CX/CV/CW/D8 /BQ /BG,becausethereisno /DB/CT/CX/CV/CW/D8columninthedatatable,onlyin
thepost-aggregationtable.Thisis wherethe /CW/CP/DA/CX/D2/CVkeywordcomesin:
select distinct race,tattoos.’year of birth’ asbirthyear, count(*)asweight
fromtattoos
groupby race, birthyear
havingweight > 4/F4SQL extensions That’s all the aggregators you get in standard SQL. So imple-
mentersoftheSQLstandardtypicallyaddadditionalfuncti ons
beyondthe standard;seeTable 3.1 for a list, includingboth aggregationfunctions
gsl_stats March24,2009
DATABASES 83
like /DA/CP/D6andR→Rfunctions like /D0/D3/CV. The table focuses on numeric functions,
and the standard and mySQL both include several functions fo r manipulation of
text,dates,andothersundrytypesofdata;seethe onlinere ferencesfordetails.
Bear portability in mind when using these functions, and be c areful to stick to
the SQL standard if you ever hope to use your queries in anothe r context. If you
wanttostaystandard,callyourdataintoaC-sidevectororm atrixanduse /CP/D4/D3/D4/CN/B9/DA/CT/D8/D3/D6/CN/D0/D3/CV , /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/CT/DC/D4 , /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D7/CZ/CT/DB , /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/DA/CP/D6 , ...,
to getthe desiredstatistics onthematrix side.
SORTING To order the output table, add an /D3/D6/CS/CT/D6 /CQ/DDclause. For example, to view
thelist ofcountrypopulationsin alphabeticalorder,use
select*
frompop
order by country
• Youmayhavemultipleelementsintheclause,suchas /D3/D6/CS/CT/D6 /CQ/DD /D3/D9/D2/D8/D6/DD/B8 /D4/D3/D4.
If thereareties in theﬁrstvariable,theyare brokenbythe s econd.
• The keyword /CS/CT/D7, short for descending , will reverse the order of the variable’s
sorting.Sampleusage: /D3/D6/CS/CT/D6 /CQ/DD /D3/D9/D2/D8/D6/DD /CS/CT/D7/B8 /D4/D3/D4.
GETTING LESS Especially when interactively interrogating a database, y ou may
not want to see the whole of the table you have constructed wit h
a /D7/CT/D0/CT/D8clause. The output may be a million lines long, but twenty sho uld be
enough to give you the gist of it, so use a /D0/CX/D1/CX/D8clause. For example,the follow-
ingquerywill return onlythe ﬁrsttwentyrowsofthe /D4/D3/D4table:
select*
frompop
limit20
You may want later rows, and so you can add the /D3/CU/CU/D7/CT/D8keyword. For example,
select*
frompop
limit5offset3
will return the ﬁrst ﬁve rows, after discarding the ﬁrst thre e rows. Thus, you
will see rows 4–8. Beyond making interactive querying easie r, /D0/CX/D1/CX/D8 /B9 /D3/CU/CU/D7/CT/D8
gsl_stats March24,2009
84 CHAPTER 3
clauses can also be used to break tables that are somehow givi ng you problems
into moremanageablepieces,probablyviaaC-side /CU/D3/D6loop.
• Yougetone /D0/CX/D1/CX/D8/ /D3/CU/CU/D7/CT/D8perquery,whichmustbe thelastthingin the query.
• Ifyouareusing /D9/D2/CX/D3/D2andfamilytocombine /D7/CT/D0/CT/D8statements(seebelow),your/D0/CX/D1/CX/D8clauseshouldbeattheendofallofthem,andappliesonlytot heaggregate
table./F4Random subsets The /D0/CX/D1/CX/D8clause gives you a sequential subset of your data,
whichmaynotberepresentative.Ifthisisaproblem,youcan
takearandomdrawofsomesubsetofyourdata.Ideally,youco uldprovideaquery
like /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /CS/CP/D8/CP /DB/CW/CT/D6/CT /D6/CP/D2/CS/B4/B5 /BO /BC/BA/BD/BGtodraw14% ofyourdata.
SQLite-via-ApopheniaandmySQLprovidea /D6/CP/D2/CSfunctionthatworksexactlyas
above.6Foreverycallto thefunction(andthus,foreveryrow),itdr awsauniform
randomnumberbetweenzeroandone.7
CREATING TABLES Therearetwowaystocreateatable.Oneisviaa /D6/CT/CP/D8/CTstate-
ment and then an /CX/D2/D7/CT/D6/D8statement for every single row of
data. The /D6/CT/CP/D8/CTstatement requires a list of column names;8the /CX/D2/D7/CT/D6/D8state-
mentrequiresa listofonedataelementforeachcolumn.
begin;
create table newtab(name, age);
insertinto newtabvalues("Joe", 12);
insertinto newtabvalues("Jill",14);
insertinto newtabvalues("Bob",14);
commit;
The /CQ/CT/CV/CX/D2- /D3/D1/D1/CX/D8wrapper, by the way, means that everything will happen in
memory until the ﬁnal commit. The program may run faster, but if the program
6Standard SQL’s /D6/CP/D2/CS/D3/D1function is absolutely painful. SQLite’s version currentl y produces a number be-
tween±9,223,372,036,854,775,807,whichthereaderwillrecogni zeas±(263−1).Soweneedtopullarandom
number, divide by 263−1,shiftitto thefamiliar [0,1]range, and then compare ittoalimit. Standard SQLdoes
noteven provide exponentiation, sodoing this requires the bit-shifting operator which Ihad promised you would
never need; read /BD/BO/BO/DCas2x. That said, /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /CS/CP/D8/CP /DB/CW/CT/D6/CT /B4/D6/CP/D2/CS/D3/D1/B4/B5/BB/B4/B9/B4/BD/BO/BO/BI/BF/B5/B9/BD/BA/BC/B5/B7/BD /B5/BB/BE/BO /BC/BA/BD/BGwill pull approximately 14% ofthe data set.
7After youread Section 11.1,youwill wonder about thestream ofrandom numbersproduced inthedatabase.
There is one stream for the database, which Apophenia mainta ins internally. To initialize it with a seed of seven,
use /CP/D4/D3/D4/CN/CS/CQ/CN/D6/D2/CV/CN/CX/D2/CX/D8/B4/BJ/B5 . If you do not call this function, the database RNG auto-allo cates at ﬁrst use with
seed zero.
8SQLite has the pleasant property that its columns are basica lly type-less. Other database engines insist on
table declarations that look a little like C functions, e.g. , /D6/CT/CP/D8/CT /D8/CP/CQ/D0/CT /D2/CT/DB/D8/CP/CQ/B4/D2/CP/D1/CT /DA/CP/D6/CW/CP/D6/CJ/BF/BC℄/B8 /CP/CV/CT/CX/D2/D8/B5; seeyour database engine documentation for details.
gsl_stats March24,2009
DATABASES 85
crashesinthemiddle,thenyouwill havelosteverything.Th eoptimalspeed/secu-
rity trade-offisleft asanexerciseforthe reader.
If you havehundredsorthousandsof /CX/D2/D7/CT/D6/D8s,you are almostcertainly better off
puttingthedatainatextﬁleandusingeithertheCfunction /CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/D8/D3/CN/CS/CQ or
the command-lineprogram with the same name. The form abovei s mostly useful
in situations where you are creating the table in mid-progra m, as in the example
onpage108.
The other method of creating a table is by saving the results o f a query. Simply
put /D6/CT/CP/D8/CT /D8/CP/CQ/D0/CT /D2/CT/DB/D8/CP/CQ/CN/D2/CP/D1/CT /CP/D7at the head of the query you would like to
save:
create table tourist_traps as
selectcountry
fromlonely_planet
where(0.0+pp)> 600
Q3.6The /D6/CX/CS/CT/D6/D7table of the /CS/CP/D8/CP/B9/D1/CT/D8/D6/D3/BA/CS/CQ database includes the average
boardingsineachstationoftheWashingtonMetrosystem,ev eryyearsince
itsopening.Createa /D6/CX/CS/CT/D6/D7/CN/D4/CT/D6/CN/DD/CT/CP/D6 tablewithonecolumnfortheyear
andone column for total averageboardingsacrossthe system for the given
year.
DROPPING A TABLE Theconverseoftablecreationis tabledropping:
droptable newtab;
Seealso /CP/D4/D3/D4/CN/D8/CP/CQ/D0/CT/CN/CT/DC/CX/D7/D8/D7 on theC-side (p 108),whichcanalsodeletetables
if desired.
ROWIDSometimes, you need a unique identiﬁer for each output row. T his would
be difﬁcult to create from scratch, but SQLite always insert s such a row,
named /D6/D3/DB/CX/CS. It is a simple integer counting from one up to the number of ro ws,
and does not appear when you query /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /D8/CP/CQ/D0/CT. But if you query/D7/CT/D0/CT/D8 /D6/D3/DB/CX/CS/B8 /B6 /CU/D6/D3/D1 /D8/CP/CQ/D0/CT, thenthehiddenrownumberswill appearin the
output.9
9mySQLusers willneed to explicitly ask forsuch acolumn when creating thetable. Astatement like /D6/CT/CP/D8/CT/D8/CP/CQ/D0/CT /D2/CT/DB/D8/CP/CQ /B4 /CX/CS/CN/D3/D0/D9/D1/D2 /CX/D2/D8 /CP/D9/D8/D3/CN/CX/D2/D6/CT/D1/CT/D2/D8/B8 /CX/D2/CU/D3/BD /CW/CP/D6/B4/BF/BC/B5/B8 /CX/D2/CU/D3/BE /CS/D3/D9/CQ/D0/CT/B8 /BA/BA/BA/B5willcre-
ate the table with the typical columns that you will ﬁll, plus an /CX/CS/CN/D3/D0/D9/D1/D2 that the system will ﬁll. After/CX/D2/D7/CT/D6/D8 /CX/D2/D8/D3 /D2/CT/DB/D8/CP/CQ /DA/CP/D0/D9/CT/D7 /B4Ꜽ/C2/D3/CTꜼ/B8 /BE/BF/B5/BN /CX/D2/D7/CT/D6/D8 /CX/D2/D8/D3 /D2/CT/DB/D8/CP/CQ /DA/CP/D0/D9/CT/D7 /B4Ꜽ/C2/CP/D2/CTꜼ /BE/BD/BA/BK/B5/BN, the ta-
ble will haveone row for Joewhere /CX/CS/CN/D3/D0/D9/D1/D2 /BP/BP/BDand onefor Jane where /CX/CS/CN/D3/D0/D9/D1/D2 /BP/BP/BE.
gsl_stats March24,2009
86 CHAPTER 3
Q3.7Using /D3/D6/CS/CT/D6 /CQ/DDand /D6/D3/DB/CX/CS, ﬁnd the rank of your home country’s GDP
amongcountriesinthe World Bankdatabase.
METADATA What tables are in the database? What are their column names? Stan-
dard SQL provides no easy way to answer these questions, so ev ery
database engine has its own speciﬁc means. SQLite gives each database a table
named /D7/D5/D0/CX/D8/CT/CN/D1/CP/D7/D8/CT/D6 thatprovidessuchinformation.Itincludesthetypeofob-
ject (either index or table, in the /D8/DD/D4/CTcolumn), the name (in the /D2/CP/D1/CTcolumn),
and the query that generated the object (in the /D7/D5/D0column). MySQL users, see
page106.
In practical terms, this table is primarily good for getting the lay of an unfamil-
iardatabase—aquick /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /D7/D5/D0/CX/D8/CT/CN/D1/CP/D7/D8/CT/D6/BN whenyouﬁrstopenthe
databaseneverhurts.IfyouareusingtheSQLitecommandlin e,thereisa /BA/D8/CP/CQ/D0/CT
commandthatdoesexactlywhatthis programdoes.Thus,thec ommand /D7/D5/D0/CX/D8/CT/BF/D1/DD/CS/CQ/BA/CS/CQ /BA/D8/CP/CQ/D0/CTjust lists available tables, and the /BA/D7/CW/CT/D1/CP command gives all
oftheinformation from /D7/D5/D0/CX/D8/CT/CN/D1/CP/D7/D8/CT/D6 .
MODIFYING TABLES SQL is primarily oriented toward the ﬁltering style of pro-
gramdesign:e.g.,haveonequeryto ﬁlteradatatabletopro-
duce a new table with bad data removed, then have another quer y to ﬁlter the
resulting table to produce an aggregate table, then select s ome elements from the
aggregatetableto produceanewtable,etcetera.
Butyouwilloftenwanttomodifyatableinplace,ratherthan sendingitthrougha
ﬁltertoproduceanewtable(especiallyifthetableissever almillion entrieslong).
SQLprovidesthreeoperationsthatwillmodify a tablein pla ce./CS/CT/D0/CT/D8/CT Unlike /CS/D6/D3/D4,whichactsonanentiretable, /CS/CT/D0/CT/D8/CTactsonindividualrows
ofadatabase.Forexample,toremovethecolumnswithmissin gGDPdata,
you could use this query [—but before you destroy data in the s ample databases,
makea copy,e.g.,via /D6/CT/CP/D8/CT /D8/CP/CQ/D0/CT /CV/CS/D4/BE /CP/D7 /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /CV/CS/D4]:
deletefrom gdp
wheregdp=’..’/CX/D2/D7/CT/D6/D8 The obvious complement to deleting lines is inserting them. You already
saw /CX/D2/D7/CT/D6/D8usedaboveinthecontextofcreatingatableandtheninserti ng
elementsitem-by-item.Youcanalsoinsertviaaquery,viat heform /CX/D2/D7/CT/D6/D8 /CX/D2/D8/D3/CT/DC/CX/D7/D8/CX/D2/CV/CN/D8/CP/CQ/D0/CT /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /BA/BA/BA.
gsl_stats March24,2009
DATABASES 87/D9/D4/CS/CP/D8/CT The /D9/D4/CS/CP/D8/CTquery will replace the data in a column with new data. For
example,theWorldBankrefrainedfromestimatingIraq’s20 06population,
but the US Central Intelligence Agency’s World Factbook for 2006 estimates it at
26,783,383.Here is howto changeIraq’s population(in the /D4/D3/D4table)from /BA/BAto/BE/BI/BJ/BK/BF:
updatepop
setpopulation=26783
wherecountry=’Iraq’
®Youcanlimityourqueriestofewerrowsusinga /D0/CX/D1/CX/D8clause,which
givesyouasequentialsnippet,orviarandomdraws.
®The SQL standard includes a few simple aggregation commands :/CP/DA/CV/B4/B5, /D7/D9/D1/B4/B5, and /D3/D9/D2/D8/B4/B5, and most SQL implementations pro-
vide a few more nonstandard aggregatorsfor queries called u sing its
functions.
®When aggregating, you can add a /CV/D6/D3/D9/D4 /CQ/DDclause to indicate how
theaggregationshouldbegrouped.
®Sortyouroutputusingan /D3/D6/CS/CT/D6 /CQ/DDclause.
®You can create tables using the /D6/CT/CP/D8/CTand /CX/D2/D7/CT/D6/D8commands, but
youare probablybetteroff justreadingthetable from atext ﬁle. Use/CS/D6/D3/D4to deleteatable.
®SQLite gives every row a /D6/D3/DB/CX/CS, though it is hidden unless you ask
forit explicitly.
3.3 JOINS AND SUBQUERIES Sofar,wehavebeencuttingonetabledown,ei-
ther by selecting a subsetof rows or by group-
ing rows. SQL’s other great strength is in building up tables by joining together
data from disparate sources.The joining processis notbase don a /CY/D3/CX/D2keyword,
butsimply specifyingmultiple data sourcesin the /CU/D6/D3/D1sectionofyourqueryand
describinghowtheymeshtogetherin the /DB/CW/CT/D6/CTsection.
If you specify two tables in your /CU/D6/D3/D1line, then, lacking any restrictions, the
database will return one joined line for every pair of lines. Let table 1 have one
column with data
1
2
3
and table 2 have one column with data
a
b
c
; then /D7/CT/D0/CT/D8
gsl_stats March24,2009
88 CHAPTER 3/B6 /CU/D6/D3/D1 /D8/CP/CQ/D0/CT/BD/B8 /D8/CP/CQ/D0/CT/BEwill produce an output table with every combination,
3×3 = 9rows:/BD /CP/BD /CQ/BD /BE /CP/BE /CQ/BE /BF /CP/BF /CQ/BF .
Such a product quickly gets overwhelming: in the exercise on page 81, you saw
how joining the 208 countries in the World Bank data’s /D4/D3/D4table with the same
208countriesin the /CV/CS/D4table producesafew hundredpagesofrows.
Thus, the /DB/CW/CT/D6/CTclause becomes essential. Its most typical use for a join ari ses
whenonecolumnineachtablerepresentsidenticalinformat ion.Outofthe43,264
rows from the above join, including those that matched Qatar with Ghana and
Cameroon with Zimbabwe, we are interested only in those that match Qatar with
Qatar, Cameroon with Cameroon, and so on. That is, we want onl y those rows/DB/CW/CT/D6/CT /D4/D3/D4/BA/D3/D9/D2/D8/D6/DD /BP /CV/CS/D4/BA/D3/D9/D2/D8/D6/DD , andso the querymakessenseonly when
thatrestriction isaddedin:
selectpop.country,pop.population,gdp.GDP
frompop,gdp
wherepop.country =gdp.country
You can see that using the table-dot-column format for the co lumn names is now
essential. In the /D7/CT/D0/CT/D8clause specifying the output columns, you can use either/D4/D3/D4/BA/D3/D9/D2/D8/D6/DD or /CV/CS/D4/BA/D3/D9/D2/D8/D6/DD , sincethe two will be by deﬁnitionidentical, or if
you are unconcerned with the country names and just want the n umeric data you
canomit namesentirely.
Q3.8Addacalculationtothe /D7/CT/D0/CT/D8portionoftheabovequerytoﬁndtheGDP
per capita of each country. Be sure to give the calculated col umn a name,
like /CV/CS/D4/CN/D4/CT/D6/CN/CP/D4 soyoucan /D3/D6/CS/CT/D6 /CQ/DD /CV/CS/D4/CN/D4/CT/D6/CN/CP/D4 .
gsl_stats March24,2009
DATABASES 89
Q3.9The World Bank data includes a classiﬁcation for each countr y. Countries
receiving World Bank assistance (what the WB calls client countries ) are
classedbyregion(e.g.,MiddleEastandNorthAfrica),whil eothercountries
arebinnedintoa genericclasslike “Lower-middle-incomee conomies.”
FindthetotalGDPpercapitaforeachWorldBankgrouping.He re,youwill
join using the country columns in the /CV/CS/D4and /D0/CP/D7/D7/CT/D7 table, and by the
country columns in the /D4/D3/D4and /D0/CP/D7/D7/CT/D7 table. Add up total GDP in the
region,anddividebytotalpopulationin theregion.
Example: a time lag The form above, where two columns match, is by far the
most common type of join, but there are other creative uses
of joins. For example,it is common in time series analysis to include the value of
avariableattime t−1asdatathatinﬂuencedthe valueattime t.
The /CS/CP/D8/CP/B9/D0/CX/D1/CP/D8/CT/BA/CS/CQ databaseincludesatableofthedeviationfromthecentury-
long norm for aggregate worldwide temperatures (see Smith & Reynolds (2005)
for methods, caveats, and discussion). A quick /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /D8/CT/D1/D4will show
that there is an upward trend in the data:the ﬁrst few yearsar e all below zero;the
lastfewyearshoveraround0.5.10
What does the month-to-month change look like? The ﬁrst step is dealing with
the fact that there are separate /DD/CT/CP/D6and /D1/D3/D2/D8/CWcolumns. One solution would be
to deal only with /DD/CT/CP/D6 /B7 /D1/D3/D2/D8/CW/BB/BD/BE/BA , which moves through time in smooth in-
crements of1
12. This creates its own problem, because comparing ﬂoating-p oint
values is not reliable: /BD/BL/BC/BC /B7 /BD/BA/BB/BD/BE/BA /B9 /BD/BA/BB/BD/BE/BAcould wind up as something
like /BD/BL/BC/BC/BA/BC/BC/BC/BC/BD , and a testwhetherthis valueexactlyequals /BD/BL/BC/BCwill fail. As a
variant that solves this problem, instead of dividing month s by 12, multiply years
by12,sothatweare comparingonlyintegers:
selectR.year+R.month/12., R.temp−L.temp
fromtempL,tempR
whereR.year*12 +R.month= L.year*12+L.month+1;
Thesalientfeatureofthisdatasetisthatnotmuchhappens. Thelong-termshiftis
theresultofalarge numberofverysmallmonth-to-month cha nges.
10Chapter 5 will cover graphing, but for now, try /CP/D4/D3/D4/CN/D4/D0/D3/D8/CN/D5/D9/CT/D6/DD /CS/CP/D8/CP/B9/D0/CX/D1/CP/D8/CT/BA/CS/CQ Ꜽ/D7/CT/D0/CT/D8 /D8/CT/D1/D4/CU/D6/D3/D1 /D8/CT/D1/D4Ꜽfrom your command line to get avisual indication of the trend .
gsl_stats March24,2009
90 CHAPTER 3
Q3.10Perhapswe would see a larger changevia a larger time span. Ca lculate the
year-to-yeardifferences.
• Createan /CP/D2/D2/D9/CP/D0/CX/DE/CT/CS tablewith two columns:the yearandaverage/D8/CT/D1/D4overallmonthsforthe year.
• Jointhattablewithitselflaggedbyoneyear.Youwon’thav etoworry
about unreliable ﬂoat comparisons, but recall that if SQLit e thinks/DD/CT/CP/D6isa string,thenit will treat /DD/CT/CP/D6/B7/BC/BA/BC asanumber.
Havinglookedatyear-longdifferences,try decades.
• Create a /CS/CT/CP/CS/CT/D7 table with the average for each decade. ( Hint:/CV/D6/D3/D9/D4 /CQ/DD /D6/D3/D9/D2/CS/B4/DD/CT/CP/D6/BB/BD/BC/B5 .)
• Join the table with itself lagged by ten years. Are the diffe rences be-
ginningto showapattern?
Giventhat the data is sorted, we could also havedonethe matc hing of rows using
the /D6/D3/DB/CX/CS:
selectL.temp−R.temp
fromtempL,tempR
whereR.rowid+0.0=L.rowid −1;
SPEEDING IT UP Now that you have seen how to join tables, we now coverhow to
avoid joining tables. If two tables have a million elements e ach,
then joining them using a clause like /DB/CW/CT/D6/CT /CP/BP/CQrequires 1e6×1e6 = 1e12 (a
trillion) comparisons. This is impossibly slow, so there ar e a number of tricks to
avoidmakingallthose 1e12comparisons.11
Indices You can ask the SQL engine to create an index for a table that yo u intend
to usein ajoin later. Thecommands:
create index pop_index onpopulation(country)
create index gdp_index ongdp(country)
11Say that you mean to join a million subjects via ID number, via /D7/CT/D0/CT/D8 /D8/BD/BA/B6/B8 /D8/BE/BA/B6 /CU/D6/D3/D1 /D8/BD/B8 /D8/BE/DB/CW/CT/D6/CT /D8/BD/BA/CX/CS /BP /D8/BE/BA/CX/CS, but you forget to include the /DB/CW/CT/D6/CTclause. Then you just asked the system to cre-
ate a trillion-entry table, which will take from several hou rs to weeks. Thus, the ﬁrst step in speeding up an
inordinately slow query is not to try the tricks in this secti on, but to make sure that you actually wrote the query
you had intended to write.
gsl_stats March24,2009
DATABASES 91
would index the /D4/D3/D4and /CV/CS/D4tables on the /D3/D9/D2/D8/D6/DD column. The name of the
index, such as /D4/D3/D4/CN/CX/D2/CS/CT/DC , is basically irrelevant and can be any gibberish that
sounds nice to you. Once you have created this index, a join us ing any of the
indexed columns goes muchfaster, because the system no longer has to do 1e12
comparisons.Basically,itcanlookattheﬁrstvalueof /DA/CP/D6inthelefttable—sayit
is 17—and then check the right table’s index for the list of el ements whose value
is 17. That is, instead of one million comparisonsto join the ﬁrst element, it only
has to do one index lookup. The lookup and the process of build ing the tree took
time as well, but these processes are on the order of millions of operations, not
millions squared. The tree is internally structured as a bin ary tree; see Chapter 6
fordiscussionofb-trees.
ThereisstandardSQLsyntaxforindexingmultiplecolumns, e.g., /D6/CT/CP/D8/CT /CX/D2/CS/CT/DC/D4/D3/D4/CN/CX/D2/CS/CT/DC/BE /D3/D2 /D4/D3/D4/B4/D3/D9/D2/D8/D6/DD/B8 /D4/D3/D4/D9/D0/CP/D8/CX/D3/D2/B5 ,whichgoesby lexicographicor-
der. This is just an index on the ﬁrst item ( /D3/D9/D2/D8/D6/DD) with the second column
( /D4/D3/D4/D9/D0/CP/D8/CX/D3/D2 ) as a backup ordering; if you want to join by the second column ,
you should prepare by creating anotherindex that puts that c olumn in the ﬁrst (or
theonly)position.
Subqueries Among SQL’s nicest tricks is that it allows for the input tabl es to be
queriesthemselves.Forexample:howlargeistheaverageWo rldBank
grouping?Answeringthisquestionisatwo-stepprocess:ge ta /D3/D9/D2/D8/B4/B6/B5 foreach
category,andthengetanaverageofthat.Youcouldrunaquer ytoproduceatable
ofcounts,savethetable,andthenrunaqueryonthattableto ﬁndtheaverages.
create table temptabas
select count (*)asct
fromclasses
groupby class;
select avg (ct)
fromtemptab
Butrather than generatinga temporary table, SQL allows you to simply insertthe/D7/CT/D0/CT/D8statementdirectlyinto the querywhereit is used:
select avg (ct)
from(select count (*)asct
fromclasses
groupby class)
The query inside the /CU/D6/D3/D1clause will return a table, and even though that table
has no name, it can be used as a data source like any other table . If the query
output needs a name, you can alias the result as usual: /CU/D6/D3/D1 /B4/D7/CT/D0/CT/D8 /BA/BA/BA/B5 /D8/BD
will allowyouto referto thequery’soutputas /D8/BDelsewherein thequery.
gsl_stats March24,2009
92 CHAPTER 3
Q3.11Onpage79,youﬁrstfoundyourhomecountry’spopulation,th enthecoun-
tries with populations greater than this. Use a subquery to d o this in one
query. (Hint: you can replace a number with a query that returns one ele-
ment.)
Subsetting via a foreign table If you look at the World Bank data, you will see a
large numberof countries that are small islandsof
a few million people.Say that we are unconcernedwith thesec ountries,and want
onlytheGDP ofcountrieswhere /D4/D3/D4/D9/D0/CP/D8/CX/D3/D2 /BQ /BE/BJ/BC.
Q3.12Write a query to pull only the GDP of countries where the popul ation is
greater than 270 million, using the standard /DB/CW/CT/D6/CT /D0/CT/CU/D8/D3/D0 /BP /D6/CX/CV/CW/D8/D3/D0
join syntaxfrom the headofthis section.
But the full join (as per the exercise) is not necessary: we ar e not particularly
concerned with the population per se, but are just using it to eliminate rows. It
wouldthusbelogicaltoﬁtthequeryintothe /DB/CW/CT/D6/CTclause,sincethatistheclause
that is typically used to select a subset of the rows. Indeed, we can put a query
directly intoa /DB/CW/CT/D6/CT /BA/BA/BA /CX/D2clause:
select*
fromgdp
wherecountryin(selectcountryfrompopwherepopulation >270)
Thesubquerywill return alist of countrynames,andthe main querycanthen use
thoseasif youhaddirectly typedthemin.
This is typically much fasterthan a full join operation, bec ausethere wasno need
to make(left table rowcount) ×(right tablerow count)comparisons.
The boost in efﬁciency implies some slight restrictions: be cause the /CU/D6/D3/D1clause
does not list the table used in the subquery, you can not refer to any of the sub-
query’scolumnsin theoutput./F4Joining via a /CU/D3/D6loopThe time it takes to do an especially large join is not
linear in the number of rows, primarily for real-world
reasons of hardware and software engineering. If your compu ter can not store all
the data points needed for a query in fast memory, it will need to do plenty of
swappingbackandforthbetweendifferentphysicallocatio nsinthecomputer.But
your computer may be able to store a hundredth or a thousandth of the data set
in fast memory, and so you can perhapsget a painfully slow que ry to run in ﬁnite
gsl_stats March24,2009
DATABASES 93
time bybreakingitdowninto aseriesofshorterqueries.
Here is an example from my own work (Baum et al., 2008). We had gathered
550,000 genetic markers (SNPs) from a number of pools of subj ects, and wanted
the mean for each pool. Omitting a few details, the database i ncluded a /D4/D3/D3/D0/D7
table with the subject /CX/CSand the /D4/D3/D3/D0/CX/CSof its pool, with only about a hundred
elements;andatableofindividual /CX/CSs,the /CB/C6/C8labels,andtheirvalues,whichhad
tens of millions of values.Even after creating the appropri ate indices, the straight
join—
selectpools.poolid aspoolid,SNP, avg(val)asval,var(val) asvar
fromgenes, pools
wheregenes.id=pools.id
group by pools.poolid,SNP
—wastakinghours.
Our solution was to use a C-side /CU/D3/D6loop, plus subsetting via a foreign table,
to avoid the join that was taking so long. There are three step s to the process:
create a blank table to be ﬁlled, get a list of /D4/D3/D3/D0/CX/CSs, and then use /CX/D2/D7/CT/D6/D8 /CX/D2/D8/D3/BA/BA/BA /D7/CT/D0/CT/D8 /BA/BA/BAto add each /D4/D3/D3/D0/CX/CS’s data to the main table. The details of the
functions will be discussed below, but these three steps sho uld be evident in this
codesnippet.
apop_query("create table t (poolname, SNP,val,var);");
apop_data *names = apop_query_to_text("select distinctpoolid from p ools");
for(inti=0; i< names−>textsize[0]; i++)
apop_query("insert intot\n\
select ’%s’,SNP,avg(val), var(val)\n\
from genes \n\
where idin(select idfrom pools where poolid = ’%s’)\n\
group by SNP;\n\
", names[i][0], names[i][0]);
This allowed the full aggregation process to run in only a few minutes. The next
weekwe boughtbetterhardware.
As noted above, if there is no natural grouping like the pools in this example, a/CU/D3/D6loop using the /D0/CX/D1/CX/D8 /BA/BA/BA/D3/CU/CU/D7/CT/D8 form can also break a too-long table into
smallerpieces.
STACKING TABLES You can think of joining two tables as setting one table to the
rightofanothertable.Butnowandthen,youneedtostackone
ontop oftheother.Therearefourkeywordsto dothis.
gsl_stats March24,2009
94 CHAPTER 3
• /CD/D2/CX/D3/D2:Sandwiching /D9/D2/CX/D3/D2betweentwo completequeries,suchas
selectid,age, zip
fromdata_set_1
union
selectid,age, zip
fromdata_set_2
will produce the results of the ﬁrst query stacked directly o n top of the second
query.Be carefulthatbothtableshavethesamenumberofcol umns.
• /CD/D2/CX/D3/D2 /CP/D0/D0:Ifarowis duplicatedin bothtables,thenthe /D9/D2/CX/D3/D2operationthrows
out one copy of the duplicate lines, much like /D7/CT/D0/CT/D8 /CS/CX/D7/D8/CX/D2/D8 includes only
oneoftheduplicates.Replacing /D9/D2/CX/D3/D2with /D9/D2/CX/D3/D2 /CP/D0/D0willretaintheduplicates.
• /C1/D2/D8/CT/D6/D7/CT/D8 : As you can guess, putting /CX/D2/D8/CT/D6/D7/CT/D8 between two /D7/CT/D0/CT/D8state-
mentsreturnsa singlecopyofonlythoselinesthatappearin bothtables.
• /BX/DC/CT/D4/D8:Thisdoessubtraction,returningonlyelementsfrom theﬁr sttablethatdo
not appear in the second. Notice the asymmetry: nothing in th e second table will
appear.
®You can put the output of a query into the /CU/D6/D3/D1clause of a parent
query.
®Youcanjointablesbylistingmultipletablesinthe /CU/D6/D3/D1clause.When
you do, you will need to specify a /DB/CW/CT/D6/CTclause, and possibly the/CS/CX/D7/D8/CX/D2/D8 keyword, to prevent having an unreasonably long output
table.
®If you intend to join elements, you can speed up the join immen sely
bycreatinganindexﬁrst.
®Ifthejoinstilltakestoolong,youcansidestepitviathe /D7/CT/D0/CT/D8 /BA/BA/BA/DB/CW/CT/D6/CT /D3/D0 /CX/D2 /B4/D7/CT/D0/CT/D8 /BA/BA/BA/B5form, orvia aC-side /CU/D3/D6loop.
®Tables can be stacked using /D9/D2/CX/D3/D2, /D9/D2/CX/D3/D2 /CP/D0/D0, /CX/D2/D8/CT/D6/D7/CT/D8 , and/CT/DC/CT/D4/D8.
3.4 O N DATABASE DESIGN Say that you are not reading in existing data, but
are gathering your own, either from a simulation
or data collected from the real world. Here are some consider ations and sugges-
tions for how you could design your database,summarizing th e common wisdom
aboutthe bestwayto thinkaboutdatabasetables.
gsl_stats March24,2009
DATABASES 95
The basic premise is that each type of object should have a sin gle table, and each
objectshouldhavea singlerowin thattable.
Figure3.2showsatableofobservationsforagenericstudyi nvolvingseveralsub-
jectsandtreatments,whoseinformationwasmeasuredatsev eraltimes.Thesimple
one-table design is how the typical spreadsheetis designed . This version has one
rowpersubject,soeachrowhastwoobservations,andinform ationaboutsubjects,
treatments,observations,andpoolsaremixedtogether.
Figure3.3showsastructurebettersuitedfordatabases.Fo rmoststatisticalstudies,
thekeyobjectistheobservation,andthatgetsitsowntable ;wenowseethatthere
were twenty observations. The other objects in the study—su bjects, pools, and
treatments—all gettheir own tablesas well. By giving eache lementofeachtable
an ID number, each table can easily cross-reference others. This setup has many
advantages.
Minimize redundancy This is rule number one in database design, and many a
bookandarticlehasbeenwrittenabouthowonegoesabout
reducingdatatotheredundancy-minimized normalform (Codd,1970).Ifahuman
had to enter all of the redundantdata, this creates more chan cesfor error, and the
same opportunities for failure come up when the data needs to be modiﬁed when
somebodynoticesthattherewereactuallyninesubjectsint hepoolfrom6/2/02.In
thesingle-tableform,informationaboutthepoolwasrepea tedforeverymemberof
thepool,whilehavingaseparatetableforpoolsmeansthate achpool’sinformation
is listedexactlyonce.
Ask non-observation questions Therearereasonstoaskquestionsbasedontreat-
ments or pools, but a setup with only an obser-
vation-based table does not facilitate this. From the multi ple tables, it is easy to
ask questions that focus on data, treatments, or pools, via j oin operations on the
observation,pool,subject,ortreatmentIDs.
Gelman & Hill (2007, p 239) point out that separating subject s and groups facil-
itates multilevel models, where each group has parameters f or its own submodel
estimated, and then those parameters are used to estimate an overall model. This
sortofmodelingwillbecoveredinlater chapters.
Use the power of row subsets Figure 3.2 includes multiple observations on one
line, for the morning and evening measurements.
But what if we went from two observations to hourly observati ons for 24 hours?
Remember, there is no way to arbitrarily select a subset of co lumns, so columns
gsl_stats March24,2009
96 CHAPTER 3
subjid value_morn value_eve poolcount pooldate t_type t_dosage
1 23.28 NaN 12 2/2/02 control NaN
2 14.07 NaN 12 2/2/02 control NaN
3 20.98 NaN 12 2/2/02 control NaN
4 12.12 NaN 12 2/2/02 control NaN
5 30.28 28.11 11 4/2/02 case 0.2
6 22.15 14.05 11 4/2/02 case 0.2
7 19.78 12.54 8 4/2/02 case 0.4
8 21.53 9.01 8 4/2/02 case 0.4
9 27.42 23.20 19 6/2/02 case 0.2
10 18.57 12.29 19 6/2/02 case 0.2
Figure 3.2 Spreadsheet style: one monolithic table, withmu ch redundancy.
obsidsubjid valuetime
11 23.28morn
22 14.07morn
33 20.98morn
44 12.12morn
55 30.28morn
66 22.15morn
77 19.78morn
88 21.53morn
99 27.42morn
1010 18.57morn
111 NaNeve
122 NaNeve
133 NaNeve
144 NaNeve
155 28.11eve
166 14.05eve
177 12.54eve
188 9.01eve
199 23.20eve
2010 12.29evesubjid poolid treatmentid
1 1 1
2 1 1
3 1 1
4 1 1
5 2 2
6 2 2
7 3 3
8 3 3
9 4 2
10 4 2
poolid poolcount pooldate
1 12 2/2/02
2 11 4/2/02
3 8 4/2/02
4 19 6/2/02
treatmentid t_type t_dosage
1 control NaN
2 case 0.2
3 case 0.4
4 case 0.6
Figure3.3 Database style:one table for eachobject type, on e row for eachobject.
gsl_stats March24,2009
DATABASES 97
named /BD/BT/C5, /BE/BT/C5,...,wouldbedifﬁculttouse.Ifweneededthemeanofallmor n-
ing observations, we’d need to do something like /D7/CT/D0/CT/D8 /B4/BD/BE/BT/C5 /B7 /BD/BT/C5 /B7 /BE/BT/C5/B7 /BF/BT/C5 /B7 /BA/BA/BA/B5/BB/BD/BE, but if the table in Figure 3.3 had an hour column, we could
simplyuse:
select avg (value)
fromobservations
wheretime like ’%am’
(or /DB/CW/CT/D6/CT /D8/CX/D1/CT /BO /BD/BE, dependingontheformat wechoosefor thetime).
If there is any chancethat two observationswill somehow be c ompared or aggre-
gated,thentheyshouldprobablyberecordedindifferentro wsofthesamecolumn.
For24 hoursandten subjects,thetablewould be 240rows,whichis notnearlyas
pleasing or human-digestible as a 10×24spreadsheet. But you will rarely need
to look at all the data at once, and can easily construct the cr osstab if need be via/CP/D4/D3/D4/CN/CS/CQ/CN/D8/D3/CN/D6/D3/D7/D7/D8/CP/CQ .
Even worse than having two data points of the same type in sepa rate columns is
having two data points of the same type in separate tables, su ch as a cases table
andacontrolstable.Or,saythatapoliticalscientistwant stodoastudyofcounty-
level data throughout the United States, including variabl es such as correlations
between tax rates, votes by Senators, and educational outco mes. Because DC has
nocountysubdivisionsanditsresidentshavenoCongressio nalrepresentation,the
DC data doesnotﬁt the form of the data for the states and commo nwealthsof the
United States. But the correct approachis nonethelessto pu t DC data in the same
table as the counties of the ﬁfty states, rather than creatin g a table for DC and a
tablefor allotherstates—orstill worse,a separatetablef oreverystate.
It is easy to /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /CP/D0/D0/CS/CP/D8/CP /DB/CW/CT/D6/CT /D7/CT/D2/CP/D8/CT/CN/DA/D3/D8/CT /CX/D7 /D2/D3/D8 /D2/D9/D0/D0if
DC’s lackofrepresentationwill affecttheanalysis.12
®Databasesarenotspreadsheets.Theyaretypicallydesigne dformany
tables,whichmayhavemillions ofrowsif necessary.
®Each type of object (observations, treatments, groups) sho uld have a
singletable,andeachobjectshouldhaveasinglerowin that table.
®Bear in mind the tools you have when designing your table layo uts.
Itiseasytojointables,ﬁndsubsetsoftables,andcreatesp readsheet-
like crosstabsfrom datatables.
12By the way, /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /CP/D0/D0/CS/CP/D8/CP /DB/CW/CT/D6/CT /D4/D3/D4/D9/D0/CP/D8/CX/D3/D2 /BQ /B4/D7/CT/D0/CT/D8 /D4/D3/D4/D9/D0/CP/D8/CX/D3/D2 /CU/D6/D3/D1/CP/D0/D0/CS/CP/D8/CP /DB/CW/CT/D6/CT /D7/D8/CP/D8/CT /BP /B3/BW/BV/B3/B5won’twork: itwillreturn only 49outof 50 states, because th epopulation of
DC (zero Senators, zero Representatives) is 572,000, while Wyoming (two Senators, one Representative) has a
population of 494,000. [2000 census data]
gsl_stats March24,2009
98 CHAPTER 3
3.5 F OLDING QUERIES INTO CCODE This section covers the functions in
the Apophenia library that will cre-
ate and query a database. All of these functions are wrappers of functions in the
SQLite or mySQL libraries that do the dirty work, but they are sufﬁciently com-
plete that you should never need to use the functions in the SQ Lite/mySQL C
librariesdirectly. Thedetailsofthemaindiscussionwill applyto SQLite;mySQL
users,seepage106forthelist ofdifferences.
IMPORTING The ﬁrst command you will need is /CP/D4/D3/D4/CN/D3/D4/CT/D2/CN/CS/CQ . If you give it the
name of a ﬁle, like /CP/D4/D3/D4/CN/D3/D4/CT/D2/CN/CS/CQ/B4Ꜽ /D7/D8/D9/CS/DD/BA/CS/CQ Ꜽ/B5, then the database
will live on your hard drive. This is slower than memory, but w ill exist after you
stopandrestarttheprogram,andsootherprogramswillbeab letousetheﬁle,you
have more information for debugging, and you can re-run the p rogram without
re-reading in the data. Conversely, if you give a null argume nt— /CP/D4/D3/D4/CN/D3/D4/CT/D2/CN/B9/CS/CQ/B4/C6/CD/C4/C4/B5 —thenthedatabaseiskeptin memory,andwillrunfasterbutd isappear
when the program exits. Apophenia uses only one database at a time, but see the/CP/D4/D3/D4/CN/D1/CT/D6/CV/CT/CN/CS/CQ/D7 andSQLite’s /CP/D8/D8/CP/CWfunctionsbelow.
Command-lineutilities
Apophenia includes a handful of command-line util-
ities for handling SQLite databases where there is no
need to write a full-blown C program. /CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/B9/D8/D3/CN/CS/CQreads a text ﬁle into a database table, /CP/D4/D3/D4/CN/B9/D1/CT/D6/CV/CT/CN/CS/CQ/D7 will send tables from one database to an-
other, /CP/D4/D3/D4/CN/D4/D0/D3/D8/CN/D5/D9/CT/D6/DD will send query output di-
rectly to Gnuplot, and /CP/D4/D3/D4/CN/CS/CQ/CN/D8/D3/CN/D6/D3/D7/D7/D8/CP/CQ will
take a table from the SQLite database and produce a
crosstab. All of these are simply wrappers for the cor-
responding Apophenia functions. For all of the utili-
ties, you can use the /B9/CWparameter to get detailed in-
structions (e.g., /CP/D4/D3/D4/CN/D4/D0/D3/D8/CN/D5/D9/CT/D6/DD /B9/CW).Unless your program is generat-
ing its own data, you will probably
ﬁrst be importing data from a text
ﬁle. The /CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/D8/D3/CN/CS/CQ func-
tion will do this for you, or you can
tryitonthecommandline(seebox).
The ﬁrst line of the text ﬁle can be
column names, and the remaining
rowsare thedata.If yourdataﬁle is
not quite in the right format (and it
rarely is), see Appendix B for some
textmassagingtechniques.
When you are done with all of your
queries, run /CP/D4/D3/D4/CN/D0/D3/D7/CT/CN/CS/CQ to close the database. If you send the function a
one— /CP/D4/D3/D4/CN/D0/D3/D7/CT/CN/CS/CQ/B4/BD/B5 —then SQLite will take a minute to clean up the da-
tabase before exiting, leaving you with a smaller ﬁle on disk ; sending in a zero
doesn’t bother with this step. Of course, if your database is in memory, it’s all
mootandyoucanforget to closethe databasewithoutconsequ ence.
The queries Thesimplestfunctionis /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD , whichtakesa singletextargu-
ment: the query. This line runs the query and returns nothing , which
isappropriatefor /D6/CT/CP/D8/CTor /CX/D2/D7/CT/D6/D8queries:
gsl_stats March24,2009
DATABASES 99
intpage_limit = 600;
apop_query(
"create table tourist_traps as \
select country \
from lonely_planet \
where (pp+ 0.0) > %i ",page_limit);
• A string is easiestfor you as a human to read if it is broken up over severallines;
to do this, end every line with a backslash, until you reach th e end of the string.
Thenextexamplewill useanotheralternative.
• As the example shows, all of Apophenia’s query functions ac cept the /D4/D6/CX/D2/D8/CU-
style arguments from page 26, so you can easily write queries based on C-side
calculations.
Therearealsoaseriesoffunctionsto querythedatabaseand putthe resultinaC-
side variable. This function will run the givenquery and ret urn the resulting table
foryouranalysis:
intpage_limit = 600;
apop_data *tourist_traps = apop_query_to_text(
"select country "
"from lonely_planet "
"where (0.0+pp)> %i ", page_limit);
• C merges consecutive strings, so Ꜽ/D7/CT/D0/CT/D8 /D3/D9/D2/D8/D6/DD Ꜽ Ꜽ/CU/D6/D3/D1Ꜽwill be merged
into Ꜽ/D7/CT/D0/CT/D8 /D3/D9/D2/D8/D6/DD /CU/D6/D3/D1Ꜽ.Wecanusethistosplitastringoverseverallines.
But be careful to include whitespace: Ꜽ/D7/CT/D0/CT/D8 /D3/D9/D2/D8/D6/DDꜼ Ꜽ/CU/D6/D3/D1Ꜽmerges intoꜼ/D7/CT/D0/CT/D8 /D3/D9/D2/D8/D6/DD/CU/D6/D3/D1Ꜽ .
Afterthissnippet, /D8/D3/D9/D6/CX/D7/D8/CN/D8/D6/CP/D4/D7 isallocated,ﬁlledwithdata,andreadytouse—
unlessthequeryreturnednodata,inwhichcaseitis /C6/CD/C4/C4.Itisworthcheckingfor/C6/CD/C4/C4outputafteranyquerythatcouldreturnnothing.Thereare /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/BA/BA/BA
functions for all of the types you will meet in the next chapte r, including /CP/D4/D3/D4/CN/B9/D5/D9/CT/D6/DD/CN/D8/D3/CN/D1/CP/D8/D6/CX/DC to pull a query to a /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC , /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/D8/D3/CN/D8/CT/DC/D8 to
pulla queryinto thetextpartofan /CP/D4/D3/D4/CN/CS/CP/D8/CP set, /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/D8/D3/CN/CS/CP/D8/CP to pull
data into the matrix part, and /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/D8/D3/CN/DA/CT/D8/D3/D6 and /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/D8/D3/CN/B9/CU/D0/D3/CP/D8to pull the ﬁrst column or ﬁrst number of the returned table in to a /CV/D7/D0/CN/B9/DA/CT/D8/D3/D6ora /CS/D3/D9/CQ/D0/CT.
For immediate feedback, you can use /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D7/CW/D3/DB to dump your data to
screen or /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D4/D6/CX/D2/D8 to print to a ﬁle (or even back to the database). If
youwanta quickon-screenpicture ofa table,try
apop_data_show(apop_query_to_data("select *from table"));
gsl_stats March24,2009
100 CHAPTER 3
Listing 3.4givesan ideaofhowquicklydata canbebroughtfr om a database-side
tableto aC-sidematrix. Theuseofthesestructuresishandl edindetailinChapter
4, so the application of the /D4/CT/D6/CP/D4function may mystify those reading this book
sequentially.But the /D1/CP/CX/D2function shouldmakesense:it opensthe database,sets
the /CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/CS/CQ/CN/D2/CP/D1/CT/CN/D3/D0/D9/D1/D2 to an appropriate value, and then uses /CP/D4/D3/D4/CN/B9/D5/D9/CT/D6/DD/CN/D8/D3/CN/CS/CP/D8/CP to pull outa data set.Its lasttwo stepsdo the math andshowth e
resultsonscreen.
1#include <apop.h>
2
3voidpercap(gsl_vector *in){
4doublegdp_per_cap = gsl_vector_get(in, 1)/gsl_vector_get(in, 0);
5 gsl_vector_set(in,2, gdp_per_cap); //column 2isgdp_per_cap.
6 }
7
8intmain(){
9 apop_opts.verbose ++;
10 apop_db_open("data −wb.db");
11 strcpy(apop_opts.db_name_column,"country");
12 apop_data *d= apop_query_to_data("select pop.country ascountry,\
13 pop.population as pop,gdp.GDPas GDP,1as GDP_per_cap\
14 from pop,gdp \
15 where pop.country == gdp.country");
16 apop_matrix_apply(d −>matrix,percap);
17 apop_data_show(d);
18 apop_opts.output_type = ’d’;
19 apop_data_print(d, "wbtodata_output");
20 }
Listing3.4 Querypopulations andGDPtoan /CP/D4/D3/D4/CN/CS/CP/D8/CP structure,andthencalculatethe GDPper
capita using Croutines. Online source: /DB/CQ/D8/D3/CS/CP/D8/CP/BA .
• Line 11: As above, SQL tables have no special means of handli ng row names,
while /CP/D4/D3/D4/CN/CS/CP/D8/CP sets can have both row and column labels. You can set /CP/D4/D3/D4/CN/B9/D3/D4/D8/D7/BA/CS/CQ/CN/D2/CP/D1/CT/CN/D3/D0/D9/D1/D2 toacolumnnamethatwillbespeciallytreatedasholding
rownamesfor thesakeofimporting to an /CP/D4/D3/D4/CN/CS/CP/D8/CP set.
• Lines12–15:Theﬁnaltablewillhavethreecolumns(pop,GD P,GDP/cap),sothe
query asks for three columns, one of which is ﬁlled with ones. This is known as
planningahead :it is difﬁcultto resize /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC esand /CP/D4/D3/D4/CN/CS/CP/D8/CP sets,so we
querya tableof the appropriatesize,andthenﬁll the column ofdummy datawith
correctvaluesin theC-side matrix.
Data to db To go from C-side matrices to database-side tables, there ar e the plain
old print functions like /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D4/D6/CX/D2/D8 and /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D4/D6/CX/D2/D8 .
Lines 18–19of Listing 3.4 will write the data table to a table named /DB/CQ/D8/D3/CS/CP/D8/CP/CN/B9/D3/D9/D8/D4/D9/D8.Saythattomorrowyoudecideyouwouldpreferto havethedat adumped
to aﬁle;thenjustchangethe /B3/CS/B3to an /B3/CU/B3andawayyougo.
gsl_stats March24,2009
DATABASES 101
Crosstabs Inthespreadsheetworld,weoftengettablesinaformwhereb oththeX-
and Y-dimensions are labeled, such as the case where the X-di mension
is the year, the Y-dimension is the location, and the (x,y)point is a measurement
takenthatyearatthatlocation.
Conversely,the mostconvenientform for this data in a datab aseis three columns:
year, location, statistic. After all, how would you write a q uery such as /D7/CT/D0/CT/D8/D7/D8/CP/D8/CX/D7/D8/CX /CU/D6/D3/D1 /D8/CP/CQ /DB/CW/CT/D6/CT /DD/CT/CP/D6 /BO /BD/BL/BL/BCif there werea separatecolumnfor
eachyear?Convertingbetweenthe two forms is an annoyance, and soApophenia
providesfunctionsto do conversionsbackand forth, /CP/D4/D3/D4/CN/CS/CQ/CN/D8/D3/CN/D6/D3/D7/D7/D8/CP/CQ and/CP/D4/D3/D4/CN/D6/D3/D7/D7/D8/CP/CQ/CN/D8/D3/CN/CS/CQ .
Imagine a data table with two columns, /CW/CT/CX/CV/CW/D8and /DB/CX/CS/D8/CW, where /CW/CT/CX/CV/CW/D8may
takeonvalueslike /D9/D4, /D1/CX/CS/CS/D0/CT, or /CS/D3/DB/D2, and /DB/CX/CS/D8/CWtakesonvalueslike /D0/CT/CU/D8and/D6/CX/CV/CW/D8.Thenthequery
create table anovatab as
selectheight, width, count(*)asct
groupby height, width
will produceatable lookingsomethinglike
height width ct
up left 12
up right 18
middle left 10
middle right 7
down left 6
down right 18
Then,the command
apop_data *anova_tab = apop_db_to_crosstab("anovatab","height"," width","ct");
will putinto /CP/D2/D3/DA/CP/CN/D8/CP/CQ dataoftheform
Left Right
Up12 18
Middle 10 7
Down 6 18
gsl_stats March24,2009
102 CHAPTER 3
You can print this table as a summary, or use it to run ANOVA tes ts, as in Sec-
tion 9.4.The /CP/D4/D3/D4/CN/D6/D3/D7/D7/D8/CP/CQ/CN/D8/D3/CN/CS/CQ function goesin the otherdirection;seethe
onlinereferencefor details.
Q3.13Use the command-line program /CP/D4/D3/D4/CN/CS/CQ/CN/D8/D3/CN/D6/D3/D7/D7/D8/CP/CQ (or the corre-
spondingC function) and the /CS/CP/D8/CP/B9/D0/CX/D1/CP/D8/CT/BA/CS/CQ databaseto produce a ta-
ble of temperatures, where each row is a year and each column a month.
Importtheoutputinto yourfavorite spreadsheetprogram.
Multiple databases For both SQL and C, the dot means subelement . Just as a
C /D7/D8/D6/D9/D8named /D4/CT/D6/D7/D3/D2might have a subelement named/D4/CT/D6/D7/D3/D2/BA/CW/CT/CX/CV/CW/D8 ,the fullnameofacolumnis /CS/CQ/D2/CP/D1/CT/BA/D8/CP/CQ/D0/CT/D2/CP/D1/CT/BA/D3/D0/D2/CP/D1/CT .
The typical database system (including mySQL and SQLite) be gins with one da-
tabase open, which always has the alias /D1/CP/CX/D2, but allows you to attach additional
databases. For SQLite, the syntax is simply /CP/D8/D8/CP/CW /CS/CP/D8/CP/CQ/CP/D7/CT Ꜽ/D2/CT/DB/CS/CQ/BA/CS/CQꜼ /CP/D7/CS/CQ/CP/D0/CX/CP/D7 /BNafter this you can refer to tables via the /CS/CQ/CP/D0/CX/CP/D7/BA/D8/CP/CQ/D0/CT/D2/CP/D1/CT form.
FormySQL,youdon’tevenneedthe /CP/D8/D8/CP/CWcommand,andcanreferto tablesin
othermySQLdatabasesusingthe /CS/CQ/D2/CP/D1/CT/BA/D8/CP/CQ/D0/CT/D2/CP/D1/CT form atanytime.
Aliasesagainhelptoretainbrevity.Insteadofusingthefu ll /CS/CQ/BA/D8/CP/CQ/D0/CT/BA/D3/D0 format
foracolumn,thisqueryassignsaliasesforthe /CS/CQ/BA/D8/CP/CQ/D0/CT partsinthe /CU/D6/D3/D1clause,
thenusesthosealisesin the /D7/CT/D0/CT/D8clause:
attachdatabase newdb asn;
selectt1.c1, t2.c2
frommain.ﬁrsttabt1,n.othertabt2
Given two attached databases, say /D1/CP/CX/D2and /D2/CT/DB, you could easily copy tables
betweenthemvia
create table new.tablecopy
as select*frommain.origial
Apopheniaalsoprovidestwoconveniencefunctions, /CP/D4/D3/D4/CN/CS/CQ/CN/D1/CT/D6/CV/CT and /CP/D4/D3/D4/CN/B9/CS/CQ/CN/D1/CT/D6/CV/CT/CN/D8/CP/CQ/D0/CT ,whichfacilitate suchcopying.
In-memory databases are faster, but at the close of the progr am, you may want
the database on the hard drive. To get the best of both worlds, use an in-memory
databaseforthe bulkofthework,andthenwrite the database to diskatthe endof
theprogram,e.g.:
gsl_stats March24,2009
DATABASES 103
intmain(void){
apop_db_open(NULL); //open adbinmemory.
do_hard_math(...);
remove("on_disk.db");
apop_db_merge("on_disk.db");
}
• /D6/CT/D1/D3/DA/CTisthe standardC library functionto deleteaﬁle.
• Removing the ﬁle before merging prevented the duplication of data (because du-
plicatetablesareappendedto, notoverwritten).
®Open an SQLite database in memory using /CP/D4/D3/D4/CN/CS/CQ/CN/D3/D4/CT/D2/B4/C6/CD/C4/C4/B5 ,
andontheharddriveusing /CP/D4/D3/D4/CN/CS/CQ/CN/D3/D4/CT/D2/B4Ꜽ/CU/CX/D0/CT/D2/CP/D1/CTꜼ/B5 .
®Importdatausing /CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/D8/D3/CN/CS/CQ .
®If you don’t need output, use /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD to send queries to the da-
tabaseengine.
®Use /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/D8/D3/CN/B4/CS/CP/D8/CP/DG/D1/CP/D8/D6/CX/DC/DG/DA/CT/D8/D3/D6/DG/D8/CT/DC/D8/DG/CU/D0/D3/CP/D8/B5 to
write aqueryresultto variousformats.
3.6 M ADDENING DETAILS Data are never as clean as it seems in the text-
books, and our faster computers have done noth-
ing to help the fact that everybody has different rules regar ding how data should
bewrittendown.Hereareafewtipsondealingwithsomecommo nfrustrationsof
dataimportation anduse;AppendixBoffers afew moretools.
Spaces in column names Column names should be short and have no punctu-
ation but underscores. Instead of a column name like/C8/CT/D6/CT/D2/D8 /D3/CU /D1/CP/D0/CT /D8/D6/CT/CP/D8/D1/CT/D2/D8 /BD /CP/D7/CT/D7 /D7/CW/D3/DB/CX/D2/CV /D3/D2/D0/DD /D7/CX/CV/D2/D7 /D3/CU /D2/CP/D9/D7/CT/CP,
giveabriefnamelike /D1/CP/D0/CT/CN/D8/BD/CN/D1/D3/CS/CT/D6/CP/D8/CT ,andthencreateadocumentationtable
thatdescribesexactlywhatthatabbreviationmeans.
Not everybody follows this advice, however, which creates a small frustration.
The query /D7/CT/D0/CT/D8 /B3/D4/CT/D6/CT/D2/D8 /D3/CU /D1/CP/D0/CT/D7 /D8/D6/CT/CP/D8/D1/CT/D2/D8 /BD/B3 /CU/D6/D3/D1 /CS/CP/D8/CPwill pro-
duce a table with the literal string /D4/CT/D6/CT/D2/D8 /D3/CU /D1/CP/D0/CT/D7 /D8/D6/CT/CP/D8/D1/CT/D2/D8 /BDrepeated
for each row, which is far from what you meant. The solution is to use the dot
notation to specify a table: /D7/CT/D0/CT/D8 /CS/CP/D8/CP/BA/B3/D4/CT/D6/CT/D2/D8 /D3/CU /D1/CP/D0/CT/D7 /D8/D6/CT/CP/D8/D1/CT/D2/D8 /BD/B3
gsl_stats March24,2009
104 CHAPTER 3/CP/D7 /D1/CP/D0/CT/D7/CN/D8/BD /CU/D6/D3/D1 /CS/CP/D8/CPwill correctly return the data column, and give it an
aliasthatis mucheasierto use.
Text and numbers Insomecases,youneedbothtextandnumericdatainthesame
data set. As you will see in the next chapter, the /CP/D4/D3/D4/CN/CS/CP/D8/CP
structure includes slots for both text and numbers, so you on ly need to specify
which column goes where. The ﬁrst argument to the /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/D8/D3/CN/D1/CX/DC/CT/CS/CN/B9/CS/CP/D8/CPfunction is a speciﬁer consisting of the letters /D2, /DA, /D1, /D8, indicating whether
each column should be read in to the output /CP/D4/D3/D4/CN/CS/CP/D8/CP ’s name, vector, a matrix
column, or a text column. For example, /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/D8/D3/CN/D1/CX/DC/CT/CS/CN/CS/CP/D8/CP/B4Ꜽ/D2/D1/D8Ꜽ/B8Ꜽ/D7/CT/D0/CT/D8 /CP/B8 /CQ/B6/B1/CX/B8  /CU/D6/D3/D1 /CS/CP/D8/CPꜼ/B8 /D3/D9/D2/D8/CT/D6/B5 wouldusecolumn /CPasthe row
names, /CQ/B6/D3/D9/D2/D8/CT/D6 as the ﬁrst column of the matrix, and as a column of text
elements. This provides maximal ﬂexibility, but requires k nowing exactly what
thequerywill output.13
Now that you have text in an /CP/D4/D3/D4/CN/CS/CP/D8/CP set, what can you do with it? In most
cases,thedatawill beunordereddiscretedata,andtheonly thing youcandowith
itis to turn it intoa seriesofdummyvariables.Seepage123f or anexample.
Missing data Everybody represents missing data differently. SQLite use s /C6/CD/C4/C4to
indicate missing data; Section 4.5 will show that real numbe rs in C
can take /C6/BT/C6values, whose use is facilitated by the GSL’s /BZ/CB/C4/CN/C6/BT/C6 macro. The
typical input data set indicates a missing value with a text m arker like /C6/CP/C6, /BA/BA, /B9,/B9/BD, /C6/BT, orsomeotherarbitrary indicator.
Whenreadingintext,youcanset /CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/CS/CQ/CN/D2/CP/D2 toaregularexpressionthat
matches the missing data marker. If you are unfamiliar with r egular expressions,
seeAppendixB fora tutorial. Fornow,herearesomeexamples :
//Apophenia’s default NaNstring, matching NaN,nan,or NAN :
strcpy(apop_opts.db_nan,"NaN");
//Literaltext:
strcpy(apop_opts.db_nan,"Missing");
//Matches twoperiods. Periods are special inregexes, soth eyneed backslashes.
strcpy(apop_opts.db_nan,"\\.\\.");
13Whydoesn’tApophenia automatically detect thetype ofeach column? Because itstresses replicability, and
it is impossible to replicably guess column types. One commo n approach used by somestats packages is to look
at the ﬁrst row of data and use that to cast the entire column, b ut if the ﬁrst element in a column is /C6/BT/C6, then
numeric data may wind up as text or vice versa, depending on ar bitrary rules. Thesystem could search the entire
column for text and presume that some count of text elements m eans the entire column is text, but this too is
error-prone. Next month, when the new data set comes in, colu mns that used to be auto-typed as text may now
be auto-typed as numbers, so scripts written around the ﬁrst data set break. Explicitly specifying types may take
work, butoutguessing the system’s attempts atcleaning rea l-world data frequently takes morework.
gsl_stats March24,2009
DATABASES 105
The searched-for text must be the entire string, plus or minu s surrounding quota-
tionmarksorwhitespace.Noneofthesewillmatch /C6/BT/C6/BV/CHor /D1/CX/D7/D7/CX/D2/CV /D4/CT/D6/D7/D3/D2/D7.
Once the database has a /C6/CD/C4/C4in the right place, Apophenia’s functions to read
betweendatabasesononesideand /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC es, /CP/D4/D3/D4/CN/CS/CP/D8/CP ,andotherCstruc-
tures on the other will translate betweendatabase /C6/CD/C4/C4s and ﬂoating-point /BZ/CB/C4/CN/B9/C6/BT/C6s.
Mathematically, any operation on unknown data produces an u nknown result, so
youwillneedtodosomethingtoensurethatyourdatasetisco mpletebeforemak-
ingestimationsbasedonthedata.Thenaïveapproachistosi mplydeleteeveryob-
servation that is not complete. Allison (2002) points out th at this naïve approach,
knowninthejargonas listwisedeletion ,isasomewhatreasonableapproach,espe-
cially if there is no reason to suspectthat the pattern of mis sing data is correlated
tothedependentvariableinyourstudy.14Missingdatawillbecoveredindetailon
page345.
ImplementinglistwisedeletioninSQLis simple:given /CS/CP/D8/CP/D3/D0/BD and /CS/CP/D8/CP/D3/D0/BE ,
add a /DB/CW/CT/D6/CT /CS/CP/D8/CP/D3/D0/BD /CX/D7 /D2/D3/D8 /D2/D9/D0/D0 /CP/D2/CS /CS/CP/D8/CP/D3/D0/BE /CX/D7 /D2/D3/D8 /D2/D9/D0/D0clause to
yourquery.Ifboth arenumericdata,thenyoucanevensummar izethisto/DB/CW/CT/D6/CT /B4 /CS/CP/D8/CP/D3/D0/BD /B7 /CS/CP/D8/CP/D3/D0/BE /B5 /CX/D7 /D2/D3/D8 /D2/D9/D0/D0.
Q3.14Using the above notes and the /CS/CP/D8/CP/B9/D8/CP/D8/D8/D3/D3/BA/CS/CQ ﬁle, query to an /CP/D4/D3/D4/CN/B9/CS/CP/D8/CPset the number of tattoos, number of piercings, and the polit ical af-
ﬁliation of each subject. Make sure that all /C6/CP/C6s are converted to zeros at
somepointalongthechain.Printthetabletoscreen(via /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D7/CW/D3/DB )
to make sure that all is correctly in place. Then, query out a l ist of the po-
litical parties in the data set. ( Hint: /D7/CT/D0/CT/D8 /CS/CX/D7/D8/CX/D2/D8 .) Write a /CU/D3/D6loop
torunthroughthelist,ﬁndingthemeannumberoftattoosand piercingsfor
Democrats,Republicans,.... Would you keepthe last person in the survey
(who has far more tattoos than anybody else) or eliminate the person as an
outlier, via a /DB/CW/CT/D6/CTclauserestricting thetattoo countto under30?
Outer join Another possibility is that a row of data is entirely missing from one
table. The World Bank database includes a /D0/D3/D2/CT/D0/DD/CN/D4/D0/CP/D2/CT/D8 table list-
ing the number of pages in the given country’s Lonely Planet t ourist guidebook.
Antarcticahasa 328-pageguidebook,butnoGDP anda negligi blepopulation,so
thequery
14Systematic relationships between missingness and the inde pendent variables is much less of aconcern.
gsl_stats March24,2009
106 CHAPTER 3
selectpp,gdp
fromlonely_planet lp,gdp
wherelp.country=gdp.country
will not return an Antarctica line, because there is no corre sponding line in the/CV/CS/D4table. The solution is the /D3/D9/D8/CT/D6 /CY/D3/CX/D2, which includes all data in the ﬁrst
table, plus data from the second table or a blank if necessary . Here is a join that
will includeAntarcticain its output.Theconditionfor joi ningthe two tables(join/D3/D2 /D0/BA/D3/D9/D2/D8/D6/DD/BP/CV/CS/D4/BA/D3/D9/D2/D8/D6/DD )nowappearsinadifferentlocationfromthenorm,
becausetheentireleftouterjoinclausedescribesasingle tabletobeusedasadata
source.
selectpp,gdp
fromlonely_planet lp leftouter join gdp
onl.country=gdp.country
wherel.country like’A%’
Q3.15The query above is a left outer join , which includes all data from the left
table, but may exclude data from the right table. As of this wr iting, this
is all that SQLite supports, but other systems also support t heright outer
join(includeallentriesintherighttable)andthe fullouterjoin (includeall
entriesfrom bothtables).
Usingthe /D9/D2/CX/D3/D2keyword,generateareferencetablewithallofthecountry
names from both the Lonely Planet and GDP tables. Then use a fe w left
outer joins beginning with the reference table to produce a c omplete data
set./F4mySQL As well as SQLite, Apophenia supports mySQL. mySQL is somewh at
better for massive data sets, but will work only if you alread y have a
mySQLserverrunning,havepermissiontoaccessit,andhave adatabaseinplace.
YourpackagemanagerwillmakeinstallingthemySQLserver, client,anddevelop-
mentlibrarieseasy,andmySQL’smaintainershaveplacedon lineacomprehensive
manualwith tutorial.
OncemySQLissetuponyoursystem,youwillneedtomakeoneof twochanges:
either set your shell’s /BT/C8/C7/C8/CN/BW/BU/CN/BX/C6/BZ/C1/C6/BX environment variable to /D1/DD/D7/D5/D0,15or in
your code, set /CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/CS/CQ/CN/CT/D2/CV/CX/D2/CT/BP/B3/D1/B3 . You can thus switch back and forth
between SQLite and mySQL; if the variable is /B3/D1/B3then any database operations
will go to the mySQL engineandif it is not, then databaseoper ationswill besent
15As discussed in Appendix A, you will probably want to add /CT/DC/D4/D3/D6/D8 /BT/C8/C7/C8/CN/BW/BU/CN/BX/C6/BZ/C1/C6/BX/BP/D1/DD/D7/D5/D0 to your/BA/CQ/CP/D7/CW/D6 on systems using /D1/DD/CB/C9/C4.
gsl_stats March24,2009
DATABASES 107
to the SQLite engine. This could be useful for transferring d ata between the two.
Forexample:
apop_opts.db_engine = ’m’;
apop_db_open("mysqldb");
apop_data *d= apop_query_to_data("select *fromget_me");
apop_opts.db_engine = ’l’;
apop_db_open("sqlitedb");
apop_opts.output_type = ’d’;//print todatabase.
apop_data_print(d,"put_me");
SQLite’s concept of a database is a single ﬁle on the hard driv e, or a database
in memory. Conversely mySQL has a server that stores all data bases in a central
repository (whose location is of no concern to end-users). I t has no conceptof an
in-memory database.
As noted above, every SQL system has its own rules for metatad ata. From the/D1/DD/D7/D5/D0prompt, you can query the mySQL server for a complete list of d atabases
with /D7/CW/D3/DB /CS/CP/D8/CP/CQ/CP/D7/CT/D7 ,andthenattachtooneusing /D9/D7/CT /CS/CQ/D2/CP/D1/CT /BN(ortype /D1/DD/D7/D5/D0/CS/CQ/D2/CP/D1/CTat the command prompt to attach to /CS/CQ/D2/CP/D1/CTfrom the outset). You can
use /D7/CW/D3/DB /D8/CP/CQ/D0/CT/D7/BN togetthelistoftablesinthecurrentdatabase(like theSQL ite
prompt’s /BA/D8/CP/CQ/D0/CT/D7 command), or use /D7/CW/D3/DB /D8/CP/CQ/D0/CT/D7 /CU/D6/D3/D1 /DD/D3/D9/D6/CN/CS/CQ/BN to see the
tables in /DD/D3/D9/D6/CN/CS/CQ without ﬁrst attaching to it. Given a table, you can use /D7/CW/D3/DB/D3/D0/D9/D1/D2/D7 /CU/D6/D3/D1 /DD/D3/D9/D6/CN/D8/CP/CQ/D0/CT to seethecolumnnamesof /DD/D3/D9/D6/CN/D8/CP/CQ/D0/CT .16
mySQL digresses from the SQL standard in different manners f rom SQLite’s
meansofdigressingfrom thestandard:
• SQLite is somewhatforgiving aboutdetails of punctuation ,such as taking /BP/BPand/BPas equivalent, and “double-ticks” and ‘single-ticks’ as eq uivalent. mySQL de-
mandsa single /BPand‘single-ticks’.
• After every /D7/CT/D0/CT/D8, /D6/CT/CP/D8/CT, and so on, mySQL’s results need to be internally
processed, lest you get an error about commands executed out of order. Apophe-
nia’s functions handle the processing for you, but you may st ill see odd effects
whensendingastringholdingmultiplesemicolon-separate dqueriestothe /CP/D4/D3/D4/CN/B9/D5/D9/CT/D6/DD/BA/BA/BA functions. Similarly, you may havetrouble using /CQ/CT/CV/CX/D2/ /D3/D1/D1/CX/D8wrap-
pers to bundle queries, though mySQL’s internal cache manag ement may make
suchwrappersunnecessary.
• mySQLincludesmanymorefunctionsbeyondtheSQLstandard ,andhasanumber
of additional utilities. For example, there is a /C4/C7/BT/BWcommand that will read in a
textﬁle muchmorequicklythan /CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/D8/D3/CN/CS/CQ .
16Or, usethecommand-line program /D1/DD/D7/D5/D0/D7/CW/D3/DB to do all of these things in aslightly morepleasant format.
gsl_stats March24,2009
108 CHAPTER 3
®SQL represents missing data via a /C6/CD/C4/C4marker, so queries may in-
cludeconditionslike /DB/CW/CT/D6/CT /D3/D0 /CX/D7 /D2/D3/D8 /D2/D9/D0/D0.
®Data ﬁles use whatever came to mind to mark missing data, so se t/CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/CS/CQ/CN/D2/CP/D2 toaregularexpressionappropriateforyourdata.
®If a name appears in one table but not another, and you would li ke
to joint tablesbyname,usethe /D3/D9/D8/CT/D6 /CY/D3/CX/D2to ensurethat allnames
appear.
3.7 SOME EXAMPLES Here are afew examplesof howC codeandSQL calls
canneatly interact.
TAKING SIMULATION NOTES Saythatyouarerunningasimulationandwouldlike
to take noteson its state each period. The following
codewillopenaﬁleontheharddrive,createatable,andadda nentryeachperiod.
The begin-commit wrapper puts data in chunks of 10,000 eleme nts, so if you get
tired of waiting, you can halt the program and walk away with y our data to that
point.17
doublesim_output;
apop_db_open("sim.db");
apop_table_exists("results", 1); //See below.
apop_query("create table results (period,output);begin ;");
for(inti=0; i<max_periods; i++){
sim_output =run_sim(i);
apop_query("insertintoresults values(%i,%g);",i, sim_ output);
if(!(i%1e4))
apop_query("commit; begin;");
}
apop_query("commit;");
apop_db_close(0);
• The /CP/D4/D3/D4/CN/D8/CP/CQ/D0/CT/CN/CT/DC/CX/D7/D8/D7 command checks for whether a table already exists. If
the second argument is one, as in the example above, then the t able is deleted
so that it can be created anew subsequently; if the second arg ument is zero, then
the function simply returns the answer to the question “does the table exist?” but
leavesthetableintactif itis there.It is especiallyusefu lin /CX/CUstatements.
• Every 1e4entries, the system commits what has been entered so far and b egins
a new batch. With some SQLite systems, this can add signiﬁcan t speed. mySQL
17Sometimessuchbehaviorwillleavethedatabaseinanunclea n state.Ifso,trytheSQLitecommand /DA/CP/D9/D9/D1.
gsl_stats March24,2009
DATABASES 109
doesitsownbatchmanagement,sothe /CQ/CT/CV/CX/D2sand /D3/D1/D1/CX/D8sshouldbeomittedfor
mySQLdatabases.
EASY T-TESTS People on the East and West coasts of the United States someti mes
joke that they can’t tell the difference between all those st ates in
the middle. This is a perfect chance for a ttest: are incomes in North Dakota
signiﬁcantly different from incomes in South Dakota? First , we will go through
thetestalgorithm in English,andthenseehowitis donein co de.
LettheﬁrstdatasetbetheincomeofcountiesinNorthDakota ,andletthesecond
betheincomeofcountiesinSouthDakota.If ˆµ,ˆσ2,andnaretheestimatedmean,
variance,andactualcountofelementsofthe North andSouth datasets,
stat=ˆµN−ˆµS/radicalig
ˆσ2
N/nN+ ˆσ2
S/nS∼tnN+nS−2. (3.7.1)
[Thatis,thegivenratiohasa tdistributionwith nN+nS−2degreesoffreedom.]
The ﬁnal step is to look up this statistic in the standard ttables as found in the
backof any standardstatistics textbook.Of course,lookin g up data is the job of a
computer,soweinsteadasktheGSL forthetwo-tailed conﬁde ncelevel(seepage
305fordetails):
doubleconﬁdence = (1−2*gsl_cdf_tdist_Q(|stat|, nN+nS−2));
If /D3/D2/CU/CX/CS/CT/D2/CT is large, say >95%, then we can reject the null hypothesis that
NorthandSouthDakotanincomes(bycounty)aredifferent.O therwise,thereisn’t
enoughinformation to saymuchwith conﬁdence.
Listing 3.5translatesthe processinto C.
• Lines 4–8 comprise two queries, that are read into a /CV/D7/D0/CN/DA/CT/D8/D3/D6 . Both ask for
the same data, but one has a /DB/CW/CT/D6/CTclause restricting the query to pull only North
Dakotan counties, and the other has a /DB/CW/CT/D6/CTclause restricting the query to South
Dakota.
• Lines10–15getthe vitalstatisticsfrom thevectors:coun t,mean,andvariance.
• Giventhis, line 17is thetranslationofEquation3.7.1.
• Finally, line 18is the conﬁdencecalculationfrom above,w hichline 19 prints asa
percentage.
gsl_stats March24,2009
110 CHAPTER 3
1#include <apop.h>
2
3intmain(){
4 apop_db_open("data −census.db");
5gsl_vector *n=apop_query_to_vector("select in_per_capita from inco me "
6 "where state= (select statefrom geography where name =’No rthDakota’)");
7gsl_vector *s= apop_query_to_vector("selectin_per_capita from inco me "
8 "where state= (select statefrom geography where name =’So uthDakota’)");
9
10 doublen_count =n−>size,
11 n_mean = apop_vector_mean(n),
12 n_var = apop_vector_var(n),
13 s_count = s −>size,
14 s_mean = apop_vector_mean(s),
15 s_var =apop_vector_var(s);
16
17 doublestat =fabs(n_mean −s_mean)/sqrt(n_var/(n_count −1)+ s_var/(s_count −1));
18 doubleconﬁdence =1−(2*gsl_cdf_tdist_Q(stat,n_count +s_count −2));
19 printf("Reject the nullwith%g%% conﬁdence\n",conﬁden ce*100);
20 }
Listing3.5 Are North Dakota incomes different from South Da kota incomes? Answering the long
way. Online source: /D8/D8/CT/D7/D8/BA/D0/D3/D2/CV/BA .
No, easier Butthis is notquite aseasyasit couldbe,becauseApophenia provides
a high-level function to do the math for you, as per Listing 3. 6. The
codeisidenticaluntillineeight,butthenlineninecallst he /CP/D4/D3/D4/CN/D8/CN/D8/CT/D7/D8 function,
whichtakesthetwovectorsasinput,andreturnsan /CP/D4/D3/D4/CN/CS/CP/D8/CP structureasoutput,
listing the relevant statistics. Line ten prints the entire output structure, and line
eleven selects the single conﬁdence statistic regarding th e two-tailed hypothesis
thatincome ND∝\e}atio\slash=income SD.
DUMMY VARIABLES The /CP/D7/CTcommand is the if-then-else of SQL. Say that you
have data that are true/false or yes/no. One way to turn this
into a one-zero variable would be via the /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D8/D3/CN/CS/D9/D1/D1/CX/CT/D7 function on
the matrix side. This works partly because of our luck that y > nandT > Fin
English,so yandTwillmaptooneand nandFwillmaptozero.Butsaythatour
surveyused afﬁrmative andnegative,sothemappingwouldbebackwardfromour
intuition. Then we can put a /CP/D7/CTstatement in with the other column deﬁnitions
to produceacolumnthatisonewhen /CQ/CX/D2/CP/D6/DD/D5 is afﬁrmativeandzerootherwise:
selectid,
casebinaryqwhen"afﬁrmative" then1else0end,
other_vars
fromdatatable;
gsl_stats March24,2009
DATABASES 111
1#include <apop.h>
2
3intmain(){
4 apop_db_open("data −census.db");
5gsl_vector *n= apop_query_to_vector("select in_per_capita from inco me "
6 "where state= (select state fromgeography where name =’No rthDakota’)");
7gsl_vector *s= apop_query_to_vector("select in_per_capita from inco me "
8 "where state= (select state fromgeography where name =’So uthDakota’)");
9apop_data *t =apop_t_test(n,s);
10 apop_data_show(t); //show the whole output set...
11 printf("\nconﬁdence: %g\n",apop_data_get_ti(t,"con f.*2tail",−1));//...or justone value.
12 }
Listing3.6 Are North Dakota incomes different from South Da kota incomes? Online source:/D8/D8/CT/D7/D8/BA.
To take this to the extreme, we can turn a variable that is disc rete but not or-
dered (such as district numbers in the following example)in to a series of dummy
variables. It requires writing down a separate /CP/D7/CTstatement for each value the
variablecouldtake,butthat’swhat /CU/D3/D6loopsarefor.[Again,thisisdemonstration
code. Use /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D8/D3/CN/CS/D9/D1/D1/CX/CT/D7 to do this in practice.] Listing 3.7 creates a
seriesofdummyvariablesusingthis technique.
• Onlines 5–6,the /CQ/D9/CX/D0/CS/CN/CP/CN/D5/D9/CT/D6/DD function queriesoutthelist ofdistricts.
• Then the query writes a selectstatementwith a line /CP/D7/CT /CB/D8/CP/D8/CT /DB/CW/CT/D2 /D7/D8/CP/D8/CT/CN/B9/D2/CP/D1/CT /D8/CW/CT/D2 /BD /CT/D0/D7/CT /BCfor every /D7/D8/CP/D8/CT/CN/D2/CP/D1/CT .
• Line 11 uses the obfuscatory if (page 211) to print a comma be tween items, but
notatthe endofthe /D7/CT/D0/CT/D8clause.
• Line18pullsthedatafromthismassivequery,andline19ru nsanOLSregression
onthe returneddata.
• You can set /CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/DA/CT/D6/CQ/D3/D7/CT/BP/BD at the head of /D1/CP/CX/D2to have the function dis-
playthefull queryasitexecutes.
• Lines 20–21 show the parameter estimates, but suppress the gigantic variance–
covariancematrix.
Note well that the /CU/D3/D6loop starting on line eight goes from /CX/BP/BD, not /CX/BP/BC. When
includingdummyvariables,youalwayshavetoexcludeoneba selinevaluetopre-
ventXfrom being singular; excluding /CX/BP/BCmeans Alabama will be the baseline.
Q: Rewrite the /CU/D3/D6loop to use anotherstate as a baseline. Or, set the /CU/D3/D6loop to
run the full range from zero to the end of the array, and watch d isaster befall the
analysis.
gsl_stats March24,2009
112 CHAPTER 3
1#include <apop.h>
2
3char*build_a_query(){
4char*q=NULL;
5apop_data *state =apop_query_to_text("select Name as state,State as id\
6 from geography where sumlevel+0.0= 40");
7 asprintf(&q, "select in_per_capita as income,");
8for(inti=1; i< state−>textsize[0];i++)
9 asprintf(&q,"%s (case state when’%s’ then1else 0end) ’%s ’%c \n",
10 q,state −>text[i][1],state−>text[i][0],
11 (i< state −>textsize[0]−1) ? ’,’:’’);
12 asprintf(&q,"%sfrom income\n",q);
13 returnq;
14 }
15
16intmain(){
17 apop_db_open("data −census.db");
18 apop_data *d= apop_query_to_data(build_a_query());
19 apop_model *e = apop_estimate(d, apop_ols);
20 e−>covariance = NULL; //don’tshow it.
21 apop_model_show(e);
22 }
Listing3.7 A sample of a /CU/D3/D6loop that creates SQL that creates dummy variables. Online s ource:/D7/D8/CP/D8/CT/CS/D9/D1/D1/CX/CT/D7/BA .
®There is no standard for /CU/D3/D6loops, assigning variables, or matrix-
stylemanipulationwithinSQL,soyouneedtodothesethings onthe
C-sideofyouranalysis.
®Functions exist to transfer data between databases and matr ices, so
youcanincorporatedatabase-sidequeriesdirectly into C c ode.
gsl_stats March24,2009
4
MATRICES AND MODELS
My freedom thus consists in moving about within the narrow fr ame that I have as-
signed myself for each one of my undertakings.... Whatever d iminishes constraint
diminishes strength. Themore constraints one imposes, the more one freesone’s self
of the chains thatshackle the spirit.
—Stravinsky(1942, p65)
RecallthattheClanguageprovidesonlythemostbasicofbas ics,suchasaddition
and division, and everything else is provided by a library. S o before you can do
data-orientedmathematics,youwill needalibrary to handl ematricesandvectors.
There are many available; this book uses the GNU Scientiﬁc Li brary (GSL). The
GSL is recommended because it is actively supported and will work on about as
manyplatformsasCitself.Beyondfunctionsusefulforstat istics,italsoincludesa
fewhundredfunctionsusefulinengineeringandphysics,wh ichthisbookwillnot
mention. The full reference documentation is readily avail able online or in book
form(Gough,2003).Also,thisbookco-evolvedwiththeApop henialibrary,which
buildsupontheGSLfor morestatistics-orientedwork.
This chapter goes overthe basics of dealing with the GSL’s ma trices and vectors.
Althoughinsistingthatmatricesandvectorstakeonaspeci ﬁc,rigidform canbea
constraint,itistheconstraintthatmakesproductivework possible.Thepredictable
form of the various structures makes it is easy to write funct ions that allocate and
ﬁllthem, multiply andinvertthem,andconvertbetweenthem .
gsl_stats March24,2009
114 CHAPTER 4
4.1 T HEGSL’S MATRICES AND VECTORS Quick—what’s14times 17?
Thanks to calculators, we are
allabitrusty onourmultiplication,soListing4.1produce samultiplication table.
1#include <apop.h>
2
3intmain(){
4gsl_matrix *m= gsl_matrix_alloc(20,15);
5 gsl_matrix_set_all(m,1);
6for(inti=0; i< m−>size1; i++){
7 Apop_matrix_row(m, i, one_row);
8 gsl_vector_scale(one_row, i+1);
9 }
10 for(inti=0; i< m−>size2; i++){
11 Apop_matrix_col(m, i, one_col);
12 gsl_vector_scale(one_col, i+1);
13 }
14 apop_matrix_show(m);
15 gsl_matrix_free(m);
16 }
Listing4.1 Allocate a matrix, then multiply each row and eac h column by a different value to
produce a multiplicationtable. Online source: /D1/D9/D0/D8/CX/D4/D0/CX/CP/D8/CX/D3/D2/D8/CP/CQ/D0/CT/BA .
• The matrix is allocated in the introductory section, on lin e four. It is no surprise
that it has /CP/D0/D0/D3in the name, giving indication that memory is being allocate d
for the matrix. In this case, the matrix has 20 rows and 15 colu mns. Row always
comesﬁrst, then Column,justlike the orderin RomanCatholi c,RandyChoirboy,
orRCCola.
• Lineﬁveis theﬁrstmatrix-leveloperation:seteveryelem entin the matrix to one.
• The rest of the ﬁle works one row or column at a time. The ﬁrst l oop, from lines
six to nine, begins with the /BT/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D6/D3/DB macro to pull a single row, which
itputsinto a vectornamed /D3/D2/CT/CN/D6/D3/DB.
• Given the vector /D3/D2/CT/CN/D6/D3/DB, line eight multiplies every element by /CX/B7/BD. When this
happensagainbycolumnson line12,we haveamultiplication table.
• Line14displaysthe constructedmatrix to thescreen.
• Line 15 frees the matrix.1The system automatically frees all matrices at the end
of the program. Some consider it good style to free matrices a nd other allocated
memoryanyway;othersconsiderfreeing atthe endof /D1/CP/CX/D2to beawasteoftime.
1Dueto magic discussed below, vectors allocated by /BT/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D6/D3/DB and /CN/D3/D0do notreally exist and do
notneed to be freed.
gsl_stats March24,2009
MATRICES AND MODELS 115
Naming conventions EveryfunctionintheGSLlibrary willbeginwith /CV/D7/D0/CN,and
the ﬁrstargumentofall of thesefunctionswill bethe object
to be acted upon. Most GSL functions that affect a matrix will begin with /CV/D7/D0/CN/B9/D1/CP/D8/D6/CX/DC/CN and most that operate on vectors begin with /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN . The other
libraries used in this book stick to such a standard as well: 1 00% of Apophenia’s
functions begin with /CP/D4/D3/D4/CNand a great majority of them begin with a data type
such as /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN or /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0/CN , and GLib’s functions all begin with /CV/CN/B9/D3/CQ/CY/CT/D8: /CV/CN/D8/D6/CT/CT/CN, /CV/CN/D0/CX/D7/D8/CN,etcetera.2
ThiscustomisimportantbecauseCisageneral-purposelang uage,andthedesign-
ers of any one library have no idea what other libraries autho rs may be calling in
the same program. If two libraries both havea function named /CS/CP/D8/CP/CN/CP/D0/D0/D3 , then
onewill break.
C’s library-loaded matrix and vector operations are clearl y more verbose and re-
dundantthancomparableoperationsinlanguagesthatarepu rpose-builtformatrix
manipulation. But C’s syntax does provide a few advantages— notably that it is
verbose and redundant. As per the discussion of debugging st rategy on page 46,
spacingouttheoperationscanmakedebuggingnumericalalg orithmslesspainful.
When there is a type name in the function name, there is one mor e clue in the
functioncallitselfwhetheryouareusingthe functioncorr ectly.
The authors of the Mathematica package chose not to use abbre viations; here is
theiranswerto thequestionofwhy,whichapplieshereaswel l:
Theanswer...isconsistency.Thereisageneralconvention ...thatall
functionnamesarespelledoutasfullEnglishwords,unless thereis a
standard mathematical abbreviation for them. The great adv antageof
this scheme is that it is predictable . Once you know what a function
does,youwillusuallybeabletoguessexactlywhatitsnamei s.Ifthe
names were abbreviated, you would always have to remember wh ich
shortening of the standard English words was used. (Wolfram , 2003,
p 35)
The naming convention also makes indices very helpful. For e xample, the index
of the GSL’s online reference gives a complete list of functi ons that operate on
vectors alphabetized under /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/BA/BA/BA , and the index of this book gives a
partiallist ofthemostusefulfunctions.
2There is one awkward detail to the naming scheme: some functi ons in the Apophenia library act on /CV/D7/D0/CN/B9/D1/CP/D8/D6/CX/DCes and /CV/D7/D0/CN/DA/CT/D8/D3/D6 s. Thosehave names beginning with /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC and /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6 , compromis-
ing between the library nameand the nameof the main input.
gsl_stats March24,2009
116 CHAPTER 4
Q4.1Don’t delay—have a look at the /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/BA/BA/BA and /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/BA/BA/BA
sections of the index to this book or the GSL’s online referen ce and skim
overthe sort ofoperationsyoucando. TheApopheniapackage hasa num-
ber of higher-level operations that are also worth getting t o know, so have
a look atthe /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/BA/BA/BA , /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/BA/BA/BA , and /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/BA/BA/BA
sectionsaswell.
If you ﬁnd the naming scheme to be too verbose, you can write yo ur own wrap-
per functions that require less typing. For example, you cou ld write a ﬁle /D1/DD/CN/B9/D3/D2/DA/CT/D2/CX/CT/D2/CT/CN/CU/D2/D7/BA ,whichcouldinclude:
voidmset(gsl_matrix *m,introw,intcol,doubledata){
gsl_matrix_set(m,row,col, data);
}
voidvset(gsl_vector *v,introw,doubledata){
gsl_vector_set(v,row, data);
}
Youwouldalsoneeda headerﬁle, /D1/DD/CN/D3/D2/DA/CT/D2/CX/CT/D2/CT/CN/CU/D2/D7/BA/CW :
#include <gsl/gsl_matrix .h>
#include <gsl/gsl_vector .h>
voidmset(gsl_matrix *m,introw,intcol,doubledata);
voidvset(gsl_vector *v,introw,doubledata);
#deﬁneVECTOR_ALLOC(vname,length) gsl_vector *vname =gsl_vector_alloc(length);
//For simple functions, you canrename them via#deﬁne; see p age 212:
#deﬁnevget(v,row)gsl_vector_get(v, row)
#deﬁnemget(m,row, col)gsl_matrix_get(m,row, col)
After throwing an /AZ/CX/D2/D0/D9/CS/CT Ꜽ/D1/DD/CN/D3/D2/DA/CT/D2/CX/CT/D2/CT/CN/CU/D2/D7/BA/CWꜼ at the top of your pro-
gram, you will be able to use your abbreviatedsyntax such as /DA/CV/CT/D8/B4/DA/B8/BF/B5 . It’s up
to your æsthetic as to whether your code will be more or less le gible after you
make these changes. But the option is always there: if you ﬁnd a function’s name
or form annoying, just write a more pleasant wrapper functio n for your personal
library thathidesthe annoyingparts.
BASIC MATRIX AND VECTOR OPERATIONS The simplest operations on matrices
and vectors are element-by-element
operations such as adding the elements of one matrix to those of another. The
GSLprovidesthefunctionsyouwouldexpecttodosuchthings .Eachmodiﬁesits
ﬁrstargument.
gsl_stats March24,2009
MATRICES AND MODELS 117
gsl_matrix_add (a,b); // aij←aij+bij,∀i, j
gsl_matrix_sub (a,b); // aij←aij−bij,∀i, j
gsl_matrix_mul_elements (a,b); // aij←aij·bij,∀i, j
gsl_matrix_div_elements (a,b); // aij←aij/bij,∀i, j
gsl_matrix_scale (a,x); // aij←aij·x,∀i, j∈N,x∈R
gsl_matrix_add_constant (a,x); // aij←aij+x,∀i, j∈N,x∈R
gsl_vector_add (a,b); // ai←ai+bi,∀i
gsl_vector_sub (a,b); // ai←ai−bij,∀i
gsl_vector_mul (a,b); // ai←ai·bi,∀i
gsl_vector_div (a,b); // ai←ai/bi,∀i
gsl_vector_scale (a,x); // ai←ai·x,∀i∈N,x∈R
gsl_vector_add_constant (a,x); // ai←ai+x,∀i∈N,x∈R
apop_vector_log(a); // ai←ln(ai),∀i
apop_vector_log10(a); // ai←log10(ai),∀i
apop_vector_exp(a); // ai←eai,∀i
The functions to multiply and divide matrix elements are giv en slightly lengthier
namestominimizethepotentialthattheywillbeconfusedwi ththeprocessofmul-
tiplyingamatrixwithanothermatrix, AB,oritsinverse, AB−1.Thoseoperations
requirefunctionswith more computationalﬁrepower,intro ducedbelow.
Q4.2Rewrite the structured birthday paradox program from page 3 5 using a/CV/D7/D0/CN/D1/CP/D8/D6/CX/DC insteadofthe /D7/D8/D6/D9/D8thatitcurrently uses.
• /CP/D0/D0/D3or /CP/D0/D0/D3the matrix in /D1/CP/CX/D2;passit to bothfunctions.
• Replacethe /AZ/CX/D2/D0/D9/CS/CT directivesto callin /CP/D4/D3/D4/BA/CW.
• Replace everything after the title-printing line in /D4/D6/CX/D2/D8/CN/CS/CP/DD/D7 with/CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D7/CW/D3/DB/B4 /CS/CP/D8/CP/CN/D1/CP/D8/D6/CX/DC /B5.
• Put three /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/D7/CT/D8 commands in the /CU/D3/D6loop of/CP/D0/D9/D0/CP/D8/CT/CN/CS/CP/DD/D7 to set the number of people, likelihood of match-
ing the ﬁrst, and likelihood of any match (as opposed to one mi nus
thatlikelihood,asin /CQ/CS/CP/DD/CU/D2/D7/BA ).
Apply and map Beyond the simple operations above, you will no doubt want to
transformyourdatainmorecreativeways.Forexample,thef unc-
tion in Listing 4.2will takein a /CS/D3/D9/CQ/D0/CTindicating taxableincomeandwill return
US income taxes owed, assuming a head of household with two de pendents tak-
ingthestandarddeduction(asof2006;seeInternalRevenue Service(2007)).This
functioncanbeappliedto a vectorofincomestoproducea vec toroftaxesowed.
gsl_stats March24,2009
118 CHAPTER 4
1#include <apop.h>
2
3doublecalc_taxes( doubleincome){
4doublecutoffs[]= {0,11200, 42650, 110100, 178350, 349700, INFIN ITY};
5doublerates[]= {0, 0.10, .15, .25,.28, .33, .35};
6doubletax= 0;
7intbracket = 1;
8 income−= 7850;//Head of household standard deduction
9 income−= 3400*3;//exemption: self plus twodependents.
10 while(income > 0){
11 tax+= rates[bracket] *GSL_MIN(income, cutoffs[bracket] −cutoffs[bracket−1]);
12 income −=cutoffs[bracket];
13 bracket ++;
14 }
15 returntax;
16 }
17
18intmain(){
19 apop_db_open("data −census.db");
20 strncpy(apop_opts.db_name_column,"geo_name", 100);
21 apop_data *d= apop_query_to_data("select geo_name,Household_medi an_in as income\
22 from income where sumlevel = ’040’\
23 order by household_median_in desc");
24 Apop_col_t(d,"income",income_vector);
25 d−>vector = apop_vector_map(income_vector,calc_taxes);
26 apop_name_add(d −>names, "taxowed",’v’);
27 apop_data_show(d);
28 }
Listing4.2 Read in the median income for each US state and ﬁnd the taxes a family at the median
would owe. Online source: /D8/CP/DC/CT/D7/BA.
• Lines 24–27 of Listing 4.2 demonstrate the use of the /CP/D4/D3/D4/CN/CS/CP/D8/CP structure, and
willbeexplainedindetailbelow.Fornow,itsufﬁcestoknow thatline24produces
a /CV/D7/D0/CN/DA/CT/D8/D3/D6 named /CX/D2/D3/D1/CT/CN/DA/CT/D8/D3/D6 ,holdingthemedianhouseholdincomefor
eachstate.
• The bulk of the program is the speciﬁcation of the tax rates i n the /CP/D0/CN/D8/CP/DC/CT/D7
function.In theexerciseon page192,youwill plotthis func tion.
• The program does not bother to ﬁnd out the length of the array s declared in lines
four and ﬁve. The /D9/D8/D3/CU/CU/D7 array has a ﬁnal value that guarantees that the /DB/CW/CX/D0/CT
loop on lines 10–14 will exit at some point. Similarly, you ca n always add a ﬁnal
value like /C6/CD/C4/C4or /C6/BT/C63to the end of a list and rewrite your /CU/D3/D6loop’s header to/CU/D3/D6 /B4/CX/D2/D8 /CX/BP/BC/BN /CS/CP/D8/CP/CJ/CX℄ /AX/BP /C6/BT/C6/BN /CX/B7/B7/B5.Thismeansyouhavetorememberto
put the sentinel value at the end of the list, but do not need to remember to ﬁx a
countereverytime youﬁx thearray.
3/C6/BT/C6is read as not-a-number, and will beintroduced introduced o n page 135.
gsl_stats March24,2009
MATRICES AND MODELS 119
Threading
Even low-end laptops ship with processors that are
capable of simultaneously operating on two or more
stacks of frames, so the /D1/CP/D4and /CP/D4/D4/D0/DDfunctions
can split their work among multiple processors. Set/CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/D8/CW/D6/CT/CP/CS/CN/D3/D9/D2/D8 to the desired number of
threads (probably the number of processor coresin
your system), and these functions apportion work to
processors appropriately.
When threading, be careful writing to global vari-
ables: if a thousand threads could be modifying a
global variable in any order, the outcome is likely un-
deﬁned. When writing functions for threading, your
best bet is to take all variables that were not passed
inexplicitlyas read-only.Youcouldwrite a /CU/D3/D6loopto apply
the /CP/D0/CN/D8/CP/DC function to each ele-
ment of the income vector in turn.
Butthe /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D1/CP/D4 function
will do this for you. Let c()be
the /CP/D0/CN/D8/CP/DC/CT/D7 function, and ibe
the /CX/D2/D3/D1/CT/CN/DA/CT/D8/D3/D6 ; then the call
to /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D1/CP/D4 on line 25 re-
turnsc(i), which is then assignedto
the vector element of the data set,/CS/B9/BQ/DA/CT/D8/D3/D6 . Line 27 displays the
output.
But /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D1/CP/D4 is just the
beginning: Apophenia provides a
smallfamily offunctionsto map andapplya functionto a data set. Thefull index
offunctionsis relegatedto themanualpages,buthere isa li st ofexamplesto give
youanidea.
• You saw that /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D1/CP/D4/B4/CX/D2/D3/D1/CT/CN/DA/CT/D8/D3/D6/B8 /CP/D0/CN/D8/CP/DC/CT/D7/B5 will take in
a /CV/D7/D0/CN/DA/CT/D8/D3/D6 and returns another vector. Or, /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/CP/D4/D4/D0/DD/B4/CX/D2/D3/D1/CT/CN/B9/DA/CT/D8/D3/D6/B8 /CP/D0/CN/D8/CP/DC/CT/D7/B5 would replace every element of /CX/D2/D3/D1/CT/CN/DA/CT/D8/D3/D6 with/CP/D0/CN/D8/CP/DC/CT/D7/B4 /CT/D0/CT/D1/CT/D2/D8 /B5.
• One often sees functions with a header like /CS/D3/D9/CQ/D0/CT /D0/D3/CV/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS/B4/CV/D7/D0/CN/B9/DA/CT/D8/D3/D6 /CX/D2/CS/CP/D8/CP/B5,whichtakesinadatavectorandreturnsaloglikelihood.Th enif
everyrowof /CS/CP/D8/CP/D7/CT/D8 isavectorrepresentingaseparateobservation,then /CP/D4/D3/D4/CN/B9/D1/CP/D8/D6/CX/DC/CN/D1/CP/D4/B4 /CS/CP/D8/CP/D7/CT/D8 /B8 /D0/D3/CV/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS/B5 wouldreturnthevectorofloglikeli-
hoodsofeachobservation.
• Functionswith /BA/BA/BA/CN/D1/CP/D4/CN/BA/BA/BA/CN/D7/D9/D1 , like /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D1/CP/D4/CN/CP/D0/D0/CN/D7/D9/D1 ,will return
the sum of f(item)for every item in the matrix or vector. For example, /CP/D4/D3/D4/CN/B9/D1/CP/D8/D6/CX/DC/CN/D1/CP/D4/CN/CP/D0/D0/CN/D7/D9/D1/B4 /D1 /B8 /CV/D7/D0/CN/CX/D7/D2/CP/D2/B5 will return the total numberof elements
of /D1that are /C6/BT/C6. Continuing the log likelihood example from above, /CP/D4/D3/D4/CN/B9/D1/CP/D8/D6/CX/DC/CN/D1/CP/D4/CN/D7/D9/D1/B4 /CS/CP/D8/CP/D7/CT/D8 /B8 /D0/D3/CV/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS/B5 would be the total log likeli-
hoodofallrows.
• Another example from the family appeared earlier: Listing 3.4 (page 100) used/CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/CP/D4/D4/D0/DD to generate a vector of GDP per capita from a matrix with
GDPandpopulation.
®You can express matrices and vectors via /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC and /CV/D7/D0/CN/B9/DA/CT/D8/D3/D6structures.
®Refer to elements using /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/D7/CT/D8 and /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/CV/CT/D8
(andsimilarly for /CP/D4/D3/D4/CN/CS/CP/D8/CP setsand /CV/D7/D0/CN/DA/CT/D8/D3/D6/D7 ). ≫
gsl_stats March24,2009
120 CHAPTER 4
“v” “c0” “c1” “c2” “t0” “t1” “t2”
“r0” (0,−1) (0, 0) (0, 1) (0,2) (0, 0) (0, 1) (0, 2)
“r1” (1,−1) (1, 0) (1, 1) (1,2) (1, 0) (1, 1) (1, 2)
“r2” (2,−1) (2, 0) (2, 1) (2,2) (2, 0) (2, 2) (2, 2)
Figure 4.3 The vector is column −1 of the matrix, while the text gets its own numbering system.
Row names are sharedby allthree elements.
≫
®Once your data set is in these forms, you can operate on the mat rix
or vector as a whole using functions like /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/CP/CS/CS/B4/CP/B8/CQ/B5 or/CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/D7/CP/D0/CT/B4/CP/B8/DC/B5 .
®Use the /CP/D4/D3/D4/CN( /D1/CP/D8/D6/CX/DC| /DA/CT/D8/D3/D6) /CN( /D1/CP/D4| /CP/D4/D4/D0/DD) family of functions to
sendeveryrow ofavector/matrixto a functionin turn.
4.2 /CP/D4/D3/D4/CN/CS/CP/D8/CP The /CP/D4/D3/D4/CN/CS/CP/D8/CP structure is the joining-together of four data
types: the /CV/D7/D0/CN/DA/CT/D8/D3/D6 , /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC , a table of strings, and an/CP/D4/D3/D4/CN/D2/CP/D1/CT structure.
The conceptual layout is given in Figure 4.3. The vector, col umns of the matrix,
andcolumnsoftextare all named.Also,all rows are named,bu t there is only one
set of row names, becausethe presumption is that each row of t he structure holds
information aboutasingleobservation.
• Think of the vector as the −1stelement of the matrix, and the text elements as
havingtheir ownaddresses.
• There are various means of creating an /CP/D4/D3/D4/CN/CS/CP/D8/CP set, including /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/B9/D8/D3/CN/CS/CP/D8/CP, /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D8/D3/CN/CS/CP/D8/CP , /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D8/D3/CN/CS/CP/D8/CP , or creating a blank
slatewith /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/CP/D0/D0/D3 ;seebelow.
• For example, Listing 4.2 used /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/D8/D3/CN/CS/CP/D8/CP to read the table into an/CP/D4/D3/D4/CN/CS/CP/D8/CP set, and by setting the /CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/CS/CQ/CN/D2/CP/D1/CT/CN/D3/D0/D9/D1/D2 option to a col-
umnnameonline20,thequerysetrownamesforthedata.Line2 5setsthe /DA/CT/D8/D3/D6
elementofthedataset,andline26addsanelementtothe /DA/CT/D8/D3/D6slotofthe /D2/CP/D1/CT/D7
elementoftheset.
• You can easily operate on the subelements of the structure. If your /D1/CP/D8/D6/CX/DC/CN/D1/CP/D2/B9/CX/D4/D9/D0/CP/D8/CT functionrequiresa /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC ,but /DD/D3/D9/D6/CN/CS/CP/D8/CP isan /CP/D4/D3/D4/CN/CS/CP/D8/CP struc-
ture, then you can call /D1/CP/D8/D6/CX/DC/CN/D1/CP/D2/CX/D4/D9/D0/CP/D8/CT /B4 /DD/D3/D9/D6/CN/CS/CP/D8/CP /B9> /D1/CP/D8/D6/CX/DC/B5. Similarly,
gsl_stats March24,2009
MATRICES AND MODELS 121
you can manipulate the names and the table of text data direct ly. The size of the
textdatais storedin the /D8/CT/DC/D8/D7/CX/DE/CT element.Sampleusage:
apop_data *set= apop_query_to_text(...);
for(intr=0; r< set−>textsize[0];r++){
for(intc=0; c< set−>textsize[1];c++)
printf("%s\t",set−>text[r][c]);
printf("\n");
}
• There is no consistency-checking to make sure the number of row names, the/DA/CT/D8/D3/D6/B9/BQ/D7/CX/DE/CT ,or /D1/CP/D8/D6/CX/DC/B9/BQ/D7/CX/DE/CT/BD areequal.Ifyouwanttoputavectorofﬁfteen
elements and a 10×10matrix in the same structure, and name only the ﬁrst two
columns,you are free to do so. In fact, the typicalcaseis tha t not all elementsare
assignedvaluesatall. If /DA/CT/D8/D3/D6/CN/D7/CX/DE/CT is zero,then
apop_data *newdata_m = apop_data_alloc(vector_size, n_rows,n_cols );
will initialize mostelementsof /D2/CT/DB/CS/CP/D8/CP to /C6/CD/C4/C4,butproducea /D2/CN/D6/D3/DB/D7× /D2/CN/D3/D0/D7
matrix with an empty set of names. Alternatively, if /D2/CN/D6/D3/DB/D7 /BP/BP /BCbut /DA/CT/D8/D3/D6/CN/B9/D7/CX/DE/CTispositive,thenthevectorelementisinitialized andthe m atrix setto /C6/CD/C4/C4.4
Get, set, and point You can use any of the GSL tools above to dissect the /CV/D7/D0/CN/B9/D1/CP/D8/D6/CX/DCelementofthe /CP/D4/D3/D4/CN/CS/CP/D8/CP struct,andsimilarlyforthe/DA/CT/D8/D3/D6element. In addition, there is a suite of functions for setti ng and getting
an element from an /CP/D4/D3/D4/CN/CS/CP/D8/CP set using the names. Let tbe a title and ibe a
numeric index; then you may refer to the row–column coordina te using the (i,i),
(t,i),(i,t), or(t,t)form:
apop_data_get(your_data,i,j);
apop_data_get_ti(your_data,"rowname",j);
apop_data_get_it(your_data,i,"colname");
apop_data_get_tt(your_data,"rowname","colname");
apop_data_set(your_data, i,j,new_value);
apop_data_set_ti(your_data, "rowname",j,new_value);
...
apop_data_ptr(your_data, i,j);
apop_data_ptr_ti(your_data, "rowname",j);
...
4Seasoned C programmers will recognize such usage as similar to a /D9/D2/CX/D3/D2between a /CV/D7/D0/CN/DA/CT/D8/D3/D6 , a /CV/D7/D0/CN/B9/D1/CP/D8/D6/CX/DC, and a /CW/CP/D6array, though the /CP/D4/D3/D4/CN/CS/CP/D8/CP set can hold both simultaneously. C++programmers will
observe that the structure allows a form of polymorphism, be cause you can write one function that takes an/CP/D4/D3/D4/CN/CS/CP/D8/CP asinput, butoperates ononeorboth ofa /CV/D7/D0/CN/DA/CT/D8/D3/D6 ora /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC , depending onwhich isnot/C6/CD/C4/C4in the input.
gsl_stats March24,2009
122 CHAPTER 4
• The /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D4/D8/D6/BA/BA/BA form returns a pointer to the given data point, which
youmayreadfrom,write to,increment,etcetera.Itmimicst he /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/D4/D8/D6
and /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/D4/D8/D6 functions,whichdothesamethingfortheirrespectivedata
structures.
• Asabove,youcanthinkaboutthevectorasthe −1stelementofthematrix, sofor
example, /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D7/CT/D8/CN/D8/CX/B4/DD/D3/D9/D6/CN/CS/CP/D8/CP/B8 Ꜽ/D6/D3/DB/D2/CP/D1/CTꜼ/B8 /B9/BD/B5will operates on
the /CP/D4/D3/D4/CN/CS/CP/D8/CP structure’svectorratherthanthematrix.Thisfacilitate sformslike/CU/D3/D6 /B4/CX/D2/D8 /CX/BP/B9/BD/BN /CX/BO /CS/CP/D8/CP/B9/BQ/D1/CP/D8/D6/CX/DC/B9/BQ/D7/CX/DE/CT/BE/BN /CX/B7/B7/B5, that runs across an entire
row,includingbothvectorandmatrix.
• These functions use case-insensitiveregular-expressio nmatching to ﬁnd the right
name, so you can even be imprecise in your column request. App endix B dis-
cusses regular expressions in greater detail; for now it suf ﬁces to know that you
can be approximate about the name: Ꜽ/D4/BA/DA/CP/D0/BA/B6Ꜽ will match /C8 /DA/CP/D0/D9/CT, /D4/B9/DA/CP/D0and/D4/BA/DA/CP/D0/D9/CT/D7 .
Foranexample,ﬂipbackto /D8/D8/CT/D7/D8/BA,listedonpage111.Linetenshowedthefull
output of the ttest, which was a list of named elements, meaning that the out put
usedtheset’s rownamesand /DA/CT/D8/D3/D6elements.Line elevenpulled a singlenamed
elementfrom thevector./F4Forming partitioned matrices You can copy the entire data set, stack two data
matrices one on top of the other (stack rows),
stack two data matrices one to the right of the other (stack co lumns), or stack
two datavectors:
apop_data *newcopy = apop_data_copy(oldset);
apop_data *newcopy_tall = apop_data_stack(oldset_one,oldset_two, ’r’);
apop_data *newcopy_wide = apop_data_stack(oldset_one, oldset_two, ’c’);
apop_data *newcopy_vector = apop_data_stack(oldset_one,oldset_tw o, ’v’);
Again,you are generallybetter off doing data manipulation in the database.If the
tables are in the database instead of /CP/D4/D3/D4/CN/CS/CP/D8/CP sets the vertical and horizontal
stackingcommandsaboveareequivalentto
select*fromoldset_one
union
select*fromoldset_two
/*and*/
selectt1.*, t2.*
fromoldset_one t1,oldset_two t2
gsl_stats March24,2009
MATRICES AND MODELS 123
Q4.3Theoutputoftheexerciseonpage105isatablewithtattoos, piercings,and
political afﬁliation. Run a Probit regression to determine whether political
afﬁliationaffectsthe countofpiercings.
• The function /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D8/D3/CN/CS/D9/D1/D1/CX/CT/D7 will produce a new data ma-
trix with acolumnforall butthe ﬁrstcategory.
• Stackthatmatrix to theright ofthe originaltable.
• Send the augmented table to the /CP/D4/D3/D4/CN/D4/D6/D3/CQ/CX/D8/BA/CT/D7/D8/CX/D1/CP/D8/CT function.
Theoutputforthecategoricalvariablesindicatestheeffe ctrelativeto
theomitted category.
• Encapsulate the routine in a function: using the code you ju st wrote,
put together a function that takes in data and a text column na me or
numberandreturnsanaugmenteddatasetwith dummyvariable s.
®The /CP/D4/D3/D4/CN/CS/CP/D8/CP structure combines a vector, matrix, text array, and
namesfor alloftheseelements.
®Youcanpullnameditems from adataset(suchasanestimation out-
put)using /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/CV/CT/D8/CN/D8/CX andfamily.
4.3 SHUNTING DATA Igor Stravinsky, who advocated constraints at the head
ofthischapter,alsopointsoutthat“Rigiditythatslightl y
yields,likeJusticeswayedbymercy,isallthe beautyofear th.”5Noneoffunction
to this point would make any sense if they did not operate on a s peciﬁc structure
like the /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC or /CV/D7/D0/CN/DA/CT/D8/D3/D6 , but codingis much easierwhen there is the
ﬂexibility of easily switching among the various constrain ed forms. To that end,
this section presents suggestions for converting among the various data formats
used in this book. It is not an exciting read (to say the least) ; you may prefer to
takethis sectionasa referenceforuseasnecessary.
Table 4.4 provides the key to the method most appropriate for each given con-
version. From/to pairs marked with a dot are left as an exerci se for the reader;
none are particularly difﬁcult, but may require going throu gh another format; for
example, you can go from a /CS/D3/D9/CQ/D0/CT/CJ ℄to an /CP/D4/D3/D4/CN/CS/CP/D8/CP set via /CS/D3/D9/CQ/D0/CT/CJ ℄⇒/CV/D7/D0/CN/D1/CP/D8/D6/CX/DC⇒ /CP/D4/D3/D4/CN/CS/CP/D8/CP . As will be proven below, it is only two steps from
anyformat toanyother.
5Stravinsky (1942), p 54,citing GK Chesterton, “Thefurrows ,” inAlarms and discursions .
gsl_stats March24,2009
124 CHAPTER 4FromTo
TextﬁleDb table /CS/D3/D9/CQ/D0/CT/CJ
℄/CV/D7/D0/CN/DA/CT/D8/D3/D6 /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC /CP/D4/D3/D4/CN/CS/CP/D8/CP
Textﬁle C F · · · F
Dbtable·Q·Q Q Q/CS/D3/D9/CQ/D0/CT/CJ ℄· · C F F·/CV/D7/D0/CN/DA/CT/D8/D3/D6 P P F C F F/CV/D7/D0/CN/D1/CP/D8/D6/CX/DC P P F V C F/CP/D4/D3/D4/CN/CS/CP/D8/CP P P F S S C
Table4.4 A key tomethods of conversion./F4Copying structures Thecomputercanveryquicklycopyblockswithoutbother-
ing to comprehend what that data contains; the function to
dothisis /D1/CT/D1/D1/D3/DA/CT,whichisasafevariantof /D1/CT/D1/D4/DD.Forexample,borrowingthe/D3/D1/D4/D0/CT/DC structure from Chapter2:
complex ﬁrst= {.real = 3,.imaginary = −1};
complex second;
memmove(&second,&ﬁrst, sizeof(complex));
Thecomputerwillgotothelocationof /CU/CX/D6/D7/D8andblindlycopywhatitﬁndstothe
locationof /D7/CT/D3/D2/CS,uptothesizeofone /D3/D1/D4/D0/CT/DC struct.Since /CU/CX/D6/D7/D8and /D7/CT/D3/D2/CS
nowhaveidenticaldata,theirconstituentpartsareguaran teedtoalsobeidentical.6
But there is one small caveat: if one element of the /D7/D8/D6/D9/D8is a pointer, then it is
the pointer that is copied, not the data itself (which is else where in memory). For
example,the /CV/D7/D0/CN/DA/CT/D8/D3/D6 includesa /CS/CP/D8/CPpointer,sousing /D1/CT/D1/D1/D3/DA/CT wouldresult
intwoidenticalstructsthatbothpointtothesamedata.Ify ouwantthis,useaview,
as per Method V below; if you want a copy, then you need to /D1/CT/D1/D1/D3/DA/CT both the
base /CV/D7/D0/CN/DA/CT/D8/D3/D6 andthe /CS/CP/D8/CParray.Thissetsthestagefortheseriesoffunctions
below with /D1/CT/D1/D4/DDin the name that are modeled on C’s basic /D1/CT/D1/D1/D3/DA/CT/ /D1/CT/D1/D4/DD
functionsbuthandleinternalpointerscorrectly.
Method C: Copying The /CV/D7/D0/CN/BA/BA/BA/CN/D1/CT/D1/D4/DD functions assume that the destination
to which you are copying has already been allocated; this al-
lows you to reuse the same space and otherwise carefully over see memory. The
6How to remember the order of arguments: computer scientists think in terms of data ﬂowing from left to
right:inC, /CS/CT/D7/D8 /BP /D7/D3/D9/D6/CT;inR, /CS/CT/D7/D8 /BO/B9 /D7/D3/D9/D6/CT;inpseudocode, /CS/CT/D7/D8← /D7/D3/D9/D6/CT.Similarly,mostcopying
functions havethe data ﬂow from end ofline to beginning: /D1/CT/D1/D1/D3/DA/CT/B4/CS/CT/D7/D8/B8 /D7/D3/D9/D6/CT/B5/BA
gsl_stats March24,2009
MATRICES AND MODELS 125/CP/D4/D3/D4/CN/BA/BA/BA/CN/D3/D4/DD functions allocate and copy in one step, so you can declare an d
copyon thesameline, andmoreeasilyembedacopyinto a ﬁlter ing operation.
//Textﬁle⇒Textﬁle
//Just use thesystem’s ﬁle copy command. The /CP/D4/D3/D4/CN/D7/DD/D7/D8/CT/D1 functionacts like
//the standard C /D7/DD/D7/D8/CT/D1command, butaccepts printf-style arguments:
apop_system("cp %s%s", from_ﬁle_name,to_ﬁle_name);
// /CV/D7/D0/CN/DA/CT/D8/D3/D6⇒ /CV/D7/D0/CN/DA/CT/D8/D3/D6
gsl_vector *copy = gsl_vector_alloc(original −>size);
gsl_vector_memcpy(copy, original);
gsl_vector *copy2 = apop_vector_copy(original);
// /CS/D3/D9/CQ/D0/CT/CJ ℄⇒ /CS/D3/D9/CQ/D0/CT/CJ ℄
//Let /D3/D6/CX/CV/CX/D2/CP/D0/CN/D7/CX/DE/CT be the lengthof the original array.7
double*copy1 = malloc( sizeof(double)*original_size);
memmove(copy1,original, sizeof(double)*original_size);
doublecopy2[original_size];
memmove(&copy2,original, sizeof(original));
// /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC⇒ /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC
gsl_matrix *copy = gsl_matrix_alloc(original −>size1, original−>size2);
gsl_matrix_memcpy(copy,original);
gsl_matrix *copy2 = apop_matrix_copy(original);
// /CP/D4/D3/D4/CN/CS/CP/D8/CP⇒ /CP/D4/D3/D4/CN/CS/CP/D8/CP
apop_data *copy1 =apop_data_alloc(original −>vector−>size,original−>matrix−>size1,
original−>matrix−>size2);
apop_data_memcpy(copy1,original);
apop_data *copy2 =apop_data_copy(original);
Method F: Function call These are functions designed to convert one format to
another.
Therearetwowaystoexpressamatrixof /CS/D3/D9/CQ/D0/CTs.Theanalogtousingapointeris
todeclarealistofpointers-to-pointers,andtheanalogto anautomaticallyallocated
arrayis to usedouble-subscripts:
double**method_one = malloc( sizeof(double*)*size_1);
for(inti=0; i< size_1; i++)
method_one[i]= malloc( sizeof(double)*size_2);
doublemethod_two[size_1][size_2] = {{2,3,4},{5,6,7}};
The ﬁrst method is rather inconvenient. The second method se ems convenient,
becauseit lets youallocatethe matrix atonce.Butdueto min utiæ thatwill not be
7The /D7/CX/DE/CT/D3/CU function is not just for types: you can also send an array or ot her element to/D7/CX/DE/CT/D3/CU. If /D3/D6/CX/CV/CX/D2/CP/D0 is an array of 100 /CS/D3/D9/CQ/D0/CTs, then /D7/CX/DE/CT/D3/CU/B4/D3/D6/CX/CV/CX/D2/CP/D0/B5/BP/BD/BC/BC/B6/D7 /CX/DE/CT/D3 /CU/B4/CS/D3 /D9/CQ/D0 /CT/B5 , while/D7/CX/DE/CT/D3/CU/B4/B6/D3/D6/CX/CV/CX/D2/CP/D0/B5/BP/D7/CX/DE/CT/D3/CU /B4/CS/D3/D9 /CQ/D0/CT/B5 , and so you could use /D7/CX/DE/CT/D3/CU/B4/D3/D6/CX/CV/CX/D2/CP/D0/B5 as the third argument for/D1/CT/D1/D1/D3/DA/CT.However, thisisincredibly errorprone,becausethisison eofthefewplaces inCwhereyoucouldsend
either an object or a pointer to an object to the same function without a warning or error. In cases with modest
complexity, thedifference between an array and its ﬁrstele ment can be easy to confuse and hard to debug.
gsl_stats March24,2009
126 CHAPTER 4
discussedhere (see Kernighan & Ritchie (1988, p 113)), that method is too much
ofahassleto beworth anything.
Instead,declare your data as a single line, listing the enti re ﬁrst row, then the sec-
ond, et cetera, with no intervening brackets. Then, use the /CP/D4/D3/D4/CN/D0/CX/D2/CT/BA/BA/BA func-
tionsto convertto amatrix. Foranotherexample,seepage9.
//text⇒db table
//Theﬁrst number states whether the ﬁle has row names; the se cond
//whether ithas columnnames. Finally,if nocolnames are pr esent,
//youcan provide them inthe last argument as a /CW/CP/D6 /B6/B6
apop_text_to_db("original.txt","tablename",0, 1,NULL );
//text⇒ /CP/D4/D3/D4/CN/CS/CP/D8/CP
apop_data *copyd = apop_text_to_data("original.txt",0, 1);
// /CS/D3/D9/CQ/D0/CT/CJ ℄/CJ ℄⇒ /CV/D7/D0/CN/DA/CT/D8/D3/D6 , /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC
doubleoriginal[]= {{2,3,4},{5,6,7}};
gsl_vector *copv= apop_array_to_vector(original, original_size);
gsl_matrix *copm =apop_array_to_matrix(original,original_size1,o riginal_size2);
// /CS/D3/D9/CQ/D0/CT/CJ ℄⇒ /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC
doubleoriginal[]= {2,3,4,5,6,7};
intorig_vsize = 0, orig_size1 = 2,orig_size2 = 3;
gsl_matrix *copym = apop_line_to_matrix(original,orig_size1,orig_ size2);
// /CS/D3/D9/CQ/D0/CT/CJ ℄⇒ /CP/D4/D3/D4/CN/CS/CP/D8/CP
apop_data *copyd = apop_line_to_data(original,orig_vsize, orig_si ze1,orig_size2);
// /CV/D7/D0/CN/DA/CT/D8/D3/D6⇒ /CS/D3/D9/CQ/D0/CT/CJ ℄
double*copyd = apop_vector_to_array(original_vec);
// /CV/D7/D0/CN/DA/CT/D8/D3/D6⇒n×1 /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC
gsl_matrix *copym = apop_vector_to_matrix(original_vec);
// /CV/D7/D0/CN/DA/CT/D8/D3/D6 , /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC⇒ /CP/D4/D3/D4/CN/CS/CP/D8/CP
apop_data *copydv = apop_vector_to_data(original_vec);
apop_data *copydm =apop_matrix_to_data(original_matrix);
Method P: Printing Apophenia’s printing functions are actually four-in-one f unc-
tions: you can dump your data to either the screen, a ﬁle, a
database, or a system pipe [see Appendix B for an overview of p ipes]. Early in
putting together an analysis, you will want to print all of yo ur results to screen,
and then later, you will want to save temporary results to the database, and then
next month, a colleague will ask for a text ﬁle of the output; y ou can make all of
thesemajorchangesin outputbychangingonecharacterin yo urcode.
Thefourchoicesfor the /CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/D3/D9/D8/D4/D9/D8/CN/D8/DD/D4/CT variableare
apop_opts.output_type =’s’; //default: print toscreen.
apop_opts.output_type =’f’; //print toﬁle.
apop_opts.output_type =’d’; //store inadatabase table.
apop_opts.output_type =’p’; //writetothe pipe in /CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/D3/D9/D8/D4/D9/D8/CN/D4/CX/D4/CT .
gsl_stats March24,2009
MATRICES AND MODELS 127
• The screen output will generally be human-readable, meani ng different column
sizesandothernotes andconveniencesfor youatthe termina lto understandwhat
is going on. The ﬁle output will generally be oriented toward allowing a machine
to readtheoutput,meaningstricterformatting.
• The second argument to the output functions is a string. Out put to screen or pipe
ignores this; if outputting to ﬁle, this is the ﬁle name; if wr iting to the database,
thenthis will bethetable name.8
// /CV/D7/D0/CN/DA/CT/D8/D3/D6 , /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC , /CP/D4/D3/D4/CN/CS/CP/D8/CP⇒textﬁle
apop_opts.output_type = ’t’
apop_vector_print(original_vector,"text_ﬁle_copy");
apop_matrix_print(original_matrix,"text_ﬁle_copy");
apop_data_print(original_data,"text_ﬁle_copy");
// /CV/D7/D0/CN/DA/CT/D8/D3/D6 , /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC , /CP/D4/D3/D4/CN/CS/CP/D8/CP⇒dbtable
apop_opts.output_type = ’d’
apop_vector_print(original_vector,"db_copy");
apop_matrix_print(original_matrix,"db_copy");
apop_data_print(original_data,"db_copy");
Method Q: Querying Theonlywayto getdataoutofadatabaseis to queryitout.
//dbtable⇒dbtable
apop_query("create table copy as \
select*from original");
//dbtable⇒ /CS/D3/D9/CQ/D0/CT, /CV/D7/D0/CN/DA/CT/D8/D3/D6 , /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC , or /CP/D4/D3/D4/CN/CS/CP/D8/CP
doubled= apop_query_to_ﬂoat("select value fromoriginal");
gsl_vector *v= apop_query_to_vector("select *from original");
gsl_matrix *m = apop_query_to_matrix("select *from original");
apop_data *d= apop_query_to_data("select *from original");
Method S: Subelements Sometimes,evenafunctionisjustoverkill;youcanjust
pullasubelementfrom the maindataitem.
Notice,bytheway,thatthe /CS/CP/D8/CPsubelementofa /CV/D7/D0/CN/DA/CT/D8/D3/D6 cannotnecessarily
be copied directly to a /CS/D3/D9/CQ/D0/CT/CJ ℄—thestridemay be wrong; see Section 4.6 for
details.Instead,usethecopyingfunctionsfrom MethodFab ove.
// /CP/D4/D3/D4/CN/CS/CP/D8/CP⇒ /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC , /CV/D7/D0/CN/DA/CT/D8/D3/D6
my_data_set−> matrix
my_data_set−> vector
8File names tend to have periods in them, but periods in table n ames produce difﬁculties. When printing to a
database, the ﬁlename thus has its dots stripped: /D3/D9/D8/BA/D4/D9/D8/BA/D7/DA becomes the table name /D3/D9/D8/CN/D4/D9/D8.
gsl_stats March24,2009
128 CHAPTER 4
Method V: Views Pointers make it reasonably easy and natural to look at subse ts
ofamatrix.Doyouwantamatrixthatrepresents Xwiththeﬁrst
rowloppedoff?Thenjustsetupamatrixwhose /CS/CP/D8/CPpointerpointstothesecond
row.Sincethenewmatrixispointingtothesamedataastheor iginal,anychanges
will affect both matrices, which is often what you want; if no t, then you can copy
thesubmatrix’sdatato anewlocation.
However, it is not quite as easy as just ﬁnding the second row a nd pointing to it,
sincea /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC includesinformationaboutyourdata(i.e., metadata),suchas
the number of rows and columns. Thus, there are a few macros to help you pull
a row, column, or submatrix from a larger matrix. For example , say that /D1is a/CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/B6 ,then
Apop_matrix_row(m, 3,row_v);
Apop_matrix_col(m, 5,col_v);
Apop_submatrix(m, 2,4, 6, 8, submatrix);
will produce a /CV/D7/D0/CN/DA/CT/D8/D3/D6/B6 named /D6/D3/DB/CN/DAholding the third row, another named/D3/D0/CN/DAholding the ﬁfth column, and a 6 ×8 /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/B6 named /D7/D9/CQ/D1/CP/D8/D6/CX/DC
whose(0, 0) thelementis at(2, 4)inthe original.
For an /CP/D4/D3/D4/CN/CS/CP/D8/CP set, we have the names at our disposal, and so you could
use either /BT/D4/D3/D4/CN/D6/D3/DB/B4/D1/B8 /BF/B8 /D6/D3/DB/CN/DA/B5and /BT/D4/D3/D4/CN/D3/D0/B4/D1/B8 /BH/B8 /D3/D0/CN/DA/B5to pull the
given vectors from the matrix element of an /CP/D4/D3/D4/CN/CS/CP/D8/CP structure using row/col-
umnnumber,or /BT/D4/D3/D4/CN/D6/D3/DB/CN/D8/B4/D1/B8 Ꜽ /CU/D3/D9/D6/D8/CW /D6/D3/DB Ꜽ/B8 /D6/D3/DB/CN/DA/B5and /BT/D4/D3/D4/CN/D3/D0/CN/D8/B4/D1/B8Ꜽ /D7/CX/DC/D8/CW /D3/D0/D9/D1/D2 Ꜽ/B8 /D3/D0/CN/DA/B5to pulltheserowsandcolumnsby theirtitles.
Themacrosworkabitofmagic:theyinternallydeclareanaut omatically-allocated/CV/D7/D0/CN/D1/CP/D8/D6/CX/DC or /DA/CT/D8/D3/D6with the requisite metadata, and then declare a pointer
with the name you selected, that can be used like any other poi nter to a matrix or
vector.However,becausethesemacrosusedonlyautomatica llyallocatedmemory,
you do not need to free the matrix or vector generated by the ma cro. Thus, they
provide a quick, disposable view of a portion of the matrix.9If you need a more
permanent record, them copy the view to a regular vector or ma trix using any of
the methods from prior pages (e.g., /CV/D7/D0/CN/DA/CT/D8/D3/D6 /B6/D4/CT/D6/D1/CP/D2/CT/D2/D8/CN/D3/D4/DD /BP /CP/D4/D3/D4/CN/B9/DA/CT/D8/D3/D6/CN/D3/D4/DD/B4/D8/CT/D1/D4/CN/DA/CX/CT/DB/B5/BN ).
9Thesemacros are based on GSLfunctions that are slightly les s convenient. For example:/CV/D7/D0/CN/DA/CT/D8/D3/D6 /DA /BP /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/D3/D0/B4/CP/CN/D1/CP/D8/D6/CX/DC/B8 /BG/B5/BA/DA/CT/D8/D3/D6/BN/CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D7/CW/D3/DB/B4/B2/DA/B5/BN
If themacro seems to bemisbehaving, as macros sometimes do, you can fall back on this form.
gsl_stats March24,2009
MATRICES AND MODELS 129
4.4 L INEAR ALGEBRA Saythatwehaveatransitionmatrix,showingwhether
the system can go from a row state to a column state.
Forexample,Figure 4.4 was such a transition matrix, showin g which formats can
beconvertedto whichotherformats.
Omitting the labelsandmarking eachtransition with a onean deachdotin Figure
4.4with a zero,we getthe followingtransition matrix:
110001
010111
001110
111111
111111
111111
Listing 4.5 showsa brief program to readthe datasetfrom a te xtﬁle, take the dot
productof /D8with itself, anddisplaythe result.
#include <apop.h>
intmain(){
apop_data *t =apop_text_to_data("data −markov",0, 0);
apop_data *out = apop_dot(t,t,0, 0);
apop_data_show(out);
}
Listing4.5 Twotransitions along atransitionmatrix. Onli ne source: /D1/CP/D6/CZ/D3/DA/BA .
Beforediscussingthesyntaxof /CP/D4/D3/D4/CN/CS/D3/D8 in detail,hereis the program’soutput:
231223
343444
223332
454555
454555
454555
Thistellsus,forexample,thattherearethreewaystotrans itionfromtheﬁrststate
to the second in two steps (you can verify that they are: 1 ⇒1⇒2, 1⇒2⇒2,
and1⇒6⇒2).
The /CP/D4/D3/D4/CN/CS/D3/D8 functiontakesuptofourarguments:two /CP/D4/D3/D4/CN/CS/CP/D8/CP structures,and
one ﬂag for each matrix indicating what to do with it ( /B3/D8/B3=transpose the matrix,/B3/DA/B3=usethevectorelement, /BC=usethematrix as-is).Forexample,if /CGisamatrix,
then
gsl_stats March24,2009
130 CHAPTER 4
apop_dot(X,X, ’t’, 0);
will ﬁnd X′X: the function takes the dot product of /CGwith itself, and the ﬁrst
versionis transposedandthesecondis not.
• Ifadatasethasa /D1/CP/D8/D6/CX/DCcomponent,thenitwillbeusedforthedotproduct,
andifthe /D1/CP/D8/D6/CX/DCelementis /C6/CD/C4/C4thenthe /DA/CT/D8/D3/D6componentis used.
• There should be exactly as many transposition ﬂags as matri ces. If the ﬁrst
element is a vector, it is always taken to be a row; if the secon d element
is a vector, it is always a column. In both cases, if the other e lement is a
matrix,youwillneedoneﬂagtoindicatewhethertousethe /CP/D4/D3/D4/CN/CS/CP/D8/CP set’s/DA/CT/D8/D3/D6element( /B3/DA/B3),usethetransposedmatrix( /B3/D8/B3),orusethematrixas
written (anyothercharacter).10
• If both elements are vectors, then you are probably better o ff just using/CV/D7/D0/CN/CQ/D0/CP/D7/CN/CS/CS/D3/D8 , below, but if you use /CP/D4/D3/D4/CN/CS/D3/D8 , the output will be an/CP/D4/D3/D4/CN/CS/CP/D8/CP setthathasa vectorelementoflengthone.
Q4.4The quadratic form X′YXappears very frequently in statistical work.
Write a function with the header /CP/D4/D3/D4/CN/CS/CP/D8/CP /B6/D5/D9/CP/CS/D6/CP/D8/CX/CN/CU/D3/D6/D1/B4/CP/D4/D3/D4/CN/B9/CS/CP/D8/CP /B6/DC/B8 /CP/D4/D3/D4/CN/CS/CP/D8/CP /B6/DD/B5/BNthattakestwo /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC esandreturns the
quadraticform asabove.Besuretocheckthat /DDissquareandhasthesame
dimensionas /DC/B9> /D7/CX/DE/CT/BD.
Vector·vector Giventwovectors xandy, /CV/D7/D0/CN/CQ/D0/CP/D7/CN/CS/CS/D3/D8 returns x1y1+x2y2+
···+xnyn.Ratherthanoutputtingthevalueof x·yasthefunction’s
return value,it takesthe location of a /CS/D3/D9/CQ/D0/CT, andplacesthe outputthere.E.g., if/DCand /DDare /CV/D7/D0/CN/DA/CT/D8/D3/D6/B6 s,use
doubledotproduct;
gsl_blas_ddot (x,y,&dotproduct);
10Why do you have to tell a computer whether to transpose or not? Some feel that if you send a /BDto indicate
transposition when you meant /BC(or vice versa), the system should be able to determine this. Say that you have a
1×10vector that you will multiply against three data sets,where the ﬁrstis 8×10, thesecond is 15×10, and
the third is 10×10. You write asimple /CU/D3/D6loop:/CU/D3/D6/B4/CX/D2/D8 /CX/BP/BC/BN /CX/BO/BF/BN /CX/B7/B7/B5/D3/D9/D8/CJ/CX℄ /BP /CP/D4/D3/D4/CN/CS/D3/D8/B4/CS/CP/D8/CP/CJ/CX℄/B8 /DA/B8 /BD/B5/BN
At /CX/BP/BC, a ‘smart’ system realizes that you committed a faux pas: an 8×10matrix dot a 10×1column vector
works without transposition. So it corrects you without tel ling you, and does the same with /CS/CP/D8/CP/CJ/BD℄. With/CS/CP/D8/CP/CJ/BE℄, the transposition works, since there are both ten rows and t en columns. So /D3/D9/D8/CJ/BC℄and /D3/D9/D8/CJ/BD℄are
correct and /D3/D9/D8/CJ/BE℄is not. Good luck catching and debugging that.
gsl_stats March24,2009
MATRICES AND MODELS 131
Q4.5Write a table displaying the sum of squares 12+ 22+ 32+···+n2for
n= 1through 10.
• Write afunctionthattakesin nand
–allocatesa /CV/D7/D0/CN/DA/CT/D8/D3/D6/B6 ofsize n,
–ﬁlls thevectorwith 1,... ,n,
–calculatesandreturns v·vusing /CV/D7/D0/CN/CQ/D0/CP/D7/CN/CS/CS/D3/D8 ,
–andﬁnallyfrees /DA.
• Write a loop for n= 1through 10that calls the above function and
thenprints nandthe returnedvalue.
• Verify your work, by printing n(n+ 1)(2 n+ 1)/6alongside your
calculationofthesumofsquaresupto n.
An example: Cook’s distance Cook’s distance is an estimate of how much each
data point affects a regression (Cook, 1977). The
formula is
Ci=/summationtext
j(ˆyr
j−ˆyri
j)2
p·MSE, (4.4.1)
where pis the number of parameters, MSEis mean squared error for the overall
regression, ˆyr
jis thejthelement of the predicted value of ˆybased on the overall
regression,and ˆyri
jisthejthelementofthepredictedvalueof ˆybasedonaregres-
sion excluding data point i. That is, to ﬁnd Cook’s distance for 3,000 data points,
we would need to do a separate regression on 3,000 data sets, e ach excluding a
different data point. The formula simply quantiﬁes whether the predictions made
bythe mainregressionchangesigniﬁcantlywhenexcludinga givendatapoint.
The procedure provides us a good opportunity to do some matri x-shunting and
linear algebra, since we will need functions to produce the s ubsets, functions to
calculate ˆy=Xˆβ, andto ﬁndthe squareddifferencesandMSE.
The ﬁrst function is in Listing 4.6. It produces the series of data sets, each with
onerow missing. Thefunction is namedafter the jackknife procedure,whichuses
thesamedelete-oneloopfor calculatingcovariancesorcor rectingbias.11
• Lines 9–10 use a submatrix to produce a view of the main matri x starting at the
11The Jackknife is not discussed in this book; see the online do cumentation for Apophenia’s /CP/D4/D3/D4/CN/B9/CY/CP/CZ/CZ/D2/CX/CU/CT/CN/D3/DA .
gsl_stats March24,2009
132 CHAPTER 4
1#include <apop.h>
2
3typedefdouble (*math_fn)(apop_data *);
4
5gsl_vector *jack_iteration( gsl_matrix *m,math_fn do_math){
6intheight =m−>size1;
7gsl_vector *out = gsl_vector_alloc(height);
8apop_data *reduced = apop_data_alloc(0, height −1, m−>size2);
9 APOP_SUBMATRIX(m,1, 0,height −1, m−>size2,mv);
10 gsl_matrix_memcpy(reduced −>matrix, mv);
11 for(inti=0; i< height;i++){
12 gsl_vector_set(out,i,do_math(reduced));
13 if(i < height−1){
14 APOP_MATRIX_ROW(m, i, onerow);
15 gsl_matrix_set_row(reduced −>matrix,i,onerow);
16 }
17 }
18 returnout;
19 }
Listing4.6 Iteratively produce /CX/D2/B9/BQ/D7/CX/DE/CT/BD submatrices, each with one omitted row of data. Online
source: /CY/CP/CZ/CX/D8/CT/D6/CP/D8/CX/D3/D2/BA .
position (1,0), and with size ( /D1/B9/BQ/D7/CX/DE/CT/BD /B9 /BD/B8 /D1/B9/BQ/D7/CX/DE/CT/BE )—that is, the original
matrix with the ﬁrst row missing—and then uses /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/D1/CT/D1/D4/DD to copy
thattoa newmatrix.
• The /CU/D3/D6loopthenrepeatstheview-and-copyprocedurerowbyrow.It beginswith
rowzero,whichwasomitted before,andoverwritesrowzeroi nthecopy,akarow
one of the original. It then copies over original row one, ove rwriting the copy of
originalrowtwo, andsoonto theendofthematrix.
• Line 12 calls the function which was sent in as an argument. S ee page 190 for
notes on writing functions that take functions as inputs, in cluding the meaning of
the /D8/DD/D4/CT/CS/CT/CU online 3.
Now that we have the matrix-shunting out of the way, Listing 4 .7 provides addi-
tionalfunctionsto dothe linearalegbra.
• The /D7/D9/D1/CN/D7/D5/D9/CP/D6/CT/CS/CN/CS/CX/CU/CU function calculates/summationtext
i(Li−Ri)2. The ﬁrst line ﬁnds
L−R, and the second line applies the function /CV/D7/D0/CN/D4/D3/DB/CN/BE to each element of
L−R(that is,it squareseachelement)andreturnsthepost-squa ringsum.12
• The /D4/D6/D3/CY/CT/D8 function is taking the dot product yest=Xβ. By giving this single
12TheGSLprovidesefﬁcient powercalculators from /CV/D7/D0/CN/D4/D3/DB/CN/BE upto /CV/D7/D0/CN/D4/D3/DB/CN/BL ,andthecatch-all function/CV/D7/D0/CN/D4/D3/DB/CN/CX/D2/D8/B4/DA/CP/D0/D9/CT/B8 /CT/DC/D4/D3/D2/CT/D2/D8/B5 , that will raise /DA/CP/D0/D9/CTto any integer exponent in a more efﬁcient manner
than thegeneral-purpose /D4/D3/DB.
gsl_stats March24,2009
MATRICES AND MODELS 133
#include <apop.h>
typedefdouble (*math_fn)(apop_data *);
gsl_vector *jack_iteration(gsl_matrix *,math_fn);
apop_data *ols_data;
gsl_vector *predicted;
doublep_dot_mse;
doublesum_squared_diff(gsl_vector *left, gsl_vector *right){
gsl_vector_sub(left,right); //destroys the leftvector
returnapop_vector_map_sum(left,gsl_pow_2);
}
gsl_vector *project(apop_data *d, apop_model *m){
returnapop_dot(d,m−>parameters,0, ’v’) −>vector;
}
doublecook_math(apop_data *reduced){
apop_model *r = apop_estimate(reduced,apop_ols);
doubleout =sum_squared_diff(project(ols_data,r),predicted) /p_dot_mse;
apop_model_free(r);
returnout;
}
gsl_vector *cooks_distance(apop_model *in){
apop_data *c= apop_data_copy(in −>data);
apop_ols.prep(in−>data,in);
ols_data = in−>data;
predicted= project(in −>data,in);
p_dot_mse = c−>matrix−>size2*sum_squared_diff(in −>data−>vector,predicted);
returnjack_iteration(c−>matrix,cook_math);
}
intmain(){
apop_data *dataset = apop_text_to_data("data −regressme",0, 1);
apop_model *est = apop_estimate(dataset,apop_ols);
printf("plot ’−’\n");
strcpy(apop_opts.output_delimiter, "\n");
apop_vector_show(cooks_distance(est));
}
Listing4.7 Calcluate the Cook’s distance, by running 3,200 regressions. Compile with/CY/CP/CZ/CX/D8/CT/D6/CP/D8/CX/D3/D2/BA . Online source: /D3/D3/CZ/D7/BA.
line a function of its own,we hide some of the details and get a self-documenting
indicationofthecode’sintent.
• The /D3/D3/CZ/CN/D1/CP/D8/CW function calculates Equation 4.4.1 for each value of /CX. It is not
calleddirectly,butispassedto /CY/CP/CZ/CN/CX/D8/CT/D6/CP/D8/CX/D3/D2 ,whichwillapplythefunctionto
gsl_stats March24,2009
134 CHAPTER 4
eachofits 3,200submatrices.
• The /D3/D3/CZ/D7/CN/CS/CX/D7/D8/CP/D2/CT function produces two copies of the data set: an untainted
copy , and a regression-style version with the dependent variabl e in the /DA/CT/D8/D3/D6
elementofthedataset,andtheﬁrstcolumnofthe /D1/CP/D8/D6/CX/DCallones.
• After /D1/CP/CX/D2calls /D3/D3/CZ/D7/CN/CS/CX/D7/D8/CP/D2/CT , which calls the various linear algebra proce-
duresand /CY/CP/CZ/CN/CX/D8/CT/D6/CP/D8/CX/D3/D2 ,whichcalls /D3/D3/CZ/CN/D1/CP/D8/CW foreachsubmatrix,wehave
a list of the Cook’sdistance for everypoint in the set, which we can useto search
foroutliers.
• The /D1/CP/CX/D2functionproducesGnuplot-readyoutput,sorunthisusing, e.g., /BA/BB/D3/D3/CZ/DG /CV/D2/D9/D4/D0/D3/D8 /B9/D4/CT/D6/D7/CX/D7/D8 .Someresearchersprefertosortthedatapointsbeforeplot -
ting;i.e.,try sendingtheoutputvectorto /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/D7/D3/D6/D8 beforeplotting.
Q4.6Addsomebaddatapoints to the /CS/CP/D8/CP/B9/D6/CT/CV/D6/CT/D7/D7/D1/CT ﬁle, like /BD/DG/BD/DG/BD, to sim-
ulate outliers or erroneous data. Does the Cook’s distance o f the bad data
standoutasespeciallylarge?
MATRIX INVERSION AND
EQUATION SOLVINGInverting a matrix requires signiﬁcantly more computa-
tion than the element-by-elementoperations above.But
here in the modernday, it is not sucha big deal:my old
laptop will invert a 1,000×1,000matrix in about ten seconds, and does the in-
version step for the typical OLS regression, around a 10×10matrix at the most,
in wellunderthe blink ofaneye.
Apophenia provides functions to ﬁnd determinants and inver ses (via the GSL
andBLAS’striangulardecompositionfunctions),named /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/CX/D2/DA/CT/D6/D7/CT ,/CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/CS/CT/D8/CT/D6/D1/CX/D2/CP/D2/D8 , and for both at once, /CP/D4/D3/D4/CN/CS/CT/D8/CN/CP/D2/CS/CN/CX/D2/DA . Exam-
ples for using this function are located throughout the book ; e.g., see the calcula-
tion ofOLScoefﬁcientson page280.
Sometimes,youdonothavetobotherwithinversion.Forexam ple,weoftenwrite
the OLS parameters as β= (X′X)−1(X′Y), but you could implement this as
solving (X′X)β=X′Y, which involves no inversion. If /DC/D4/DCis the matrix X′X
and /DC/D4/DDis the vector X′Y, then /CV/D7/D0/CN/D0/CX/D2/CP/D0/CV/CN/C0/C0/CN/D7/D3/D0/DA/CT/B4/DC/D4/DC/B8 /DC/D4/DD/B8 /CQ/CT/D8/CP/DA/B5
will return thevector β.
® /CP/D4/D3/D4/CN/CS/CP/D8/CP· /CP/D4/D3/D4/CN/CS/CP/D8/CP : /CP/D4/D3/D4/CN/CS/D3/D8 .
®Vector·vector: /CV/D7/D0/CN/CQ/D0/CP/D7/CN/CS/CS/D3/D8 .
®Inversion: /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/CX/D2/DA/CT/D6/D7/CT , /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/CS/CT/D8/CT/D6/D1/CX/D2/CP/D2/D8 ,or/CP/D4/D3/D4/CN/CS/CT/D8/CN/CP/D2/CS/CN/CX/D2/DA .
gsl_stats March24,2009
MATRICES AND MODELS 135
4.5 N UMBERS Floating-pointnumberscantakeseveralspecialvalues,th emost
importantofwhichare /C1/C6/BY/C1/C6/C1/CC/CH , /B9/C1/C6/BY/C1/C6/C1/CC/CH ,and /C6/BT/C6.13Data-
orientedreaderswillmostlybeinterestedin /C6/BT/C6(read:notanumber),whichisan
appropriatewaytorepresentmissingdata.Listing4.8show syouthenecessaryvo-
cabulary.Allfour /CX/CUstatementswillbetrue,andprinttheirassociatedstateme nts.
#include <math.h> //NaN handlers
#include <stdio.h> //printf
intmain(){
doublemissing_data = NAN;
doublebig_number = INFINITY;
doublenegative_big_number = −INFINITY;
if(isnan(missing_data))
printf("missing_data ismissinga data point.\n");
if(isﬁnite(big_number)== 0)
printf("big_number is not ﬁnite.\n");
if(isﬁnite(missing_data)== 0)
printf("missing_data isn’tﬁnite either.\n");
if(isinf(negative_big_number)== −1)
printf("negative_big_number is negative inﬁnity.\n");
}
Listing4.8 Some functions totestfor inﬁnityor NaNs. Onlin e source: /D2/D3/D8/CP/D2/D9/D1/CQ/CT/D6/BA .
Becauseﬂoating-pointnumberscantakethesevalues,divis ionbyzerowon’tcrash
your program. Assigning /CS/D3/D9/CQ/D0/CT /CS /BP /BD/BA/BC/BB/BC/BA/BC will result in /CS /BP/BP /C1/C6/BY/C1/C6/C1/CC/CH ,
and /CS /BP /BC/BA/BC/BB/BC/BA/BC will result in /CSbeing set to /C6/BT/C6. However, integers have none
of these luxuries: try /CX/D2/D8 /CX /BP /BD/BB/BCand you will get something in the way of/BT/D6/CX/D8/CW/D1/CT/D8/CX /CT/DC/CT/D4/D8/CX/D3/D2 /B4/D3/D6/CT /CS/D9/D1/D4/CT/CS/B5.
Comparisonto an /C6/BT/C6valuealwaysfails:
doubleblank = NAN;
blank == NAN; //Thisevaluates tofalse.
blank == blank; //Thisevaluates tofalse.(!)
isnan(blank); //Returns 1: the correct way tocheck for anNaN value.
13Pedantic note on standards: These values are deﬁned in the C9 9 standard (§7.12) only on machines that
support the IEEE 754/IEC 60559 ﬂoating-point standards, bu t since those standards are from 1985 and 1989,
respectively, they may be taken as given: to the best of my kno wledge, all current hardware supports /C1/C6/BY/C1/C6/C1/CC/CH
and /C6/BT/C6. Recall that /CVrequires /AL/D7/D8/CS/BP/CV/D2/D9/BL/BL for C99 features; otherwise, the GSL provides /BZ/CB/C4/CN/C8/C7/CB/C1/C6/BY ,/BZ/CB/C4/CN/C6/BX/BZ/C1/C6/BY , and /BZ/CB/C4/CN/C6/BT/C6 that work in non-C99 and non-IEEE 754 systems.
gsl_stats March24,2009
136 CHAPTER 4
GSLconstant approx. GSLconstant approx.
e /C5/CN/BX 2.71828 π /C5/CN/C8/C1 3.14159
log2e /C5/CN/C4/C7/BZ/BE/BX 1.44270 π/2 /C5/CN/C8/C1/CN/BE 1.57080
log10e /C5/CN/C4/C7/BZ/BD/BC/BX 0.43429 π/4 /C5/CN/C8/C1/CN/BG 0.78540
ln 2 /C5/CN/C4/C6/BE 0.69315 1/π /C5/CN/BD/CN/C8/C1 0.31831
ln 10 /C5/CN/C4/C6/BD/BC 2.30259 2/π /C5/CN/BE/CN/C8/C1 0.63662√
2 /C5/CN/CB/C9/CA/CC/BE 1.41421√π /C5/CN/CB/C9/CA/CC/C8/C1 1.77245/radicalbig
1/2 = 1/√
2 /C5/CN/CB/C9/CA/CC/BD/CN/BE 0.70711 2/√π /C5/CN/BE/CN/CB/C9/CA/CC/C8/C1 1.12838√
3 /C5/CN/CB/C9/CA/CC/BF 1.73205 lnπ /C5/CN/C4/C6/C8/C1 1.14473
Eulerconstant( γ) /C5/CN/BX/CD/C4/BX/CA 0.57722
Table 4.9 TheGSLdeﬁnes anumber of useful constants./F4Predeﬁned constants There are a number of useful constants that are deﬁned
by the GSL (via preprocessor /AZ/CS/CT/CU/CX/D2/CTs); they are listed
in Table 4.9.14It is generally better form to use these constants, because t hey are
moredescriptivethanrawdecimalvalues,andtheyaredeﬁne dtogreaterprecision
thanyouwill wantto typein yourself.
PRECISION Aswithanyﬁnitemeansofwritingrealnumbers,thereisarou ndoffer-
rortothe computer’sinternalrepresentationofnumbers.T hecomputer
basicallystoresnon-integernumbersusingscientiﬁcnota tion.Forthosewhohave
forgottenthis notation, πiswritten as 3.14159×100,or /BF/BA/BD/BG/BD/BH/BL/CT/BC ,and100πas
3.14159×102, or /BF/BA/BD/BG/BD/BH/BL/CT/BE . Numbers alwayshave exactlyone digit before the
decimalpoint,andtheexponentischosento ensurethatthis is the case.
Your computer works in binary, so ﬂoating-point numbers (of type /CU/D0/D3/CP/D8and/CS/D3/D9/CQ/D0/CT) are of the form d×2n, where dis a string of ones and zeros and nis an
exponent.15
Thescaleofanumberisitsoverallmagnitude,andisexpressedbythee xponent n.
Theﬂoating-pointsystemcanexpressa wide rangeofscalesw ith equalease:it is
aseasytoexpressthreepicometers( 3e−12)asthreemillionkilometers( 3e9).The
precision is how many signiﬁcant digits of information are held in d:3.14e−12
and3.14e9bothhavethree signiﬁcantdecimaldigits ofinformation.
Thereisaﬁxedspacefor d,andwhenthatspaceisexceeded, nisadjustedtosuit,
but that changeprobably means a loss in precision for d. To give a small base-ten
14TheGSLgetsmostoftheseconstants fromBSDand UNIX,soyoum aybeable toﬁndthemeven whenthe
GSLis notavailable. Theexceptions are /C5/CN/CB/C9/CA/CC/BF and /C5/CN/CB/C9/CA/CC/C8/C1 , which are GSL-speciﬁc.
15This oversimpliﬁes some details that are basically irrelev ant for users. For example, the ﬁrst digit of dis
always one, sothe computer normally doesn’t bother storing it.
gsl_stats March24,2009
MATRICES AND MODELS 137
i 2i2−i
100 1 .26765e+30 7 .88861e−31
200 1 .60694e+60 6 .22302e−61
300 2 .03704e+90 4 .90909e−91
400 2 .58225e+120 3 .87259e−121
500 3 .27339e+150 3 .05494e−151
600 4 .14952e+180 2 .40992e−181
700 5 .26014e+210 1 .90109e−211
800 6 .66801e+240 1 .4997e−241
900 8 .45271e+270 1 .18305e−271
1000 1 .07151e+301 9 .33264e−302
1100inf 0
1200inf 0
Table 4.10 Multiplyingtogether large columns ofnumbers wi lleventually fail.
example,saythatthespacefor disonlythreedigits;then 5.89e0×892e0 = 525e1,
though 5.89×892 = 5 ,254. The ﬁnal four was truncated to zero to ﬁt dinto its
givenspace.
Precision can easily be lost in this manner, and once lost can never be regained.
One general rule of thumb implied by this is that if you are wri ting a precision-
sensitive function to act on a /CU/D0/D3/CP/D8, use /CS/D3/D9/CQ/D0/CTvariables internally, and if you
aretakingin /CS/D3/D9/CQ/D0/CTs,use /D0/D3/D2/CV /CS/D3/D9/CQ/D0/CTinternally.
The loss of precision becomes especially acute when multipl ying together a long
list of numbers. This will be discussed further in the chapte r on maximum likeli-
hoodestimation(page330),becausethelikelihoodfunctio ninvolvesexactlysuch
multiplication.Saythatwehaveacolumnofathousandvalue seacharoundahalf.
Then the product of the thousand elements is about 2−1000, which strains what a/CS/D3/D9/CQ/D0/CTcan represent. Table 4.10 shows a table of powers of two as rep resented
by a /CS/D3/D9/CQ/D0/CT. Fori >1,000—a modestnumberof data points—a /CS/D3/D9/CQ/D0/CTthrows
in the towel and calls 2i=∞and2−i= 0. These are referred to as an overﬂow
errorandunderﬂowerror ,respectively.
For those who would like to try this at home, Listing 4.11 show sthe codeused to
produce this table, and also repeats the experiment using a /D0/D3/D2/CV /CS/D3/D9/CQ/D0/CT, which
doesn’tgiveup untilover16,000doublingsandhalvings.
gsl_stats March24,2009
138 CHAPTER 4
#include <math.h>
#include <stdio.h>
intmain(){
printf("Powers of twoheldina double:\n");
for(inti=0; i< 1400; i+=100)
printf("%i\t %g\t%g\n", i,ldexp(1,i), ldexp(1, −i));
printf("Powers of twoheldina longdouble:\n");
for(inti=0; i< 18000; i+=1000)
printf("%i\t %Lg\t %Lg\n",i,ldexpl(1,i), ldexpl(1, −i));
}
Listing4.11 Find the computer’s representation of 2iand2−ifor large i. Online source:/D4/D3/DB/CT/D6/D7/D3/CU/D8/DB/D3/BA .
• The program uses the /D0/CS/CT/DC/D4family of functions, which manipulate the ﬂoating-
pointrepresentationofa numberdirectly(and arethusprob ablybadform).
• The /D4/D6/CX/D2/D8/CUformat speciﬁerforthe /D0/D3/D2/CV /CS/D3/D9/CQ/D0/CTtypeis /B1/C4/CV.16
The solution to the problem of ﬁnding the product of a large nu mber of elements
isto calculatethelog oftheproductratherthantheproduct itself; seepage330.
If you need to calculate πto a million decimal points, you will need to ﬁnd a
library that can work with numbers to arbitrary precision. S uch libraries typi-
cally work by representing all numbers as a data structure li sting the ones place,
tens place, hundreds place, ..., and then extending the list in either direction as
necessary. Another alternative is rational arithmetic, wh ich leaves all numbers in/B4/CX/D2/D8/B5/BB/B4/CX/D2/D8/B5 form for as long as possible. Either system will need to provi de its
own add/subtract/multiply/divide routines to act on its da ta structures, rather than
using C’s built-in operators. Unfortunately, the added lay er of complexity means
thatthearithmeticoperationsthathadbeenfastprocedure s(oftenimplementedvia
special-purposeregistersontheprocessorhardwareitsel f)arenowalongseriesof
library calls.
Soto domath efﬁcientlyon large matrices,we arestuckwith ﬁ nite precision,and
thereforemustnotrelytooheavilyonnumbersafteraroundm aybefoursigniﬁcant
digits. Forthe purposesof estimating and testing the param eters of a model using
real-world data, this is OK. If two numbers differ only after eight signiﬁcant dig-
its (say, 3.14159265 versus 3.14159268), there is rarely an y reason to take these
numbers as signiﬁcantly different. Even if the hypothesis t est indicates that they
aredifferent, itwill bedifﬁcultto convinceareferee ofth is.
16The /B1/CVand /B1/C4/CVformatspeciﬁers round offlarge values, sochange them toto /B1/CUand /B1/C4/CUto seetheprecise
value ofthe calculations without exponential notation.
gsl_stats March24,2009
MATRICES AND MODELS 139
CONDITIONING Most matrix routines do badly when the determinant is near ze ro,
or when eigenvalues are different orders of magnitude. One w ay
to cause such problems with your own data is to have one column that is of the
orderof 1×1010andanotherthatis ontheorderof 1×10−10. In ﬁnite-precision
arithmeticontwonumbersofsuchwiderange,thesmallernum berisoftensimply
swallowed: /BF/BA/BD/BG/CT/BD/BC /B7 /BH/BA/BL/BE/CT/B9/BD/BC /BP /BF/BA/BD/BG/CT/BD/BC.
Thus, try to ensure that each column of the data is approximat ely of the same
orderofmagnitudebeforedoingcalculations.Saythatyouh aveatheorythatmean
ﬁngernailthicknessisinﬂuencedbyalocation’spopulatio n.Youcouldmodifythe
scalewhenpulling datafrom thedatabase,
selectpopulation/1000., nail_thickness *1000.
fromhealth_data;
oryoucouldmodify it in the /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC :
APOP_COL(data, 0,pop)
gsl_vector_scale(pop,1/1000.);
APOP_COL(data, 1,nails)
gsl_vector_scale(nails, 1000.);
Thesenotesaboutconditioning are not C-speciﬁc.Anymathe matics packagethat
hopes to work efﬁciently with large matrices must use ﬁnite- precision arithmetic,
and will therefore have the same problems with ill-conditio ned data matrices. For
muchmoreaboutprecisionissuesandthestandardmachinere presentationofnum-
bers,seeGoldberg(1991).
COMPARISON Floating-point numbers are exact representations of a real number
with probability zero. Simply put, there is a bit of fuzz, so e xpect
everynumberto bealittle bit offfrom whereit shouldbe.
It is normally not a problem that 4 + 1e−20∝\e}atio\slash= 4, and such fuzz can be safely
ignored, but Polhill et al.(2005) point out that the fuzziness of numbers can be
a problem for comparisons, and those problems can create odd effects in simu-
lations or agent-based models. After a long series of ﬂoatin g-point operations, a
comparison of the form /B4/D8 /BP/BP /BC/B5will probably not work. For example, Listing
4.12calculates 1.2−3·0.4usingstandardIEEEarithmetic,andﬁndsthatitisless
thanzero.17
There are labor-intensive solutions to the problem, like al ways using /D0/D3/D2/CV /CX/D2/D8s
17This example is from aweb siteafﬁliated with the authors of t he above paper, at /CW/D8/D8/D4/BM/BB/BB/DB/DB/DB/BA/D1/CP/CP/D9/D0/CP/DD/BA/CP/BA/D9/CZ/BB/CU/CT/CP/D6/D0/D9/D7/BB/CU/D0/D3/CP/D8/CX/D2/CV/B9 /D4 /D3/CX/D2 /D8/BB .
gsl_stats March24,2009
140 CHAPTER 4
#include <stdio.h>
intmain(){
doublet= 1.2;
t−= 0.4;
t−= 0.4;
t−= 0.4;
if(t<0)
printf ("Bythe IEEEﬂoating −point standard,1.2−3*.04 <0.\n");
}
Listing4.12 The IEEEstandard reallydoes implythat 1.2−3·0.4<0. Online source: /CU/D9/DE/DE/BA.
for everything,18but the most sensible solution is to just bear in mind that no
comparison is precise so, for example, agents should not die when their wealth is
zero,butwhen it is lessthan maybe 1e−6. Otherwise, the modelshouldbe robust
to agentswhohaveaniota ofnegativewealth.
®Floating-pointnumberscantakeonvaluesof /B9/C1/C6/BY/C1/C6/C1/CC/CH , /C1/C6/BY/C1/C6/C1/CC/CH ,
and /C6/BT/C6.
®Multiplying together a column of a thousand numbers will bre ak, so
get the log of the product by summing the logs of the column’s e le-
ments.
®Reporting results based on the ﬁfth signiﬁcant digit (or so) is spuri-
ous.
®Try to keep the scale of your variables within a factor of abou t a
thousandofeachother.
®Exact comparisons of ﬂoating-point numbers can fail, so do n ot test/CU /BP/BP /BC,but /CU/CP/CQ/D7/B4/CU/B5 /BO /BD/CT/B9/BI(orso).
4.6 /F4 /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC AND /CV/D7/D0/CN/DA/CT/D8/D3/D6
INTERNALSFirst, a warning: the intent of this sec-
tion is not to show you how to circum-
venttheGSL’saccessfunctionssuchas/CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/CV/CT/D8 and /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/D7/CT/D8 .Doingsoisbadform,invitingerrorsand
makingcodemoredifﬁcultto read.19Instead,thesenoteswillbeusefulto youfor
18Recall that /B4/CP/BB/CQ/B5/B6/CQ /B7 /CP/B1/CQis exactly /CPfor /D0/D3/D2/CV /CX/D2/D8 /CP/B8 /CQ, /CQ/ne}ationslash= 0.
19If you are really concerned about the overhead from these fun ctions, then /AZ/CS/CT/CU/CX/D2/CT /BZ/CB/C4/CN/CA/BT/C6/BZ/BX/CN/BV/C0/BX/BV/C3/CN/B9/C7/BY/BY, either via that preprocessor directive or adding -DGSL_RA NGE_CHECK_OFF to your compilation com-
gsl_stats March24,2009
MATRICES AND MODELS 141
understandingwhythe data structuresare the way theyare, a ndgiving youa han-
dleon whatoperationsare easyandwhatoperationsaredifﬁc ult.
Hereis therelevantsectionofthe declarationofthe /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC structure:
typedefstruct {
size_tsize1;
size_tsize2;
size_ttda;
double*data;
[...]
intowner;
}gsl_matrix ;
(0,0) (0,1) ...(0,9) (1,0) (1, 1) ...(1,9) (2,0) (2,1) ...(2 ,9) ...(9,0) (9, 1)...(9, 9)
⇓
(0,0) (0,1) (0,2) (0,3) (0,4) (0,5) (0,6) (0,7) (0,8) (0,9)
֒→(1,0) (1,1) (1,2) (1,3) (1,4) (1,5) (1,6) (1,7) (1,8) (1,9)
֒→(2,0) (2,1) (2,2) (2,3) (2,4) (2,5) (2,6) (2,7) (2,8) (2,9)
֒→(3,0) (3,1) (3,2) (3,3) (3,4) (3,5) (3,6) (3,7) (3,8) (3,9)
֒→(4,0) (4,1) (4,2) (4,3) (4,4) (4,5) (4,6) (4,7) (4,8) (4,9)
֒→(5,0) (5,1) (5,2) (5,3) (5,4) (5,5) (5,6) (5,7) (5,8) (5,9)
֒→(6,0) (6,1) (6,2) (6,3) (6,4) (6,5) (6,6) (6,7) (6,8) (6,9)
֒→(7,0) (7,1) (7,2) (7,3) (7,4) (7,5) (7,6) (7,7) (7,8) (7,9)
֒→(8,0) (8,1) (8,2) (8,3) (8,4) (8,5) (8,6) (8,7) (8,8) (8,9)
֒→(9,0) (9,1) (9,2) (9,3) (9,4) (9,5) (9,6) (9,7) (9,8) (9,9)
Figure 4.13 Within a submatrix, the (3,4) element is still on e step from the (3,3) element, and ten
steps from the (2,4) element.
As you know, /D7/CX/DE/CT/BDand /D7/CX/DE/CT/BEare simply the count of rows and columns. The/CS/CP/D8/CPpointer is a single pointer to a stream of numbers. Since memo ry addresses
are linear, the top of Figure 4.13 is closer to what is actuall y in memory: the ﬁrst
rowofdata,followedimmediatelyafterwardbythesecondro w,thenthethirdrow,
and so on, forming one long row of data. By adding line breaks, we humans can
think of this one long row of data as actually being a grid, lik e the second half of
Figure4.13.
Stepping along the row means simply stepping along by /D7/CX/DE/CT/D3/CU/B4/CS/D3/D9/CQ/D0/CT/B5 units,
andsteppingdownamatrixcolumnmeanssteppingby /D7/CX/DE/CT/D3/CU/B4/CS/D3/D9/CQ/D0/CT/B5/B6 /D7/CX/DE/CT/BE
stepsfrom thecurrentelement.Forexample,toreachthe(3, 5)elementofatenby
tenmatrix,theprocessormustskipthreerowsandthenskipﬁ veitems,soitwould
jump /D7/CX/DE/CT/D3/CU/B4/CS/D3/D9/CQ/D0/CT/B5/B6/BF/BH stepsfrom thebaseelement.
Modern computers are proactive about data gathering. When t hey read data from
slower types of memory, they also check the neighbors as well . If the code is rel-
atively predictable, the system can gather the next bit of da ta at the same time as
mand line. Between this and thecompiler’s optimization rou tines, the function call will reduce to theappropriate
array operation.
gsl_stats March24,2009
142 CHAPTER 4
it is crunching the current data element. The /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC structure works won-
derfully with suchasystem,becausestepsarepredictablea ndofﬁxedsize,sothe
processor has a good chance of correctly guessing what data t o put into its faster
caches.
Now say that we have a 100×10matrix, which would have the following infor-
mation:
size1 =100;
size2 =10;
tda = 10;
data = [location of (0,0)];
owner =1;
With /D8/CS/CPequalto /D7/CX/DE/CT/BE,jumpingdownacolumnwouldrequireajumpof /D7/CX/DE/CT/B9/D3/CU/B4/CS/D3/D9/CQ/D0/CT/B5/B6/D8/CS/CP .20
Ifwewantedtopulloutthe 4×6submatrixthatbeginsat (3,2),thentheresulting
submatrixdatawouldlooklike this:
size1 =4;
size2 =6;
tda = 10;
data = [location of (3,2)inthe original matrix];
owner =0;
Wecanusethismatrixexactlyaswiththefullmatrix:Forexa mple,togetthethird
elements in the ﬁrst row, we would step /D7/CX/DE/CT/D3/CU/B4/CS/D3/D9/CQ/D0/CT/B5 /B6 /BEforward from the
base element pointed to by /CS/CP/D8/CP, and to get to the beginning of the next column,
we would jump /D7/CX/DE/CT/D3/CU/B4/CS/D3/D9/CQ/D0/CT/B5/B6/D8/CS/CP . Thus, the process of pulling a subset of
the data merely required ﬁnding the ﬁrst point and writing do wn arbitrary limits
for /D7/CX/DE/CT/BDand /D7/CX/DE/CT/BE. No actual data was copied. This is how /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/D6/D3/DB ,/BT/C8/C7/C8/CN/CA/C7/CF , /BT/C8/C7/C8/CN/BV/C7/C4 , /BT/C8/C7/C8/CN/CB/CD/BU/C5/BT/CC/CA/C1/CG ,andothersuchroutines work.
The /D3/DB/D2/CT/D6variablenowbecomesimportant, becausetherecouldbemult iplesub-
matrices all pointing to the same data. Since the submatrix i s not the owner of its
data,theGSLwill notallowit to freethe datasetto whichit p oints.
The /CV/D7/D0/CN/DA/CT/D8/D3/D6 has a similar structure, including a starting point and a str ide to
indicatehowfarto jumpto the nextelement.Thus,taking aro w orcolumnsubset
ofamatrix alsomerelyrequireswriting downthecorrectcoo rdinatesandlengths.
The GSL’s structures are good for fast access,becausethe ne xtelement is always
20The abbreviation /D8/CS/CPstands for trailing dimension of array. For a /CV/D7/D0/CN/DA/CT/D8/D3/D6 , the analogous element is
thestride.
gsl_stats March24,2009
MATRICES AND MODELS 143
aﬁxedjumprelativetothecurrentelement,whetheryouaret raversingbyrowsor
columns. Theyare exceptionallygood for describing submat rices and subvectors,
because doing so merely requires writing down new coordinat es. They handle a
1×10,000matrix justaseasilyasa 10,000×1matrix ora 100×100matrix.
They are not good for non-contiguous subsets like the ﬁrst, s econd, and ﬁfth
columns of a data set, since the relative jumps from one colum n to the next are
notidentical.Similarly, theyarenotgoodforholdingvari oustypesofdata,where
some jumps could be /D7/CX/DE/CT/D3/CU/B4/CX/D2/D8/B5 and others could be /D7/CX/DE/CT/D3/CU/B4/CS/D3/D9/CQ/D0/CT/B5 . Also,
since space is always allocated for every element, there is n o way to efﬁciently
representsparsematrices.
Systems that deal well with variable-sized jumps have the pr os and cons reversed
from the above. For example, one solution is to let the overal l table be a list of
column vectors, where each column has its own type. But trave rsing along a row
could involve jumping all over memory, so common operations like ﬁnding the
sumforeachrow becomesa signiﬁcantlysloweroperation.
Other designers with different goals have used different me ans of representing a
datamatrix,andthe /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC isbynomeansthebestforallneeds.Butitdoes
very well for the goal of allowing the hardware to process row s and columns of
homogeneousdatawith maximalefﬁciency.
®The GSL’s matrix and vector structures are very good for efﬁc ient
computation, because each element has a ﬁxed size and is a ﬁxe d
distancefrom theneighboringelements.
®It is very easy to take contiguous subvectors or submatrices of these
structures.Doingsorequirescopyingonlyafewbitsofmeta data,but
notthedataitself.
®There is no simple way to take non-contiguous subsets of /CV/D7/D0/CN/B9/D1/CP/D8/D6/CX/CT/D7 or /CV/D7/D0/CN/DA/CT/D8/D3/D6/D7 . You will either need to copy the data
manually (i.e., using a /CU/D3/D6loop), or do the manipulations in the da-
tabasebeforeyourdatais in /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC form.
4.7 M ODELS Recall the one-sentence summary of statistical analysis fr om the
ﬁrst page of the introduction: estimate the parameters of a m odel
usingdata.TheApophenialibraryprovidesfunctionsandda tastructuresatexactly
thislevelofabstraction,intheformofthe /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 and /CP/D4/D3/D4/CN/CS/CP/D8/CP structures
andthefunctionsthatoperateonthem.
gsl_stats March24,2009
144 CHAPTER 4
You have already met the /CP/D4/D3/D4/CN/CS/CP/D8/CP structure, which lent a hand to operations
onthe matrix algebralayerofabstraction;the remainderof thechapterintroduces
the /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 structure, which providessimilar forms of strength throug h con-
straint: it encapsulates model information in a uniform man ner, allows models to
be used interchangeably in functions that can take any model as an input, and al-
lowssensibledefaultsto beﬁlledin asnecessary.
Agreatdealofstatisticalworkconsistsofconvertingorco mbiningexistingmodels
to form new ones. That is, models can be ﬁltered to produce mod els just as data
can be ﬁltered to provide new information. We can read estima tion as ﬁltering an
un-parameterized model into a parameterized one. Bayesian updating (discussed
more thoroughly on page 258) takes in a prior model, a likelih ood function, and
data, and outputs a new model—which can then be used as the inp ut to another
roundofﬁltering whennewdatacomesin.
Anotherexamplediscussedbelow,is theimposition of acons traint:beginbyesti-
mating a general model, then generate a new model with a const raint imposed on
some of the parameters, and re-estimate. The difference in l og likelihoods of the
constrainedandunconstrainedmodelscanthenbeusedforhy pothesistesting.
The structure of the model struct In the usage of this book, a model intermedi-
atesbetweendataandparameters.From there,
themodelcangoin threedirections:
i)X⇒β:Givendata,estimateparameters.
ii)β⇒X:Givenparameters,generateartiﬁcialdata(e.g.,makeran domdraws
from the model,orﬁndtheexpectedvalue).
iii)(X,β)⇒p: Given both data and parameters, estimate their likelihood or
probability.
To give a few examples, form (i) is the descriptive problem, s uch as estimating a
covariance or OLS parameters. Monte Carlo methods use form ( ii): producing a
few million draws from the model given ﬁxed parameters. Baye sian estimation is
based on form (iii), describing a posterior probability giv en both data and param-
eters,asarethelikelihoodsin a maximumlikelihoodestima tion.
Formanycommonmodels,thereare /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 salreadywritten, includingdis-
tributions likethe Normal,Multivariate Normal,Gamma,Zi pf, etcetera,andgen-
eralized linear models like OLS, WLS, probit, and logit. Bec ause they are in a
standardized form, they can be sent to model-handling funct ions, and be applied
to data in sequence.For example, you can ﬁt the data to a Gamma , a Lognormal,
and an Exponential distribution and compare the outcomes (a s in the exercise on
page257).
gsl_stats March24,2009
MATRICES AND MODELS 145
Everymodelcanbeestimatedvia aform suchas
apop_model *est= apop_estimate(data,apop_normal);
Examples of this form appear throughout the book—havea look at the code later
in this section,oronpages133,289,352,or361,for example .
Discussion of the other directions—making random draws of d ata given parame-
ters and ﬁnding likelihoods given data and parameters—will be delayed until the
chapters on Monte Carlo methods and maximum likelihood esti mation, respec-
tively.
Changing the defaults Acompletemodelincludesboththemodel’sfunctionsand
the environment in which those functions are evaluated
(Gentleman & Ihaka, 2000). The /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 thus includes both the outputs, the
functions, and everything one would need to replicate one fr om the other. For the
purposes of Apophenia’s model estimations, an N(0,1)is a separate model from
anN(1,2), andamaximumlikelihoodmodelwhoseoptimizationstepisd onevia
a conjugate gradient method is separate from an otherwise id entical model esti-
matedviaa simplexalgorithm.
Buta generic /D7/D8/D6/D9/D8indendedtoholdsettingsforallmodelsfacesthe complica-
tion that different methods of estimation require differen t settings. The choice of
conjugate gradient or simplex algorithm is meaningless for an instrumental vari-
able regression, while a list of instrumental variables mak es no sense to a maxi-
mum likelihoodsearch.
Apoheniastandard /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 structthushasanopenspaceforattachingdiffer-
ent groups of settings as needed. If the model’s defaults nee d tweaking, then you
can ﬁrst add an MLE, OLS, histogram, or other settings group, and then change
whatever details need changing within that group. Again, ex amples of the usage
and syntax of this two-step processs abound, both in online d ocumentation and
throughoutthebook,suchason pages153,339,or352.
Writing your own It would be nice if we could specify a model in a single form
and leave the computer to work out the best way to implement
all three of the directions at the head of this section, but we are rather far from
such computational nirvana. Recall the example of OLS from t he ﬁrst pages of
Chapter 1. The ﬁrst form of the model—ﬁnd the value of βsuch that (y−Xβ)2
is minimized—gave no hint that the correct form in the other d irection would be
(X′X)−1X′y. Other models, such as the probit model elaborated in Chapte r 10,
beginwith similar Xβ-type forms,buthavenoclosedform solution.
gsl_stats March24,2009
146 CHAPTER 4
Thus, writing down a model for a computable form requires wri ting down a pro-
cedure for one, two, or all three of the above directions, suc h as an /CT/D7/D8/CX/D1/CP/D8/CT
function, a /D0/D3/CV/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS and /D4(probability) function, and a /CS/D6/CP/DBfunction to
make random draws. You can ﬁll in those that you can solve in cl osed form, and
canleaveApopheniatoﬁllincomputationally-intensivede faultproceduresforthe
rest.
1#include <apop.h>
2
3apop_model new_OLS;
4
5static apop_model *new_ols_estimate( apop_data *d,apop_model *params){
6 APOP_COL(d,0, v);
7apop_data *ydata = apop_data_alloc(d −>matrix−>size1,0, 0);
8 gsl_vector_memcpy(ydata −>vector,v);
9 gsl_vector_set_all(v, 1); //afﬁne:ﬁrst column is ones.
10 apop_data *xpx =apop_dot(d,d,’t’, 0);
11 apop_data *inv= apop_matrix_to_data(apop_matrix_inverse(xpx −>matrix));
12 apop_model *out = apop_model_copy(new_OLS);
13 out−>data = d;
14 out−>parameters = apop_dot(inv,apop_dot(d, ydata,1), 0);
15 returnout;
16 }
17
18apop_model new_OLS = {.name ="A simple OLSimplementation",
19 .estimate= new_ols_estimate};
20
21intmain(){
22 apop_data *dataset = apop_text_to_data("data −regressme",0, 1);
23 apop_model *est =apop_estimate(dataset, new_OLS);
24 apop_model_show(est);
25 }
Listing4.14 Anew implementationof the OLSmodel. Online so urce: /D2/CT/DB/D3/D0/D7/BA .
For example, listing 4.14 shows a new implementation of the O LS model. The
mathbehindOLSis coveredin detailon page274.
• In thiscase,onlythe /CT/D7/D8/CX/D1/CP/D8/CT functionisspeciﬁed.
• The procedure itself is simply a matter of pulling out the ﬁr st column of data and
replacingit with ones,andcalculating (X′X)−1X′y.
• Lines12–14allocatean /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 andsetits /D4/CP/D6/CP/D1/CT/D8/CT/D6 elementtothecorrect
value. Line 13 keeps a pointer to the original data set, which is not used in this
shortprogram,butoftencomesin handy.
• The allocation of the output on line 12 needs the model, but w e have not yet de-
clared it. The solution to such circularity is to simply give a declaration of the
gsl_stats March24,2009
MATRICES AND MODELS 147
modelonline 3.
• Given the function, line 18 initializes the model itself, a process which is rather
simplethankstodesignatedinitializers (seep 32).
• Althoughthe /D1/CP/CX/D2functionisatthebottomofthisﬁle,thetypicalmodeldeser ves
its own ﬁle. By using the /D7/D8/CP/D8/CXkeyword in line ﬁve, the function name will
only be known to this ﬁle, so you can name it what you wish witho ut worrying
about cluttering up the global name space. But with is a point er to the function
in the model object itself, a routine in another ﬁle could use the /CP/D4/D3/D4/CN/D2/CT/DB/CN/B9/C7/C4/CB/BA/CT/D7/D8/CX/D1/CP/D8/CT/B4/BA/BA/BA/B5 form to call this function (which is what /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT
online 23will dointernally).
• Lines 1–3provide the completeheaderan externalﬁle would needto use the new
model,sincethe structureofthe /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 is providedin /CP/D4/D3/D4/BA/CW.
Q4.7Comparethe /D2/CT/DB/CN/C7/C4/CB modelwith the /CP/D4/D3/D4/CN/D3/D0/D7 model.
• Modify Listing4.14to declareanarrayof /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 s.Declare
theﬁrstelementto be /CP/D4/D3/D4/CN/D3/D0/D7 andthesecondtobe /D2/CT/DB/CN/C7/C4/CB.
[Thereversewon’twork, because /D2/CT/DB/CN/C7/C4/CB destroystheinputdata.]
• Write a /CU/D3/D6looptoﬁllasecondarrayofpointers-to-modelswith the
estimatefrom thetwo models.
• Calculateanddisplaythe differencebetween/CT/D7/D8/CX/D1/CP/D8/CT/CJ/BC℄/B9/BQ/D4/CP/D6/CP/D1/CT/D8/CT/D6/D7/B9/BQ/DA/CT/D8/D3/D6 and/CT/D7/D8/CX/D1/CP/D8/CT/CJ/BD℄/B9/BQ/D4/CP/D6/CP/D1/CT/D8/CT/D6/D7/B9/BQ/DA/CT/D8/D3/D6 ./F4AN EXAMPLE :NETWORK DATA The default, for models such as /CP/D4/D3/D4/CN/D3/D0/D7 or/CP/D4/D3/D4/CN/D4/D6/D3/CQ/CX/D8 , is that each row of the data is
assumed to be one observation, the ﬁrst column of the data is t he dependentvari-
able,andthe remainingcolumnsare theindependentvariabl e.
For the models that are merely a distribution, the rule that o ne row equals one
observationis notnecessary,sothedatamatrix canhaveany form:1×10,000,or
10,000×1,or100×100.Thisprovidesmaximumﬂexibilityinhowyouproduce
thedata.
But for data describing ranks (score of ﬁrst place, second pl ace, ...) things get
moreinteresting,becausesuchdataoften appearsin multip le forms. Forexample,
say that we have a classroom where every student wrote down th e ID number his
orherbestfriend, andwetallied this listofstudentnumber s:
11 22 22 34 44 67 77.
First, wewould needto counthowoften eachstudentappeared :
gsl_stats March24,2009
148 CHAPTER 4
id_nocount
2 4
4 3
7 3
1 2
3 1
6 1.
In SQL:
selectid_no,count(*)asct
fromsurveys
groupby id_no
order by ctdesc
If we were talking about city sizes (another favorite for ran k-type analysis), we
would list the size of the largest city, the second largest, e t cetera. The labels are
not relevant to the analysis; you would simply send the row of counts for most
popular,secondmostpopular,etcetera:
43 32 11.
Each row of the data set would be one classroom like the above, and the column
numberrepresentstherankingbeingtallied.
As mentioned above, you can add groups of settings to a model t o tweak its be-
havior.Inthe caseofthe modelscommonlyusedfor rankanaly sis,youcansignal
to themodelthatit will begettingrank-ordereddata.Forex ample:
apop_model *rank_version = apop_model_copy(apop_zipf);
Apop_settings_add_group (rank_version, apop_rank,NULL );
apop_model_show(apop_estimate(ranked_draws, rank_ver sion));
Alternatively, some data sets are provided with one entry li sting the rank for each
observation.Therewouldbefour1’s, three2’s,three 3’s,e tcetera:
11 11 22 23 33 44 55.
In the city-size example, imagine drawing people uniformly at random from all
cities, and then writing down whether each person drawn is fr om the largest city,
thesecondlargest, etcetera.Here,orderofthewritten-do wndatadoesnotmatter.
Youcanpassthis datadirectly to the variousestimationrou tines withoutaddinga
groupofsettings;e.g., /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT/B4 /D6/CP/D2/CZ/CT/CS/CN/CS/D6/CP/DB/D7 /B8 /CP/D4/D3/D4/CN/CV/CP/D1/D1/CP/B5 .
gsl_stats March24,2009
MATRICES AND MODELS 149
Q4.8The /D2/D3/D1/CX/D2/CT/CT columnintheﬁle /CS/CP/D8/CP/B9/D0/CP/D7/D7/D6/D3/D3/D1 isexactlythesortofdata
onwhichonewouldruna networkdensityanalysis.
• Readthedatainto adatabase.
• Querythevectorofrankstoan /CP/D4/D3/D4/CN/CS/CP/D8/CP set,usingaquerylikethe
oneabove.
• Transpose the matrix ( hint: /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/D8/D6/CP/D2/D7/D4/D3/D7/CT/CN/D1/CT/D1/D4/DD ), be-
cause /CP/D4/D3/D4/CN/DE/CX/D4/CU ’s /CT/D7/D8/CX/D1/CP/D8/CT functionrequireseachclassroomtobe
a row, with the nth-ranked in the nth column. This data set includes
onlyoneclassroom,soyouwill haveonlyonerowofdata.
• Call /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT/B4 /DD/D3/D9/D6/CS/CP/D8/CP /B8 /CP/D4/D3/D4/CN/DE/CX/D4/CU/B5 ; show the resulting
estimate.Howwelldoesthe Zipfmodelﬁtthe data?/F4MLEMODELS To give some examples from a different style of model, here ar e
some notes on writing models based on a maximum likelihood
estimation.
• Write alikelihoodfunction.Its headerwill looklike this :
static double apop_new_log_likelihood( gsl_vector *beta,apop_data *d)
Here, /CQ/CT/D8/CPholdsthe parametersto be maximizedand /CSis the ﬁxedparameters—
the data. This function will return the value of the log likel ihood function at the
givenparametersanddata.
In some cases, it is more natural to express probabilities in log form, and some-
times in terms of a plain probability; use the one that works b est, and most func-
tionswill calculatetheotherasneeded.
• Declarethemodelitself:
apop_model new_model ={"The Me distribution",2, 0,0,
.log_likelihood = new_log_likelihood };
–If you are using a probability instead of a log likelihood, ho ok it into your
modelwith /BA/D4 /BP /D2/CT/DB/CN/D4.
–The three numbers after the name are the size of the parameter structure,
using the same format as /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/CP/D0/D0/D3 : size of vector, rows in ma-
trix, then columns in matrix. If any of these is /B9/BD, then the /B9/BDwill be re-
placedwiththenumberofcolumnsintheinputdataset’smatr ix(i.e., /DD/D3/D9/D6/CN/B9
gsl_stats March24,2009
150 CHAPTER 4/CS/CP/D8/CP /B9/BQ/D1/CP/D8/D6/CX/DC/B9/BQ/D7/CX/DE/CT/BE ).21This is what you would use for an OLS regres-
sion,forexample,wherethereis oneparameterperindepend entvariable.
With thislittle, acalllike /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT/B4 /DD/D3/D9/D6/CN/CS/CP/D8/CP /B8 /D2/CT/DB/CN/D1/D3/CS/CT/D0/B5 will work,
because /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT defaults to doing a maximum likelihood search if there
isno explicitly-speciﬁed /D2/CT/DB/CN/D1/D3/CS/CT/D0/BA/CT/D7/D8/CX/D1/CP/D8/CT function.
• For better estimations, write a gradient for the log likeli hood function. If you do
not provide a closed-form gradient function, then the syste m will ﬁll in the blank
by numerically estimating gradients, which is slower and ha s less precision. Cal-
culating the closed-form gradient is usually not all that ha rd anyway, typically
requiringjustafewderivatives.SeeListing4.17(oranyex isting /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 )for
anexampleshowingthedetailsofsyntax.
SETTING CONSTRAINTS A constraint could either be imposed because the author
ofthemodeldeclaredanarbitrarycutoff(‘wecan’tspend
more than $1,000.’) or because evaluating the likelihood fu nction fails ( ln(−1)).
Thus,thesystemneedstosearchneartheborder,withouteve rgoingpastit, andit
needs to be able to arbitrarily impose a constraint on an othe rwise unconstrained
function.
Apophenia’s solution is to add a constraint function that ge ts checked before the
actual function is evaluated. It does two things if the const raint is violated: it
nudges the point to be evaluated into the valid area, and it im poses a penalty to
be subtracted from the ﬁnal likelihood, so the system will kn ow it is not yet at an
optimum. The unconstrained maximization routines will the n have a continuous
functionto searchbutwill neverﬁndan optimumbeyondthepa rameterlimits.22
To give a concrete example, Listing 4.15 adds to the /CP/D4/D3/D4/CN/D2/D3/D6/D1/CP/D0 model a con-
straint function that will ensure that both parameters of a t wo-dimensional input
aregreaterthan givenvalues.
Observe how the constraint function manages all of the requi site steps. First, it
checks the constraints and quickly returns zero if none of th em binds. Then, if
theydo bind,it setsthe return vectorto just insidethe cons trainedregion.Finally,
it returns the distance (on the Manhattan metric ) between the input point and the
pointreturned.23Theunconstrainedevaluationsystemshouldrepeatedlytry points
closer and closer to the zero-penalty point, and the penalty will continuously de-
clineasweapproachthatpoint.
21if your model has a more exotic parameter count that needs to b e determined at run-time, use the /D4/D6/CT/D4
method of the /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 to do the allocation.
22Thisisakintothecommonpenalty functionmethodsofturnin gaconstrained problemintoanunconstrained
one,asinAvriel(2003),buttheformaltechniqueascommonl yexplained involvesaseriesofoptimizations where
the penalty approaches zero as the series progresses. It is h ard to get a computer to ﬁnd the limit of a sequence;
thebestyoucould expect would beaseries ofestimations wit hdecreasing penalties; /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT/CN/D6/CT/D7/D8/CP/D6/D8
can help with the process.
23Ifyou need to calculate thedistance to apointin yourown con straint functions, seeeither /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/B9/CS/CX/D7/D8/CP/D2/CT or /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/CV/D6/CX/CS/CN/CS/CX/D7/D8/CP /D2/CT .
gsl_stats March24,2009
MATRICES AND MODELS 151
1#include <apop.h>
2
3doublelinear_constraint( apop_data *d,apop_model *m){
4doublelimit0= 2.5,
5 limit1= 0,
6 tolerance = 1e −3;//or try GSL_EPSILON_DOUBLE
7doublebeta0 =apop_data_get(m −>parameters,0,−1),
8 beta1= apop_data_get(m −>parameters, 1,−1);
9if(beta0> limit0&& beta1> limit1)
10 return0;
11 //else create avalidreturn vector and return apenalty.
12 apop_data_set(m −>parameters,0,−1,GSL_MAX(limit0+ tolerance, beta0));
13 apop_data_set(m −>parameters,1,−1,GSL_MAX(limit1+ tolerance,beta1));
14 returnGSL_MAX(limit0+ tolerance −beta0,0)
15 + GSL_MAX(limit1+tolerance −beta1,0);
16 }
17
18intmain(){
19apop_model *constrained = apop_model_copy(apop_normal);
20 constrained−>estimate =NULL;
21 constrained−>constraint = linear_constraint;
22 apop_db_open("data −climate.db");
23 apop_data *dataset = apop_query_to_data("selectpcp from precip");
24 apop_model *free = apop_estimate(dataset,apop_normal);
25 apop_model *constr = apop_estimate(dataset, *constrained);
26 apop_model_show(free);
27 apop_model_show(constr);
28 doubletest_stat = 2 *(free−>llikelihood−constr−>llikelihood);
29 printf("Reject the null (constraint has no effect)with% g%% conﬁdence\n",
gsl_cdf_chisq_P(test_stat,1) *100);
30 }
Listing4.15 An optimization, a constrained optimization, and a likelihood ratio test comparing the
two. Online source: /D2/D3/D6/D1/CP/D0/D0/D6/BA .
Intherealworld,setlinearconstraintsusingthe /CP/D4/D3/D4/CN/D0/CX/D2/CT/CP/D6/CN/D3/D2/D7/D8/D6/CP/CX/D2/D8 func-
tion, which takes in a set of contrasts (as in the form of the Ftest) and does all
the requisitework from there.Foranexampleof its use,have a lookatthe budget
constraintin Listing4.17.
The /D1/CP/CX/D2portionoftheprogramdoesalikelihoodratiotestcomparin gconstrained
andunconstrainedversionsoftheNormaldistribution.
• Lines 19–21 copy off the basic Normal model, and add the cons traint function to
thecopy.The /CT/D7/D8/CX/D1/CP/D8/CT routinefortheNormaldoesn’tuseanyconstraint,soitis
invalid inthe unconstrainedcase,soline 20erasesit.
• Lacking an explicit /CT/D7/D8/CX/D1/CP/D8/CT routine in the model, line 25 resorts to maximum
likelihood estimation (MLE). The MLE routine takes the mode l’s constraint into
gsl_stats March24,2009
152 CHAPTER 4
account.
• Lines 28–29 are the hypothesis test. Basically, twice the d ifference in log likeli-
hoodshasa χ2distribution;page350coversthedetails.
AN EXAMPLE :UTILITY MAXIMIZATION The process of maximizing a function
subjecttoconstraintsisusedextensively
outside of statistical applications, such as for economic a gents maximizing their
welfareorphysicalsystemsmaximizingtheirentropy.With littleabuseoftheopti-
mizationroutines,youcouldusethemtosolveanymodelinvo lvingmaximization
subject to constraints. This section gives an extended exam ple that numerically
solvesanEcon101-styleutility maximizationproblem.
The consumer’s utility from a consumption pair (x1,x2)isU=xα
1xβ
2. Given
prices P1andP2andBdollars in cash, she has a budget constraint that requires
P1x1+P2x2≤B.Hergoalistomaximizeutilitysubjecttoherbudgetconstr aint.
Thedata(i.e.,the /CP/D4/D3/D4/CN/CS/CP/D8/CP setofﬁxedelements)willhaveaone-elementvector
anda2×2matrix, structuredlike this:/bracketleftbiggbudget price 1α
price 2β/bracketrightbigg
.
Once the models are written down, the estimation is one funct ion call, and calcu-
latingthemarginalvaluesisonemore.Overall,theprogram isoverkillforaprob-
lem that can be solved via two derivatives, but the same frame work can be used
for problems with no analytic solutions (such as for consume rs with a stochastic
utility functionordynamicoptimizationswith nograceful closedform).
Because the estimation ﬁnds the slopes at the optimum, it giv es us comparative
statics,answeringquestionsaboutthechangeintheﬁnalde cisiongivenamarginal
risein price P1orP2(orboth).
Listing 4.16 shows the model via numerical optimization, an d because the model
issosimple, Listing4.17showstheanalyticversionofthe m odel.
• The /CT/D3/D2/BD/BC/BD/CN/CT/D7/D8/CX/D1/CP/D8/CT routine just sets some optimization settings and calls/CP/D4/D3/D4/CN/D1/CP/DC/CX/D1/D9/D1/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS .
• The budget constraint, in turn, is a shell for /CP/D4/D3/D4/CN/D0/CX/D2/CT/CP/D6/CN/D3/D2/D7/D8/D6/CP/CX/D2/D8 . That
function requires a constraint matrix, which will look much like the matrix of
equationssentinto the Ftestsonpage310.In this case,the equationsare

−budget <−p1β1−p2β2
0 < β 1
0 < β 2
.
All inequalities are in less-thanform, meaningthat the ﬁrs t—the costof goodsis
gsl_stats March24,2009
MATRICES AND MODELS 153
#include <apop.h>
apop_model econ_101;
static apop_model *econ101_estimate( apop_data *choice,apop_model *p){
Apop_settings_add_group(p,apop_mle,p);
Apop_settings_add(p,apop_mle,tolerance, 1e −4);
Apop_settings_add(p,apop_mle,step_size, 1e −2);
returnapop_maximum_likelihood(choice, *p);
}
static double budget(apop_data *beta,apop_model *m){
doubleprice0 =apop_data_get(m −>data, 0, 0),
price1 = apop_data_get(m −>data,1, 0),
cash = apop_data_get(m −>data,0,−1);
apop_data *constraint = apop_data_alloc(3,3, 2);
apop_data_ﬁll(constraint,
−cash,−price0,−price1,
0., 1.,0.,
0., 0.,1.);
returnapop_linear_constraint(m −>parameters−>vector, constraint, 0);
}
static double econ101_p( apop_data *d,apop_model *m){
doublealpha =apop_data_get(d, 0, 1),
beta = apop_data_get(d,1, 1),
qty0= apop_data_get(m −>parameters,0,−1),
qty1= apop_data_get(m −>parameters,1,−1);
returnpow(qty0,alpha) *pow(qty1, beta);
}
apop_model econ_101 = {"MaxCobb −Douglass subject toa budget constraint", 2,0, 0,
.estimate = econ101_estimate,.p=econ101_p, .constraint = budget};
Listing4.16 Anagent maximizes itsutility.Online source: /CT/D3/D2/BD/BC/BD/BA .
less than the budget—had to be negated. However, the next two statemets, β1is
positiveand β2ispositive,arenaturalandeasytoexpressintheseterms.C onvert-
ingthis systemofinequalitiesinto thefamiliar vector/ma trix pairgives

−budget−p1−p2
0 1 0
0 0 1
.
• The budget consraint as listed has a memory leak that you won ’t notice at this
scale: it re-speciﬁes the constraint every time. For larger projects, you can ensure
that /D3/D2/D7/D8/D6/CP/CX/D2/D8 is only allocated once by declaring it as /D7/D8/CP/D8/CXand initially
settingit to /C6/CD/C4/C4,thenallocatingit onlyif it isnot /C6/CD/C4/C4.
• The analytic version of the model in Listing 4.17 is a straig htforward translation
gsl_stats March24,2009
154 CHAPTER 4
#include <apop.h>
apop_model econ_101_analytic;
apop_model econ_101;
#deﬁnefget(r,c)apop_data_get(ﬁxed_params, (r), (c))
static apop_model *econ101_analytic_est( apop_data *ﬁxed_params, apop_model *pin){
apop_model *est= apop_model_copy(econ_101_analytic);
doublebudget = fget(0,−1),p1 = fget(0,0),p2= fget(1, 0),
alpha = fget(0, 1),beta = fget(1, 1);
doublex2= budget/(alpha/beta + 1)/p2,
x1 = (budget−p2*x2)/p1;
est−>data =ﬁxed_params;
est−>parameters = apop_data_alloc(2,0,0);
apop_data_ﬁll(est−>parameters,x1,x2);
est−>llikelihood = log(econ_101.p(ﬁxed_params, est));
returnest;
}
static void econ101_analytic_score( apop_data *ﬁxed_params, gsl_vector *gradient,
apop_model *m){
doublex1= apop_data_get(m −>parameters,0,−1);
doublex2= apop_data_get(m −>parameters,1,−1);
doublealpha = fget(0, 1), beta = fget(1,1);
gsl_vector_set(gradient,0, alpha *pow(x1,alpha−1)*pow(x2,beta));
gsl_vector_set(gradient,1, beta *pow(x2,beta−1)*pow(x1,alpha));
}
apop_model econ_101_analytic = {"Analyticallysolve Cobb −Douglass maximization subject
toa budget constraint",
.vbase =2, .estimate=econ101_analytic_est, .score =econ 101_analytic_score};
Listing4.17 The analytic version. Online source: /CT/D3/D2/BD/BC/BD/BA/CP/D2/CP/D0/DD/D8/CX/BA .
of the solution to the constrained optimization. If you are f amiliar with Lagrange
multipliers you should have little difﬁculty in verifying t he equations expressed
bytheroutines.Theroutines arein thenaturalslotsfor est imatingparametersand
estimatingthe vectorofparameterderivatives.
• The term scoreis deﬁned in Chapter 10, at which point you will notice that it s
use here is something of an abuse of notation, because the sco re is deﬁned as the
derivativeofthelog-utilityfunction,whilethefunction hereisthederivativeofthe
utility function.
• The preprocessor can sometimes provide quick convenience s; here it abbreviates
thelong functioncall to pullparametersto /CU/CV/CT/D8. Section6.4(page211)givesthe
detailsofthepreprocessor’suseandmanycaveats.
• Theprocessofwrappinglibraryfunctionsinstandardized modelroutines,andoth-
gsl_stats March24,2009
MATRICES AND MODELS 155
#include <apop.h>
apop_model econ_101,econ_101_analytic;
voidest_and_score( apop_model m,apop_data *params){
gsl_vector *marginals =gsl_vector_alloc(2);
apop_model *e =apop_estimate(params,m);
apop_model_show(e);
printf("\nThe marginal values:\n");
apop_score(params,marginals, e);
apop_vector_show(marginals);
printf("\nThe maximized utility: %g\n",exp(e −>llikelihood));
}
intmain(){
doubleparam_array[]= {8.4, 1,0.4,
0, 3, 0.6}; //0is justadummy.
apop_data *params = apop_line_to_data(param_array,2,2,2);
sprintf(apop_opts.output_delimiter,"\n");
est_and_score(econ_101, params);
est_and_score(econ_101_analytic, params);
}
Listing4.18 Given the models, the /D1/CP/CX/D2program is but a series of calls. Online source:/CT/D3/D2/BD/BC/BD/BA/D1/CP/CX/D2/BA .
erwiseputtingeverythinginitsplace,paysoffinthe /D1/CP/CX/D2functioninListing4.18.
Notably, the /CT/D7/D8/CN/CP/D2/CS/CN/D7/D3/D6/CT function can run without knowing anything about
modelinternals,andcanthusrunonboththeclosed-formand numeric-searchver-
sionsofthemodel.Italsodisplaysthemaximizedutility,b ecause—continuingthe
metaphorthatlikelihood=utility—the /CT/D3/D2/BD/BC/BD model’smaximizationreturnedthe
logutility inthe /D0/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS elementofthe outputmodel.
• The /CT/D3/D2/BD/BC/BD/BA/CP/D2/CP/D0/DD/D8/CX modelcalculatestheparameterswithoutcalculatingutil-
ity, but there is no need to write a separate calculation to ﬁl l it in—just call the
utility calculation from the /CT/D3/D2/BD/BC/BD model. Thanks to such re-calling of other
models’functions,itis easyto producevariantsofexistin gmodels.
• The only public parts of /CT/D3/D2/BD/BC/BD/BA and /CT/D3/D2/BD/BC/BD/BA/CP/D2/CP/D0/DD/D8/CX/BA are the models,
so we don’t have to bother with a header ﬁle, and can instead si mply declare the
modelsthemselvesatthetop of /CT/D3/D2/BD/BC/BD/BA/D1/CP/CX/D2/BA .
• Themodelﬁleswillbecompiledseparately,andalllinkedt ogether,usingaMake-
ﬁleasperAppendixA,with an /C7/BU/C2/BX/BV/CC/CB line listing all three /BA/D3ﬁles.
Q4.9Useoneofthemodelstoproduceaplotofmarginalchangein x0andx1as
αexpands.
gsl_stats March24,2009
156 CHAPTER 4
®The /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 aggregatesmethodsof estimating parameters from
data,drawingdatagivenparameters,andestimatinglikeli hoodsgiven
both.
®Most /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 s take in a data structure with an observation on
each row and a variable on each column. If the model includes a de-
pendentvariable,it shouldbethe ﬁrstcolumn.
®Given a prepackaged model, you can estimate the parameters o f the
model by putting your data into an appropriate /CP/D4/D3/D4/CN/CS/CP/D8/CP struc-
ture, and then using /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT/B4/CS/CP/D8/CP/B8 /DD/D3/D9/D6/CN/D1/D3/CS/CT/D0/B5 . This
will produce an /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 that you can interrogate or display on
screen.
®If closed-form calculations for any of the model elements ar e avail-
able, then by all means write them in to the model. But the vari ous
functions that take /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 s as input make their best effort to
ﬁll in the missing methods. For example, the score function i s not
mandatoryto usegradient-basedoptimization methods.
gsl_stats March24,2009
5
GRAPHICS
Graphs are friendly.
—Tukey(1977, p157)
Graphics is one of the places where the computing world has no t yet agreed on a
standard, and so instead there are a dozen standards, includ ing JPG, PNG, PDF,
GIF, and many other TLAs. You may ﬁnd yourself in front of a com puter that
readilyhandleseverything,includingquickdisplaystoth escreen,oryoumayﬁnd
yourself logging in remotely to a command-line at the univer sity’s servers, that
support only SVG graphics. Some journals insist on all graph ics being in EPS
format, andothersrequireJPGsandGIFs.
The solution to the graphics portability problem is to use a h andful of external
programs, easily available via your package manager, that t ake in plain text and
output an image in any of the panoply of graphics formats. The text-to-graphics
programshereareasopenandfreelyavailableasgcc,soyouc anbeconﬁdentthat
yourcodewill beportableto newcomputers.1
But this chapteris notjust abouta few plotting programs:it is abouthow you can
controlany text-drivenprogram from within C. If you prefer to creategraphics or
do other portions of your analytic pipeline using a separate package (like one of
thestats packageslisted in the introduction),thenyoucan usethetechniqueshere
to doso.
1There is some politics about how this is not strictly true: th e maintainers of Gnuplot will not allow you to
modifytheir codeandthendistribute themodiﬁedpackage in dependently (i.e.,to forkthecodebase).Theproject
is entirely unrelated to the GNU project, and the name is simp ly a compromise between the names that the two
main authors preferred: nplot and llamaplot.
gsl_stats March24,2009
158 CHAPTER 5
Appendix B takes a different approach to converting data to a n executable script,
viacommand-linetoolstomodifytext.Ifyourdataisnotgoi ngthroughanycom-
putations or transformations, you may be better off using a s hell script as per Ap-
pendixB insteadofwriting aC programasperthis chapter.
The plot-producing program with which this chapter will pri marily be concerned
isGnuplot.Its languagebasicallyhasonlytwoverbs— /D7/CT/D8and /D4/D0/D3/D8—plus afew
variants ( /D9/D2/D7/CT/D8, /D6/CT/D4/D0/D3/D8, et cetera). To give you a feel for the language, here is a
typicalGnuplotscript;youcanseethatit consistsof astri ng of /D7/CT/D8commandsto
eliminate the legend, set the title, et cetera, and a ﬁnal /D4/D0/D3/D8command to do the
actualwork.
unset key
set title"USnational debt"
set termpostscript color
set out ’debt.eps’
plot ’data−debt’withlines
In the code supplement, you will ﬁnd the /D4/D0/D3/D8/D7ﬁle, which provides many of the
plots in this chapterin cut-and-paste-ableform. Youwill a lsoﬁnd the /CS/CP/D8/CP/B9/CS/CT/CQ/D8
ﬁleplottedinthisexample.Butﬁrst,hereareafewwordsont hevariousmeansof
sendingtheseplotsamplesto Gnuplot.
PRELIMINARIES As with SQLite or mySQL, there is a command-line interpreter
for Gnuplot’s commands ( /CV/D2/D9/D4/D0/D3/D8), so you can interactively try
different /D7/CT/D8commands to see what options look best. After you have ﬁnishe d
shopping for the best settings, you can put them into a script that will always
producethe perfect plot, or better still, write a C program t o autogeneratea script
thatwillalwaysproducethe perfectplot.
There are various ways by which you can get Gnuplot to read com mands from a
script(e.g.,a ﬁlenamed /D4/D0/D3/D8/D1/CT).
• From the shell command line, run /CV/D2/D9/D4/D0/D3/D8 /B9/D4/CT/D6/D7/CX/D7/D8 /BO /D4/D0/D3/D8/D1/CT. This runs the
script and exits, but the plot persists on the screen. Withou t the /B9/D4/CT/D6/D7/CX/D7/D8 option,
the plot will disappear after a split second. If you are writi ng to a ﬁle rather than
lookingatthe plotonscreen,thenthe /B9/D4/CT/D6/D7/CX/D7/D8 optionis unnecessary.
• Run /CV/D2/D9/D4/D0/D3/D8 with no options, and from its prompt, type /D0/D3/CP/CS /B3/D4/D0/D3/D8/D1/CT/B3 . This
leavesyouatthe Gnuplotpromptto experimentwith settings .
• The hybrid: /CV/D2/D9/D4/D0/D3/D8 /D4/D0/D3/D8/D1/CT /B9from the command line. This executes the in-
structions in /D4/D0/D3/D8/D1/CT, but leaves you at the Gnuplot prompt to play with different
settings.
gsl_stats March24,2009
GRAPHICS 159/D7/CT/D8 /D8/CT/D6/D1 /BA/BA/BAMeaning Outputgoal/DC/BD/BDWindow system;mostPOSIX OSes displayon screen/DB/CX/D2/CS/D3/DB/D7 Window system;WindowsOSes displayon screen/CP/D5/D9/CPWindow system;MacOSX displayon screen/D4/D2/CVPortable networkgraphics browser/CV/CX/CUGraphicsinterchangeformat browser,wordprocessor/D7/DA/CVscalablevectorgraphics browser,wordprocessor/D4/D7Postscriptorencapsulatedpostscript PDF/D0/CP/D8/CT/DCLATEX graphicssub-language L ATEX docs
Table 5.1 Some of the terminal types that Gnuplot supports.
IfyouareataGnuplotprompt,youcanexitviaeitherthe /CT/DC/CX/D8commandor <ctrl-
d>.Onmanysystems,youcanalsointeractwiththeplot,spinni ng3-Dplotswith
themouseorzoomingin to selectedsubregionsof2-D plots.
Q5.1Check your Gnuplot installation. Write a one-line text ﬁle n amed /D4/D0/D3/D8/D1/CT
whose text reads: /D4/D0/D3/D8 /D7/CX/D2/B4/DC/B5. Execute the script using one of the above
methods.Oncethatworks,try thenationaldebtexampleabov e.
Ifyoursystemisunabletodisplayplotstothescreen,reado nforalternative
outputformats./D7/CT/D8 /D8/CT/D6/D1AND /D7/CT/D8 /D3/D9/D8Gnuplot defaults to putting plots on the screen, which is
useful for looking at data, but is not necessarily useful for
communicating with peers. Still worse, some systems are not even capable of
screenoutput.Therearemanypotentialsolutionsto thepro blem.
The /D7/CT/D8 /D8/CT/D6/D1/CX/D2/CP/D0 command dictates the language with which to write the out-
put. Table 5.1 presents the more common options, and Gnuplot ’s help system de-
scribes the deatils regarding each of them; e.g., /CW/CT/D0/D4 /D7/CT/D8 /D8/CT/D6/D1 /D0/CP/D8/CT/DCor /CW/CT/D0/D4/D7/CT/D8 /D8/CT/D6/D1 /D4/D3/D7/D8/D7/D6/CX/D4/D8 .Thedefaultistypicallytheon-screenformatappropriate
foryoursystem.2
The /D7/CT/D8 /D3/D9/D8commandprovidesaﬁlenametowriteto.Forexample,ifaGnup lot
ﬁlehas
set term postscript color
set out ’a_plot.eps’
2The popular JPG format is not listed because its compression is designed to work well with photographic
images, and makes lines and text look fuzzy. Useit for plots a nd graphs only as a lastresort.
gsl_stats March24,2009
160 CHAPTER 5
at its head, then the script will not display to the screen and will instead write the
designatedﬁle, inPostscriptformat.
Comments
Gnuplot follows the commenting standards of many
scripting languages: everything on a line after a # is
ignored. For example, ifa script begins with/AZ/D7/CT/D8 /D8/CT/D6/D1/CX/D2/CP/D0 /D4/D3/D7/D8/D7/D6/CX/D4/D8 /D3/D0/D3/D6/AZ/D7/CT/D8 /D3/D9/D8 /B3/D4/D6/CX/D2/D8/D1/CT/BA/CT/D4/D7/B3
then these lines are ignored, and Gnuplot will display
plotsonthescreenasusual.Ifyoulaterdecidetoprint
the plot,you can delete the #s and the script willwrite
to /D4/D6/CX/D2/D8/D1/CT/BA/CT/D4/D7 .You can rest assured that no mat-
ter where you are, there is some
way to view graphics, but it may
take some experimentation to ﬁnd
out how. For example, if you are
dialing in to a remote server, you
may be able to copy the graphics to
a /D4/D9/CQ/D0/CX/CN/CW/D8/D1/D0 directory, make the
ﬁle publicly readable ( /CW/D1/D3/CS /BI/BG/BG/D4/D0/D3/D8/BA/D4/D2/CV ) and then view the plot
from a web browser. Or, you could
produce Postscript output, and then run /D4/D7/BE/D4/CS/CUto produe a PDF ﬁle, which you
canopenviayourfamiliar PDF viewer.
Nowthatyouknowhowto runa Gnuplotscriptandviewits outpu t,we canmove
onto whatto putinthe script.
5.1 /D4/D0/D3/D8The /D4/D0/D3/D8commandwill setthebasicshapeoftheplot.
To plot a basic scatterplot of the ﬁrst two columns of data in a ﬁle, such as the/CS/CP/D8/CP/B9/CS/CT/CQ/D8 ﬁle in theonlinecodesupplement,simply use /D4/D0/D3/D8 /B3/CS/CP/D8/CP/B9/CS/CT/CQ/D8/B3 .
You will often dump more columns of data to your dataﬁle than a re necessary.
For example, the ﬁrst portion of the /CS/CP/D8/CP/B9/CS/CT/CQ/D8 ﬁle includes three columns: the
year, the debt, and the deﬁcit. To plot only the ﬁrst and third columns of data,
use /D4/D0/D3/D8 /B3/CS/CP/D8/CP/CU/CX/D0/CT/B3 /D9/D7/CX/D2/CV /BD/BM/BF. This produces a scatterplot with Xvalues
from column one and Yvalues from column 3. Notice that Gnuplot uses index
numberinginsteadofoffsetnumbering:the ﬁrstcolumnis on e,notzero.
Say that you just want to see a single data series, maybe colum n three; then /D4/D0/D3/D8/B3/CS/CP/D8/CP/CU/CX/D0/CT/B3 /D9/D7/CX/D2/CV /BF.Withonlyonecolumngiven,theplotwillassumethatthe
Xvaluesarethe ordinalseries 1,2,3,...andyourdataarethe Yvalues./D6/CT/D4/D0/D3/D8 You will often want multiple data sets on the same plot, and Gn uplot does
this easily using the /D6/CT/D4/D0/D3/D8command. Just change every use of /D4/D0/D3/D8after
theﬁrstto /D6/CT/D4/D0/D3/D8.Page170presentsa fewmore notesonusingthis function.
gsl_stats March24,2009
GRAPHICS 161
set xrange [−4:6]
plot sin(x)
replot cos(x)
replot log(x) +2 *x−0.5*x**2
• Gnuplot always understands the variable xto refer to the ﬁrst axis and yto the
second. If you are doing a parametric plot (see the example in Figure 11.4, page
360),thenyouwill beusingthevariables t,u,andv.
• GnuplotknowsallofthefunctionsinthestandardCmathlib rary.Forexample,the
abovesequencewillproduceasetofpleasingcurves.Notice that /DC/B6/B6/BEiscommon
math-packagenotationfor x2./D7/D4/D0/D3/D8The /D4/D0/D3/D8commandprintsﬂat,2-Dplots.Toplot3-Dsurfaces,use /D7/D4/D0/D3/D8.All
of the above applies directly, but with three dimensions. If your data set has
three columns, then you can plot it with /D7/D4/D0/D3/D8 /B3 /CS/CP/D8/CP/CU/CX/D0/CT /B3. If your data set has
more than three columns, then specify the three you want with a form like /D7/D4/D0/D3/D8/B3 /CS/CP/D8/CP/CU/CX/D0/CT /B3 /D9/D7/CX/D2/CV /BD/BM/BH/BM/BG.
• There is also the crosstab-like case where the data’s row an d column dimensions
represent the XandYaxes directly: the (1,1)stelement in the data ﬁle is the
height at the Southwest corner of the plot, and the (n,n)thelement is the height
attheNortheastcorner.Toplotsuchdata,use /D7/D4/D0/D3/D8 /B3 /CS/CP/D8/CP/CU/CX/D0/CT /B3 /D1/CP/D8/D6/CX/DC.
• Surface plotting goes hand-in-hand with the /D4/D1/BF/CS(palette-mapped 3-D) option,
that produces a pleasing color-gradient surface. For examp le, here is a simple ex-
ample that produces the sort of plot used in advertisements f or math programs.
Again, if you run this from the Gnuplotprompt and a systemtha t supports it, you
shouldbeableto usethemouseto spinthe plot.
set pm3d
splot sin(x) *cos(y) withpm3d
Hereisamoreextendedscript,usedtoproduceFigure5.2.[T hisexampleappears
in a slightly-modiﬁed form in /CP/CV/CT/D2/D8/CV/D6/CX/CS/BA/CV/D2/D9/D4/D0/D3/D8 in the code supplement. The
simulationthatproduceditis availableuponrequest.]
1setterm postscript color;
2setout ’plot.eps’;
3setpm3d;#for the contour map,use set pm3d map;
4unsetcolorbox
5setxlabel ’percent acting’; setylabel ’value of emulation (n)’;
gsl_stats March24,2009
162 CHAPTER 5
percent acting value of emulation (n) 
1 0.75 0.5 0.25 01.2 
1
0.8 
0.6 
0.4 
0.2 
0
10.75 0.5 0.25 01.2 
1
0.8 
0.6 
0.4 
0.2 
0 0  20  40  60  80  100  120 
percent acting value of emulation (n) 
Figure 5.2 Twoviewsofthesamedensityplotfromafewthousa ndsimulationsofagroupofagents.
Agents act iff ti+nki> C, where tiis a Normally distributed private preference,
kiis the percentage of other people acting, nis the agent’s preference for emulating
others, and Cis a Uniformly-distributed cutoff. The vertical axis shows the density of
simulations withthe givenpercent actingandvalue of n.Whenthe value of emulationis
low,outcomes areunimodallydistributed,butoutcomesbec omebimodallydistributedas
emulation becomes more valuable.
6setpalette gray;
7setxtics (’0’0,’0.25’ 250,’0.5’ 500,’0.75’ 750, ’1’999);
8setytics (’0’0, ’0.2’ 1, ’0.4’2, ’0.6’ 3, ’0.8’ 4,’1’ 5, ’1.2’ 6)
9 splot ’dataﬁle’matrixwithpm3d
• Lines one and two send the outputto a Postscript ﬁle instead of the screen.Given
line six,the /D3/D0/D3/D6modiﬁeris optionalin this case.
• Line three tells Gnuplot to prepare for a palette-mappedsu rface, and is necessary
beforethe /D7/D4/D0/D3/D8commandonline nine.
• Linefourdeletesthe legend,whichinthe pm3dcaseis known asthecolorbox.
• Line ﬁve sets the labels, and demonstrates that Gnuplot com mands may put each
either on a separate line or separated with a semicolon. As yo u can see from this
script,endingaline with a semicolonis optional.
• Line six sets the color scheme to something appropriate for a book printed in
black and white. There are many palettes to be had; the defaul t, omitting the /D7/CT/D8/D4/CP/D0/CT/D8/D8/CT line entirely, worksformostpurposes.
• Lines seven and eight ﬁx the axis labels, because Gnuplot de faults to using the
indexofthe columnorrow asthelabel. Theformatrequiresat extlabel,followed
bytheindexatwhichthe labelwill beplaced;seebelowforfu rther notes.
• Changing line three to /D7/CT/D8 /D4/D1/BF/CS /D1/CP/D4produces an overhead view of the same
surface,sometimesknownasa contourplot , asin thesecondplotofFigure 5.2.
gsl_stats March24,2009
GRAPHICS 163
The short version Thesamplelinesabovewereallrelativelybrief,butyoucan put
a hugeamountofinformation ontooneline.Forexample,
set style data bars
set style functionlines
set linetype 3
set xrange [−10:10]
set yrange [0:2]
plot ’data’using 1:3title’data’
replot sin(x)title’sine’
#can be rewrittenas:
plot ’data’using 1:3[ −10:10][0:2] withbars title’data’, sin(x) withlines linet ype 3title’sine’
#or as
plot ’data’using 1:3[ −10:10][0:2] wbars title’data’, sin(x) wl lt3title’sine’
All of these settings will be discussed below. The purpose of this example is to
showthatstyleinformationcanbeputabovetheplotcommand ,oritcanbemixed
inonthelinedeﬁningthe /D4/D0/D3/D8.The /D6/CT/D4/D0/D3/D8commandisalsotechnicallyoptional,
because you can add additional steps on one /D4/D0/D3/D8line using a comma. Finally,
once you have everything on one line, you can abbreviate almo st anything, such
asreplacing /DB/CX/D8/CW /D0/CX/D2/CT/D7with /DB /D0. Thisis yetanotherminimalism-versus-clarity
tradeoff,andyouareencouragedto stickwith the clearvers ionatﬁrst.
5.2 /F4SOME COMMON SETTINGS Atthispoint,youcanproduceabasicplot
ofdataorafunction(orbothatonce).But
you may have in mind a different look from Gnuplot’s default, which means you
will needto putafew /D7/CT/D8commandsbeforetheﬁnal /D4/D0/D3/D8.
This sectioncatalogsthe mostcommonsettings. Formore inf ormation onthe set-
tings here and many more, see the very comprehensive Gnuplot documentation,
which can be accessedfrom inside the Gnuplot command-linep rogram via /CW/CT/D0/D4,
optionally followed by any of the headers below (e.g., /CW/CT/D0/D4 /D7/CT/D8 /D7/D8/DD/D0/CT, /CW/CT/D0/D4/D7/CT/D8 /D4/D3/CX/D2/D8/D8/DD/D4/CT ).
Finally, if you are interactively experimenting with setti ngs—which you are en-
couragedtodowhilereadingthissection—bearinmindthaty oumayhavetogive
a /D6/CT/D4/D0/D3/D8command(oneword with nooptions)beforethe settingstakee ffect.
gsl_stats March24,2009
164 CHAPTER 5/D7/CT/D8 /D7/D8/DD/D0/CTThebasicstyleoftheplotmaybeasimplelineorpoints,abar plot,box-
eswitherrorbars,ormanyotherpossibilities.Gnuplotkee pstrackoftwo
typesofstyle:thatforfunctionplotting( /D7/CT/D8 /D7/D8/DD/D0/CT /CU/D9/D2/D8/CX/D3/D2 )andfordataplot-
ting( /D7/CT/D8 /D7/D8/DD/D0/CT /CS/CP/D8/CP).Forexample,toplotsomethingthatlookslikeabarchart,
try /D7/CT/D8 /D7/D8/DD/D0/CT /CS/CP/D8/CP /CQ/D3/DC/CT/D7, followed on the next line with /D4/D0/D3/D8 /DD/D3/D9/D6/CS/CP/D8/CP .
As above, this is equivalent to the slightly shorter form /D4/D0/D3/D8 /DD/D3/D9/D6/CS/CP/D8/CP /DB/CX/D8/CW/CQ/D3/DC/CT/D7,butit isoften usefulto separatethestyle-settingfrom th eplotcontent.
Otherfavoritedatastylesinclude /D0/CX/D2/CT/D7, /CS/D3/D8/D7, /CX/D1/D4/D9/D0/D7/CT/D7 (linesfromthe x-axisto
thedatalevel), /D7/D8/CT/D4/D7(acontinuouslinethattakesnodiagonals), /D0/CX/D2/CT/D7/D4/D3/CX/D2/D8/D7 (a
line with theactualdatapointmarked),and /CT/D6/D6/D3/D6/CQ/CP/D6/D7 (to bediscussedbelow).
Ifyouareplotting afunction,like /D4/D0/D3/D8 /D7/CX/D2/B4/DC/B5,thenuse /D7/CT/D8 /D7/D8/DD/D0/CT /CU/D9/D2/D8/CX/D3/D2/D0/CX/D2/CT/D7(or /CS/D3/D8/D7or /CX/D1/D4/D9/D0/D7/CT/D7 , et cetera). Because there are separate styles for
functions and data, you can easily plot data overlaid by a fun ction in a different
style./D7/CT/D8 /D4/D3/CX/D2/D8/D8/DD/D4/CT/B8 /D7/CT/D8 /D0/CX/D2/CT/D8/DD/D4/CT You can set the width and colors of your lines,
andwhetheryourpointswill displayasballs,tri-
angles,boxes,stars,etcetera.3
The /D4/D3/CX/D2/D8/D8/DD/D4/CT and /D0/CX/D2/CT/D8/DD/D4/CT commands,among a handful of other commands,
may differ from on-screento Postscriptto PNG to other forma ts, dependingupon
what is easy in the different formats. You can see what each te rminal can do via
the /D8/CT/D7/D8command.E.g.:
set terminalpostscript
set out ’testpage.ps’
test
Amongotherthings,the testpagedisplaysanumberedcatalo gofpointsandlines
availableforthe giventerminal./D7/CT/D8 /D8/CX/D8/D0/CT/B8 /D7/CT/D8 /DC/D0/CP/CQ/CT/D0/B8 /D7/CT/D8 /DD/D0/CP/CQ/CT/D0 Thesesimple commandslabelthe Xand
Yaxes and the plot itself. If the plot is
going to be a ﬁgure in a paper with a paper-side caption, then t he title may be
optional,butthere is rarelyanexcusefor omitting axislab els.Sampleusage:
3As of this writing, Gnuplot’s default for the ﬁrsttwo plotte d lines is to use /D0/CX/D2/CT/D8/DD/D4/CT /BD=red and /D0/CX/D2/CT/D8/DD/D4/CT/BE=green.Sevenpercentofmalesand0.4%offemalesarered–gr een colorblind andthereforewon’tbeabletodis-
tinguish onelinefromtheother. Try,e.g., /D4/D0/D3/D8 /D7/CX/D2/B4/DC/B5/BN /D6/CT/D4/D0/D3/D8 /D3/D7/B4/DC/B5 /D0/CX/D2/CT/D8/DD/D4/CT /BF,tobypass /D0/CX/D2/CT/D8/DD/D4/CT/BE=green, thus producing a red/blue plot.
gsl_stats March24,2009
GRAPHICS 165
set xlabel ’Time, days’
set ylabel ’Observed density,picograms/liter’
set title’Densityover time’/D7/CT/D8 /CZ/CT/DDGnuplot puts a legend on your plot by default. Most of the time , it is rea-
sonablyintelligentaboutit,butsometimesthelegendgets intheway.Your
ﬁrstoptionin this caseis tojustturn offthe keyentirely, v ia /D9/D2/D7/CT/D8 /CZ/CT/DD.
The more moderate option is to move the key, using some combin ation of /D0/CT/CU/D8/B8/D6/CX/CV/CW/D8, or /D3/D9/D8/D7/CX/CS/CT to set its horizontal position and /D8/D3/D4/B8 /CQ/D3/D8/D8/D3/D1, or /CQ/CT/D0/D3/DBto
set its vertical; ask /CW/CT/D0/D4 /D7/CT/D8 /CZ/CT/DDfor details on the precise meaning of these
positions(orjustexperiment).
• Thekeyalsosometimesbeneﬁtsfrom aborder, via /D7/CT/D8 /CZ/CT/DD /CQ/D3/DC.
• Forsurfaceplotswith /D4/D1/BF/CS,thekeyisathermometerdisplayingtherangeofcolors
andtheirvalues.Toturnthisoff,use /D9/D2/D7/CT/D8 /D3/D0/D3/D6/CQ/D3/DC .See /CW/CT/D0/D4 /D7/CT/D8 /D3/D0/D3/D6/CQ/D3/DC
onmovingtheboxorchangingits orientation./D7/CT/D8 /DC/D6/CP/D2/CV/CT, /D7/CT/D8 /DD/D6/CP/D2/CV/CT Gnuplot generally does a good job of selecting a default
range for the plot, but you can manually override this
using /D7/CT/D8 /D6/CP/D2/CV/CT/CJ /D1/CX/D2 /BM /D1/CP/DC ℄.
• Sometimes, you will want to leave one end of the range to be se t by Gnuplot, but
ﬁx the other end, in which case you can use a /B6to indicate the automatically-set
bound.Forexample, /D7/CT/D8 /DD/D6/CP/D2/CV/CT /CJ/B6/BM/BD/BC℄ﬁxesthe top of the plot at ten, but lets
thelowerendofthe plotfallwhereit may.
• Youmaywanttheaxestogobackward.Saythatyourdatarepre sentsrankings,so
1 is best; then /D7/CT/D8 /DD/D6/CP/D2/CV/CT /CJ/B6/BM/BD℄ /D6/CT/DA/CT/D6/D7/CT will put ﬁrst place at the top of the
plot, and autoset the bottom of the plot to just past the large st ranking in the data
set./D7/CT/D8 /DC/D8/CX/D7AND /D7/CT/D8 /DD/D8/CX/D7Gnuplot has reasonably sensible defaults for how the
axeswillbelabeled,butyoumayalsosetthetickmarks
directly.Todoso,provideafulllistinparensforthetexta ndpositionofeverylast
label,suchasonlines sevenandeightofthecodeonpage161.
Producingthis by handis annoying,butas a ﬁrstindication o f producingGnuplot
codefrom C,hereis asimple routineto write a /D7/CT/D8 /DD/D8/CX/D7line:
gsl_stats March24,2009
166 CHAPTER 5
static void deal_with_y_tics( FILE*f,doublemin,doublemax,doublestep){
intj =0;
fprintf(f,"setytics (");
for(doublei=n_min;i< n_max; i+=n_step){
fprintf(f, "’%g’%i",i,j++);
if(i+n_step <n_max−1)
fprintf(f, ",");
}
fprintf(f,")\n");
}
ASSORTED Hereare afewmore settingsthatyoumayﬁndhandy.
unsetborder #Delete the border of the plot.
unsetgrid #Make the plot evenmore minimalist.
setsize square #Set all axes tohave equal length onscreen or paper.
setformat y "%.3g" #Youcan use printf strings toformat axis labels.
setformat y "" #Or justturn offprintingon the Yaxis entirely.
setzero 1e−20 #Set limitat whichapoint is rounded tozero(default: 1e−8).
5.3 F ROM ARRAYS TO PLOTS Thescriptsabovegaveaﬁlenamefromwhich
to read the data ( /D4/D0/D3/D8 /B3/CS/CP/D8/CP/B9/CS/CT/CQ/D8/B3 ). Alter-
natively, /D4/D0/D3/D8 /B3/B9/B3tells Gnuplot to plot data to be placed immediately after the/D4/D0/D3/D8command. With the /B3/B9/B3trick, the process of turning a matrix into a basic
plot is trivial. In fact, the principle is so simple that ther e are several ways of im-
plementingit.
Write to a ﬁle Let /CS/CP/D8/CPbe an /CP/D4/D3/D4/CN/CS/CP/D8/CP set whose ﬁrst and ﬁfth columns we
would like to plot against each other. Then we need to create a ﬁle,
put a /D4/D0/D3/D8 /B3/B9/B3command in the ﬁrst line (perhaps preceded by a series of stat ic/D7/CT/D8commands), and then ﬁll the remainder with the data to be plot ted. Below
is the basic code to create a Gnuplot ﬁle. Since virtually any thing you do with
Gnuplotwill beavariantofthis code,it will bedissectedin detail.
1FILE*f = fopen("plot_me","w");
2if(!f) exit(0);
3 fprintf(f,"setkey off; setylabel ’picograms/liter’\ns etxrange [−10:10]\n");
4 fprintf(f,"plot ’ −’using1:5title’columns one andﬁve’\n");
5 fclose(f);
6 apop_matrix_print(data −>matrix,"plot_me");
gsl_stats March24,2009
GRAPHICS 167
• The ﬁrst argument to /CU/D3/D4/CT/D2is the ﬁle to be written to, and the second option
should be either Ꜽ/CPꜼfor append or Ꜽ/DBꜼfor write anew; in this case, we want to
startwith a cleanﬁle soweuse Ꜽ/DBꜼ.
• The /CU/D3/D4/CT/D2function can easily fail, for reasons including a mistyped d irectory
name,nopermissions,orafulldisk.Thus,youareencourage dtocheckthat /CU/D3/D4/CT/D2
workedaftereveryuse.Ifthe ﬁle handleis /C6/CD/C4/C4, thensomethingwentwrongand
youwill needto investigate.
• As you can see from lines three and four, the syntax for /CU/D4/D6/CX/D2/D8/CU is similar to
that of the rest of the /D4/D6/CX/D2/D8/CUfamily: the ﬁrst argument indicates to what you
are writing, and the rest is a standard /D4/D6/CX/D2/D8/CUline, which may include the usual
insertionsvia /B1/CV, /B1/CX, andsoon.
• You can separate Gnuplot commands with a semicolon or newli ne, and can put
theminone /CU/D4/D6/CX/D2/D8/CU statementormany,asisconvenient.However,youwillneed
to endeachlineofdata(andthe /D4/D0/D3/D8lineitself) with anewline.
• Since Gnuplot lets us select columns via the /D9/D7/CX/D2/CV /BD/BM/BHclause, there is no need
toparedownthedatasetinmemory.Noticeagainthattheﬁrst columninGnuplot
is 1,not0.
• The /D8/CX/D8/D0/CTclause shows that Gnuplot accepts both “double quotes” and ‘ single
quotes’aroundtextsuch asﬁle namesor labels. Single quote sare nothing special
to C,sothis makesit mucheasiertoentersuchtext.
• Lineﬁveclosestheﬁle,sothereisnoconfusionwhenlinesi xwritesthedatatothe
ﬁle. It prints the matrix instead of the full /CP/D4/D3/D4/CN/CS/CP/D8/CP structure so that no names
orlabelsarewritten.Since /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D4/D6/CX/D2/D8 defaultstoappending,thematrix
appearsafterthe /D4/D0/D3/D8headerthatlinestwoandthreewrote totheﬁle.Youwould
needto set /CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/D3/D9/D8/D4/D9/D8/CN/CP/D4/D4/CT/D2/CS/BP/BC tooverwrite.
• At the end of this, /D4/D0/D3/D8/CN/D1/CT will be executable by Gnuplot, using the forms like/CV/D2/D9/D4/D0/D3/D8 /B9/D4/CT/D6/D7/CX/D7/D8 /BO /D4/D0/D3/D8/CN/D1/CT,asabove.
Instant gratiﬁcation The abovemethod involvedwriting your commandsand data
to a ﬁle and then running Gnuplot, but you may want to pro-
duceplotsasyourprogramruns.Thisisoftenusefulforsimu lations,togiveyoua
hintthatallisOKwhiletheprogramruns,andtoimpressyour friendsandfunders.
Thisiseasytodousingapipe,sonamedbecauseofUNIX’srunn ingdata-as-water
metaphor;seeAppendixBfor afull exposition.
The command /D4/D3/D4/CT/D2does two things: it runs the speciﬁed program, and it pro-
duces a data pipe that sends a stream of data produced by your p rogram to the
now-running child program. Any commandsyou write to the pip e are read by the
childasif someonehadtypedthosecommandsinto theprogram directly.
Listing 5.3presentsasamplefunctionto openandwrite to a p ipe.
gsl_stats March24,2009
168 CHAPTER 5
1#include <apop.h>
2
3voidplot_matrix_now( gsl_matrix *data){
4static FILE *gp= NULL;
5if(!gp)
6 gp= popen("gnuplot −persist","w");
7if(!gp){
8 printf("Couldn’t open Gnuplot.\n");
9 return;
10 }
11 fprintf(gp,"reset; plot ’ −’\n");
12 apop_opts.output_type = ’p’;
13 apop_opts.output_pipe = gp;
14 apop_matrix_print(data,NULL);
15 fﬂush(gp);
16 }
17
18intmain(){
19 apop_db_open("data −climate.db");
20 plot_matrix_now(apop_query_to_matrix("select (year *12+month)/12.,tempfrom temp"));
21 }
Listing5.3 Afunction toopen a pipe toGnuplot and plot a vect or. Online source: /D4/CX/D4/CT/D4/D0/D3/D8/BA .
• The /D4/D3/D4/CT/D2function takes in the location of the Gnuplot executable, an d a /DBto
indicate thatyou will be writing to Gnuplotratherthan read ing from it. Mostsys-
temswill acceptthesimple programname, /CV/D2/D9/D4/D0/D3/D8,andwill searchtheprogram
path for its location (see Appendix A on paths). If /CV/D2/D9/D4/D0/D3/D8 is not on the path,
thenyouwillneedtogiveanexplicitlocationlike /BB/D9/D7/D6/BB/D0/D3/CP/D0/BB/CQ/CX/D2/BB/CV/D2/D9/D4/D0/D3/D8 .In
this case, you can ﬁnd where Gnuplot lives on your machine usi ng the command/DB/CW/CX/CW /CV/D2/D9/D4/D0/D3/D8.The /D4/D3/D4/CT/D2functionthenreturnsa /BY/C1/C4/BX/B6,hereassignedto /CV/D4.
• Since /CV/D4was declared to be a static variable, and /D4/D3/D4/CT/D2is called only when/CV/D4/BP/BP/C6/CD/C4/C4 , it will persist through multiple calls of this function, an d you can re-
peatedlycallthefunctionto producenewplotsin the samewi ndow.
If /CV/D4is /C6/CD/C4/C4after the call to /D4/D3/D4/CT/D2, then something went wrong. This is worth
checkingfor everytime apipeis created.
• But if the pipe was created properly, then the function cont inues with the now-
familiar processof writing /D4/D0/D3/D8 /B3/B9/B3anda matrix to a ﬁle. The /D6/CT/D7/CT/D8command
to Gnuplot(line 11)ensuresthatnexttime youcallthe funct ion, thenewplotwill
nothaveanystrangeinteractionswith the lastplot.
• Lines 12 and 13 set the output type to /B3/D4/B3and the output pipe to /CV/D4; /CP/D4/D3/D4/CN/B9/D1/CP/D8/D6/CX/DC/CN/D4/D6/CX/D2/D8 usestheseglobalvariablestoknowthatitshouldwritetoth atpipe
insteadofa ﬁleor /D7/D8/CS/D3/D9/D8.
• Notice the resemblancebetweenthe form here andthe form us edto write to a ﬁle
gsl_stats March24,2009
GRAPHICS 169
above.A /BY/C1/C4/BXpointer can point to either a program expectinginput or a ﬁle , and
theprogramwritestoeitherinexactlythesamemanner.They areevenbothclosed
using /CU/D0/D3/D7/CT. The only difference is that a ﬁle opens via /CU/D3/D4/CT/D2and a program
opens with /D4/D3/D4/CT/D2. Thus, although the option is named /CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/D3/D9/D8/D4/D9/D8/CN/B9/D4/CX/D4/CT,itcouldjustaseasilypointtoaﬁle;e.g., /BY/C1/C4/BX /B6/CU/BP/CU/D3/D4/CT/D2/B4 /D4/D0/D3/D8/D1/CT /B8 Ꜽ/DBꜼ/B5/BN/CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/D3/D9/D8/D4/D9/D8/CN/D4/CX/D4/CT /BP /CU/BN.
• One ﬁnal detail: piped outputis often keptin a buffer, a spacein memory that the
system promises to eventually write to the ﬁle or the other en d of the pipe. This
improves performance, but you want your plot now, not when th e system deems
thebufferworthwriting. Thefunctiononline15, /CU/CU/D0/D9/D7/CW,tells thesystemtosend
allelementsofthe /CV/D4bufferdownthepipeline.Thefunctionalsoworkswhenyou
areexpectingstandardoutputto the screen,bytheway,via /CU/CU/D0/D9/D7/CW/B4/D7/D8/CS/D3/D9/D8/B5 .4
The main drawback to producing real-time plots is that they c an take over your
computer, as another plot pops up and grabs focus every half s econd, and can
signiﬁcantly slow down the program. Thus, you may wantto set tle for occasional
redisplays,suchaseveryﬁfty periodsofyoursimulation,v ia aform like
for(intperiod =0; period< 1000; period++){
gsl_vector *output = run_simulation();
if(!(period% 50))
plot_vector_now(output);
}
Q5.2Nowwouldbea goodtime to plotsomedataseries.
• Query a two-column table from /CS/CP/D8/CP/B9/D8/CP/D8/D8/D3/D3/BA/CS/CQ giving the birth
year in the ﬁrst column and the mean number of tattoos for resp on-
dentsin thatbirth yearin thesecond.
• Dump the data to a Gnuplottable ﬁle using the above /CU/D4/D6/CX/D2/D8/CU tech-
niques.
• Plot the ﬁle, then add /D7/CT/D8commands that you /CU/D4/D6/CX/D2/D8/CU to ﬁle to
produceanicer-lookingplot. E.g.,try boxesandimpulses.
• Modify your program to display the plot immediately using p ipes.
How could you have written the program initially to minimize the
effortrequired toswitch betweenwriting to a ﬁleandapipe?
• Howdoesthegraphlookwhenyourestrictyourquerytoinclu deonly
thosewith anonzeronumberoftattoos?
4Alternatively, /CU/CU/D0/D9/D7/CW/B4/C6/CD/C4/C4/B5 will ﬂush all buffers at once. For programs like the ones in th is book, where
there are only ahandful of streams open, it doesn’t hurtto ju st use /CU/CU/D0/D9/D7/CW/B4/C6/CD/C4/C4/B5 in all cases.
gsl_stats March24,2009
170 CHAPTER 5/F4Self-executing ﬁles This chapter is about the many possible paths from a data
set to a script that can be executed by an external program;
here’sonemore.
ThoseexperiencedwithPOSIXsystemsknowthatascriptcanb emadeexecutable
by itself. The ﬁrst line of the script must begin with the spec ial marker #! fol-
lowedbytheinterpreterthatwillreadtheﬁle,andthescrip tmustbegivenexecute
permissions. Listing 5.4 shows a program that produces a sel f-executing Gnuplot
scripttoplot sin(x). You couldevenuse /D7/DD/D7/D8/CT/D1/B4Ꜽ/BA/BB/D4/D0/D3/D8/D1/CTꜼ/B5 to havethe script
executeatthe endofthisprogram.
#include <apop.h>
#include <sys/stat.h> //chmod
intmain(){
charﬁlename[]= "plot_me";
FILE*f =fopen(ﬁlename,"w");
fprintf(f, "#!/usr/bin/gnuplot −persist\n\
plot sin(x)");
fclose(f);
chmod(ﬁlename, 0755);
}
Listing5.4 Write to a ﬁle that becomes a self-executing Gnup lot script. Run the script using/BA/BB/D4/D0/D3/D8/CN/D1/CT from thecommand line.Online source: /D7/CT/D0/CU/CT/DC/CT/D9/D8/CT/BA ./F4 /D6/CT/D4/D0/D3/D8 REVISITED /D6/CT/D4/D0/D3/D8and the /D4/D0/D3/D8 /B3/B9/B3mechanism are incompatible, be-
cause Gnuplot needs to re-read the data upon replotting, but
cannotbackup in thestreamto rereadit. Instead,whenreplo tting datasets,write
thedatatoaseparateﬁleandthenrefertothatﬁleintheﬁlet obereadbyGnuplot.
Toclarify,hereisaCsnippetthatwritestoaﬁleandthenask sGnuplottoreadthe
ﬁle:
apop_data_print(data,"dataﬁle");
FILE*f = fopen("gnuplot", "w");
fprintf(f,"plot ’dataﬁle’ using 1title’data column1’;\n \
replot ’dataﬁle’ using 5title’data column5’;\n");
fclose(f);
Also, when outputting to a paper device, replotting tends to make a mess. Set the
outputterminaljustbeforetheﬁnalreplot:
plot ’dataﬁle’using 1
replot ’dataﬁle’using 2
replot ’dataﬁle’using 3
set termpostscript color
set out ’four_lines.eps’
replot ’dataﬁle’using 4
gsl_stats March24,2009
GRAPHICS 171
®A Gnuplot command ﬁle basically consists of a group of /D7/CT/D8com-
mandsto specifyhowthe plotwill look,andthenasingle /D4/D0/D3/D8(2-D
version)or /D7/D4/D0/D3/D8(3-D version)command.
®Youcanrunexternaltext-drivenprogramsfromwithinCusin g /CU/D3/D4/CT/D2
and /D4/D3/D4/CT/D2.
®Using the /D4/D0/D3/D8 /B3/B9/B3form, you can put the data to be plotted in the
command ﬁle immediately after the command. You can use this a nd/CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D4/D6/CX/D2/D8 toproduceplotﬁlesofyourdata.
5.4 A SAMPLING OF SPECIAL PLOTS For a system that basically only has
a /D7/CT/D8anda /D4/D0/D3/D8command,Gnuplot
is surprisingly versatile. Here are some specialized visua lizationsthat go well be-
yondthe basic2-D plot.
LATTICES Perhaps plotting two pairs of columns at a time is not sufﬁcie nt—you
wantbulk,displayingeveryvariableplottedagainstevery other.Forthis,
usethe /CP/D4/D3/D4/CN/D4/D0/D3/D8/CN/D0/CP/D8/D8/CX/CT function.
#include "eigenbox.h"
intmain(){
apop_plot_lattice(query_data(), "out");
}
Listing5.5 Thecode toproduce Figure 5.6.Linkwiththecode inListing8.2,p267. Onlinesource:/D0/CP/D8/D8/CX/CT/BA .
Listing 5.5 producesa ﬁle that (via /CV/D2/D9/D4/D0/D3/D8 /B9/D4/CT/D6/D7/CX/D7/D8 /BO/D3/D9/D8) produces the plot
in Figure 5.6.Yes,it is one line of code,butyou will needto l ink it with the data-
querying code in Listing 8.2, p 267. Each variable is plotted against every other;
e.g., the upper-middle plot shows males per 100 females vers us state population,
andthemiddle-leftplotshowsamirrorimage(alongthediag onalline)ofthesame
plot.
Whatis a lattice plot goodfor? Somecall it getting a lay ofthe land , while others
callitdatasnooping .Giventenperfectlyrandomvariables,thereisagoodchanc e
that at least one pair of lattice plots will look to you as if it demonstrates a nice
correlation. A formal regression on the chosen pair of varia bles will likely verify
yourinitial visualimpression.Formoreon thisconﬂict,se epage316.
gsl_stats March24,2009
172 CHAPTER 5
m_per_100_f
median_agepopulation
Figure 5.6 The Census data, as queried onpage 267.
ERROR BARS The typical error bar has three parts: a center, a top limit, a nd a bot-
tom limit. Gnuplotsupportsthistype ofdatadirectly,via /D7/CT/D8 /D7/D8/DD/D0/CT/CS/CP/D8/CP /CT/D6/D6/D3/D6/CQ/CP/D6/D7 . You can provide the necessary information in a variety of fo r-
mats;themostcommonare(x,ycenter,ytop,ybottom)and(x, ycenter,yrange),
wheretherangeistypicallyastandarddeviation.Listing5 .7,whichproducesFig-
ure 5.8, takes the second approach, querying out a month, the mean temperature
for the month, and the standard deviation of temperature for the month. Plotting
the data shows both the typical annual cycle of temperatures and the regular ﬂuc-
tuationofvariancesoftemperature.
HISTOGRAMS A histogram is a set of X- and Y-values like any other, so plott ing it
requiresnospecialtools.However,Gnuplotwillnottakeal istofdata
andformahistogramforyou—youhavetodothisontheC-sidea ndthensendthe
ﬁnalhistogramtoGnuplot.Fortunately, /CP/D4/D3/D4/CN/D4/D0/D3/D8/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1 doesthebinning
for you. Have a look at Listing 11.2, page 359, for an example o f turning a list of
dataitemsinto a histogram(shownin Figure11.3).
gsl_stats March24,2009
GRAPHICS 173
#include <apop.h>
intmain(){
apop_db_open("data −climate.db");
apop_data *d= apop_query_to_data("select \
(yearmonth/100.−round(yearmonth/100.)) *100 as month,\
avg(tmp),stddev(tmp)\
from precip group bymonth");
printf("set xrange[0:13]; plot ’ −’witherrorbars\n");
apop_matrix_show(d −>matrix);
}
Listing5.7 Query out the month, average, and variance, and p lot the data using errorbars. Prints
to stdout, so pipe the output through Gnuplot: /BA/BB/CT/D6/D6/D3/D6/CQ/CP/D6/D7 /DG /CV/D2/D9/D4/D0/D3/D8 /B9/D4/CT/D6/D7/CX/D7/D8 .
Online source: /CT/D6/D6/D3/D6/CQ/CP/D6/D7/BA .
253035404550556065707580
0 1 2 3 4 5 6 7 8 910 11 12 13temp,◦F
monthMonthly temp±σ
++++++++
+
+
+
++
Figure 5.8 Monthly temperature, ±σ.
Q5.3Theleading digit of a number is simply its most signiﬁcantdigit: the lead-
ing digit of 3247.8 is 3, and the leading digit of 0.098 is 9. Benford’s law
(Benford,1938)statesthatthedigit d∈{0,1,... ,9}willbealeadingdigit
with frequency
Fd∝ln((d+ 1)/d). (5.4.1)
Checkthisagainstadatasetofyourchoosing,suchasthe /D4/D3/D4/D9/D0/CP/D8/CX/D3/D2 col-
umnin theWorldBankdata,orthe /CC/D3/D8/CP/D0/CN/CP/D6/CT/CP columnfrom theUSCen-
susdata.Theformaltestistheexerciseonpage322;sinceth isisthechapter
onplotting,justproduceahistogramofthechosendataseta ndverifythatit
slopessharplydownward.( Hint: ifd= 3.2e7, then10(int)log10 (d)= 1e7.)
gsl_stats March24,2009
174 CHAPTER 5
195019551960196519701975198019851990
0 1 2 3 4 5 6 7 8 9birth year
tattoosb
bb
bb b
b
bbb
b
b
bbb
bb
b
b
bb
bb
b
bbbb
b
bbbb
b
b
bb
bb
bbb
bb
b
bbbb
bb
b
b
bbb
bb
bbb
bb
bbbb
bb
bb
bb
bbb
b
bb
b
bbb
b
bb
bb
b
bb
bb
bb
b
bbb
b
bb
bbb
bb
bb b
Figure 5.9 Eachpoint represents a person.
LOG PLOTS Youcanplotyourdataonalogscalebyeithertransformingit beforeit
getsto Gnuplotorbytransforming theplot.
Log plots work best on a log-base-10 scale, rather than the ty pical natural loga-
rithm, because readers can immediately convert a 2 on the sca le to1e2, a−4to
1e−4, et cetera. From C, you can use the /D0/D3/CV/BD/BC/B4/DC/B5 function to calculate log 10
/DC,
and if your data is in a /CV/D7/D0/CN/DA/CT/D8/D3/D6 , you can use /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D0/D3/CV/BD/BC to trans-
form the entirevectoratonce.
In Gnuplot, simply /D7/CT/D8 /D0/D3/CV/D7/CP/D0/CT /DDto use a log-scaled Yaxis, /D7/CT/D8 /D0/D3/CV/D7/CP/D0/CT/DCtousealog-scaled Xaxis,or /D7/CT/D8 /D0/D3/CV/D7/CP/D0/CT /DC/DDforboth.
Q5.4Redo the /CS/CP/D8/CP/B9/CS/CT/CQ/D8 plot from the beginning of this chapter using a log
scale.
PRUNING AND JITTERING Plottingtheentiredatasetmaybedetrimentalforafew
reasons.One is the range problem: there is always that
one data point at Y= 1e20throws off the whole darn plot. If you are using an
interactiveon-screenplot,youcanselectasmallerregion ,butitwouldbebetterto
justnotplotthatpointto beginwith.
The second reason for pruning is that the data set may be too la rge for a single
gsl_stats March24,2009
GRAPHICS 175
page. The black blob you get from plotting ten million data po ints on a single
pieceofpaperis notveryinformative.Inthiscase,youwant touseonlyarandom
subsetofthedata.5
Both of these are problems of selecting data, and so they are e asy to handle via
SQL.Asimple /D7/CT/D0/CT/D8 /B6 /CU/D6/D3/D1 /D4/D0/D3/D8/D1/CT /DB/CW/CT/D6/CT /DA/CP/D0/D9/CT /BO /BD/CT/BJwilleliminateval-
ues greater than a million, and page 84 showed how to select a r andom subset of
thedata.
In Gnuplot, you can add the /CT/DA/CT/D6/DDkeyword to a plot, such as /D4/D0/D3/D8 /B3/CS/CP/D8/CP/B3/CT/DA/CT/D6/DD /BHto plot every ﬁfth data point. This is quick and easy, but take care that
thereare noevery-ﬁvepatternsinthe data.
Now consider graphing the number of tattoos a person has agai nst her year of
birth. Because both of these are discrete values, we can expe ct that many people
willsharethesameyearofbirthandthesametattoocount,me aningthattheplotof
thosepeoplewouldbeexactlyonepoint.Apointat(1965,1ta ttoo)couldrepresent
onepersonorﬁfty.
1#include <apop.h>
2gsl_rng*r;
3
4voidjitter(double*in){
5*in+= (gsl_rng_uniform(r) −0.5)/10;
6 }
7
8intmain(){
9 apop_db_open("data −tattoo.db");
10 gsl_matrix *m = apop_query_to_matrix("select \
11 tattoos.’ct tattoos ever had’ct, \
12 tattoos.’year of birth’+1900 yr\
13 from tattoos \
14 where yr < 1997 and ct+0.0< 10");
15 r= apop_rng_alloc(0);
16 apop_matrix_apply_all(m,jitter);
17 printf(setkey off; setxlabel ’tattoos’;\n\
18 set ylabel ’birthyear’; \n\
19 plot ’ −’pointtype 6\n");
20 apop_matrix_show(m);
21 }
Listing5.10 By adding a bit of noise to each data point, the pl ot reveals more data. Online source:/CY/CX/D8/D8/CT/D6/BA .
5Another strategy for getting less ink on the page is to change the point type from the default cross to a dot.
For the typical terminal, do this with /D4/D0/D3/D8 /BA/BA/BA /D4/D3/CX/D2/D8/D8/DD/D4/CT /BC.
gsl_stats March24,2009
176 CHAPTER 5
One solution is to add a small amount of noise to every observa tion, so that two
points will fall exactly on top of each other with probabilit y near zero. Figure 5.9
showssuch a plot. Without jittering, there would be exactly one point on the one-
tattoo column for every year from about 1955 to 1985; with jit tering, it is evident
thatthereare generallymore peoplewith onetattoo bornfro m 1965–1975thanin
earlier or later years, and that more than half of the sample w ith two tattoos was
bornafter1975.
Further, the processof jittering is rather simple. Listing 5.10 showsthe codeused
toproducetheplot.Lines10–14areasimplequery;lines17– 20produceaGnuplot
header and ﬁle that get printed to /D7/D8/CS/D3/D9/D8(so run the program as /BA/BB/CY/CX/D8/D8/CT/D6 /DG/CV/D2/D9/D4/D0/D3/D8). In between these blocks, line 16 applies the /CY/CX/D8/D8/CT/D6function to every
element of the matrix. That function is on lines 4–6, and simp ly adds a random
number∈[−0.05,0.05]to its input. Comment out line 16 to see the plot without
jitter.
Q5.5Modify the code in Listing 5.10 to do the jittering of the data points in the
SQLqueryinsteadofin the /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC .
®Apophenia will construct a grid of plots, plotting every var iable
againsteveryother, via /CP/D4/D3/D4/CN/D4/D0/D3/D8/CN/D0/CP/D8/D8/CX/CT .
®With Gnuplot’s /D7/CT/D8 /D7/D8/DD/D0/CT /CT/D6/D6/D3/D6/CQ/CP/D6/D7 command, you can plot a
rangeora one- σspreadfor eachdatapoint.
®You need to aggregate data into histograms outside of Gnuplo t, but
oncethatis done,plotting themis aseasyaswith anyotherda taset.
®If the data set has an exceptional range, you can take the log o f the
data in C via /D0/D3/CV/BD/BC, plot the log in Gnuplot via /D7/CT/D8 /D0/D3/CV/D7/CP/D0/CT /DD,
ortrim thedatainSQLvia,e.g., /D7/CT/D0/CT/D8 /D3/D0/D7 /CU/D6/D3/D1 /D8/CP/CQ/D0/CT /DB/CW/CT/D6/CT/DA/CP/D6/BO/BD/CT/BE/BC .
®If data falls on a grid (e.g., integer-valued rows and column s), then
youcanadd jitterto the plotto revealthedensityateachpoint.
gsl_stats March24,2009
GRAPHICS 177
5.5 A NIMATION Perhaps three dimensions is not quite enough, and you need
one more. Gnuplot easily supports animation: just stack ma-
trices one after the next and call /D4/D0/D3/D8in between. However, many media (such
as paper) do not yet support animation, meaning that your out put will generally
be dependenton your display method. The GIF format provides animation and is
supportedbyallmajorwebbrowsers,soyoucanalsoputyourm oviesonline.6
Therearetwodetailsthatwillhelpyouwithplottingmultip ledatasets.First,Gnu-
plot reads an /CTalone on a line to indicate the end of a data set. Second, Gnupl ot
allows you to deﬁne constants via a simple equals sign; e.g., the command /D4 /BP/BC/BA/BIcreates the variable /D4and sets it to 0.6. Third, Gnuplot has a /D4/CP/D9/D7/CT /D4com-
mandthatwillwait psecondsbeforedrawingthenextplot.
Tyingitalltogether, wewanta Gnuplottableﬁle thatlookss omethinglike this:
set pm3d;
p=1;
splot ’−’withpm3d
{data[0]here}
e
pause p;
splot ’−’withpm3d
{data[1]here}
e
pause p;
splot ’−’withpm3d
{data[2]here}
e
You can run the resulting output ﬁle through the Gnuplot comm and line as usual.
If a one-secondpause is too long or too short, you only need to changethe single
valueof /D4attheheadofthe ﬁleto changethedelaythroughout.
Youcanwritetheaboveplotstoapaper-orientedoutputform at,inwhichcaseeach
plot will be on a separate page. You could then page through th em with a screen
viewer, or perhaps print them into a ﬂipbook. When writing a ﬁ le, set /D4/BP/BCin the
above,sincethere is nousedelayingbetweenoutputs.
Inadditiontotheexamplebelow,Listings7.12(page253)an d9.1(page298)also
demonstratethe productionofanimations.
6For GIFs, you will need to request animation in the /D7/CT/D8 /D8/CT/D6/D1line, e.g., /D7/CT/D8 /D8/CT/D6/D1 /CV/CX/CU /CP/D2/CX/D1/CP/D8/CT /CS/CT/D0/CP/DD/BD/BC/BC. Thenumber at the end is the pause between frames in hundredt hs of asecond.
gsl_stats March24,2009
178 CHAPTER 5
Figure 5.11 The Game of Life: at left is the original colony; a t right is the colony after 150 periods.
ThevaguelyV-shapedﬁgures(suchasthegroupsfarthestlef t,right,andtop)areknown
asgliders, because theytravelone stepforwardevery four periods.
An example: the game of life There is a tradition of agent-based modeling built
around plotting agents on a grid, pioneered by Ep-
stein&Axtell(1996).A simplepredecessorisConway’sGame ofLife,a cellular
automaton discussed at length in Gardner (1983). The game is played on a grid,
whereeachpointonthegridcanhostasingleblob.Theseblob scannotmove,and
aresomewhatdelicate:iftheblobhasonlyzerooroneneighb ors,itdiesofloneli-
ness,andifithasfourormoreneighbors,itdiesofovercrow ding.Ifanemptycell
issurroundedbyexactlythreeblobs,then anewblobis borno nthatcell.
Thesesimplerulesproducecomplexandinterestingpattern s.AtleftinFigure5.11
is the so-called r pentomino , a simple conﬁguration of ﬁve blobs. At right is the
outcome after 150 periods of life. Listing 5.12 presents the code to run the game.
BecausetheprogramprintsGnuplotcommandsto /D7/D8/CS/D3/D9/D8,runitusing /BA/BB/D0/CX/CU/CT /DG/CV/D2/D9/D4/D0/D3/D8.
• The gameusestwo grids: the completedgrid from the last per iod, named /CP/D8/CX/DA/CT
in thecode,andtheincompletegrid thatwill soonrepresent the stateoflife in the
nextperiod,named /CX/D2/CP/D8/CX/DA/CT .
• Both grids are initialized to zero (lines 27–28), and then l ines 29–31 deﬁne the r
pentomino.
• Line32istheGnuplotheader,andline34tellsGnuplotthat datapointsarecoming.
• Themainworkeachperiodispreparingtheinactivegrid,wh ichiswhatthe /CP/D0/CN/B9/CV/D6/CX/CSfunction does. It sets everything to zero, and then the two lo ops ( /CX-indexed
for rows and /CY-indexed for columns) checks every point in the grid except t he
borders.
• The /CP/D6/CT/CP/CN/D4/D3/D4 function calculates the population in a 3 ×3 space; line 16 needs
gsl_stats March24,2009
GRAPHICS 179
1#include <apop.h>
2intarea_pop( gsl_matrix *a,introw,intcol){
3inti, j, out = 0;
4for(i=row−1; i<= row+1; i++)
5 for(j=col−1;j<= col+1; j++)
6 out += gsl_matrix_get(a, i, j);
7returnout;
8 }
9
10voidcalc_grid( gsl_matrix *active,gsl_matrix *inactive,intsize){
11inti, j, s,live;
12 gsl_matrix_set_all(inactive, 0);
13 for(i=1; i<size−1;i++)
14 for(j=1; j< size−1; j++){
15 live =gsl_matrix_get(active,i,j);
16 s= area_pop(active, i,j) −live;
17 if((live && (s == 2|| s== 3))
18 || (!live&& s == 3)){
19 gsl_matrix_set(inactive, i, j, 1);
20 printf("%i %i\n", i,j);
21 }
22 }
23 }
24
25intmain(){
26inti, gridsize=100, periods = 550;
27gsl_matrix *t,*active = gsl_matrix_calloc(gridsize,gridsize);
28gsl_matrix *inactive = gsl_matrix_calloc(gridsize,gridsize);
29 gsl_matrix_set(active,50, 50, 1);gsl_matrix_set(act ive,49, 51, 1);
30 gsl_matrix_set(active,49, 50, 1);gsl_matrix_set(act ive,51, 50, 1);
31 gsl_matrix_set(active,50, 49, 1);
32 printf("set xrange [1:%i]\nsetyrange [1:%i]\n",grids ize,gridsize);
33 for(i=0; i< periods;i++){
34 printf("plot ’ −’withpoints pointtype 6\n");
35 calc_grid(active,inactive,gridsize);
36 t = inactive;
37 inactive = active;
38 active = t;
39 printf("e\npause .02\n");
40 }
41 }
Listing5.12 Conway’s game of life.Online source: /D0/CX/CU/CT/BA.
to subtract the population (if any) at the central point to ge t the population in the
point’sneighborhood.
• Notice that the loops in both /CP/D6/CT/CP/CN/D4/D3/D4 and /CP/D0/CN/CV/D6/CX/CS never consider the edges
of the grids. That means that /CP/D6/CT/CP/CN/D4/D3/D4 does not need to concern itself with edge
gsl_stats March24,2009
180 CHAPTER 5
conditionslike /CX/CU /B4/CX/AX/BP/BC/B5/BA/BA/BA .
• Therules of the Game of Life are summarizedin the /CX/CUstatementin lines 17–18.
There will be a blob at this point if either there is currently a blob and it has two
orthreeneighbors,orthereis noliving blobtherebutthere are threeneighbors.
• Ifthe /CX/CUstatementﬁndsthattherewillbeablobinthisspacenextper iod,itprints
apointto Gnuplot,andmarksit in thecurrently inactivegri d.
• Lines 36–38 is the classic swap of the active and inactive gr ids, using a temp
location to help make the exchange. Since we are only shuntin g the addresses of
data,theoperationtakeszerotime.
Q5.6Other rules for life or death also produce interesting resul ts. For example,
rewrite the rules so that a living blob stays alive only if the re are 2, 3, 4, or
5 neighbors, and an empty space has a birth only if there is one neighbor.
Ortry staying-aliverulesof2 and6 with birth rulesof1and3 .
5.6 O N PRODUCING GOOD PLOTS Cleveland & McGill (1985) offer some
suggestions for producing plots for the
purposeofperceivingthepatternsamongthestatic.Theire xperimentswereaimed
at how well people could compare data presented in various fo rmats, and arrived
at an ordering of graphical elements from those that were mos t likely to allow
accurateperceptionto layoutsthatinhibited accurateper ception:
i) Position alonga common scale(e.g.,the heightof the means in the temper-
atureplotonpage173)
ii) Position on identical but nonaligned scales (such as compa ring points on
two separategraphs)
iii) Length(e.g.,theheightoftheerrorbarsinthetemperatur eplotonpage173)
iv) Angle
v) Slope(whennottoo closetoverticalorhorizontal)
vi) Area
vii) Volume, Density, Color saturation (e.g., a continuous sca le from light blue
to darkblue)
viii) Colorhue(e.g.,acontinuousscalefrom red to blue)
Data should be presented using techniques as high up on the sc ale as possible.
Pie charts (representing data via angle and area) are a bad id ea because there are
many better ways to present the same data. Gnuplot does provi de a means of set-
ting data-dependent color, but given that color is at the bot tom of Cleveland and
gsl_stats March24,2009
GRAPHICS 181
McGill’s list, it shouldbe used as a last resort. They did not run experimentswith
animation, but our eyes have cells exclusively dedicated to sensing motion, so it
seemssensiblethatifmovementwereincludedonthelist, it would rankhighly.
USnationaldebt
01e+122e+123e+124e+125e+126e+127e+128e+129e+12
1994199619982000200220042006National debt
4.5e+125e+125.5e+126e+126.5e+127e+127.5e+128e+128.5e+129e+12
1994199619982000200220042006National debt
01e+112e+113e+114e+115e+116e+11
1994199619982000200220042006Annual deﬁcit
[Online source: /CS/CT/CQ/D8/BA/CV/D2/D9/D4/D0/D3/D8 .]As for angles and slopes, consider
these plots of the US national debt
since 1995. The top plot has a y
axis starting at $0, while the sec-
ond has a yaxis starting at $4.5
trillion. Is the rate of change from
1995–1996 larger or smaller than
therateofchangefrom2005–2006?
Was growth constant or decelerat-
ing from 1995–2000? It is difﬁ-
cult to answer these questions from
the top graph, becauseeverythingis
somewhat ﬂat—the change in an-
gles is too small to be perceived,
andwearebadatdiscerningslopes.
Differences in slope on the second
scalearemore visible.Thelessonis
that plots show their patterns most
clearly when the axes are set such
thattheslopeis around45◦.
The bottom plot is the US national
deﬁcit. This is the amount the gov-
ernment spends above its income,
and is thus the rate of change of the
debt. The rate of change in the ﬁrst
twographs(a slopein thosegraphs)
is the height of this plot for each
year, and position along a common
scale is number one on Cleveland
and McGill’s list. The answers to
the above questions are now obvi-
ous: the rate of change for the debt slowed until 2000 and then quickly rose to
aboutdouble1995rates.
DarrellHuff,intheclassic HowtoLieWithStatistics (Huff&Geis,1954,Chapter
5),hasadifferentgoalandsomakesdifferentrecommendati ons.Hepointsoutthat
thetop twographstelladifferentnarrative.Thesecondgra phtells astorythatthe
nationaldebtisrapidlyincreasing,becausetheheightoft hepointat2006isabout
eighttimes theheightat1995.Thetop graphshowsthatthede btrose,butnotata
gsl_stats March24,2009
182 CHAPTER 5
fast-multiplying rate. Huff concludesthat the full story i s best told when the zero
of the yaxis always in the picture, even if this means blank space on t he page—
advice that directly contradicts the advice above.So the ch oice for any given plot
depends on the context and intent, although some rules—like avoiding pie charts
andcontinuouscolorscales—arevalid foralmostallsituat ions.
5.7 /F4GRAPHS—NODES
AND FLOWCHARTSIncommonconversation,wetypicallymeantheword
graphto be a plot of data like every diagram to this
point in the chapter. The mathematician’s deﬁnition
ofgraph,however,isasetofnodesconnectedbyedges,asinFigure5. 13.Gnuplot
canonlyplot; if youhavenetwork datathatyouwould like to v isualize,Graphviz
is the package to use. Like all of the tools in this book, Graph viz installs itself
gracefullyviayourpackagemanager.
The packageincludes variousexecutables,the most notable of which are /CS/D3/D8and/D2/CT/CP/D8/D3. Both take the same input ﬁles, but /CS/D3/D8produces a ﬂowchart where there
is a deﬁnite beginningand end,while /D2/CT/CP/D8/D3producesmore amorphousplots that
aim onlyto groupnodesvia thelinks connectingthem.
Theprogramsaresimilarto Gnuplotin thattheytakeinaplai n textdescriptionof
the nodes and edges, and produce an output ﬁle in any of a pleth ora of graphics
formats. The syntaxfor the input ﬁles is entirely different from Gnuplot’s, but the
concept is familiar: there are elements to describe setting s interspersed with data
elements.
For example, ﬂip back to page 3 and have a look at Figure 1.3. Pr oduce the ﬁrst
graphinthe ﬁgureusingthe following inputto /CS/D3/D8:
digraph {
rankdir = LR;
node [shape=box];
"Data"−> "Estimation"−> "Parameters";
}
The lines with /BPin them set parameters, stating that the graph should read le ft-
to-right instead of the top-to-bottom default, and that the nodes should be boxes
insteadofthe defaultellipses.Theline with the /B9/BQs deﬁneshowthe nodesshould
link,andalreadylookslikea textversionofFigure 1.3.The commandline
dot−Tpng<graphdata.dot > output.png
gsl_stats March24,2009
GRAPHICS 183
Figure 5.13 The social network of aJunior Highclassroom.
producesa graphmuchlike thatin Figure1.3,in thePNG forma t.7
Atthispoint,youhaveallthetoolsyouneedtoautogenerate agraph.Forexample,
say that you have an n×ngrid where a one in position (i,j)indicates a link
betweenagents iandjandazeroindicatesnolink.Thenasimple /CU/D3/D6loopwould
convertthisdataintoa /D2/CT/CP/D8/D3-plottableﬁle,withaseriesofrowswithaform like,
e.g., /D2/D3/CS/CT/BF/BE /B9/BQ /D2/D3/CS/CT/BD/BE.
voidproduce_network_graph( apop_data *link_data, char*outﬁle){
FILE*g= fopen(outﬁle,"w");
fprintf(g,"digraph{\n");
for(inti=0;i< link_data−>matrix−>size1;i++)
for(intj=i+1; j<link_data−>matrix−>size2;j++)
if(apop_data_get(link_data,i,j))
fprintf(g, "node%i−> node%i;\n", i,j);
fprintf(g,"}\n");
fclose(g);
}
In the code supplement, you will ﬁnd a ﬁle named /CS/CP/D8/CP/B9/D0/CP/D7/D7/D6/D3/D3/D1 , which lists
the survey results from a Junior High classroom in LA, in whic h students listed
7ThesecondhalfofFigure1.3wasproducedusingexactlythes amegraph,plusthe /D4/D7/CU/D6/CP/CVpackagetoreplace
text likeDatawith the OLS-speciﬁc math shown in the ﬁgure.
gsl_stats March24,2009
184 CHAPTER 5
theirﬁvebestfriends.The egocolumnisthestudentwriting downthenameofhis
or her best friend, and the nomineecolumn gives the number of the best friend.
Figure 5.13 graphs the classroom, using /D2/CT/CP/D8/D3and the following options for the
graph:
digraph{
node [label="",shape=circle,height=0.12,width=0.12];
edge [arrowhead=open,arrowsize=.4];
...
}
Afewpatternsareimmediatelyevidentin thegraph:attheri ghtisagroupoffour
students who form a complete clique, but do not seem very inte rested in the rest
of the class. The student above the clique was absent the day o f the survey and
thus is nominated as a friend but has no nominations him or her self; similarly for
one studentat the lower left. Most of the graph is made from tw o large clumps of
studentswhoarecloselylinked,attheleftandinthecenter ,probablyrepresenting
the boys and the girls. There are two students who nominated t hemselves as best
friends(oneattoprightandoneatthebottom),andthosetwo studentsarenotvery
popular.
Q5.7Write a programto replicateFigure5.13.
• Read the /CS/CP/D8/CP/B9/D0/CP/D7/D7/D6/D3/D3/D1 ﬁle into an /CP/D4/D3/D4/CN/CS/CP/D8/CP set, using either/CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/D8/D3/CN/CS/CQ andaquery,or /CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/D8/D3/CN/CS/CP/D8/CP .
• Openyouroutputﬁle,andcopyinthe headerfrom above.
• Write a single /CU/D3/D6loop to write one line to the output ﬁle for each
line inthe dataset.Baseyourprinting functionon theonefr om page
183.
• Closetheﬁle.
Runningtheprogram will producea /D2/CT/CP/D8/D3-formatted ﬁle.
• From the command line, run /D2/CT/CP/D8/D3 /B9/CC/D4/D7 /BO/D1/DD/CN/D3/D9/D8/D4/D9/D8 /BQ/D3/D9/D8/BA/CT/D4/D7.Theoutputgraphshouldlookjustlike Figure5.13.
• In the /CS/D3/D8manual ( /D1/CP/D2 /CS/D3/D8from the command line), you will see
that there are many variant programs to produce different ty pes of
graph.Whatdoestheclassroomlooklikevia /CS/D3/D8, /CX/D6/D3,and /D8/DB/D3/D4/CX?
The exercise on page 414 will show you another way to produce t he
Graphviz-readableoutputﬁle.
gsl_stats March24,2009
GRAPHICS 185
Internal use Ifyouhavebeenstickingtothephilosophyofcodingviasmal l,simple
functionsthatcalleachother,yourcodewilllooklikeaset ofelements
linked via function calls—exactly the sort of network for wh ich Graphviz was
written. If you feel that your code ﬁles are getting a bit too c omplex, you can use
Graphviztogetthebig picture.
For example, say that your database is growing involved, wit h queries that merge
tablesintonewtables,otherqueriestosplitthetablesbac kintostillmoretables,et
cetera.Foreachquery thatcreatesatable, it is easyto writ e downa line (or lines)
like /CQ/CP/D7/CT/CN/D8/CP/CQ /B9/BQ /CW/CX/D0/CS/CN/D8/CP/CQ . Then, /CS/D3/D8can sort all those individual links into
arelativelycoherentﬂowfrom rawdatato ﬁnaloutput.8
You could also graph the calling relationships among the fun ctions in your C
code—but before you start manually scanning your code, you s hould know that
there is a program to do this for you. Ask your package manager for /CS/D3/DC/DD/CV/CT/D2,
which generates documentation via specially-formatted co mments in the source
ﬁle. If conﬁguredcorrectly, it will use Graphviz to include call graphs in the doc-
umentation.
The online code supplement includes a few more examples of Gr aphviz at work,
includingthecodeusedto createFigures1.1,6.5,and6.7.
®The Graphviz package produces graphs from a list of nodes and
edges.Suchlists are easyto autogeneratefrom C.
®YoucanalsouseGraphviztokeeptrackofrelationshipsamon gfunc-
tions inyourcodeortablesin yourdatabase.
5.8 /F4PRINTING AND LATEXThis book focuses on tools to write replicable,
portableanalyses,whereeverystepisdescribed
inahandfulofhuman-legibletextﬁlesthataresenttoprogr amsthatbehaveinthe
samemanneronalmostanycomputer.TheT EXdocumentpreparationsystem(and
the set of macrosbuilt on top of it, L ATEX) extendthe pipeline to the ﬁnalwriteup.
For example, you can easily write a script to run an analysis a nd then regenerate
theﬁnaldocumentusingupdatedtablesandplots.9
8SQL does not have the sort of metadata other systems have for d escribing a table’s contents in detail (e.g.,
the /CP/D4/D3/D4/CN/CS/CP/D8/CP structure’s /D8/CX/D8/D0/CTelement). But you can set up a metadata table, with a column fo r the table
name,itsdescription, andthetables thatgenerated thatta ble. Suchatableisreasonably easytomaintain, because
you need only add an /CX/D2/D7/CT/D6/D8 /CX/D2/D8/D3 /D1/CT/D8/CP/CS/CP/D8/CP /BA/BA/BAquery above any query that generates a table. Q: Write a
function totake insuch atable andoutput aﬂowchart demonst rating theﬂowofdata through thedatabase tables.
9Toanswer somequestions youareprobably wondering: yes,th isbookisaL ATEXdocument. Mostoftheplots
wereproducedvia /D7/CT/D8 /D8/CT/D6/D1 /D0/CP/D8/CT/DCinGnuplot,tominimizecomplications withsendingPostscr ipttothepress.
Save for the pointer-and-box diagrams in the C chapter, Stud ent’s hand-drawn menagerie, and the snowﬂake at
gsl_stats March24,2009
186 CHAPTER 5
A complete tutorial on L ATEX would be an entire book—which has already been
written dozens of times. But this chapter’s discussion of th e pipeline from raw
data to output graphs is incomplete without mention of a few u npleasant details
regardingplotsin L ATEX.
You have two options when putting a plot in a T EXed paper: native L ATEX and
Postscript.
Native format Just as you can set the output device to a screen or a Postscrip t
printer, you can also send it to a ﬁle written using L ATEX’s graphics
sub-language.One the plus side, the fonts will be identical to those in your docu-
ment, and the resolution is that of T EX itself (100 times ﬁner than the wavelength
ofvisiblelight). On theminusside,somefeatures,suchasc olor, arecurrently not
available.
Producing a plot in L ATEX format requires setting the same /D8/CT/D6/D1/ /D3/D9/D8settings as
with anyothertypeofoutput: /D7/CT/D8 /D8/CT/D6/D1 /D0/CP/D8/CT/DC/BN /D7/CT/D8 /D3/D9/D8 /B3/D4/D0/D3/D8/BA/D8/CT/DC/B3 .10
Just as you can dump one C ﬁle into another via /AZ/CX/D2/D0/D9/CS/CT , you can include the
Gnuplotoutputvia the \ /CX/D2/D4/D9/D8command:
\documentclass{article}
\usepackage{latexsym}
\begin{document}
...
\begin{ﬁgure}
\input outﬁle.tex
\caption{Thisﬁgure was autogenerated bya C program.}
\end{ﬁgure}
...
\end{document}
Another common complaint: the Y-axis label isn’t rotated properly. The solution
providesagoodexampleofhowyoucaninsertarbitraryL ATEXcodeintoyourGnu-
plot code.First, in the Gnuplotﬁle, you canset the labelto a nyset ofinstructions
thatLATEXcanunderstand.Let λbeanarbitrarylabel;thenthefollowingcommand
will write the labelandtellL ATEXto rotate it appropriately:
the head ofevery chapter, I madeapoint of producing the enti re book using only the tools it discusses.
The snowﬂake was generated by covering a triangle with a unif orm-by-area distribution of dots, each with a
randomly selected color and size, and then rotating the tria ngle to form the ﬁgure. Therefore, any patterns you
seebeyond the six-sided rotational symmetry are purely apo phenia.
And in my experience helping others build data-to-publicat ion pipelines, the detail discussed in this section
about rotating the Y-axis label really isacommon complaint.
10By the way, for a single plot, the /D7/CT/D8 /D3/D9/D8command is optional, since you could also use apipe: /CV/D2/D9/D4/D0/D3/D8/BO /D4/D0/D3/D8/D1/CT /BQ /D3/D9/D8/CU/CX/D0/CT/BA/D8/CT/DC .
gsl_stats March24,2009
GRAPHICS 187
set ylabel ’\rotatebox{90}{Your $\lambda$ here.}’
Twoﬁnalnotestocompletetheexample: \ /D6/D3/D8/CP/D8/CT/CQ/D3/DC isinthe /CV/D6/CP/D4/CW/CX/DC package,
soit needsto becalledin thedocumentpreamble:
\usepackage{latexsym,graphicx}
Second,manydviviewersdonotsupportrotation,soifyouar eviewingviaT EX’s
native dvi format, the rotation won’t appear. Use either /D4/CS/CU/D0/CP/D8/CT/DC or /CS/DA/CX/D4/D7to
viewtheoutputasitwill print.
The Postscript route Whichbringsustothesecondoptionforincludingagraphic:
Postscript.
Usethegraphicx packageto incorporatetheplot. E.g.:
\documentclass{article}
\usepackage{graphicx}
\begin{document}
...
\begin{ﬁgure}
\rotatebox{90}{\scalebox{.35}{\includegraphics{outﬁ le.eps}}}}
\caption{Thisﬁgure was autogenerated by a Cprogram.}
\end{ﬁgure}
...
\end{document}
Noticethatyouwillfrequentlyneedtorotatetheplot 90◦andscaletheﬁguredown
to areasonablesize.
The ﬁrstoption for generatingPDFs is to use /CT/D4/D7/D8/D3/D4/CS/CU . First, convertall ofyour/CT/D4/D7ﬁlesto /D4/CS/CUﬁleson thecommandline. In /CQ/CP/D7/CW,try
fori in*.eps;do
epstopdf $i;
done
Then,in yourL ATEXheader,add
\usepackage[pdftex]{epsﬁg}
gsl_stats March24,2009
188 CHAPTER 5
Thebeneﬁttothismethodisthatyoucannowrun /D4/CS/CU/D0/CP/D8/CT/DC /D1/DD/CN/CS/D3/D9/D1/CT/D2/D8 with-
outincident; the drawbackis that you now havetwo versionso f everyﬁgure clut-
teringupyourdirectory,andmustregeneratethePDFversio nofthegraphicevery
time youregeneratethe Postscriptversion.
Thealternativeis to gothroughPostscriptin generatingth e document:
latexa_report
dvips <a_report.dvi > a_report.ps
ps2pdf a_report.ps
Either method is a lot of typing, but there is a way to automate the process: the/D1/CP/CZ/CTprogram,whichisdiscussedindetailinAppendixA.Listing 5.14isasample
makeﬁle for producing a PDF document via the Postscript rout e. As with your C
programs,oncethemakeﬁleisinplace,youcangenerateﬁnal PDFdocumentsby
just typing /D1/CP/CZ/CTat the command line. The creative reader could readily combi ne
this makeﬁle with the sample C makeﬁle from page 387 to regene rate the ﬁnal
reporteverytimetheanalysisordataareupdated.( Hint:adda /CV/CT/D2/CN/CP/D0/D0 targetthat
dependsontheothertargets.Thattarget’s actionsmaybebl ank.)
DOCNAME = a_report
pdf:$(DOCNAME).pdf
$(DOCNAME).dvi: $(DOCNAME).tex
latex$(DOCNAME); latex$(DOCNAME)
$(DOCNAME).ps: $(DOCNAME).dvi
dvips−f < $(DOCNAME).dvi > $(DOCNAME).ps
$(DOCNAME).pdf:$(DOCNAME).ps
ps2pdf $(DOCNAME).ps $(DOCNAME).pdf
clean:
rm−f $(DOCNAME).blg$(DOCNAME).log$(DOCNAME).ps
Listing5.14 AmakeﬁleforproducingPDFsfromLATEXdocuments.Onlinesource: /C5/CP/CZ/CT/CU/CX/D0/CT/BA/D8/CT/DC .
®Once a plot looks good on screen, you can send it to an output ﬁl e
usingthe /D7/CT/D8 /D8/CT/D6/D1and /D7/CT/D8 /D3/D9/D8commands.
®Forprinting, youwill probably wantto use /D7/CT/D8 /D8/CT/D6/D1 /D4/D3/D7/D8/D7/D6/CX/D4/D8 .
For online presentation, use /D7/CT/D8 /D8/CT/D6/D1 /D4/D2/CVor /D7/CT/D8 /D8/CT/D6/D1 /CV/CX/CU. For
inserting into aL ATEXdocument,youcaneitherusePostscriptor /D7/CT/D8/D8/CT/D6/D1 /D0/CP/D8/CT/DC.
gsl_stats March24,2009
6
/F4MORE CODING TOOLS
If you have a good handle on Chapter 2, then you already have wh at you need to
write some very advanced programs. But C is a world unto itsel f, with hundreds
of utilities to facilitate better coding and many features f or the programmer who
wishesto delvefurther.
This chapter covers some additional programming topics, an d some details of C
and its environment. As with earlier chapters, the syntax he re is C-speciﬁc, but it
is the norm for programming languagesto havethe sort of feat ures and structures
discussedhere,somuchofthis chapterwill beusefulregard lessoflanguage.
The statistician reader can likely get by with just a skim ove r this chapter (with a
focus on Section 6.1), but readers working on simulations or agent-based models
will almostcertainly needto usethe structuresandtechniq uesdescribedhere.
The chapter roughly divides into three parts. After Section 6.1 covers functions
that operate on other functions, Section 6.2 will use such fu nctions to build struc-
tures that can hold millions of items, as one would ﬁnd in an ag ent-based model.
Section6.3showsthemanymannersin whichyourprogramscan takein parame-
ters from the outside world, including parameter ﬁles, eniv ornmentvariables, and
the command line. Sections 6.4 and 6.5 cover additional reso urces that make life
in front of a computer easier, including both syntactic tric ks in C and additional
programsusefulto programmers.
gsl_stats March24,2009
190 CHAPTER 6
6.1 F UNCTION POINTERS Adatapoint /CSisstoredsomewherein memory,so
we can refer to its address, /B2/CS. Similarly, a func-
tion /CUis storedsomewherein memory,sowecanreferto its addressa swell.
What is a pointer to a function good for? It lets us write Funct ions that will ac-
cept any function pointer and then use the pointed-to functi on. [Functions calling
functions is already confusing enough, so I will capitalize Function to indicate a
parentfunctionthattakesalower-casefunctionasaninput .]Forexample,aFunc-
tioncouldsearchforthelargestvalueofaninputfunctiono veragivenrange,ora
bootstrapFunction could take in a statistic-calculating f unction and a data set and
thenreturn thevarianceofthestatistic.
TYPESBeforewecanstartwritingFunctionstoactonfunctions,we needtotakethe
typeofinputfunctionintoconsideration.Ifafunctionexp ects /CX/D2/D8s,thenthe
compilerneedsto know this, so it canblock attempts to sendt he function a string
orarray.
The syntax for declaring a function pointer is based on the sy ntax for declaring a
function.SaythatwewanttowriteaFunctionthatwilltakei nanarrayof /CS/D3/D9/CQ/D0/CTs
plusafunction,andwillapplythefunctiontoeveryelement ofthearray,returning
anarrayof /CX/D2/D8s.Thentheinputfunctionhastohavea form like
intdouble_to_int ( doublex); (A)
Recall that a pointer declaration is just like a declaration for the pointed-to type
but with another star, like /CX/D2/D8 /B6/CX; the same goes for declaring function pointers,
but there are also extra parens.Here is a type for a function p ointer that takes in a/CS/D3/D9/CQ/D0/CTand returns a pointer to /CX/D2/D8; you can see it is identical to line A, but for
theadditionofa starandparens:
int(*double_to_int) ( doublex) (B)
Bytheway,ifthefunctionreturnedan /CX/D2/D8/B6insteadofaplain /CX/D2/D8,thedeclaration
wouldbe:
int*(*double_to_int)( double*x)
Thetypedeclarationsdonothingbythemselves,justasthew ord /CX/D2/D8doesnothing
by itself. But now that you know how to deﬁne a function type, y ou can put the
declarationofthefunctionintoyourheaderline.AFunctio nthatappliesafunction
to anarrayof /CS/D3/D9/CQ/D0/CTswouldhavea headerlike this:
int*apply (double*v,int(*instance_of_function)( doublex)); (C)
gsl_stats March24,2009
MORE CODING TOOLS 191
Putting /D8/DD/D4/CT/CS/CT/CU to work Areyouconfusedyet?Eachcomponentbasicallymakes
sense,buttogetheritisclutteredandconfusing.Thereis
awayout: /D8/DD/D4/CT/CS/CT/CU. Byputting thatwordbeforeline B—
typedefint (*double_to_int)( doublex);
—we have created an new type named /CS/D3/D9/CQ/D0/CT/CN/D8/D3/CN/CX/D2/D8 that we can use like any
othertype.Now,line C simpliﬁesto
int*apply (double*v,double_to_int instance_of_function);
1#include <apop.h>
2
3typedefdouble (*dfn) (double);
4
5doublesample_function ( doublein){
6returnlog(in)+ sin(in);
7 }
8
9voidplot_a_fn( doublemin,doublemax,dfnplotme){
10doubleval;
11 FILE *f = popen("gnuplot −persist","w");
12 if(!f)
13 printf("Couldn’tﬁndGnuplot.\n");
14 fprintf(f, "set key off\nplot ’ −’withlines\n");
15 for(doublei=min;i<max;i+= (max −min)/100.0){
16 val = plotme(i);
17 fprintf(f,"%g\t%g\n",i, val);
18 }
19 fprintf(f, "e\n");
20 }
21
22intmain(){
23 plot_a_fn(0, 15, sample_function);
24 }
Listing6.1 A demonstration of a Function that takes in any fu nction R→Rand plots it. Online
source: /D4/D0/D3/D8/CP/CU/D9/D2/D8/CX/D3/D2/BA .
Listing 6.1 shows a program to plot any function of the form R→R, using the
Gnuplot program described in Chapter 5. With a /D8/DD/D4/CT/CS/CT/CU in place, the syntax
is easy. You don’t need extra stars or ampersands in either th e declaration of the
Function-of-a-functionorinthecalltothatFunction,and youcancallthepointed-
to functionlike anyother.
gsl_stats March24,2009
192 CHAPTER 6
• Line3:Tomakelife easier,the /CS/CU/D2typeis declaredatthetop oftheﬁle.
• Line5:Theheaderforthe /D7/CP/D1/D4/D0/CT/CN/CU/D9/D2/D8/CX/D3/D2 matchestheformatofthe /CS/CU/D2func-
tion type(i.e., /CS/D3/D9/CQ/D0/CTin, /CS/D3/D9/CQ/D0/CTout).
• Line9:The /D4/D0/D3/D8/CN/CP/CN/CU/D2 Functionspeciﬁesthatit takesin afunction oftype /CS/CU/D2.
• Line16:Usingthepassed-infunctionisassimpleasusinga nyotherfunction:this
line givesnoindicationthat /D4/D0/D3/D8/D1/CTis in anywayspecial.
• Line 23: Finally, in /D1/CP/CX/D2, you can see how /D4/D0/D3/D8/CN/CP/CN/CU/D2 is called. The /D7/CP/D1/D4/D0/CT/CN/B9/CU/D9/D2/D8/CX/D3/D2 is passedin with justits name.
Foranotherexample,havealookat /CY/CP/CZ/CX/D8/CT/D6/CP/D8/CX/D3/D2/BA onpage132.
Q6.1Turn /D4/D0/D3/D8/CP/CU/D9/D2/D8/CX/D3/D2/BA into alibrary functioncallablebyotherprograms.
• Commentoutthe /D1/CP/CX/D2function.
• Write a header /D4/D0/D3/D8/CP/CU/D9/D2/D8/CX/D3/D2/BA/CW with the necesary type and func-
tion deﬁnitions.
• Write a test program that /AZ/CX/D2/D0/D9/CS/CT s /D4/D0/D3/D8/CP/CU/D9/D2/D8/CX/D3/D2/BA/CW and plots
the /CP/D0/CN/D8/CP/DC/CT/D7 functionfrom /D8/CP/DC/CT/D7/BA (p 118).
• Modify the makeﬁle to produce the ﬁnal program by creating a nd
linkingboth /DD/D3/D9/D6/CN/D3/CS/CT/BA/D3 and /D4/D0/D3/D8/CP/CU/D9/D2/D8/CX/D3/D2/BA/D3 .
Q6.2Deﬁne a type /CS/CU/D2as in line three of Listing 6.1. Then write a Function
with header /DA/D3/CX/CS /CP/D4/D4/D0/DD/B4/CS/CU/D2 /CU/D2/B8 /CS/D3/D9/CQ/D0/CT /B6/CP/D6/D6/CP/DD/B8 /CX/D2/D8 /CP/D6/D6/CP/DD/CN/D0/CT/D2/B5
thattakesasargumentsafunction,anarray,andthelengtho fthearray,and
changes each element /CP/D6/D6/CP/DD/CJ/CX℄ to /CU/D2/B4/CP/D6/D6/CP/DD/CJ/CX℄/B5 . [Apophenia provides
comparablefunctions;seepage117fordetails.]
TestyourFunctionbycreatinganarrayofthenaturalnumber s1,2,3,...20
andtransforming itto a listofsquares.
®Youcanpassfunctionsasfunctionarguments,justasyouwou ldpass
arraysornumbers.
®The syntax for declaring a function pointer is just like the s yntax for
declaring a function, but the name is in parens and is precede d by a
star. ≫
gsl_stats March24,2009
MORE CODING TOOLS 193
≫
®Deﬁning a new type to describe the function helps immensely. This
requires putting /D8/DD/D4/CT/CS/CT/CU in front of the function pointer declaration
in thelastsummarypoint.
®Once you have a /D8/DD/D4/CT/CS/CT/CU in place, you can declare Functions that
take functions, use the passed-infunctions, and call the pa rent Func-
tion asyou would expect.Giventhe /D8/DD/D4/CT/CS/CT/CU, you needneitherstars
norampersandsfortheseoperations.
6.2 D ATA STRUCTURES Saythatyouhaveafewmillion observationstostore
on your computer. You want to ﬁnd any given item
quickly, add or delete elements easily, and not worry too muc h about a compli-
cated organization system. There are several options for ba lancing these goals,
andchoosingamongthemisnottrivial. Thissectionwillcon siderthree:thearray,
thelinked list, andthebinarytree.
TheywillbeimplementedhereviaGlib,alibraryofgeneral- usefunctionsthatev-
eryCprogrammerseemstore-implement.Itincludesafewfea turesforstringhan-
dling and other such conveniences,and modules to handle the data structures de-
scribed here.1The extended example below provides documentation-by-exa mple
of initializing, adding to, removing from, and ﬁnding eleme nts within the various
structures, but your package manager will be happy to instal l the complete docu-
mentation,aswellasGlib itself.
AN EXAMPLE This game consists of a series of meetings between pairs of bi rds,
who compete over rutilsof resource.2If two doves meet, they split
the resource evenly between them. If a dove and a hawk meet, th e dove backs
down and the hawk gets the resource. If two hawks meet, then th e hawks ﬁght,
destroying cutils in resourcesbefore ﬁnallysplitting whatis left. Tab le6.2 shows
apayofftablesummarizingtheoutcomes.Foreachpairing,t herowplayergetsthe
ﬁrstpayoff,andthe columnplayergetsthesecond.
1Glib also provides a common data structure known as a hash table , which is another technique for easy data
retrieval. It converts a piece of data, such as a string, into a number that can then be used to jump to the string’s
data in a table very quickly. Binary trees tend to work better in the context of agent-based modeling, so I have
omitted hashes from this chapter. See Kernighan & Pike (1999 ), Chapter 3, for an extended example of hash
tables that produce nonsense text. It was intended as an amus ement (compare with the Exquisite Corpse-type
game played by Pierce (1980, p 262)), but is now commonly used to produce spam email. Q: Try implementing
Kernighan and Pike’s nonsense generator using Glib’s hash t ables, string hash functions, and list structures.
2Theutil is the unit of measurement for the quantity ofutilit y an agent gets from an action.
gsl_stats March24,2009
194 CHAPTER 6
dove hawk
dove(r
2,r
2) (0, r)
hawk(r, 0) (r−c
2,r−c
2)
Table 6.2 The payoff matrixfor the hawk/dove game. If c < r,then thisis a prisoner’s dilemma.
Withc < r, the game is commonly known as a prisoner’s dilemma , due to a
rather contrived story about two separated prisoners who mu st choose between
providing evidence about the other prisoner and remaining s ilent. Its key feature
is that being a dove (cooperating) always makes the agent wor se off than being a
hawk(notcooperating,which the literature calls defectio n). Theonly equilibrium
to the P.D. game is when nobody cooperates, destroying resou rces every period,
butthe societaloptimum is wheneveryonecooperates,produ cingrutils of utility
totaleverytime.
Ontopofthiswecanaddanevolutionarytwist:saythatabird thatisverysuccess-
ful will spawn chicks.In any one interaction, a bird gets an e qual or better payoff
as a hawk than as a dove, so it seems that over time, the hawks wo uld approach
100% of the population.In the simulation below, a bird’s odd sof reproducingare
proportional to the percentageof total ﬂock wealth the bird holds, and its odds of
dyingareinverselyproportionalto thesame.
Tosimulate the game,we will needa ﬂockofbirds. Havea look a tthe headerﬁle/CQ/CX/D6/CS/D7/BB/CQ/CX/D6/CS/D7/BA/CW in the online code supplement. It begins by describing the ba sic
structurethattherestofthefunctionsdependupon,descri binga singlebird:
typedefstruct {
chartype;
intwealth;
intid;
} bird;
Theheaderthenliststwotypesoffunction.Theﬁrstarefunc tionsforeachrelevant
action in the simulation: startup, births, deaths,and actu alplaysof the hawk/dove
game.Thesecondgrouparefunctionsforﬂockmanagement,su chascountingthe
ﬂockoriterating overeverymemberoftheﬂock.
The ﬁrst set of functions are implemented in Listing 6.3. Eac h function, taken
individually, should make sense: /D4/D0/CP/DD/CN/CW/CS/CN/CV/CP/D1/CT takes in two birds and modiﬁes
theirpayoffaccordingtothegamerulesabove; /CQ/CX/D6/CS/CN/D4/D0/CP/DD/D7 takesinasinglebird,
ﬁndsanopponent,andthenhasthem playagainsteachother;e tcetera.
gsl_stats March24,2009
MORE CODING TOOLS 195
#include "birds.h"
#include <time.h>
gsl_rng*r;
intperiods =400;
intinitial_pop =1000;
intid_count =0;
voidplay_hd_game( bird*row,bird*col){
doubleresource =2,
cost =2.01;
if(row−>type == ’d’ &&col −>type == ’h’)
col−>wealth +=resource;
else if(row−>type == ’h’ &&col −>type == ’d’)
row−>wealth += resource;
else if(row−>type == ’d’ &&col −>type == ’d’){
col−>wealth +=resource/2;
row−>wealth += resource/2;
}else{//hawk vhawk
col−>wealth +=(resource −cost)/2;
row−>wealth += (resource −cost)/2;
} }
voidbird_plays( void*in,void*dummy_param){
bird*other;
while(!(other =ﬁnd_opponent(gsl_rng_uniform_int(r,id_coun t))) &&(in !=other))
;//do nothing.
play_hd_game(in, other);}
bird*new_chick( bird*parent){
bird*out=malloc( sizeof(bird));
if(parent)
out−>type =parent−>type;
else{
if(gsl_rng_uniform(r) >0.5)
out−>type =’d’;
else
out−>type =’h’;
}
out−>wealth =5 *gsl_rng_uniform(r);
out−>id =id_count;
id_count ++;
returnout;}
voidbirth_or_death( void*in,void*t){
bird*b= in;//cast void to bird;
int*total_wealth =t;
if(b−>wealth*20./*total_wealth >= gsl_rng_uniform(r))
add_to_ﬂock(new_chick(b));
if(b−>wealth*800./*total_wealth <= gsl_rng_uniform(r))
free_bird(b);}
voidstartup(intinitial_ﬂock_size){
ﬂock_init();
r =apop_rng_alloc(time(NULL));
printf("Period\tHawks\tDoves\n");
for(inti=0;i<initial_ﬂock_size; i++)
add_to_ﬂock(new_chick(NULL));}
gsl_stats March24,2009
196 CHAPTER 6
intmain(){
startup(initial_pop);
for(inti=0; i<periods;i++){
ﬂock_plays();
count(i);
}}
Listing6.3 The birds.Online source: /CQ/CX/D6/CS/D7/BB/CQ/CX/D6/CS/D7/BA
Now for the ﬂock management routines, which will be implemen ted three times:
asanarray,asalist, andasa binarytree.
ARRAYS Anarrayisassimpleasdatarepresentationcanget:justwri teeachelement
right after the other. The matrices and vectors throughout t his book keep
theirdatain arraysofthistype.
The system can retrieve an item from an array faster than from any other data
structure,sincetheprocessconsistsofsimplygoingtoaﬁx edlocationandreading
the data there. On the other hand, adding and deleting elemen ts from an array is
difﬁcult:thesimulationhastocall /D6/CT/CP/D0/D0/D3 everytimethelistexpands.Ifyouare
lucky, /D6/CT/CP/D0/D0/D3 will not move the array from its current location, but will si mply
ﬁnd that there is more free space for the array to grow. If you a re not lucky, then
thearray will havetobemovedin its entirety to anew,moresp acioushome.
An array can not have a hole in the middle, so elements can not b e deleted by
freeing the memory. There are a few solutions, none of which a re very pleasant.
The last element of the list could be moved in to the space, req uiring a copy, a
shrinking of the array, and a loss of order in the elements. If order is important,
every element could be shifted down a notch, so if item 50 is de leted, item 51 is
put in slot 50, item 52 is put in slot 51, et cetera. Thus, every death could mean a
callto /D1/CT/D1/D1/D3/DA/CT to executethousandsormillions ofcopyoperations.
Listing 6.4 marks dead birds by setting their /CX/CSto /B9/BD. This means that as the
program runs, more and more memory is used by dead elements, a nd the rest of
thesystemmustcheckforthe markerateveryuse.
As for ﬁnding an element, /CP/CS/CS/CN/D8/D3/CN/CU/D0/D3/CZ takes pains to ensure that the /CX/CSand
array index will always match one-to-one, so ﬁnding a bird gi ven its id number
is trivial. As with the code above, the code consists of a larg e number of short
functions, meaning that it is reasonably easy to understand , read, and write each
functionbyitself.
gsl_stats March24,2009
MORE CODING TOOLS 197
#include "birds.h"
bird*ﬂock;
intsize_of_ﬂock,hawks,doves;
voidﬂock_plays(){
for(inti=0; i< size_of_ﬂock;i++)
if(ﬂock[i].id >= 0)
bird_plays(&(ﬂock[i]),NULL);}
voidadd_to_ﬂock( bird*b){
size_of_ﬂock =b−>id;
ﬂock =realloc(ﬂock, sizeof(bird)*(size_of_ﬂock+1));
memcpy(&(ﬂock[b−>id]),b,sizeof(bird));
free(b); }
voidfree_bird( bird*b){ b−>id =−1;}
bird*ﬁnd_opponent( intn){
if(ﬂock[n].id >= 0)
return&(ﬂock[n]);
else return NULL;}
intﬂock_size(){ returnsize_of_ﬂock;}
intﬂock_wealth(){
inti,total =0;
for(i=0; i<size_of_ﬂock;i++)
if(ﬂock[i].id >= 0)
total +=ﬂock[i].wealth;
returntotal;}
doublecount(intperiod){
inti,tw =ﬂock_wealth();
hawks =doves =0;
for(i=0;i<size_of_ﬂock;i++)
if(ﬂock[i].id>=0)
birth_or_death(&(ﬂock[i]),&tw);
for(i=0;i<size_of_ﬂock;i++)
if(ﬂock[i].id>=0){
if(ﬂock[i].type == ’h’)
hawks ++;
elsedoves ++;
}
printf("%i\t%i\t%i\n",period, hawks, doves);
return(doves+0.0)/hawks;}
voidﬂock_init(){
ﬂock = NULL;
size_of_ﬂock = 0;}
Listing6.4 The birds, array version. The fatal ﬂaw is that bi rds are copied in, but never eliminated.
Deadbirds willeventuallypile up. Online source: /CQ/CX/D6/CS/D7/BB/CP/D6/D6/CP/DD/CU/D0/D3/CZ/BA
gsl_stats March24,2009
198 CHAPTER 6
Q6.3Because the /D4/D0/CP/DD/CN/CW/CS/CN/CV/CP/D1/CT function sets r== 2andc== 2.01, hawks
lose0.005utilswhentheyﬁght,soitismarginallybetterto beadovewhen
meetingahawk,andthegameis notquite a prisoner’sdilemma .After run-
ning the simulation a few times to get a feel for the equilibri um number
of birds, change cto2.0and see how the equilibrium proportion of doves
changes.[Foryourconvenience,asamplemakeﬁleisinclude dinthe /CQ/CX/D6/CS/D7
directoryofthecodesupplement.]
Finally, rename /D1/CP/CX/D2to /D3/D2/CT/CN/D6/D9/D2 and wrap it in a function that takes in a
value of cand returns the proportion of doves at the end of the simulati on.
Send the function to the /D4/D0/D3/D8/CN/CP/CN/CU/D9/D2/D8/CX/D3/D2 function from earlier in the
chapterto produceaplot.
Q6.4Rewrite /CP/D6/D6/CP/DD/CU/D0/D3/CZ/BA to delete birds instead of just mark them as dead.
Use /D1/CT/D1/D1/D3/DA/CT to close holes in the array, then renumber birds so their /CX/CS
matches the array index. Keep a counter of current allocated size (which
may be greater than the number of birds) so you can /D6/CT/CP/D0/D0/D3 the array
onlywhennecessary.
LINKED LISTS Alinked list is a set of /D7/D8/D6/D9/D8s connected by pointers. The ﬁrst/D7/D8/D6/D9/D8includes a /D2/CT/DC/D8pointer that points to the next element,
whose /D2/CT/DC/D8pointerpointsto the nextelement,etcetera;seeFigure6.5 .
Bird 1 
next Bird 2 
next Bird 3 
next Bird 4 
NULL
Figure 6.5 The archetypal linkedlist.Online source: /D0/CX/D7/D8/BA/CS/D3/D8 .
The linked list is a favorite for agent-basedsimulation, be causebirth and death is
easytohandle.Toaddanelementtoalinkedlist,justcreate anewnodeandreplace
the /C6/CD/C4/C4pointer at the end of the list with a pointer to the new node. De leting a
node is also simple: to delete bird 2, simply reroute the /D2/CT/DC/D8pointer from bird
1→2sothatitpointsfrom bird 1→3, andthen freethe memoryholdingbird 2.
But the real failing of the linked list is the trouble of ﬁndin g an arbitrary element.
Inanarray,ﬁndingthetenthousandthelementiseasy: /CU/D0/D3/CZ/CJ/BL/BL/BL/BL℄ .Youcansee
inthecodeofListing6.6thatglibprovidesa /CV/CN/D0/CX/D7/D8/CN/D2/D8/CW/CN/CS/CP/D8/CP functiontoreturn
thenthelementof the list, which makesit look simple, butthe only w ay that that
functioncanﬁndthetenthousandthmemberofthe /CU/D0/D3/CZisto startattheheadof
the list andtake9,999 /B9/BQ/D2/CT/DC/D8steps.In fact, if youcompile andrun this program,
gsl_stats March24,2009
MORE CODING TOOLS 199
youwill seethatit runsmuchmore slowlythanthe arrayandtr eeversions.
#include "birds.h"
#include <glib.h>
GList*ﬂock;
inthawks,doves;
voidﬂock_plays(){ g_list_foreach(ﬂock,bird_plays,NULL);}
voidadd_to_ﬂock( bird*b){ﬂock =g_list_prepend(ﬂock,b);}
voidfree_bird( bird*b){
ﬂock =g_list_remove(ﬂock, b);
free(b); }
bird*ﬁnd_opponent( intn){returng_list_nth_data(ﬂock,n);}
voidwealth_foreach( void*in,void*total){
*((int*)total) +=(( bird*)in)−>wealth;}
intﬂock_wealth(){
inttotal =0;
g_list_foreach(ﬂock,wealth_foreach, &total);
returntotal;}
intﬂock_size(){ returng_list_length(ﬂock);}
voidbird_count( void*in,void*v){
bird*b= in;
if(b−>type ==’h’)
hawks ++;
elsedoves ++;
}
doublecount(intperiod){
inttotal_wealth =ﬂock_wealth();
hawks =doves =0;
g_list_foreach(ﬂock,birth_or_death,&total_wealth);
g_list_foreach(ﬂock,bird_count,NULL);
printf("%i\t%i\t%i\n",period, hawks, doves);
return(doves+0.0)/hawks;}
voidﬂock_init(){ﬂock =NULL;}
Listing6.6 Thebirds,linkedlistversion.Thefatalﬂawist hatﬁndingagivenbirdrequirestraversing
the entire listevery time.Online source: /CQ/CX/D6/CS/D7/BB/D0/CX/D7/D8/CU/D0/D3/CZ/BA
• The /CV/CN/D0/CX/D7/D8/CN/CU/D3/D6/CT/CP/CW function implements exactly the sort of apply-function-to -
listsetupimplementedinSection6.1.Ittakesinalistanda function,andinternally
appliesthe functionto eachelement.
• The folks who wrote the Glib library could not have known any thing about the/CQ/CX/D6/CSstructure, so how could they write a linked list that would ho ld it? The so-
lution is /DA/D3/CX/CSpointers—that is, a pointer with no type associated, which c ould
therefore point to a location holding data of any type whatso ever. For example,
gsl_stats March24,2009
200 CHAPTER 6/CQ/CX/D6/CS/CN/D3/D9/D2/D8 takesin two voidpointers,theﬁrstbeingtheelementheldin thelist,
and the second being any sort of user-speciﬁed data (which in this case is just
ignored).
• The ﬁrst step in using a void pointer is castingit to the corr ect type. For example,
the ﬁrst line in /CQ/CX/D6/CS/CN/D3/D9/D2/D8 — /CQ/CX/D6/CS /B6/CQ /BP /CX/D2/BN—points /CQto the same address as/CX/D2,butsince /CQhasatypeassociated,it canbeusedasnormal.
• Asfor addingandremoving,the Glib implementation ofthe l ist takesin a pointer
to a /BZ/C4/CX/D7/D8and a pointer to the data to be added, and returns a new pointer to
a /BZ/C4/CX/D7/D8. The input and output pointers could be identical, but since this is not
guaranteed,use the form here to reassign the list to a new val ue for every add/de-
lete. For example, the ﬂock starts in /CU/D0/D3/CZ/CN/CX/D2/CX/D8 as /C6/CD/C4/C4, and is given its ﬁrst
non- /C6/CD/C4/C4valueonthe ﬁrstcallto /CP/CS/CS/CN/D8/D3/CN/CU/D0/D3/CZ .
BINARY TREES Thebinary tree takes the linked list a step further by giving each
nodetwooutgoingpointersinsteadofone.AsperFigure6.7, think
ofthesepointersasthe leftpointerandtheright pointer.T hebranchingallowsfor
a tree structure. The directions to an element are now less th an trivial—to get to/CQ/CX/D6/CS/BH, start at the head ( /CQ/CX/D6/CS/BD), then go left, then go right. But with eight data
pointsin alinkedlist, youwouldneeduptosevenstepsto get to anyelement,and
on average 3.5 steps. In a tree, the longest walk is three step s, and the average is
1.625 steps. Generally, the linked list will require on the o rder of nsteps to ﬁnd
an item, and a b-tree will require on the order of ln(n)steps (Knuth, 1997, pp
400–401).3
The tree arrangement needs some sort of order to the elements , so the system
knows whether to go left or right at each step. In this case, th e /CX/CSfor each bird
providesanaturalmeansofordering.Fortextdata, /D7/D8/D6/D1/D4wouldprovideasimi-
larordering.More generally,theremustbea keyvalue givento eachelement,and
thetree structuremusthaveafunctionfor comparingkeys.
Eariler, you saw an interesting implementation of a set of bi nary trees: a data-
base. Since databases require fast access to every element, it is natural that they
wouldinternallystructuredatainabinarytree,andthisis exactlyhowSQLiteand
mySQLoperateinternally: eachnewindexis its owntree.
This adds some complication, because you now need to associa te with each tree
a function for comparing keys. In the code below, /CV/CN/D8/D6/CT/CT/CN/D2/CT/DB initializes a tree
usingthe /D3/D1/D4/CP/D6/CT/CN/CQ/CX/D6/CS/D7 function.
3Forthosewhofollowthereference,noticethatKnuthpresen tstheequation forthesumofpathlengths,which
hecalls theinternal pathlength.Heﬁndsthatitisoforder nln(n)+O(n)forcompletebinary trees;theaverage
path length is thus ln(n) +O(1).
gsl_stats March24,2009
MORE CODING TOOLS 201
bird 1 
left right bird 5 
left right 
bird 3 
left right bird 7 
left right 
bird 2 
left right bird 4 
left right bird 6 
left right bird 8 
left right 
Figure 6.7 The archetypal binary tree.Online source: /CQ/D8/D6/CT/CT/BA/CS/D3/D8 .
The /D3/D2/D7/D8keyword
The /D3/D2/D7/D8modiﬁers in the header for /D3/D1/D4/CP/D6/CT/CN/B9/CZ/CT/DD/D7indicate that the data towhich the pointers point
will not be changed over the course of the function.
As you can see by the fact that it has not appeared un-
til page 201, the /D3/D2/D7/D8keyword is mostly optional,
though it is good form and provides one more check
thatyourfunctions don’tdowhatyouhadn’tintended.
However, when conforming with function speciﬁca-
tions elsewhere, like GLib’s function header for key-
comparison functions, you may need to use it. If you
then get an error like ’subfunction’ discards qualiﬁers
from pointer target type , then you will need to rewrite
the subfunction so that it too takes /D3/D2/D7/D8inputs (and
does not modify them).What if two birds have the same/CX/CS? Then there is no way to order
them uniquely, and therefore there
is no way to reliably store and re-
trieve them. Thus, the key for each
elementmustbeunique.4
The added complication of a tree
solvesmany of the problems above.
As with the list, inserting and delet-
ing elements doesnotrequire major/D6/CT/CP/D0/D0/D3ing, although there is often
minor internal reshufﬂing to keep
the branches of the tree at about
even length. With the key and short
chains,ﬁndinganelementismuchfaster.
#include "birds.h"
#include <glib.h>
GTree*ﬂock =NULL;
inthawks,doves;
staticgint compare_keys( const void *L,const void *R){
const int *Lb=L;
const int *Rb =R;
return*Lb−*Rb;
}
4There exist tree implementations that do not require unique keys, but it is a requirement for GLib. Similarly,
somedatabases are very strict about requiring that each tab le have aﬁeld representing a key, and someare not.
gsl_stats March24,2009
202 CHAPTER 6
staticgboolean tree_bird_plays( void*key,void*in,void*v){
bird_plays(in,NULL);
return0;
}
voidﬂock_plays(){ g_tree_foreach(ﬂock,tree_bird_plays, NU LL);}
voidadd_to_ﬂock( bird*b){g_tree_insert(ﬂock,&(b −>id),b);}
bird*ﬁnd_opponent( intn){returng_tree_lookup(ﬂock,&n);}
intﬂock_size(){ returng_tree_nnodes(ﬂock); }
staticgboolean wealth_foreach( void*key,void*in,void*t){
int*total =t;
*total +=(( bird*)in)−>wealth;
return0; }
intﬂock_wealth(){
inttotal =0;
g_tree_foreach(ﬂock,wealth_foreach, &total);
returntotal;}
staticgboolean tree_bird_count( void*key,void*in,void*v){
if(((bird*)in)−>type == ’h’)
hawks ++;
elsedoves ++;
return0; }
GList*dying_birds;
voidfree_bird( bird*b){dying_birds =g_list_prepend(dying_birds, b);}
staticgboolean tree_birth_or_death( void*key,void*in,void*t){
birth_or_death(in, t);
return0; }
static void cull_foreach( void*b,void*v){
bird*a_bird =b;
g_tree_remove(ﬂock,&(a_bird −>id));
free(a_bird);}
doublecount(intperiod){
inttotal_wealth =ﬂock_wealth();
hawks =doves =0;
dying_birds =NULL;
g_tree_foreach(ﬂock,tree_birth_or_death,&total_weal th);
g_list_foreach(dying_birds,cull_foreach,NULL);
g_list_free(dying_birds);
g_tree_foreach(ﬂock,tree_bird_count,NULL);
printf("%i\t%i\t%i\n", period,hawks,doves);
return(doves+0.0)/hawks;}
voidﬂock_init(){ﬂock =g_tree_new(compare_keys);}
Listing6.8 The birds, binary tree version. The fatal ﬂaw is t he complication in maintaining the key
for everybird. Online source: /CQ/CX/D6/CS/D7/BB/D8/D6/CT/CT/CU/D0/D3/CZ/BA
gsl_stats March24,2009
MORE CODING TOOLS 203
• Culling the ﬂock is especially difﬁcult because a tree can i nternally re-sort when
anelementisadded/deleted,soitisimpossibletodeleteel ementswhiletraversing
atree.IntheimplementationofListing6.8,the /CU/D6/CT/CT/CN/CQ/CX/D6/CS functionactuallyfreed
the bird; here it just adds dying birds to a /BZ/C4/CX/D7/D8, and then another post-traversal
stepgoestthroughthe /BZ/C4/CX/D7/D8andcullmarkedbirdsfrom thetree.
®Therearevariousmeansoforganizinglargedatasets,sucha scollec-
tions ofagentsinanagent-basedmodel.
®Arrays are simply sequential blocks of structs. Pros: easy t o imple-
ment;youcangettothe 10,000thelementinonestep.Cons:noeasy
wayto add,delete,orreorganizeelements.
®Alinkedlistisasequenceofstructs,whereeachincludesap ointerto
thenextelementinthelist.Pro:adding/deleting/resorti ngelementsis
trivial. Con:Getting to the 10,000thelementtakes9,999steps.
®A binary tree is like a linked list, but each struct has a left a nd right
successor. Pros: adding and deleting is only marginally mor e difﬁ-
cult than with a linked list; getting to the 10,000thelement takes at
most13steps.Con:Eachelementmustbeaccessedviaaunique key,
addingcomplication.
6.3 PARAMETERS Your simulations and analyses will require tweaking. You
willwanttotrymoreagents,oryoumaywantyourprogram
to load adata setfrom a textﬁle to a databasefor onerun andth en usethedata in
thedatabaseforlaterruns.
This section will cover a cavalcade of means of setting param eters and speciﬁca-
tions,in increasingorderofeaseofuseanddifﬁcultyin imp lementation.
The ﬁrst option—a default of sorts—is to set variables at the top of your /BAﬁle
or a headerﬁle. This is trivial to implement, but you will nee d to recompile every
time youchangeparameters.
Interactive The second option is to interactively get parameters from th e user, via/D7/CP/D2/CUand /CU/CV/CT/D8/D7. Listing 6.9 shows a program that asks data of the
user and then returns manipulated data. The /D7/CP/D2/CUfunction basically works like/D4/D6/CX/D2/D8/CUin reverse, reading text with the given format into pointers to variables.
Unfortunately, the system tends to be rather fragile in the r eal world, as a stray
commaorperiodcanentirelythrowofftheformatstring.The /CU/CV/CT/D8/D7functionwill
gsl_stats March24,2009
204 CHAPTER 6
read an entire line into a string, but has its own quirks. In sh ort, the interactive
inputfeaturesaregoodforsomequickinterrogationsorabi toffun,butarenotto
beheavilyreliedupon.
#include <stdio.h>
#include <string.h> //strlen
intmain(){
ﬂoatindata;
chars[100];
printf("Give me a number:");
scanf("%g",&indata);
printf("Your number squared: %g\n",indata *indata);
printf("OK,now give me a string(maxlength,100):\n");
fgets(s,99, stdin); //eat anewline.
fgets(s,99, stdin);
printf("Here itis backward:\n");
for(inti=strlen(s)−2; i>=0; i−−)
printf("%c", s[i]);
printf("\n");
}
Listing6.9 Readinginputs from the command line.Online sou rce: /CV/CT/D8/D7/D8/D6/CX/D2/CV/BA .
Environment variables These are variables passed from the shell (aka the com-
mand prompt) to the program. They are relatively easy to
set, but are generally used for variables that are infrequen tly changing, like the
username.Environmentvariablesarediscussedatlengthin AppendixA.
Parameter ﬁles Thereare many libraries thatread parameterﬁles;consiste ntwith
the rest of this chapter, Listing 6.10 shows a ﬁle in Glib’s key ﬁle
format, which will be read by the program in Listing 6.11. The conﬁguration ﬁle
can be in a human language like English, you can modify it as mu ch as you want
without recompiling the code itself, it provides a permanen t record of parameters
foreachrun, andyoucanquicklyswitch amongsetsofvariabl es.
• The payoff for Listing 6.11 is on line 22: printing the name o f a distribution, a
parameter, and the mean of that distribution given that para meter. The program to
thatpointﬁndsthesethreeitems.
• Line seven indicates which section of Listing 6.10 the foll owing code will read.
Bycommentingoutline sevenanduncommentingline eight, th ecodewouldread
the Exponential section. Below, you will see that setting th e /D3/D2/CU/CX/CVvariable on
thecommandline is notdifﬁcult.
• Line 10 reads the entire /CV/D0/CX/CQ/BA/D3/D2/CU/CX/CV ﬁle into the /CZ/CT/DD/D7structure. If something
gsl_stats March24,2009
MORE CODING TOOLS 205
#gkeys.c reads this ﬁle
[chi squared conﬁguration]
distributionname =Chi squared
parameter =3
[exponential conﬁguration]
distributionname =Exponential
parameter =2.2
Listing6.10 Aconﬁguration inthe style of Glib’skey ﬁles.O nline source: /CV/D0/CX/CQ/BA/D3/D2/CU/CX/CV .
1#include <glib.h>
2#include <apop.h>
3
4intmain(){
5 GKeyFile *keys = g_key_ﬁle_new();
6 GError *e = NULL;
7char*conﬁg= "chi squared conﬁguration";
8//char*conﬁg ="exponential conﬁguration";
9double(*distribution)( double,double);
10 if(!g_key_ﬁle_load_from_ﬁle(keys,"glib.conﬁg",0, &e))
11 fprintf(stderr, e −>message);
12 doubleparam = g_key_ﬁle_get_double(keys,conﬁg,"parameter",& e);
13 if(e) fprintf(stderr,e−>message);
14 char*name =g_key_ﬁle_get_string(keys, conﬁg, "distributionn ame", &e);
15 if(e) fprintf(stderr,e−>message);
16
17 if(!strcmp(name,"Chisquared"))
18 distribution= gsl_cdf_chisq_Pinv;
19 else if(!strcmp(name,"Exponential"))
20 distribution= gsl_cdf_exponential_Pinv;
21
22 printf("Mean of a %s distributionwithparameter %g:%g\n ",name,
23 param, distribution(0.5, param));
24 }
Listing6.11 Aprogram that reads Listing6.10. Online sourc e: /CV/CZ/CT/DD/D7/BA.
goeswrong,thenline11printstheerrormessagestoredin /CT.Properly,theprogram
should exit at this point; for the sake of brevity the /D6/CT/D8/D9/D6/D2 /BClines have been
omitted.
• Now that /CZ/CT/DD/D7holds all the valuesin the conﬁgﬁle, lines 12 and14 can getin di-
vidual values. The two /CV/CN/CZ/CT/DD/CN/CU/CX/D0/CT/CN/CV/CT/D8/BA/BA/BA functions take in a ﬁlled key struc-
ture, a section name, a variable name, and a place to put error s. They return the
requestedvalue(oranerror).
gsl_stats March24,2009
206 CHAPTER 6
• Unfortunately, there is no way to specify functions in a tex t ﬁle but by name, so
lines 17–20 set the function pointer /CS/CX/D7/D8/D6/CX/CQ/D9/D8/CX/D3/D2 according to the name from
theconﬁgﬁle.
Q6.5Rewrite the code in Listing 6.11 to set parameters via databa se,rather than
viathecommandline.
• Write a text ﬁle with three columns: conﬁguration, paramet ers, and
data.
• Readin the ﬁleusing /CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/D8/D3/CN/CS/CQ atthe beginningof /D1/CP/CX/D2.
• Write a function with header /CS/D3/D9/CQ/D0/CT /CV/CT/D8/CN/D4/CP/D6/CP/D1/B4/CW/CP/D6 /B6/D3/D2/CU/CX/CV/B8/CW/CP/D6 /B6/D4/B5thatqueriesthe databasefor the parameternamed /D4in the
conﬁguration group /D3/D2/CU/CX/CVand returns its value. Then modify the
programtogetthedistributionanditsparameterusingthe /CV/CT/D8/CN/D4/CP/D6/CP/D1
function.
Command line Reading parameters from the command line can take the most ef -
fort to implement among the parameter-setting options here , but it
is the most dynamic, allowing you to change parameters every time you run the
program.YoucanevenwritebatchﬁlesinPerl,Python,orash ell-typelanguageto
runtheprogramwithdifferentparametervariants(andthus keeparecordofthose
variants).
The /D1/CP/CX/D2function takes inputs and producesan output like any other. The output
is aninteger /D6/CT/D8/D9/D6/D2edattheendof /D1/CP/CX/D2, whichis typically zeroforsuccessora
positiveintegerindicatingatypeoffailure.Theinputsar ealwaysaninteger,giving
thenumberofcommand-lineelements,anda /CW/CP/D6/B6/B6—anarrayofstrings—listing
thecommand-lineelementsthemselves.Like anyfunction sp eciﬁcation,the types
are non-negotiable but the internal name you choose to give t hese arguments is
arbitrary. However, the universal custom is to name them /CP/D6/CV(argument count)
and /CP/D6/CV/DA(argument values).5This is an ingrained custom, and you can expectto
seethosenameseverywhere.6
Listing6.12showstherudimentaryuseof /CP/D6/CVand /CP/D6/CV/DA.Hereis asampleusage
from my commandline:
5They are in alphabetical order in the parameters to /D1/CP/CX/D2, which provides an easy way to remember that the
count comes ﬁrst.
6Perl uses /CP/D6/CV/DA, Python uses /D7/DD/D7/BA/CP/D6/CV/DA , and Ruby uses /BT/CA/BZ/CE. All three structures automatically track array
lengths, sonone of these languages uses an /CP/D6/CVvariable.
gsl_stats March24,2009
MORE CODING TOOLS 207
#include <stdio.h>
intmain(intargc,char**argv){
for(inti=0;i< argc; i++)
printf("Command lineargument %i:%s\n", i, argv[i]);
}
Listing6.12 This program will simply print out the command l ine arguments given to it. Online
source: /CP/D6/CV/DA/BA.
>>> /home/klemens/argvone 2 −−three fo\ ur "cinco−−\"ﬁve\""
command lineargument 0: /home/klemens/argv
command lineargument 1: one
command lineargument 2: 2
command lineargument 3: −−three
command lineargument 4: four
command lineargument 5: cinco −−"ﬁve"
• Argument zero ( /CP/D6/CV/DA/CJ/BC℄) is always the name of the command itself. Some cre-
ative programs run differently if they are referred to by dif ferent names, but the
norm isto justskipover /CP/D6/CV/DA/CJ/BC℄.
• After that, the elements of /CP/D6/CV/DAare the command line broken at the spaces, and
couldbedashes,numbers,oranyothersortoftext.
• As you can see from the parsing of /CU/D3\ /D9/D6, a space preceded by a backslash is
takento beacharacterlike anyother,ratherthananargumen tseparator.
• Argumentﬁveshowsthateverythingbetweenapairofquotat ionmarksisasingle
argument,andabackslashonceagainturns thequotationmar k intoplain text.
For some purposes, this is all you will need to set program opt ions from your
command line. For example you could have one program to run th ree different
actionswith a /D1/CP/CX/D2like thefollowing:
intmain(intargc,int**argv){
if(argc == 1){
printf("Ineed a command line argument.\n")
return1;
}
if(!strcmp(argv[1],"read"))
read_data();
else if(!strcmp(argv[1], "analysis_1"))
run_analysis_1();
else if(!strcmp(argv[1], "analysis_2"))
run_analysis_2();
}
gsl_stats March24,2009
208 CHAPTER 6
Q6.6The /CP/D0/D0/CQ/DD/DA/CP/D0/BA program (Listing 2.5, page 38) calculated the factorial
ofanumberwhichwashard-codedinto /D1/CP/CX/D2.Rewriteittotakethenumber
from the command line, so /CU/CP/D8/D3/D6/CX/CP/D0 /BD/BHwill ﬁnd 15!. (Hint: the /CP/D8/D3/CX
function converts a text string to the integer it represents ; for example,/CP/D8/D3/CX/B4Ꜽ/BD/BHꜼ/B5 /BP/BP /BD/BH.)
getopt For more complexsituations, use /CV/CT/D8/D3/D4/D8, which parses commandlines for
switchesof the form /B9/DC/BA/BA/BA. It is part of the standard C library, so it is fully
portable.7
Listing6.13showsaprogramthatwilldisplayaseriesofexp onents.Asexplained
by the message on lines 9–14, you can set the minimum of the ser ies via /B9/D1, the
maximum via /B9/C5, and the increment via /B9/CX. Specify the base of the exponents
after the switches. Sample usage (which also demonstrates t hat spaces between
theswitchandthe dataareoptional):
>>> ./getopt−m 3−M4−i0.32
2^3: 8
2^3.3: 9.84916
2^3.6: 12.1257
2^3.9: 14.9285
Therearethreestepsto theprocess:
• /AZ/CX/D2/D0/D9/CS/CT /BO/D9/D2/CX/D7/D8/CS/BA/CW/BQ .
• Specify a set of letters indicating valid single-letter sw itches in a crunched-
together string like line 15 of Listing 6.13. If the switch ta kes in additional
info (here,everyswitchbut /B9/CW), indicatethis with a colonafterthe letter.
• Write a /DB/CW/CX/D0/CTloop to call /CV/CT/D8/D3/D4/D8(line 27), and then act based upon the
valueofthe /CW/CP/D6that /CV/CT/D8/D3/D4/D8returned.
• /CP/D6/CV/DAistext,butyouwilloftenwanttospecifynumbers.Thefunct ions /CP/D8/D3/CX, /CP/D8/D3/D0,
and /CP/D8/D3/CUconvertASCIItexttoan /CX/D2/D8, /D0/D3/D2/CV /CX/D2/D8, or /CS/D3/D9/CQ/D0/CT, respectively.8
7The GNU version of the standard C library provides a sublibra ry named /CP/D6/CV/D4that provides many more
functions and does more automatically, but is correspondin gly more complex and less portable. Glib also has a
subsection devoted to command-line arguments,which also p rovides manymorefeatures solongasthelibrary is
installed.
8Getoptreadily handlesnegative numbersthatarearguments toaﬂag( /B9/D1 /B9/BF),butanegativenumberafterthe
options willlook like just another ﬂag, e.g., /BA/BB/CV/CT/D8/D3/D4/D8 /B9/D1 /B9/BF /B9/C5 /BG /B9/BElooks as if there is aﬂag named /BE.The
special ﬂag /B9/B9indicates that /CV/CT/D8/D3/D4/D8should stop parsing ﬂags, so /BA/BB/CV/CT/D8/D3/D4/D8 /B9/D1 /B9/BF /B9/C5 /BG /B9/B9 /B9/BEwill work.
Thisisalso usefulelsewhere, such ashandling ﬁlesthat beg in with adash;e.g.,given aﬁlenamed /B9/CP/CN/D1/CX/D7/D8/CP/CZ/CT ,
you can delete itwith /D6/D1 /B9/B9 /B9/CP/CN/D1/CX/D7/D8/CP/CZ/CT .
gsl_stats March24,2009
MORE CODING TOOLS 209
1#include <stdio.h> //printf
2#include <unistd.h> //getopt
3#include <stdlib.h> //atof
4#include <math.h> //powf
5
6doublemin= 0.,max= 10.;
7doubleincr = 1.,base = 2.;
8
9voidshow_powers(){
10 for(doublei=min;i<=max;i+= incr)
11 printf("%g^%g:%g\n",base,i,powf(base,i));
12 }
13
14intmain(intargc,char**argv){
15 charc,opts[]="M:m:i:h";
16 charhelp[]= "A program totake powers of afunction.Usage:\n"
17 "\t\tgetopt [options] [a number]\n"
18 " −h\tThis help\n"
19 " −m\t The minimum exponent at whichtostart.\n"
20 " −M\tThe maximum exponent at whichtoﬁnish.\n"
21 " −i\tIncrement bythis.\n";
22
23 if(argc==1) {
24 printf(help);
25 return1;
26 }
27 while((c=getopt(argc, argv,opts))!= −1)
28 if(c==’h’){
29 printf(help);
30 return0;
31 } else if(c==’m’){
32 min= atof(optarg);
33 } else if(c==’M’){
34 max= atof(optarg);
35 } else if(c==’i’){
36 incr =atof(optarg);
37 }
38 if(optind <argc)
39 base = atof(argv[optind]);
40 show_powers();
41 }
Listing6.13 Command-line parsing with /CV/CT/D8/D3/D4/D8. Online source: /CV/CT/D8/D3/D4/D8/BA .
• /D3/D4/D8/CP/D6/CValso sets the variable /D3/D4/D8/CX/D2/CSto indicate the position in /CP/D6/CV/DAthat it last
visited. Thus, line 38 was able to check whether there are any non-switch argu-
mentsremaining,andline39couldparsetheremainingargum ent(if any)without/CV/CT/D8/D3/D4/D8’s help.
gsl_stats March24,2009
210 CHAPTER 6
• The program provides human assistance.If the user gives th e /B9/CWswitch or leaves
off all switches entirely, then the program prints a help mes sage and exits. Every
variablethatthe usercouldforget to setviathe commandlin e hasadefaultvalue.
Q6.7Listing 6.1 (page 191)is hard-codedto plot a rangefrom x= 0tox= 15.
Modify it to use /CV/CT/D8/D3/D4/D8to get a minimum and maximum from the user,
with zeroandﬁfteen asdefaults.Providehelpif theuseruse sthe /B9/CWﬂag.
®There are many ways to change a program’s settings without ha ving
to recompiletheprogram.
®Environment variables, covered in Appendix A, are a lightwe ight
meansofsettingvariablesinthe shellthattheprogram canu se.
®Therearemanylibrariesforparsingparameterﬁles,oryouc oulduse
SQLto pullsettingsfrom a database.
®The /D1/CP/CX/D2functiontakesinargumentslistedonthecommandline,and
some C functions (like /CV/CT/D8/D3/D4/D8) will help you parse those arguments
into programsettings.
6.4 /F4SYNTACTIC SUGAR ReturningtoCsyntax,thereareseveralwaystodo
almost everything in Chapter 2. For example, you
couldrewrite thethreelines
b= (i> j);
a += b;
i++;
as the single expression /CP/B7/BP/CQ/BP/CX/B7/B7/BQ/CY/BN . The seventhelementof the array /CZcanbe
called /CZ/CJ/BI℄, /B6/B4/CZ/B7/BI/B5, or—for the truly perverse— /BI/CJ/CZ℄. That is, this book over-
looks a great deal of C syntax, which is sometimes useful and e ven graceful, but
confusesaseasilyasitclariﬁes.
This section goes over a few more details of C syntax which are also not strictly
necessary, but have decent odds of being occasionally usefu l. In fact, they are
demonstrated a handful of times in the remainder of the book. If your interest is
piqued and you would like to learn more about how C works and ab out the many
alternativesthatnotmentionedhere,seetheauthoritativ eandsurprisinglyreadable
referencefor thelanguage,Kernighan& Ritchie (1988).
gsl_stats March24,2009
MORE CODING TOOLS 211
The obfuscatory if Thereisanotherwayto write an /CX/CUstatement:
if(a < b)
ﬁrst_val;
else
second_val;
/*is equivalent to */
a < b? ﬁrst_val :second_val;
Both have all three components: ﬁrst the condition, then the ‘what to do if the
condition is true’ part, and then the ‘what to do if the condit ion is false’ part.
However, the ﬁrst is more-or-less legible to anybody who kno ws basic English,
and the second takes the reader a secondto parse every time he or she sees it. On
theotherhand,thesecondversionis muchmorecompact.
The condensed form is primarily useful because you can put it on the right side
of an assignment.Forexample,in the /D2/CT/DB/CN/CW/CX/CZ function of Listing 6.3 (p 195),
yousawthe followingsnippet:
if(gsl_rng_uniform(r) > 0.5)
out−>type = ’d’;
else
out−>type = ’h’;
Usingtheobfuscatoryif, thesefourlines canbereducedto o ne:
out−>type = gsl_rng_uniform(r)> 0.5? ’d’ :’h’;
Macros As well as /AZ/CX/D2/D0/D9/CS/CT -ing ﬁles, the preprocessor can also do text substitu-
tion,whereit simplyreplacesonesetofsymbolswith anothe r.
TextsubstitutioncandoafewthingsCcan’tdoentirelybyit self.Forexample,you
may have encountered the detail of C that all global variable s must have constant
size (due to how the compiler sets them up).9Thus, if you attempt to compile the
following program:
9Global and static variables are initialized before the prog ram calls /D1/CP/CX/D2, meaning that they have to be al-
located without evaluating any non-constant expressions e lsewhere in the code. Local variables are allocated as
needed during runtime, so they can bebased on evaluated expr essions as usual.
gsl_stats March24,2009
212 CHAPTER 6
intarray_size =10;
inta[array_size];
intmain(){ }
you will get an error like /DA/CP/D6/CX/CP/CQ/D0/CT/B9/D7/CX/DE/CT /D8/DD/D4/CT /CS/CT/D0/CP/D6/CT/CS /D3/D9/D8/D7/CX/CS/CT /D3/CU /CP/D2/DD/CU/D9/D2/D8/CX/D3/D2 .
Theeasyalternativeistosimplyleavethedeclarationatth etopoftheﬁlebutmove
the initialization into /D1/CP/CX/D2, but you can also ﬁx the problem with /AZ/CS/CT/CU/CX/D2/CT. The
followingprogramwill compileproperly,becausetheprepr ocessorwillsubstitute
thenumber10for /BT/CA/CA/BT/CH/CN/CB/C1/CI/BX beforethe compilertouchesthecode:
#deﬁneARRAY_SIZE10
inta[ARRAY_SIZE];
intmain(){ }
Donotuseanequalssign ora semicolonwith /AZ/CS/CT/CU/CX/D2/CTs.
You can also /AZ/CS/CT/CU/CX/D2/CT function-type text substitutions. For example, here is the
codeforthe /BZ/CB/C4/CN/C5/C1/C6 macrofrom the /BO/CV/D7/D0/BB/CV/D7/D0/CN/D1/CP/D8/CW/BA/CW/BQ headerﬁle:
#deﬁneGSL_MIN(a,b)((a) < (b) ?(a): (b))
It would expand every instance in the code of /BZ/CB/C4/CN/C5/C1/C6/B4/CP/B8/CQ/B5 to the if-then-else
expressionin parens. /BZ/CB/C4/CN/C5/BT/CG is similarly deﬁned.
This is amacro,which is evaluateddifferently from a function. A function evalu-
atesits argumentsandthencallsthefunction,so /CU/B4/BE/B7/BF/B5isguaranteedto evaluate
exactlyas /CU/B4/BH/B5does.Amacroworksbysubstitutingoneblockoftextforanot her,
withoutregardto whatthattextmeans.If themacro is
#deﬁnetwice(x) 2 *x
then /D8/DB/CX/CT/B4/BE/B7/BF/B5 expandsto /BE/B6/BE/B7/BF, whichisnotequalto /D8/DB/CX/CT/B4/BH/B5 /BP /BE/B6/BH.
We thus arrive at the ﬁrst rule of macro writing, which is that everything in the
macro deﬁnition should be in parentheses, to prevent unfors een interactions be-
tweenthetexttobeinsertedandthe restofthe macro.
gsl_stats March24,2009
MORE CODING TOOLS 213
Repeated evaluation is another common problem to look out fo r. For example,/BZ/CB/C4/CN/C5/C1/C6/B4/CP/B7/B7/B8 /CQ/B5expandsto /B4/B4/CP/B7/B7/B5 /BO /B4/CQ/B5 /BR /B4/CP/B7/B7/B5 /BM /B4/CQ/B5/B5,meaningthat /CP
may be incremented twice, not once as it would with a function . Again, the ﬁrst
solutionistonotusemacrosexceptasalastresort,andthes econdistomakesure
callsto macrosareassimpleaspossible.
The one thing that a macro cando better than a function is take a type as an argu-
ment, because the preprocessor just shunts text around with out regard to whether
that text represents a type, a variable, or whatever else. Fo r example, recall the
form for reallocatingapointertoanarray of /CS/D3/D9/CQ/D0/CTs:
var_array = realloc(var_array,new_length *sizeof(double))
Thiscanberewritten with a macroto createa simplerform:
#deﬁneREALLOC(ptr,length,type)ptr = realloc((ptr),(length) *sizeof(type))
//whichisused like this:
REALLOC(var_array,new_length, double);
It gives you one more moving part that could break (and which n ow needs to be/AZ/CX/D2/D0/D9/CS/CT d with every ﬁle), but may make the code more readable. This ma cro
also gives yetanotherdemonstration of the importance of pa rens:without parens,
acalllike /CA/BX/BT/C4/C4/C7/BV/B4/D4/D8/D6/B8 /BK /B7 /BD/B8 /CS/D3/D9/CQ/D0/CT/B5 wouldallocate 8+sizeof (double )
bytesofmemory insteadof 9·sizeof (double )bytes.
• Ifyouneedto debugamacro,the /B9/BXﬂagto /CVwillrunonlythepreprocessor,so
youcanseewhatexpandstowhat.Youprobablywanttorun /CV /B9/BX /D3/D2/CT/CU/CX/D0/CT/BA/DG /D0/CT/D7/D7.
• Thecustomistoputmacronamesincapitals.Youcanrelyont hisincodeyousee
from others, and are encouraged to stick to this standard whe n writing your own,
asareminderthatmacrosarerelativelyfragileandtricky. Apophenia’smacroscan
bewritten usingeitherall-capsor,ifthatlookstoomuchli keyellingtoyou,using
onlyaninitial capital.
®Short /CX/CUstatements can be summarized to one line via the /D3/D2/CS/CX/B9/D8/CX/D3/D2 /BR /D8/D6/D9/CT/CN/DA/CP/D0/D9/CT /BM /CU/CP/D0/D7/CT/CN/DA/CP/D0/D9/CT form.
®You can use the preprocessor to /AZ/CS/CT/CU/CX/D2/CT constants and short func-
tions.
gsl_stats March24,2009
214 CHAPTER 6
6.5 M ORE TOOLS Since C is so widely used, there is an ecosystem of tools
builtaroundhelpingyoueasilywritegoodcode.Beyondthe
debugger,hereare afew moreprogramsthatwill makeyourlif e as aprogrammer
easier.
MEMORY DEBUGGER The setup is this: you make a mistake in memory handling
early in the program, but it is not fatal, so the program con-
tinuesalongusingbaddata.Lateronintheprogram,youdoso methinginnocuous
withyourbaddataandgetasegfault.Thisisapaintotraceus ing /CV/CS/CQ,sothereare
packagesdesignedto handlejustthis problem.
IfyouareusingtheGNUstandardlibrary(whichyouprobably areifyouareusing/CV), thenyoucanusetheshellcommand
export MALLOC_CHECK_=2
to set the /C5/BT/C4/C4/C7/BV/CN/BV/C0/BX/BV/C3/CN enviornment variable; see Appendix A for more on
environmentvariables.Whenitisnotsetorissettozero,th elibraryusestheusual/D1/CP/D0/D0/D3. When it is set to one, the library uses a version of /D1/CP/D0/D0/D3that checks
for commonerrors like double-freeingand off-by-oneerror s, and reports them on/D7/D8/CS/CT/D6/D6. When the variable is set to two, the system halts on the ﬁrst e rror, which
isexactlywhatyouwantwhenrunningvia /CV/CS/CQ.
Another common (and entirely portable) alternative is Elec tric Fence, a library
availableviayourpackagemanager.Italsoprovidesadiffe rentversionof /D1/CP/D0/D0/D3
that crashes on any mis-allocations and mis-reads. To use it , you would simply
recompile the program using the efence library, by either ad ding /B9/D0/CT/CU/CT/D2/CT to the
compilationcommandorthe /C4/C1/C6/C3/BY/C4/BT/BZ/CB lineinyourmakeﬁle(seeAppendixA).
REVISION CONTROL The idea behind the revision control system (RCS) is that
your project lives in a sort of database known as a reposi-
tory. When you want to work, you check out a copy of the project , and when you
are done making changes,you checkthe projectback in to the r epository and can
delete the copy. The repository makes a note of every change y ou made, so you
cancheckoutacopyofyourprogramasitlookedthreeweeksag oaseasilyasyou
couldcheckoutacurrentcopy.
This has pleasant psychological beneﬁts. Don’t worry about experimenting with
your code: it is just a copy, and if you break it you can always c heck out a fresh
copyfromtherepository.Also,nothingmatchestheconﬁden ceyougetfrommak-
ing major changes to the code and ﬁnding that the results prec isely match the
resultsfrom lastmonth.
gsl_stats March24,2009
MORE CODING TOOLS 215
Finally, revision control packages facilitate collaborat ion with coauthors. If your
changesare sufﬁciently far apart (e.g., you are working on o ne function and your
coauthor on another), then the RCS will merge all changes to a single working
copy. If it is unable to work out how to do so, then it will give y ou a clearly
demarcatedlistofchangesforyouto acceptorreject.
Thismethodalsoworksforanyothertextﬁlesyouhaveinyour life,suchaspapers
writteninL ATEX,HTML,oranyothertext-basedformat.Forexample,thisbo okis
underrevisioncontrol.
Thereis no universalstandardrevision controlsoftware, b utthe Subversionpack-
age is readily available via your package manager. For usage , see Subversion’s
own detailed manual describing set-up and operation from th e command line, or
askyoursearchengineforthe variousGUIs written aroundSu bversion.
THE PROFILER If you feel that your program is running too slowly, then the ﬁ rst
step in ﬁxing it is measurement.The proﬁlertimes how long every
function takesto execute,soyouknowuponwhich functionst o focusyourclean-
upefforts.
First, you need to add a ﬂag to the compilation to include proﬁ ler symbols, /B9/D4/CV.
Then, execute your program, which will produce a ﬁle named /CV/D1/D3/D2/BA/D3/D9/D8 in the
directory, with the machine-readable timings that the proﬁ ler will use.10Unlike
thedebugger’s /B9/CVoption,the /B9/D4/CVoptionmayslowdowntheprogramsigniﬁcantly
asitwrites to /CV/D1/D3/D2/BA/D3/D9/D8 , souse /B9/CValwaysand /B9/D4/CVonlywhennecessary.
Finally, call /CV/D4/D6/D3/CU /BA/BB/D1/DD/CN/CT/DC/CT/D9/D8/CP/CQ/D0/CT to produce a human-readable table from/CV/D1/D3/D2/BA/D3/D9/D8 .11See the manual ( /D1/CP/D2 /CV/D4/D6/D3/CU) for further details about reading the
output.
As with the debugger, once the proﬁler points out where the mo st time is being
taken by your program, what you need to do to alleviate the bot tleneck often be-
comesveryobvious.
If you are just trying to get yourprograms to run, optimizing for speed may seem
farfromyourmind.Butitcannonethelessbeaninterestinge xercisetorunamod-
estlycomplexprogramthroughtheproﬁlerbecause,likethe debugger’sbacktrace,
its outputprovidesanotherusefulviewofhowfunctionscal leachother.
10If the program is too fast for the proﬁler, then rename /D1/CP/CX/D2to /CX/D2/D8/CT/D6/D2/CP/D0/CN/D1/CP/CX/D2 and write a new /D1/CP/CX/D2
function with a /CU/D3/D6loop to call /CX/D2/D8/CT/D6/D2/CP/D0/CN/D1/CP/CX/D2 ten thousand times.
11/CV/D4/D6/D3/CUoutputs to /D7/D8/CS/D3/D9/D8; usetheusual shell tricks to manipulate the output, such as piping output through
a pager— /CV/D4/D6/D3/CU /BA/BB/D1/DD/CN/CT/DC/CT/D9/D8/CP/CQ/D0/CT /DG /D0/CT/D7/D7—or dumping it to a text ﬁle— /CV/D4/D6/D3/CU /BA/BB/D1/DD/CN/CT/DC/CT/D9/D8/CP/CQ/D0/CT /BQ/D3/D9/D8/CU/CX/D0/CT—that you can view in your text editor.
gsl_stats March24,2009
216 CHAPTER 6
Optimization The /CVcompiler can do a number of things to your code to make
it run faster. For example, it may change the order in which li nes of
codeare executed,orif youassign /DC /BP /DD /B7 /DE, it may replaceeveryinstanceof /DC
with /DD /B7 /DE. To turn on optimization, use the /B9/C7/BFﬂag when compiling with /CV.
[That’s an ‘O’ as in optimization, not a zero. There are also /B9/C7/BDand /B9/C7/BE, but as
longasyouareoptimizing,whynotgoallout?]
Theproblemwith optimization,however,is thatit makesdeb uggingdifﬁcult. The
programjumpsaround,makingsteppingthroughanoddtrip,a ndifeveryinstance
of /DChas been replaced with something else, then you can not check its value. It
also sometimes happens that you did not do your memory alloca tion duties quite
right,andthingswentOKwithoutoptimization,butsuddenl ytheprogramcrashes
whenyouhaveoptimizationon.Amemorydebuggermayprovide someclues,but
you may just have to re-scour your code to ﬁnd the problem. Thu s, the /B9/C7/BFﬂag
is a ﬁnalstep,to be usedonly after you are reasonablyconﬁde ntthatyour codeis
debugged.
Q6.8Addthe /B9/D4/CVswitchtothemakeﬁleinthebirdsdirectoryandcheckthetim -
ing of the three different versions. It may help to comment ou t the /D4/D6/CX/D2/D8/CU
function and run the simulation for more periods. How does th e /B9/C7/BFﬂag
changethetimings?
gsl_stats March24,2009
II
STATISTICS
gsl_stats March 24,2009
gsl_stats March24,2009
7
DISTRIBUTIONS FOR DESCRIPTION
Thischaptercoverssomemethodsofdescribingadataset,vi aanumberofstrate-
giesofincreasingcomplexity.Theﬁrstapproach,inSectio n7.1,consistsofsimply
looking at summary statistics for a series of observations a bout a single variable,
likeitsmeanandvariance.Itimposesnostructureonthedat aofanysort.Thenext
levelofstructureistoassumethatthedataisdrawnfrom adi stribution;insteadof
ﬁndingthemeanorvariance,wewouldinsteadusethedatatoe stimatetheparam-
eters that describe the distribution. The simple statistic s and distributions in this
chapterarealreadysufﬁcientto describerathercomplexmo delsofthe realworld,
becausewecanchaintogethermultipledistributionstofor malargermodel.Chap-
ter 8 will take a slightly different approach to modeling a mu ltidimensional data
set,byprojectingit ontoa subspaceoffewdimensions.
7.1 M OMENTS Theﬁrststepinanalyzingadatasetisalwaystogetaquickla y
of the land: where do the variables generally lie? How far do
theywander?Asvariable Agoesup,doesvariable Bfollow?/F4ESTIMATOR VOCABULARY Astatisticis the output of a function that takes in
data, typically of the form f:Rn→R. That is, a
statistic takes in data and summarizes it to a single dimensi on. Common statistics
include the mean of x, its variance, max(x), the covariance of xandy, or the
regression parameter β2from a regression of Xony(which could be written in
theform β2(X,y)).
gsl_stats March24,2009
220 CHAPTER 7
Thus, many of the means of describing a data set, such as writi ng down its mean,
could be described as the generation of statistics. One goal of writing down a
statistic is dimension reduction: simply summarizing the d ata via a few human-
comprehensiblesummarystatistics,suchasthedataset’s m eanandvariance.
Anothergoal,whichismoreoftenthecase,istousethestati sticsofthedata, X,to
estimate the same statistic of the population. Let Psignify the population. When
the US Census Bureau said in an August 2006 press release1that 46.6 million
people in the United States have no health insurance, they me ant that the count
of people in the Current Population Survey that did not have h ealth insurance (a
sample statistic) indicated that the count of people in the U nited States without
health insurance (a population statistic) was 46.6 million . Is the estimate of the
statistic based on the sample data, ˆβ≡f(X), a valid estimate of the population
statistic, β≡f(P)? There are several ways to make this a precise question. For
example,as Xgrows larger, does ˆβ→β? Do there exist estimates of βthat have
smallervariancethan ˆβ?Afterdiscussingsomedesirablequalitiesinanestimator ,
wewill beginwith somesimple statistics./F4Evaluating an estimator From a given population, one could take many possi-
ble samples, say X1,X2, ..., which means that there
couldbe manypossiblecalculatedstatistics, ˆβ1=f(X1),ˆβ2=f(X2), ....
There are many means of describing whether the collection of statistics ˆβi(for
i= 1,i= 2,...) is a precise and accurate estimate of the true value of β. You
will see in the sections to follow that intuitive means of est imating a population
statistic sometimeswork onallofthesescalesatonce,ands ometimesfail.
• Unbiasedness:Theexpectedvalueof ˆβ(discussedingreatdetailbelow)equalsthe
true populationvalue: E(ˆβi) =β.
• Variance:Thevarianceistheexpectedvalueofthesquared distancetotheexpected
value: E/parenleftig
(ˆβi−E(ˆβ))2/parenrightig
.Thevarianceis alsodiscussedindetailbelow.
• Mean squared error: MSE of ˆβ≡E(ˆβ−β)2. Below we will see that the MSE
equals the variance plus the square of bias. So if ˆβis an unbiased estimator of β,
meaningthat E(ˆβ) =β,thentheMSEisequivalenttothevariance,butasthebias
increases,the differencebetweenMSE andvariancegrows.
• Efﬁciency: An estimator ˆβis efﬁcient if, for any other estimator ˜β,MSE (ˆβ)≤
MSE (˜β). Ifˆβand˜βare unbiased estimators of the same β, then this reduces to
var(ˆβ)≤var(˜β), so some authors describe an efﬁcient estimator as the unbia sed
1US Census Bureau, “Income Climbs, Poverty Stabilizes, Unin sured Rate Increases,” Press release #CB06-
136, 29 August 2006, /CW/D8/D8/D4/BM/BB/BB/DB/DB/DB/BA/CT/D2/D7/D9/D7/BA/CV/D3/DA/BB /C8/D6/CT/D7 /D7/B9 /CA /CT/D0/CT/CP /D7/CT/BB /DB/DB/DB/BB /D6/CT/D0/CT /CP/D7/CT /D7/BB/CP/D6 /CW/CX/DA /CT/D7/BB /CX/D2/D3 /D1/CT/CN/DB/CT/CP/D0/D8/CW/BB/BC/BC/BJ/BG/BD/BL/BA/CW/D8/D1/D0 .
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 221
estimatorwith minimum varianceamongallunbiasedestimat ors.
We test this using inequality 10.1.7 (page 333), that the var iance must be greater
than or equal to the Cramér–Rao lower bound. If var(ˆβ)equals the CRLB, we
knowwe haveaminimum variance.
• BLUE: ˆβis the Best Linear Unbiased Estimator if var(ˆβ)≤var(˜β)for all linear
unbiasedestimators ˜β, andˆβis itself alinearfunctionandunbiased.
• Aymptotic unbiasedness: Deﬁne ˆβn=f(x1,... ,x n). For example, ˆµ1=x1,
ˆµ2= (x1+x2)/2,ˆµ3= (x1+x2+x3)/3, .... Then limn→∞E(ˆβn) =β.
Clearly, unbiasednessimplies asymptoticunbiasedness.
• Consistency:plim (ˆβn) =β,i.e.,foraﬁxedsmall ǫ,limn→∞P(|ˆβn−β|> ǫ) = 0.
Equivalently, limn→∞P((ˆβn−β)2> ǫ2) = 0.
One can verify consistency using Chebychev’s inequality ; see, e.g., Casella &
Berger(1990,p 184).
Inasense,consistencyistheasymptoticanalogtothelowMS Econdition.IfMSE
goesto zero,thenconsistencyfollows(butnotnecessarily viceversa).
However, a biased estimator or a high-variance estimator ma y have a few things
going for it, but an inconsistent estimator is just a waste. Y ou could get yourself
two near-inﬁnite samples and ﬁnd that ˆβis different for each of them—and then
whatare yousupposedto pick?
• Asymptoticefﬁciency: var(ˆβ)→theCramér–Raolowerbound.Thismakessense
only if ˆβ’s asymptotic distribution has a ﬁnite mean and varianceand ˆβis consis-
tent.
EXPECTED VALUE Saythatanygivenvalueof xhasprobability p(x).Thenif f(x)
is anarbitrary function,
E(f(x)) =/integraldisplay
∀xf(x)p(x)dx.
Thep(x)dxpart of the integral is what statisticians call a measureand everyone
elsecallsaweighting.If p(x)isconstantforall x,theneveryvalueof xgetsequal
weighting,asdoeseveryvalueof f(x).Ifp(x1)istwiceaslargeas p(x2),meaning
that we are twice as likely to observe x1, then f(x1)gets double weighting in the
integral.
If we have a vector of data points, x, consisting of nelements xi, then we take
each single observation to be equally likely: p(xi) =1
n,∀i. The expected value
fora samplethenbecomesthefamiliar calculation
E(x) =/summationtext
ixi
n,
and(givennofurtherinformationaboutthepopulation)ist heBestUnbiasedEsti-
matorofthetrue mean µ.2
2The term expected value implies that the mean is what we humans actually expect will o ccur. But if I have
gsl_stats March24,2009
222 CHAPTER 7
VARIANCE AND ITS DISSECTIONS Thevariance for discrete data is the familiar
formula of the mean of the squareddistanceto
the average. Let xindicate the mean of the data vector x; then the best unbiased
estimateofthevarianceofthesampleis
var(x) =1
n/summationdisplay
i(xi−x)2. (7.1.1)
Degreesoffreedom
Rather than calculating the variance of a sample, say
that we seek the variance of a population, and have
only a sample from which to estimate the variance.
The best unbiased estimate of the variance of the pop-
ulationis
cvar(x) =1
n−1X
i(xi−x)2.(7.1.2)
We can think of the sum being divided by n−1in-
steadof n(asinEquation7.1.1)becausethereareonly
n−1random elements in the sum: given the mean x
andn−1elements, the nthelement is deterministi-
cally solved. That is, there are only n−1degrees of
freedom. An online appendix to this book provides a
morerigorous proofthatEquation7.1.2isanunbiased
estimatorof the population variance.
Asn→ ∞,1/n≈1/(n−1), so both the esti-
mate of variance based on 1/nand on 1/(n−1)are
asymptotically unbiased estimators of the population
variance.
Thenumberofdegreesoffreedom( d f)willappearin
other contexts throughout the book. The d findicates
the number of dimensions in which the data could
possibly vary. With no additional information, this is
just the number of independently drawn variables, but
there may be more restrictions on the data. Imagine
three variables, which would normally have three di-
mensions, with the added restriction that x1+ 2x2=
x3. Then this deﬁnes a plane (which happens to be
orthogonal to the vector (1,2,−1)and goes through
the origin). That is, by adding the restriction, the data
points have been reduced to a two-dimensional sur-
face.Forthesamplevariance,therestrictionisthatthe
meanof the sample is ˆµ.The square root of the variance is
called the standard deviation . It is
useful because the Normal distribu-
tion is usually described in terms
of the standard deviation ( σ) rather
than the variance ( σ2). Outside of
the context of the Normal, the vari-
anceis farmorecommon.
The variance is useful in its own
right as a familiar measure of dis-
persion. But it can also be decom-
posed various ways, depending on
the situation, to provide still more
information, such as how much of
the variance is due to bias, or how
much variation is explained by a
linear regression. Since information
is extracted from the decomposi-
tion ofvariancetime andtime again
throughout classical statistics, it is
worth going over these various dis-
sections.
Recall from basic algebra that the
form(x+y)2expandsto x2+y2+
2xy. In some special cases the un-
sightly 2xyterm can be eliminated
or merged with another term, leav-
ing the pleasing result that (x+
y)2=x2+y2.
a one in a million chance of winning a two million dollar lotte ry, there are no states of the world where I am
exactly two dollars wealthier. Further, research pioneere d by Kahneman and Tversky (e.g., Kahneman et al.
(1982)) found that humans tend to focus on other features ofa probability distribution. They willconsider events
with small probability to either have zero probability or a m ore manageable value (e.g., reading p= 1e−7as
p= 1e−3). Or, they may assume the most likely state of the world occur s with certainty. Bear in mind that
human readers of your papers may beinterested in many deﬁnit ions of expectation beyond the mean.
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 223
Throughout the discussion below ¯x=E[x]; that is ¯xis constant for a given data
set. The expectation of a constant is the constant itself, so E[¯x]is simply ¯x; and
E[y2¯x]wouldexpandto1
n/summationtextn
i=1/bracketleftbig
y2
i¯x/bracketrightbig
=¯x·1
n/summationtextn
i=1y2
i=¯x·E[y2].
Theﬁrstbreakdownofvarianceis theequationasabove:
var(x) =E/bracketleftbig
(x−¯x)2/bracketrightbig
=E/bracketleftbig
x2−2x¯x+¯x2/bracketrightbig
=E[x2]−E[2x¯x] +E[¯x2]
=E[x2]−2E[x]2+E[x]2
=E[x2]−E[x]2.
Read this as: var(x)is the expectation of the squared values minus the square of
theexpectedvalue.Thisformsimpliﬁesmanytransformatio nsandbasicresultsof
thetypethatfrequentlyappearin probabilityhomeworkque stions.
Q7.1Writeafunctiontodisplay var(x),E[x2],E[x]2,andE[x2]−E[x]2forany
input data, then use it to verify that the ﬁrst and last expres sions are equal
forafew columnsofdataselectedfrom anysourceonhand.
Mean squared error The next breakdown appears with the mean squared error.
Saythatwehaveabiasedestimateofthemean, ˜x;ifyouhad
thetruemean ¯x,thenyoucoulddeﬁnethebiasas (˜x−¯x).ItturnsoutthattheMSE
is a simple function ofthe true varianceandthe bias. Theval uecan be derivedby
inserting−¯x+¯x= 0andexpandingthesquare:
MSE≡E/bracketleftbig
(x−˜x)2/bracketrightbig
=E/bracketleftig
((x−¯x) + (¯x−˜x))2/bracketrightig
=E[(x−¯x)]2+ 2E[(x−¯x)(¯x−˜x)] +E/bracketleftig
(¯x−˜x)2/bracketrightig
= var(x)−2·bias(˜x)E(x−¯x) + bias( ˜x)2
= var(x) + bias( ˜x)2
Inthiscasethemiddletermdropsoutbecause E(x−¯x) = 0,andtheMSEbreaks
downto simply beingthevarianceof xplusthebiassquared.
gsl_stats March24,2009
224 CHAPTER 7
Within group/among group variance The next breakdown of variance, common
in ANOVA estimations (where ANOVA is
shortforanalysisofvariance),ariseswhenthedataisdivi dedinto asetofgroups.
Thenthetotalvarianceovertheentiredatasetcouldbeexpr essedasamonggroup
variance andwithin group variance . Above, xconsisted of a homogeneous se-
quenceofelements xi,i={1,... ,n}, butnowbreakit downinto subgroups xij,
where jindicates the group and iindicates the elements within the group. There
is thus a mean ¯xjfor each group j, which is the simple mean for the njelements
in that group. The unsubscripted ¯xcontinues to represent the mean of the entire
sample. With that notation in hand, a similar breakdownto th ose given abovecan
beappliedto the groups:
var(x) =E/bracketleftbig
(x−¯x)2/bracketrightbig
=1
n/summationdisplay
j/bracketleftiggnj/summationdisplay
i=1(xij−¯xj+¯xj−¯x)2/bracketrightigg
=1
n/summationdisplay
j/bracketleftiggnj/summationdisplay
i=1(xij−¯xj)2+nj/summationdisplay
i=1(¯xj−¯x)2+ 2nj/summationdisplay
i=1(xij−¯xj)(¯xj−¯x)/bracketrightigg
(7.1.3)
=1
n/summationdisplay
j/bracketleftiggnj/summationdisplay
i=1(xij−¯xj)2+nj/summationdisplay
i=1(¯xj−¯x)2/bracketrightigg
(7.1.4)
=1
n/summationdisplay
j[njvar(xj)] +1
n/summationdisplay
j/bracketleftbig
nj(¯xj−¯x)2/bracketrightbig
The transition from Equation 7.1.3 to 7.1.4 works because (¯xj−¯x)is constant
for a given j, and/summationtextnj
i=1(xij−¯xj) =¯xj−¯xj= 0. Once again, the unsightly
middletermcancelsout,andweareleftwithaneasilyinterp retableﬁnalequation.
In this case,theﬁrst elementis the weightedmeanof within- group variances,and
thesecondistheweightedamong-groupvariance,whereeach groupistakentobe
oneunitat ¯xj,andthenthe varianceistakenoverthis setofgroupmeans.
The /CS/CP/D8/CP/B9/D1/CT/D8/D6/D3/BA/CS/CQ setgivesaverageweekdaypassengerboardingsateverysta-
tion in the WashingtonMetro subway system, from the foundin g of the system in
November 1977 to 2007.3The system has ﬁve lines (Blue, Green, Orange, Red,
Yellow), andListing 7.1breaksdownthe varianceofridersh ip on theWashington
Metro into within-line andamong-linevariances.
• Line 20is the queryto join the /D6/CX/CS/CT/D6/D7and /D0/CX/D2/CT/D7tables.Theparensmeanthat it
3As a Washington-relevant detail, all post-’77 measurement s were made in May, outside the peak tourist
season.
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 225
1#include <apop.h>
2
3voidvariance_breakdown( char*table,char*data,char*grouping){
4apop_data *aggregates = apop_query_to_mixed_data("mmw",
5 "select var_pop(%s) var, avg(%s) avg,count( *) from %s group by %s",
6 data,data,table,grouping);
7 APOP_COL_T(aggregates, "var", vars);
8 APOP_COL_T(aggregates, "avg", means);
9doubletotal= apop_query_to_ﬂoat("select var_pop(%s)from %s", data,table);
10 doublemean_of_vars = apop_vector_weighted_mean(vars, aggrega tes−>weights);
11 doublevar_of_means = apop_vector_weighted_var(means, aggrega tes−>weights);
12 printf("total variance:%g\n",total);
13 printf("withingroup variance:%g\n",mean_of_vars);
14 printf("among group variance: %g\n",var_of_means);
15 printf("sum within+among:%g\n",mean_of_vars + var_of _means);
16 }
17
18intmain(){
19 apop_db_open("data −metro.db");
20 charjoinedtab[]= "(select riders/100 as riders,line from ride rs,lines \
21 where lines.station=riders.station)";
22 variance_breakdown(joinedtab, "riders","line");
23 }
Listing7.1 Decomposing variance between among-group and w ithin-group. Online source:/CP/D1/D3/D2/CV/DB/CX/D8/CW/CX/D2/BA .
cancomfortablybeinsertedinto a /CU/D6/D3/D1clause,asinthe queryonline four.4
• The query on line 9 pulls the total variance—the total sum of squares—and the
queryonlines4–6getsthewithin-group variancesandmeans .
• Lines10and11taketheweightedmeanofthevariancesandth eweightedvariance
ofthemeans.
• Lines 14–17 print the data to screen, showing that these two sub-calculations do
indeedaddupto thetotal variance.
Q7.2Rewritetheprogramtousethe /CS/CP/D8/CP/B9/DB/CQ/BA/CS/CQ dataset(includingthe /D0/CP/D7/D7/CT/D7
table) to break down the variance in GDP per capita into withi n-class and
among-classvariance.
Within-group and among-group variance is interesting by it self. To give one ex-
ample, Glaeser et al.(1996, Equation 8) break down the variance in crime into
4Using a subquery like this may force the SQL interpreter to re -generate the subtable for every query, which
is clearly inefﬁcient. Therefore, when using functions lik e /CP/D4/D3/D4/CN/CP/D2/D3/DA/CP in the wild, ﬁrst run a /D6/CT/CP/D8/CT /D8/CP/CQ/D0/CT/BA/BA/BAquery to join the data, perhaps index the table, and then send that table to the /CP/D4/D3/D4/CN/CP/D2/D3/DA/CP function.
gsl_stats March24,2009
226 CHAPTER 7
within-city and among-city variances,and ﬁnd that among-c ity variance is orders
ofmagnitudelargerthanwithin-city variance.
ReturningtotheMetrodata,wecouldgroupdatabyyear,andl ookforwithin-and
among-groupvariation in that form, orwe could group databy line andask about
within-andamong-groupvariationthere.
#include <apop.h>
intmain(){
apop_db_open("data −metro.db");
charjoinedtab[]= "(select year,riders,line \
from riders,lines \
where riders.station= lines.station)";
apop_data_show(apop_anova(joinedtab,"riders", "line" ,"year"));
}
Listing7.2 Produce a two-way ANOVA table breaking variance in per-station passenger boardings
intoby-year effects,by-line effects, aninteractionterm ,andtheresidual. Online source:/D1/CT/D8/D6/D3/CP/D2/D3/DA/CP/BA .
Listing7.2producesan ANOVAtable , whichisa spreadsheet-liketablegivingthe
within-group and among-groupvariances.The form of the tab le dates back to the
mid-1900s—ANOVAis basicallythemostcomplexthing thaton ecandowithout
a matrix-inverting computer, and the tabular form facilita tes doing the calculation
with paper, pencil, and a desk calculator. But it still conve ys meaning even for
thoseofuswhohaveentirely forgotten howto usea pencil.
The ﬁrst three rows of the outputpresentthe between-groups um of squares.That
is, if we were to aggregate all the data points for a given grou p into the mean,
how much variation would remain? With /CV/D6/D3/D9/D4/CX/D2/CV/BD and /CV/D6/D3/D9/D4/CX/D2/CV/BE , there are
threewaystogroupthedata: /CV/D6/D3/D9/D4 /CQ/DD /CV/D6/D3/D9/D4/CX/D2/CV/BD [(Greenline),(Redline),...],/CV/D6/D3/D9/D4 /CQ/DD /CV/D6/D3/D9/D4/CX/D2/CV/BE [(1977), (1978), ..., (2007)], and the interaction : /CV/D6/D3/D9/D4/CQ/DD /CV/D6/D3/D9/D4/CX/D2/CV/BD /B8 /CV/D6/D3/D9/D4/CX/D2/CV/BE [(Green Line, 1977), (Red Line, 1977), ...(Green
Line, 2007), (Red Line, 2007)]. Using algebra much like that done above,we can
breakdownthetotalsumofsquaresinto(weightedsumofsqua res, /CV/D6/D3/D9/D4/CX/D2/CV/BD )+
(weighted sum of squares, /CV/D6/D3/D9/D4/CX/D2/CV/BE ) + (weighted sum of squares, /CV/D6/D3/D9/D4/CX/D2/CV/BD ,/CV/D6/D3/D9/D4/CX/D2/CV/BE )+(weightedsumofsquares,residual).
Wecancomparetheweightedgroupedsumstotheresidualsum, whichislistedas
theFstatistic in the ANOVA table. As will be discussedin the chap teron testing
(seepage309),an Fstatistic overabouttwo is takento indicate thatthe groupi ng
explainsmorevariationthanwouldbeexplainedviaacompar ablerandomgroup-
ingofthedata.Theoutputofthisexampleshowsthatthegrou pingbyyearisvery
signiﬁcant, as is the more reﬁned interaction grouping by li ne and year, but the
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 227
grouping by line is not signiﬁcant, meaning that later studi es may be justiﬁed in
notfocusingonhowthesubwaystationsarebrokendowninto l ines.
Q7.3Moststationsareonmultiplelines,soastationlikeMetroC enterisincluded
in the Blue, Orange, and Red groups. In fact, the Yellow line h as only two
stationsthatit doesn’tsharewith otherlines.[You caneas ilyﬁndanonline
mapoftheWashingtonMetrotoverifythis.]Thisprobablyca usesustoun-
derestimatetheimportanceoftheper-linegrouping.Howwo uldyoudesign
agroupingthatputsallstationsinonlyonegroup?Itmayhel pinimplemen-
tation to produceanintermediatetable thatpresentsyourd esiredgrouping.
DoestheANOVAusingyournewgroupingtableshowmoresigniﬁ canceto
theline grouping?
Bychangingthesecondgroupinthecodelisting from Ꜽ/DD/CT/CP/D6Ꜽto /C6/CD/C4/C4,wewould
get a one-way ANOVA, which breaks down the total sum of square s into just
(weighted sum of squares, /CV/D6/D3/D9/D4/CX/D2/CV/BD ) + (weighted sum of squares, residual).
Theresidualsumofsquaresisthereforelarger,the d foftheresidualisalsolarger,
andin thiscasethe overallchangein the Fstatistic is notgreat./F4Regression variance Next, consider the OLS model, which will be detailed in
Section 8.2.1. In this case, we will break down the ob-
servedvalueto theestimatedvalueplustheerror: y=yest+ǫ.
var(y) =E/bracketleftbig
(yest+ǫ−¯y)2/bracketrightbig
=E/bracketleftbig
(yest−¯y)2/bracketrightbig
+E[ǫ2] + 2E[(yest−¯y)ǫ]
It will be shown below that yestǫ=βOLSXǫ= 0(because Xǫ= 0), and ¯ǫ= 0,
soE[¯yǫ] =¯yE[ǫ] = 0. Thus,the 2E[...]term is onceagainzero,andweareleft
with
var(y) =E/bracketleftbig
(yest−¯y)2/bracketrightbig
+E[ǫ2] (7.1.5)
gsl_stats March24,2009
228 CHAPTER 7
Makethefollowing deﬁnitions:
SST≡totalsum ofsquares
=E/bracketleftbig
(y−¯y)2/bracketrightbig
= var(y)
SSR≡Regressionsumofsquares
=E/bracketleftbig
(yest−¯y)2/bracketrightbig
SSE≡Sum ofsquarederrors
=E[ǫ2]
Thenthe expansionof var(y)inEquation7.1.5couldbewritten as
SST=SSR+SSE.
This is a popular breakdown of the variance, because it is rel atively easy to cal-
culate and has a reasonable interpretation: total variance is variance explained by
the regression plus the unexplained, error variance. As suc h, these elements will
appearon page311with regardto the Ftest, andare usedfor the common coefﬁ-
cientofdetermination ,whichisanindicatorofhowwellaregressionﬁtsthedata.
Itis deﬁnedas:
R2≡SSR
SST
= 1−SSE
SST.
Youwillnoticethattheterminologyaboutthesumofsquared componentsandthe
use of the Ftest matches that used in the ANOVA breakdowns,which is not j ust
acoincidence:in bothcases,thereis a portionof thedata’s variation explainedby
themodel(groupingorregression),andaportionthatisune xplainedbythemodel
(residual). In both cases, we can use this breakdown to gauge whether the model
explainsmorevariationthanwouldbeexplainedbyarandomg rouping.Theexact
detailsofthe Ftestwill bedelayeduntilthechapteronhypothesistesting .
COVARIANCE The population covariance isσ2
xy=1
n/summationtext
i(xi−x)(yi−y), which
is equivalent to E[xy]−E[x]E[y]. [Q: Re-apply the ﬁrst variance
expansionaboveto provethis.]Thevarianceis aspecialcas ewhere x=y.
As with the variance, the unbiased estimate of the sample cov ariance is s2
xy=
σ2
xy·n
n−1, i.e.,/summationtext
i(x−x)(y−y)dividedby n−1insteadof n.
Given a vector of variables x1,x2,...xn, we typically want the covariance of
everycombination.Thiscanneatlybeexpressedasa matrix
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 229

σ2
1σ2
12... σ2
1n
σ2
21σ2
2... σ2
2n......
σ2
n1σ2
n2... σ2
n
,
wherethediagonalelementsarethevariances(i.e.,thecov arianceof xiwithitself
for all i), and the off-diagonalterms are symmetric in the sensethat σ2
ij=σ2
jifor
alliandj.
Correlation and Cauchy–Schwarz: Thecorrelationcoefﬁcient (sometimescalled
thePearsoncorrelationcoefﬁcient )is
ρxy≡σxy
σxσy.
Byitself, thestatistic isusefulforlookingattherelatio nsamongcolumnsofdata,
and can be summarized into a matrix like the covariance matri x above. The cor-
relation matrix is also symmetric, and has ones all along the diagonal, since any
variableisperfectly correlatedwith itself.
TheCauchy–Schwarz inequality ,0≤ρ2≤1, puts bounds on the correlation
coefﬁcient. That is, ρis in the range [−1,1], where ρ=−1indicates that one
variable always moves in the opposite direction of the other , andρ= 1indicates
thattheymovein perfectsync.5
The matrix of correlations is another popular favorite for g etting basic descrip-
tive information about a data set; produce it via /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D3/D6/D6/CT/D0/CP/D8/CX/D3/D2 . The
correlationmatrix will bethebasisofthe Cramér–Raolower boundonpage333.
MORE MOMENTS Given a continuous probability distribution from which the data
was taken, you could write out the expectation in the varianc e
equationasanintegral,
var(f(x)) =E/parenleftbigg/parenleftig
f(x)−f(x)/parenrightig2/parenrightbigg
=/integraldisplay
∀x/parenleftig
f(x)−f(x)/parenrightig2
p(x)dx.
5It would be a digression to prove the Cauchy–Schwarz inequal ity here, but see Hölder’s inequality in any
probability text, such as Feller (1966, volumeII, p 155).
gsl_stats March24,2009
230 CHAPTER 7
Similarly forhigherpowersaswell:
skew ( f(x))≡/integraldisplay
∀x/parenleftig
f(x)−f(x)/parenrightig3
p(x)dx
kurtosis ( f(x))≡/integraldisplay
∀x/parenleftig
f(x)−f(x)/parenrightig4
p(x)dx.
These three integrals are central moments off(x). They are central because we
subtracted the mean from the function before taking the seco nd, third, or fourth
power.6
Transformedmoments
LetSandKbe the thirdand fourthcentral moments
as given here. Some use a standardized moment for
kurtosis, which may equal K′
1=K/(σ2)2,K′
2=
K/(σ2)2−3, or whatever else the author felt would
be convenient. Similarly, some call S′=S/(σ2)3/2
theskew. Theseadjustments areintendedtoeasecom-
parisons to the standard Normal and to acommodate
differences inscale.
The only way to know what a given source means
when it refers to skew and kurtosis is to look up the
deﬁnitions. The GSL uses K′
2(because engineers are
probably comparing their data to a standard Normal);
Apophenia usesK(because the corrections can add
complication in situations outside the Normal distri-
bution,and is easytomake whenneeded).What information can we get from
the higher moments? Section 9.1
will discuss the powerful Central
Limit Theorem, which saysthat if a
variablerepresentsthemeanofaset
of independent and identical draws,
then it will have an N(µ,σ)distri-
bution,where µandσareunknowns
that can be estimated from the data.
These two parameters completely
deﬁne the distribution: the skew of
a Normal is always zero, and the
kurtosis is always 3σ4. If the kurto-
sis is larger, then this often means
that the assumption of independent
drawsis false—theobservationsare
interconnected.Oneoftenseesthisamongsocialnetworks, stockmarkets,orother
systemswhereindependentagentsobserveandimitate eacho ther.
Positive skew indicates that a distribution is upward leani ng, and a negativeskew
indicates a downward lean. Kurtosis is typically put in plai n English as fat tails:
how much density is in the tails of the distribution? For exam ple, the kurtosis of
anN(0,1)is three, while the kurtosis of a Student’s tdistribution with ndegrees
of freedom is greater than three, and decreases as n→∞, converging to three
(see page 365 for a full analysis). An un-normalized kurtosi s>3σ4is known as
leptokurtic and<3σ4is knownas platykurtic ;seeFigure7.3for amnemonic.
The caveats about unbiased estimates of the sample versus po pulation variance
(seebox,page222)alsoholdforskewandkurtosis:calculat ingthemeanasdonein
thedeﬁnitionsaboveleadstoabiasedestimateofthepopula tionskeworkurtosis,
but there are simple corrections that can producean unbiase destimate. An online
6Thecentral ﬁrstmoment is always zero; the non-central seco nd, third, ...,moments are difﬁcult to interpret
and basically ignored. Since there is no ambiguity, some aut hors refer to the useful moments as thenth moment ,
n∈{1,2,3,4}, and leave itas understood when the moment iscentral or non- central.
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 231
Figure 7.3 Leptokurtic, mesokurtic and platykurtic, illus tration by Gosset in Biometrika (Student,
1927, p160). Inthe notationof the time, β2≡kurtosis/(variance squared).
appendix to this book offers a few more facts about central mo ments, and derives
thecorrectionfactors.
Butinallcases,thepopulationvssampledetailisrelevant onlyforsmall n.Efron
& Tibshirani (1993, p 43) state that estimating variance via nis “just as good”
as estimating it via n−1, so there is highly-esteemed precedentfor ignoring this
detail.Forthehighermoments,thesampleandpopulationes timatesconvergeeven
morequickly.
Coding it Given a vector, Apophenia provides functions to calculate m ost of the
above,e.g.:
apop_data *set= gather_your_data_here();
apop_data *corr =apop_data_correlation(set);
APOP_COL(set,0, v1);
APOP_COL(set,1, v2);
doublemean1 = apop_vector_mean(v1);
doublevar1= apop_vector_var(v1);
doubleskew1 = apop_vector_skew(v1);
doublekurt1= apop_vector_kurtosis(v1);
doublecov= apop_vector_cov(v1,v2);
doublecor = apop_vector_correlation(v1,v2);
apop_data_show(apop_data_summarize(set));
The last item in the code, /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D7/D9/D1/D1/CP/D6/CX/DE/CT , produces a table of some
summarystatisticsforeverycolumnofthe dataset.
gsl_stats March24,2009
232 CHAPTER 7
Your data may be aggregatedso that one line of data represent s multiple observa-
tions. For example, sampling efﬁciencycan be improved by sa mpling subpopula-
tionsdifferentlydependingupontheirexpectedvariance( Särndaletal.,1992).For
this andotherreasons,datafrom statisticalagenciesofte nincludesweightings.
Thisisnottheplacetogointodetailsaboutstatisticallys oundmeansofweighting
data,but if youhavea separatevectorwith weights,youcan u se /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/B9/DB/CT/CX/CV/CW/D8/CT/CS/CN/D1/CT/CP/D2 , /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/DB/CT/CX/CV/CW/D8/CT/CS/CN/DA/CP/D6 , et cetera, to use those weights.
Or,ifyour /CP/D4/D3/D4/CN/CS/CP/D8/CP set’s /DB/CT/CX/CV/CW/D8/D7 vectorisﬁlled, /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D7/D9/D1/D1/CP/D6/CX/DE/CT will
makeuseofit.
Q7.4• Write a query that pulls the number of males per 100 females a nd
thepopulationdensityfromtheCensusdata( /CS/CP/D8/CP/B9/CT/D2/D7/D9/D7/BA/CS/CQ ).The
querywill
–join together the /CV/CT/D3/CV/D6/CP/D4/CW/DD and /CS/CT/D1/D3/D7tables by county num-
ber,and
–excludestatesandthenationaltotal, and
–return atwo-columntable.
• Write a function /DA/D3/CX/CS /D7/D9/D1/D1/CP/D6/CX/DE/CT/CN/D4/CP/CX/D6/CT/CS/CN/CS/CP/D8/CP/B4/CW/CP/D6 /B6/D5/B5that
takes in a query that producesa two-column table, and output s some
oftheabovesummaryinformationaboutbothcolumns,includ ingthe
mean,variance,andcorrelationcoefﬁcients.
• Write a /D1/CP/CX/D2/B4/B5that sendsyour query to the abovefunction, and run
theprogram.Is populationdensitypositivelyornegativel ycorrelated
to malesperfemale?
• Write another query that pulls the ratio of (median income f or full-
time workers, female)/(median income for full-time worker s, male)
andthepopulationdensity.
• Addalineto /D1/CP/CX/D2/B4/B5tosendthatquerytoyoursummarizingfunction
aswell. Howisthe newpairofvariablescorrelated?
Quantiles The mean and variance can be misleading for skewed data. The ﬁ rst
optionfordescribingadatasetwhosedistributionislikel yab-Normalis
to plotahistogramofthedata,asperpage172.
A numeric option is to print the quartiles, quintiles, or dec iles of the data. For
quartiles, sort the data, and then display the values of the d ata points 0%, 25%,
50%,75%,and100%ofthewaythroughtheset.The0%valueisth eminimumof
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 233
the data set, the 100% value is the maximum, and the 50% value i s probably the
median (see below). For quintiles, print the values of data p oints 0%, 20%, 40%,
60%, 80%, and 100% of the way through the set, and for deciles, print the values
everytenpercent.
Sortingyourdataissimple.Ifyouhavean /CP/D4/D3/D4/CN/CS/CP/D8/CP setanda /CV/D7/D0/CN/DA/CT/D8/D3/D6 ,then
apop_data_sort(my_data,2, ’d’);
gsl_vector_sort(my_vector);
wouldsort /D1/DD/CN/CS/CP/D8/CP inplacesothatcolumn2isin‘d’escendingorder,andsortth e
vector in place to ascending order, so /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/CV/CT/D8/B4/D1/DD/CN/DA/CT/D8/D3/D6/B8 /BC/B5is the
minimumofthedata, /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/CV/CT/D8/B4/D1/DD/CN/DA/CT/D8/D3/D6/B8 /D1/DD/CN/DA/CT/D8/D3/D6/B9/BQ/D7/CX/DE/CT/B5 isthe
maximum, and /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/CV/CT/D8/B4/D1/DD/CN/DA/CT/D8/D3/D6/B8 /D1/DD/CN/DA/CT/D8/D3/D6/B9/BQ/D7/CX/DE/CT/BB/BE/B5 is about
themedian.
Alternatively, the function /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D4/CT/D6/CT/D2/D8/CX/D0/CT/D7 takes in a /CV/D7/D0/CN/DA/CT/D8/D3/D6
and returns the percentiles—the value of the data point 0%, 1 %, ..., 99%, 100%
of the way through the data. It takes in two arguments: the dat a vector, and a
characterdescribingtheroundingmethod— /B3/D9/B3forroundingup, /B3/CS/B3forrounding
down, and /B3/CP/B3for averaging. Since the number of elements in a data set is ra rely
divisible by a hundred and one, the position of most percenti le points likely falls
betweentwodatapoints.Forexample,ifthedatasethas107p oints,thenthetenth
data point is 9.47% through the data set, and the eleventh dat a point is 10.38%
through the set, so which is the tenth percentile? If you spec ify /B3/D9/B3, then it is the
eleventh data point; if you specify /B3/CS/B3then it is the tenth data point, and if you
specify /B3/CP/B3,thenit is thesimpleaverageofthetwo.
Thestandarddeﬁnitionofthemedianisthatitisthemiddlev alueofthedatapoint
ifthe datasethasanoddnumberofelements,anditis theaver ageofthetwo data
points closest to the middle if the data set has an even number of elements. Thus,
hereis afunctionto ﬁndthe medianofadataset.It ﬁndsthe pe rcentilesusingthe
averaging rule for interpolation, marks down the 50thpercentile, then cleans up
andreturnsthatvalue.
doubleﬁnd_median( gsl_vector *v){
double*pctiles= apop_vector_percentiles(v,’a’);
doubleout =pctiles[50];
free(pctiles);
returnout;
}
gsl_stats March24,2009
234 CHAPTER 7
Q7.5Write a function with header /CS/D3/D9/CQ/D0/CT /D7/CW/D3/DB/CN/D5/D9/CP/D2/D8/CX/D0/CT/D7/B4/CV/D7/D0/CN/DA/CT/D8/D3/D6/B6/DA/B8 /CW/CP/D6 /D6/D3/D9/D2/CS/CX/D2/CV/CN/D1/CT/D8/CW/D3/CS/B8 /CX/D2/D8 /CS/CX/DA/CX/D7/CX/D3/D2/D7/B5 that passes /DAand/D6/D3/D9/D2/CS/CX/D2/CV/CN/D1/CT/D8/CW/D3/CS to /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D4/CT/D6/CT/D2/D8/CX/D0/CT/D7 , and then prints a ta-
ble of selected quantiles to the screen. For example, if /CS/CX/DA/CX/D7/CX/D3/D2/D7/BP/BP/BG ,
print quartiles, if /CS/CX/DA/CX/D7/CX/D3/D2/D7/BP/BP/BH , print quintiles, if /CS/CX/DA/CX/D7/CX/D3/D2/D7/BP/BP/BD/BC , print
deciles,etcetera.
On page 88 you tabulated GDP per capita for the countries of th e world.
Useyourfunctionto printthe decilesforcountryincomesfr om /CS/CP/D8/CP/B9/DB/CQ.
Q7.6Thetrimeanis1
4the sum of the ﬁrst quartile, third quartile, and two times
the median (Tukey, 1977, p 46). It uses more information abou t the distri-
bution than the median alone, but is still robust to extreme v alues (unlike
themean).
Write a function that takes in a vector of data points, applie s /CP/D4/D3/D4/CN/B9/DA/CT/D8/D3/D6/CN/D4/CT/D6/CT/D2/D8/CX/D0/CT/D7 internally, and returns the trimean. How does the
trimeanofGDP percapitacompareto the meanandmedian,andw hy?
See also page 319, which compares percentiles of the data to p ercentiles of an
assumeddistribution to testwhetherthedataweredrawnfro m thedistribution.
®Themostbasicmeansofdescribingdataisviaitsmoments.Th ebasic
momentsshouldbeproducedandskimmedforanydataset;insi mple
cases,there isnoneedto gofurther.
®Thevariancecanoftenbedecomposedintosmallerparts,thu sreveal-
ingmore information abouthowadataset’svariationarose.
®The meanand varianceare well known,but there is also inform ation
in highermoments—theskewandkurtosis.
®It is also important to know how variables interrelate, whic h can be
summarizedusingthecorrelation matrix.
®There is a one-line function to produce each of these pieces o f in-
formation. Notably, /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D7/D9/D1/D1/CP/D6/CX/DE/CT producesa summaryof
eachcolumnofadataset.
®Youcangetamore detailednumericaldescriptionofadatase t’sdis-
tribution using quartiles or quintiles; to do so, use /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/B9/D4/CT/D6/CT/D2/D8/CX/D0/CT/D7 .
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 235
7.2 SAMPLE DISTRIBUTIONS Here are some distributions that an observed
variablemaytakeon.Theyarenotjusthereso
you can memorize them before the next statistics test. Each h as a story attached,
which is directly useful for modeling. For example, if you th ink that a variable is
theoutcomeof nindependent,binaryevents,thenthe variableshouldbemod eled
asaBinomialdistribution,andonceyouestimatetheparame tertothedistribution,
you will have a full model of that variable, that you can even t est if so inclined.
Table7.4presentsatableofwhatstoryeachdistributionis telling.Afterthecatalog
ofmodels,I will giveafew examplesofsuchmodeling.
Thedistribution Thestory
Bernoulli Asinglesuccess/failuredraw,ﬁxed p.
Binomial What are the odds of getting xsuccesses from n
Bernoullidrawswith ﬁxed p?
Hypergeometric What are the odds of getting xsuccesses from n
Bernoulli draws, where pis initially ﬁxed, but draw-
ingis withoutreplacement?
Normal/Gaussian Binomialas n→∞;ifµj≡/summationtextn
i=1xij/n,thenµj∼
Normal.
Lognormal If µj≡/producttextn
i=1xij,thenµj∼Lognormal.
Multinomial ndraws from mpossibilities with probabilities p1,
...,pm,/summationtextm
i=1pi= 1.
Multivariate
NormalMultinomialas n→∞.
Negativebinomial HowmanyBernoullidrawsuntil nsuccesses?
Poisson Given λevents per period, how many events in tpe-
riods?
Gamma The ‘Negative Poisson’: given a Poisson setup, how
longuntil nevents?
Exponential A proportion λof the remaining stock leaves each
period;howmuchisleft attime t?
Beta A versatile way to describe the odds that ptakes on
anyvalue∈(0,1).
Uniform Noinformation buttheupperandlowerbounds.
Table 7.4 Everyprobabilitydistributiontellsa story.
Commondistributionsofstatisticalparameters(asoppose dtonaturalpopulations)
arediscussedin Section9.2.
gsl_stats March24,2009
236 CHAPTER 7
Bernoulli and Poisson events The core of the system is an event, which some-
timeshappensandsometimesdoesnot.Somepeo-
ple havea disease,some do not;some daysit rains, some daysi t doesnot. Events
adduptomore-or-lesscontinuousquantities:somecitiess eea22%chanceofrain
onagivenday,andsomeseea23.2%chance;somepopulationsh avehighratesof
diseaseandsomedonot.
From there, there are variants: instead of asking how many su ccesseswe will see
inntrials(theBinomialandPoissondistributions),wecanask howmanytrialswe
can expect to make to get nsuccesses(the Negative binomial and Gamma distri-
butions).Wecanlookatsamplingwithoutreplacement(Hype rgeometric).Wecan
look at the case where the numberof trials goes to inﬁnity (No rmal) or aggregate
trials and take their product (Lognormal). In short, a surpr isingly wide range of
situationscanbedescribedfromthesimpleconceptofbinar yeventsaggregatedin
variousways.
The snowﬂake problem For a controlled study (typical of physical sciences), the
claimofaﬁxedprobability( porλ)isoftenplausible,but
for most social science experiments, where each observatio n is an individual or a
verydifferentgeographicregion,theassumptionthatallo bservationsareidentical
isoften unacceptable—everysnowﬂakeis unique.
It may seemlike the ﬁxed- pand ﬁxed- λmodels below are too simple to be appli-
cable to many situations—and frankly, they often are. Howev er, they can be used
as building blocks to produce more descriptive models. Sect ion 8.2.1 presents a
set of linear regression models, which handle the snowﬂake p roblem well, but
throw out the probability framework presented in this chapt er. But we can solve
the snowﬂake problem and still make use of simple probabilit y models by em-
bedding a linear model inside a distribution: let pidiffer among each element i,
andestimate piusingalinearcombinationofelement i’scharacteristics.Page288
coversexamplesofthe manypossibilities providedbymodel s-within-models.
Statistics and their estimators
• The catalog in this section includes the three most typical items one would want
from a distribution: a random number generator ( RNG) that would produce data
withthegivendistribution,a probabilitydensityfunction (PDF),andacumulative
densityfunction (CDF).7
7This is for the case when the independent variable is continu ous. When it is discrete, the PDF is named a
probability mass function (PMF) and the CDF a cumulative mass function (CMF). For every result or statement
about PDFs, there is an analogous result about PMFs; for ever y result or statement about CDFs, there is an
analogous result about CMFs.
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 237
• The catalog also includes the expected value and variance o f these distributions,
which are distinct from the means and variances to this point in a key manner:
givenadataset,themeanisastatistic—afunctionofdataof theform f(x).Mean-
while,givenamodel,themeanandvarianceofadrawarefunct ionsoftheparam-
eters,e.g.,givenaBinomialdistributionwithparameters nandp,E(x|n,p) =np.
Of course, we rarely knowall the parameters,so we are left wi th estimating them
fromdata,butourestimateof p,ˆpisonceagainafunctionofthedatasetonhand.
We will return to this back-and-forth between estimates fro m data and estimates
from the modelafterthecatalogofmodels.
• ThefulldetailsofRNGusewillbediscussedinChapter11,b uttheRNGfunctions
are included in the catalog here for easy reference; each req uires a pointer to a/CV/D7/D0/CN/D6/D2/CV,whichwill benamed /D6.
THEBERNOULLI FAMILY The ﬁrst setof distributions are built arounda narrative
of drawing from a pool of eventswith a ﬁxed probabil-
ity. The most commonly-used example is ﬂipping a coin, which is a single event
thatcomesout headswith probability p= 1/2. But otherexamplesabound:draw
one recipient from a sales pitch out of a list of such people an d check whether he
purchasedordidnotpurchase,orpullasinglecitizenfrom a populationandseeif
she was the victim of a crime. For one event, a draw can take val ues of only zero
orone;this isknownasa Bernoullidraw .
Bernoulli The Bernoulli distribution represents the result of one Ber noulli draw,
meaningthat P(x= 1|p) =p,P(x= 0|p) = 1−p,andP(x=anything
else|p) = 0. Notice that E(x|p) =p,eventhough xcanbeonlyzeroorone.
P(x,p) =px(1−p)(1−x),x∈{0,1}
=gsl_ran_bernoulli _pdf(x,p)
E(x|p) =p
var(x|p)=p(1−p)
RNG :gsl_ran_bernoulli (r,p)
Binomial Now take nBernoulli draws, so we can observebetween0 and nevents.
The output is now a count: how many people dunned by a telemark eter
agreetopurchasetheproduct,orhowmanycrimevictimsther eareamongaﬁxed
population.Theprobabilityofobservingexactly keventsis p(k)∼Binomial (n,p).
Counting xsuccessesout of ntrials is less than trivial. For example,there are six
ways by which two successescould occur over four trials: (0,0,1,1),(0,1,0,1),
gsl_stats March24,2009
238 CHAPTER 7
00.020.040.060.080.10.120.14
0102030405060708090100P(x,p,n )
xp= 0.1
p= 0.3
p= 0.6
p= 0.9
00.050.10.150.20.250.3
010 20 30 40 50 60P(x,p,n )
xn= 10
n= 30
n= 60
n= 100
Figure 7.5 Left: The Binomial distribution with n= 100and various values of p. Right: the Bi-
nomial distribution with p= 0.4and various values of n. Asngrows, the distribution
approaches anN(np,p
np(1−p)).
(0,1,1,0),(1,1,0,0),(1,0,0,1), or(1,0,1,0), andthe modelunderlyingthe Bi-
nomialmodeltreats them allequally.
The form of the distribution therefore borrows a counting te chnique from combi-
natorics. The notation/parenleftbign
x/parenrightbig
indicates nchoose x, the number of unordered sets of
xelementsthatcanbepulled from nobjects.Theequationis
/parenleftbiggn
x/parenrightbigg
=n!
x!(n−x)!,
and the function is /CV/D7/D0/CN/D7/CU/CN/CW/D3/D3/D7/CT/B4/D2/B8/DC/B5 (in the GSL’s Special Functions sec-
tion). For example, we could get exactly thirty successfult rials out of a hundred
in/parenleftbig100
30/parenrightbig
ways(≈2.94e25).
Combinatorics also dictates the shapeof the curve.There is only one way eachto
list four zeros or four ones— (0,0,0,0)and(1,1,1,1)—and there are four ways
to list one one— (0,0,0,1),(0,0,1,0),...—and symmetrically for one zero. In
order, the counts for zero through four ones are 1, 4, 6, 4, and 1. This simple
counting scheme already produces something of a bell curve. Returning to coin-
ﬂipping, if p= 1/2and the coin is ﬂipped 100 times ( n= 100),p(50heads)is
relativelyhigh,while p(0heads)orp(100heads)is almostnil.
In fact, as n→∞, the probability distribution approaches the familiar Nor mal
distribution with mean npand variance np(1−p), as in Figure 7.5. Assuming
that every telemarketer’s probability of selling is equal, we expect that a plot of
manymonths’telemarketerresultswilllooklikeaNormaldi stribution,withmany
telemarketers successfully selling to npvictims, and others doing exceptionally
well or poorly. The assumption that every telemarketer is eq ually effective can
evenbetested,bycheckingfordigressionfrom theNormaldi stribution.
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 239
P(x,p,n ) =/parenleftbiggn
x/parenrightbigg
px(1−p)(n−x)
=gsl_ran_binomial _pdf(x,p,n)
E(x|n,p) =np (7.2.1)
var(x|n,p) =np(1−p) (7.2.2)
RNG :gsl_ran_binomial (r,p,n)
• IfX∼Bernoulli (p), then for the sum of nindependent draws,/summationtextn
i=1Xi∼
Binomial (n,p).
• Asn→∞, Binomial (n,p)→Poisson (np)orN(np,/radicalbig
np(1−p)).
Sincenisknownand E(x)andvar(x)canbecalculatedfromthedata,Equations
7.2.1 and 7.2.2 are an oversolved system of two variables for one unknown, p.
Thus, you can test for excess variance , which indicates that there are interactions
thatfalsify thattheobservationswere iid(independentandidenticallydistributed)
Bernoullievents.
A variant: one pfromndraws Thestatistic ofinterestoftendiffers from thatcal-
culated in this catalog, but it is easy to transform
the information here. Say that we multiply the elements of a s etxbyk. Then the
meangoesfrombeing µx≡/summationtext
ixi/ntobeing µkx≡/summationtext
i(kxi)/n=k/summationtext
ixi/n=
kµx. The variance goes from being σ2
x≡/summationtext
i(xi−µx)2/ntoσ2
kx≡/summationtext
i(kxi−
kµx)2/n=k2/summationtext
i(xi−µx)2/n=k2σ2
k.
For example, we are often interested in estimating ˆpfrom data with a Binomial-
type story. Since E(x) =npunder a Binomial model, one could estimate ˆpas
E(x/n). As for the variance,let kin the last paragraphbe 1/n; then the variance
ofx/nis the original variance ( var(x) =nˆp(1−ˆp)) times 1/n2, which gives
var(ˆp) = ˆp(1−ˆp)/n.
Hypergeometric Say that we have a pool of Nelements, initially consisting of
ssuccesses and f≡N−sfailures. So N=s+f, and the
Bernoulli probability for the entire pool is p=s/N. What are the odds that we
getxsuccessesfrom ndrawswithoutreplacement ?Inthiscase,theprobabilityof
a successchangesasthe drawsare made.The countingis more d ifﬁcult, resulting
in asomewhatmore involvedequation.
gsl_stats March24,2009
240 CHAPTER 7
P(x,s,f,n )=/parenleftbigs
x/parenrightbig/parenleftbigf
n−x/parenrightbig
/parenleftbigN
n/parenrightbig
=gsl_ran_hypergeometric _pdf(x,s,f,n)
E(x|n,s,f ) =ns
N
var(x|n,s,f )=n(s
N)(1−s
N)(N−n)
(N−1)
RNG :gsl_ran_hypergeometric (r,s,f,n)
• AsN→∞, drawing with and without replacement become equivalent, s o the
Hypergeometricdistribution approachesthe Binomial.
Multinomial The Binomial distribution was basedon having a series of eve nts that
could take on only two states: success/failure, sick/well, heads/tails,
et cetera. But what if there are several possible events, lik e left/right/center, or
Africa/Eurasia/Australia/Americas? The Multinomial dis tribution extends the Bi-
nomialdistribution for suchcases.
The Binomial case could be expressed with one parameter, p, which indicated
success with probability pand failure with probability 1−p. The Multinomial
caserequires kvariables, p1, ...,pk, suchthat/summationtextk
i=1pi= 1.
P(x,p,n) =n!
x1!···xk!px1
1···pxk
k
=gsl_ran_multinomial _pdf(k,p,n)
E

x1
x2
...
xn
/vextendsingle/vextendsingle/vextendsingle/vextendsingle/vextendsingle/vextendsingle/vextendsingle/vextendsingle/vextendsinglen,p
=n
p1
p2
...
pn

var(x|n,p) =n
p1(1−p1)−p1p2...−p1pk
−p1p2p2(1−p2)...−p2pk
.........
−pkp1−pkp2... p k(1−pk)

RNG :gsl_ran_multinomial (r,draws ,k,p,out)
• There are two changes from the norm for the GSL’s functions. First, /D4and /D2are
arrays of /CS/D3/D9/CQ/D0/CTs of sizek. If/summationtextk
i=1p[i]∝\e}atio\slash= 1, then the system normalizes the
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 241
probabilities to make this the case. Also, most RNGs draw one number at a time,
butthisonedraws Kelementsatatime,whichwillbeputintothebinsofthe /D3/D9/D8
array.
• Youcanverifythatwhen k= 2, this is theBinomialdistribution.
Normal You know and love the bell curve, aka the Gaussian distributi on. It is pic-
turedfor afewvaluesof σ2in Figure7.6.
AsSection9.1will explainindetail,anysetofmeansgenera tedviaiiddrawswill
haveaNormaldistribution. Thatis,
• Draw Kitems from the population (which can have any nondegenerate distribu-
tion),x1,x2,... ,x k. TheNormalapproximationworksbestwhen Kis large.
• Write downthe meanofthoseitems, ¯xi.
• Repeatthe ﬁrsttwo steps ntimes,producinga set x={¯x1,¯x2,... ,¯xn}.
ThenxhasaNormaldistribution.
Alternatively,theBinomialdistributionalreadyproduce dsomethingofabellcurve
withn= 4above; as n→∞, the Binomial distribution approaches a Normal
distribution.
P(x,µ,σ ) =1
σ√
2πexp/parenleftigg
−1
2/bracketleftbigg(x−µ)
σ/bracketrightbigg2/parenrightigg
=gsl_ran_gaussian _pdf(x,sigma ) +mu
E(x|µ,σ) =µ
var(x|µ,σ) =σ2
/integraldisplayx
−∞N(y|µ,σ)dy=gsl_cdf_gaussian _P(x−mu,sigma )
/integraldisplay∞
xN(y|µ,σ)dy=gsl_cdf_gaussian _Q(x−mu,sigma )
RNG :gsl_ran_gaussian (r,sigma ) +mu
• IfX∼N(µ1,σ1)andY∼N(µ2,σ2)thenX+Y∼N(µ1+µ2,/radicalbig
σ2
1+σ2
2).
• BecausetheNormalis symmetric, X−Y∼N(µ1−µ2,/radicalbig
σ2
1+σ2
2).
• Section9.1(p 297)discussestheCentralLimit Theoremin g reaterdetail.
gsl_stats March24,2009
242 CHAPTER 7
00.10.20.30.40.50.6
−3−2−1 0 1 2 3P(x,µ,σ )
xσ= 0.75
σ= 1
σ= 1.75
σ= 2.5
Figure 7.6 TheNormal distribution, with µ= 0.
Multivariate Normal Just as the Normal distribution is the extension of the Bino-
mial, the Multivariate Normal is the extension of the Multi-
nomial. Say that we have a data set Xthat includes a thousand observations and
seven variables (so Xis a 1000×7 matrix). Let its mean be µ(a vector of length
seven) and the covariance among the variables be Σ(a seven by seven matrix).
Thenthe MultivariateNormaldistribution thatyoucouldﬁt to thisdatais
P(X,µ,Σ) =exp/parenleftbig
−1
2(X−µ)′Σ−1(X−µ)/parenrightbig
/radicalbig
(2π)ndet(Σ)
E(X|µ,Σ) =µ
var(X|µ,Σ) =Σ
• When Xhasonlyonecolumnand Σ= [σ2],thisreducestotheunivariateNormal
distribution.
Lognormal The Normal distribution is aproposwhen the items in a sample are the
meanofasetofdrawsfromapopulation, xi= (s1+s2+···+sk)/k.
Butwhatifadatapointisthe productofaseriesofiidsamples, ˜xi=s1·s2·····sk?
Thenthe log of ˜xiisln(˜xi) = ln( s1) + ln( s2) +···+ ln(sk), so the log is a sum
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 243
00.20.40.60.811.21.41.6
0 1 2 3 4 5P(x,µ,σ )
xµ= 0,σ= 1
µ=−0.5,σ= 1
µ= 1,σ= 1
µ= 0,σ= 2
Figure 7.7 The Lognormal distribution.
of independentelements (i.e., ntimes a mean). Very broadly, when a point in the
data set is produced by summing iid draws, it will be Normally distributed; when
apointinthedatasetisproducedbytakingtheproductofiid draws,itslogwillbe
Normally distributed—i.e., it will have a lognormal distri bution. The next section
will presentanexample.Figure7.7showssomeLognormaldis tributions.
A notational warning: in the typical means of expressing the lognormal distribu-
tion,µandσrefer to the mean of the Normal distribution that you would ge t if
you replaced every element xin your data set with ex, thus producing a standard
Normal distribution. Be careful not to confusethis with the mean and variance of
thedatayouactuallyhave.
p(x,µ,σ ) =exp/parenleftbig
−(lnx−µ)2/(2σ2)/parenrightbig
xσ√
2π
=ran_lognormal _pdf(x,mu,sigma )
E(x|µ,σ) =e“
µ+σ2
2”
var(x|µ,σ) = (eσ2−1)e(2µ+σ2)
RNG :ran_lognormal (rng,mu,sigma )
gsl_stats March24,2009
244 CHAPTER 7
Negative binomial Say that we have a sequence of Bernoulli draws. How many
failures will we see before we see nsuccesses?If ppercentof
cars are illegally parked, and a meter reader hopes to write nparking tickets, the
Negativebinomialtells hertheoddsthatshewill beableto s topwith n+xcars.
Theform is basedon theGammafunction,
Γ(z) =/integraldisplay∞
0xz−1e−xdx
=gsl_sf_gamma (z).
Youcaneasilyverifythat Γ(z+1) = zΓ(z).Also, Γ(1) = 1,Γ(2) = 1,Γ(3) = 2,
Γ(4) = 6 , and generally, Γ(z) = (z−1)!for positive integers. Thus, if nand
xare integers, formulas based on the Gamma function reduce to more familiar
factorial-basedcountingformulas.
P(x,n,p ) =Γ(n+x)
Γ(x+ 1)Γ( n)pn(1−p)x
=gsl_ran_negative _binomial _pdf(x,p,n)
E(x|n,p) =n(1−p)
p
var(x|n,p) =n(1−p)
p2
RNG :gsl_ran_negative _binomial (rng,p,n)
RATESA Poisson process is very much like a Bernoulli draw, but the u nit of mea-
surementiscontinuous—typicallyameasureoftimeorspace .Itmakessense
to have half of an hour, but not half of a coin ﬂip, so the storie s above based on
Bernoullidrawsaremodiﬁedslightly toallowfora rateof λeventsperhourtobe
appliedto halfanhourora week.
Baltimore, Maryland, sees about 110 days of precipitation p er year, somewhat
consistentlyspacedamongthemonths.Butforhowmanydaysw illitrainorsnow
in a single week? The Poisson distribution answers this ques tion. We can also
do a count of weeks: how often does it rain once in a week, twice in a week, et
cetera? The Exponential distribution answers this questio n. Turning it around, if
wewantaweekwiththreerainfalls,howlongwouldwehavetow ait?TheGamma
distribution answersthis question.
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 245
00.050.10.150.20.250.30.350.4
0 5 10 15 20 25 30P(x,λ)
xλ= 1
λ= 3
λ= 10
λ= 20
Figure 7.8 The Poissondistribution.
Poisson Say that independent events (rainy day, landmine, bad data) occur at the
mean rate of λevents per span (of time, space, et cetera). What is the
probability thatthere will be xeventsin asinglespan?
We are assuming that events occur at a sufﬁciently even rate t hat the same rate
appliesto differenttime periods:ifthe rateperdayis λ1,thenthe rateperweekis
7λ1, andthe rateperhouris λ1/24. SeeFigure7.8.
P(x,λ) =e−λλx
x!
=gsl_ran_poisson_pdf(x,lambda )
E(x|λ) =λ
var(x|λ) =λ
RNG :gsl_ran_poisson (r,lambda )
• Asn→∞, Binomial (n,p)→Poisson (np).
• IfX∼Poisson( λ1),Y∼Poisson( λ2), andXandYare independent, then
(X+Y)∼Poisson( λ1+λ2).
• Asλ→∞,Poisson( λ)→N(λ,√
λ).
gsl_stats March24,2009
246 CHAPTER 7
Q7.7• Calculate the Binomial-distributed probability of three rainfalls in
sevendays,giventheprobabilityofraininonedayof p= (110 /365).
• Calculate the Poisson-distributed probability of three r ainfalls in
sevendays,givena one-day λ= (110 /365).
Gamma distribution TheGamma distribution isso-namedbecauseitreliesheavily
on the Gamma function, ﬁrst introduced on page 244. Along
withtheBetadistributionbelow,thisnamingschemeisoneo fthegreatnotational
tragediesofmathematics.
A better name in the statistical context would be ‘Negative P oisson,’ because it
relatestothePoissondistributioninthesamewaytheNegat ivebinomialrelatesto
the Binomial. If the timing of events follows a Poisson distr ibution, meaning that
eventscome by at the rate of λper period, then this distribution tells us how long
wewouldhaveto waituntil the nth eventoccurs.
The form of the Gamma distribution, shown for some parameter values in Fig-
ure 7.9, is typically expressed in terms of a shape parameter θ≡1/λ, where λ
is the Poisson parameter. Here is the summary for the functio n in terms of both
parameters:
P(x,n,θ )=1
Γ(n)θnxn−1e−x/θ,x∈[0,∞)
=gsl_ran_gamma_pdf(x,n,theta )
P(x,n,λ ) =1
Γ(n)(1
λ)nxn−1e−λx,x∈[0,∞)(7.2.3)
E(x|n,θorλ)=nθ=n/λ
var(x|n,θorλ)=kθ2=k/λ2
/integraldisplayx
−∞G(y|n,θ)dy=gsl_cdf_gamma_P(x,theta )
/integraldisplay∞
xG(y|n,θ)dy=gsl_cdf_gamma_Q(n,theta )
RNG :gsl_ran_gamma (r,n,theta )
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 247
00.20.40.60.81
0 1 2 3 4 5 6 7 8P(x,n,θ )
xn= 1,θ= 1
n= 2,θ= 1
n= 5,θ= 1
n= 2,θ= 2
n= 2,θ= 0.5
Figure 7.9 The Gamma distribution.
• With n=d f/2andθ= 2, the Gamma distribution becomes a χ2
d fdistribution
(introducedonpage301).
• With n= 1, theGammadistribution becomesanExponential( λ)distribution.
Exponential distribution The Gamma distribution found the time until nevents
occur, but consider the time until the ﬁrst event occurs.
Γ(1)≡1,1λ= 1for all positive λ, andx0= 1for all positive x, so at n=
1, Equation 7.2.3 deﬁning the PDF of the Gamma distribution re duces to simply
e−λx.
If we had a population of items,/integraltextt
0e−λxdxpercent would have had a ﬁrst event
betweentime zero andtime t. If the eventcausesthe item to leavethe population,
thenoneminusthispercentarestillinthepopulationattim et.Theform exisvery
easyto integrate,anddoingsogivesthatthe percentleft at timet=e−λt/λ.
So we now have a story of a population where members leave via a Poisson pro-
cess. Common examples include the stock of unemployed worke rs as some ﬁnd
a job every period, radioactive particles emanating from a b lock, or drug dosage
remaining in a person’s blood stream. Figure 7.10 shows a few examples of the
Exponentialdistribution.
gsl_stats March24,2009
248 CHAPTER 7
00.10.20.30.40.50.60.70.80.91
0 1 2 3 4 5 6P(x,λ)
xλ= 1
λ= 3
λ= 10
Figure 7.10 The Exponential distribution.
Sincetheexponentis −λ,thisissometimescalledthe Negativeexponentialdistri-
bution.
P(x,λ) =1
λe−x
λ
=gsl_ran_exponential _pdf(x,lambda )
E(x|λ) =λ
var(x|λ) =λ2
/integraldisplayx
−∞Exp(λ)dy=gsl_cdf_exponential _P(x,lambda )
/integraldisplay∞
xExp(λ)dy=gsl_cdf_exponential _Q(x,lambda )
RNG :gsl_ran_exponential (r,lambda )
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 249
012345
00.10.20.30.40.50.60.70.80.91P(x,α,β )
xα= 2,β= 2
α= 0.5,β= 0.5
α= 5,β= 1
α= 1,β= 5
Figure 7.11 The Beta distribution.
DESCRIPTION Here are afew more distributions thatare frequentlyusedin model-
ing to describetheshapeofarandomvariable.
Beta distribution JustastheGammadistributionisnamedfortheGammafunctio n,
the Beta distribution is named after the Beta function—whos e
parameters are typically notated as αandβ. This book will spell out Beta (·)for
theBeta functionanduse B(·,·)forthe Betadistribution.
TheBetafunctioncanbedescribedviathefollowing forms:
Beta(α,β) =/integraldisplay1
0x(α−1)(1−x)(β−1)dx
=Γ(α)Γ(β)
Γ(α+β)
=gsl_sf_beta(alpha ,beta).
The Beta distribution is a ﬂexible way to describe data insid e the range [0,1].
Figure 7.11 shows how different parameterizations could le ad to a left-leaning,
right-leaning,concave,orconvexcurve;seepage358for mo re.
gsl_stats March24,2009
250 CHAPTER 7
P(x,α,β ) =Beta(α,β)xα−1(1−x)β−1
=gsl_ran_beta_pdf(x,alpha ,beta)
E(x|α,β) =α
α+β
var(x|α,β) =αβ
(α+β)2(α+β+ 1)/integraldisplayx
−∞B(y|α,β)dy=gsl_cdf_beta_P(x,alpha ,beta)
/integraldisplay∞
xB(y|α,β)dy=gsl_cdf_beta_Q(x,alpha ,beta)
RNG :gsl_ran_beta(r,alpha ,beta)
• Ifα <1andβ <1, thenthedistribution is bimodal,with peaksatzeroandone .
• Ifα >1andβ >1, thenthedistribution is unimodal.
• Asαrises, the distribution leans toward one; as βrises, the distribution leans
towardzero;if α=β, thenthedistribution is symmetric.
• Ifα=β= 1, thenthis isthe Uniform[0 ,1]distribution./F4The Beta distribution and order statistics The ﬁrst order statistic of a set of
numbers xis the smallest number
intheset;thesecondisthenext-to-smallest,uptothelarg estorderstatistic,which
ismax (x).
Assumethatthe α+β−1elementsof xaredrawnfromaUniform [0,1]distribu-
tion.Thenthe αthorderstatistic hasa B(α,β)distribution.
Q7.8• Write a function that takes in a /CV/D7/D0/CN/D6/D2/CV and two integers /CPand /CQ,
produces a list of /CP/B7/CQ/B9/BDrandom numbers in [0,1], sorts them, and
returnsthe athorderstatistic.
• Writeafunctiontocallthatfunction10,000timesandplot thePDFof
thereturneddata(using /CP/D4/D3/D4/CN/D4/D0/D3/D8/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1 ).Ithelpstoprecede
theplotoutputtoGnuplotwith /D7/CT/D8 /DC/D6/CP/D2/CV/CT /CJ/BC/BM/BD℄tokeeptherange
consistent.
• Write a /D1/CP/CX/D2that produces an animation of the PDFs of the ﬁrst
through 100thorderstatistic for asetof100numbers.
• Replace the call to the draw-and-sort function with a draw f rom the
B(a,b)distribution, andre-animate theresults.
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 251
Uniform distribution What discussion of distributions would be complete without
mention of the Uniform? It represents a belief that any value
within [α,β]isequallypossible.
P(x,α,β ) =/braceleftigg
1
β−αx∈[α,β]
0x < α,x > β
=gsl_ran_flat_pdf(x,alpha ,beta)
E(x|α,β) =β−α
2
var(x|α,β) =(β−α)2
12
/integraldisplayx
−∞U(y|α,β)dy=

0 x < α
x−α
β−αx∈[α,β]
1 x > β
=gsl_cdf_flat_P(x,alpha ,beta)/integraldisplay∞
xU(y|α,β)dy=gsl_cdf_flat_Q(x,alpha ,beta)
RNG, general : gsl_ran_flat(r,alpha ,beta)
RNG,α = 0,β= 1 :gsl_rng_uniform (r)
®Probabilitytheoriststhroughtheageshavedevelopedmode lsthatin-
dicatethatifaprocessfollowscertainguidelines,thedat awillhavea
predictableform.
®A single draw from a binary event with ﬁxed probability has a
Bernoulli distribution; from this, a wealth of other distri butions can
bederived.
®Aneventwhichoccurswithfrequency λperperiod(or λpervolume,
etcetera)isknownasaPoissonprocess;awealthofdistribu tionscan
bederivedforsuchaprocess.
®Ifxis the meanofa setofindependent,identically distributed draws
fromanynondegenerate distribution, then the distribution of xap-
proachesa Normaldistribution. Thisis theCentralLimit Th eorem.
®The Beta distribution is useful for modeling a variety of var iables
thatarerestrictedto [0,1]. Itcanbeunimodal,bimodal,leanineither
direction,orcansimplymatchthe Uniform distribution.
gsl_stats March24,2009
252 CHAPTER 7
7.3 U SING THE SAMPLE DISTRIBUTIONS Herearesomeexamplesofhow
you could use the distributions
describedaboveto practicalbeneﬁt.
LOOKING UP FIGURES IfIhaveﬁftydrawsfromaBernoullieventwithprobability
.25,whatisthelikelihoodthatIwillhavemorethantwenty
successes?
Statisticstextbooksusedtoincludeanappendixlistingta blesofcommondistribu-
tions, but those tables are effectively obsolete, and more m odern textbooks refer
the reader to the appropriate function in a stats package. Fo r those who long for
the daysof grand tables, the code supplementincludes /D2/D3/D6/D1/CP/D0/D8/CP/CQ/D0/CT/BA , code for
producing a neatly formatted table of CDFs for a set of Normal distributions (the
p-valueoften reportedwith hypothesistestsis oneminusthe listed value).
Thecodeisnotprintedherebecauseitisentirelyboring, bu tthetablesitproduces
provideanothernicewayto geta feelfor thedistributions.
Alternatively, Apophenia’s command-line program /CP/D4/D3/D4/CN/D0/D3/D3/CZ/D9/D4 will look up a
quicknumberfor you.
GENERATING DATA FROM A DISTRIBUTION Eachdistributionneatlysummarizes
an oft-modeled story, and so each
can be used as a capsule simulation of a process, either by its elf or as a build-
ingblockfora largersimulation.
Listing7.12givesaquickinitialexample.Itisbasedonwor koriginatedbyGibrat
(1931) and extended by many others, including Axtell (2006) , regarding Zipf’s
law, that the distribution of the sizes of cities, ﬁrms, or other such agglomera-
tions tends toward an Exponential-typeform. In the modelhe re, this comes about
because agents’ growth rates are assumed to be the mean of a se t of iid random
shocks,andsoareNormally distributed.
• First,theprogramproducesasetofagentswithonecharact eristic:size,storedina/CV/D7/D0/CN/DA/CT/D8/D3/D6 .The /CX/D2/CX/D8/CX/CP/D0/CX/DE/CT functiondrawsagentsizesfromaUniform [0,100]
distribution.Todothis,itrequiresa /CV/D7/D0/CN/D6/D2/CV,which /D1/CP/CX/D2allocatesusing /CP/D4/D3/D4/CN/B9/D6/D2/CV/CN/CP/D0/D0/D3 andpassesto /CX/D2/CX/D8/CX/CP/D0/CX/DE/CT .SeeChapter11formoreonusingrandom
numbergenerators.
• Eachperiod,theﬁrmsgrowbyaNormallydistributedrate(v iathe /CV/D6/D3/DBfunction).
Thatis,the /CV/D6/D3/DBfunctionrandomlydraws gfroma /CV/D7/D0/CN/D6/D2/CV/CN/CV/CP/D9/D7/D7/CX/CP/D2 ,andthen
reassigns the ﬁrm size to size←size∗exp(g). The most likely growth rate is
therefore exp(0) = 1 . When g <0,exp(g)<1; and when g >0,exp(g)>1.
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 253
#include <apop.h>
intagentct =5000;
intperiods = 50;
intbinct = 30;
doublepauselength = 0.6;
gsl_rng*r;
voidinitialize( double*setme){
*setme = gsl_rng_uniform(r) *100;
}
voidgrow(double*val){
*val*= exp(gsl_ran_gaussian(r,0.1));
}
doubleestimate(gsl_vector *agentlist){
returnapop_vector_mean(agentlist);
}
intmain(){
gsl_vector *agentlist = gsl_vector_alloc(agentct);
r= apop_rng_alloc(39);
apop_vector_apply(agentlist, initialize);
for(inti=0;i< periods;i++){
apop_plot_histogram(agentlist, binct, NULL);
printf("pause %g\n",pauselength);
apop_vector_apply(agentlist,grow);
}
fprintf(stderr,"the mean: %g\n",estimate(agentlist));
}
Listing7.12 A model ofNormally distributedgrowth. Online source: /D2/D3/D6/D1/CP/D0/CV/D6/D3/DB/D8/CW/BA .
Also,exp(g)∗exp(−g) = 1, and by the symmetry of the Normal distribution, g
and−ghaveequallikelihood,soitiseasyforanagentto ﬁndgoodlu ckinperiod
one counteredby comparable bad luck in period two, leaving i t near where it had
started.
• The output is a set of Gnuplot commands, so use /BA/BB/D2/D3/D6/D1/CP/D0/CV/D6/D3/DB/D8/CW /DG /CV/D2/D9/D4/D0/D3/D8.
Witha /D4/CP/D9/D7/CTbetweeneachhistogram,theoutputbecomesananimation,sh owing
a quick transition from a Uniform distribution to a steep Log normal distribution,
wheremostagentsarefastapproachingzerosize,butahandf ulhavesizeapproach-
ing1,000.8
8Here, the x-axis is the ﬁrm size, and the y-axis is the number of ﬁrms. Typically, Zipf-type distribut ions are
displayed somewhat differently: the x-axis is the rankof the ﬁrm, 1st,2nd,3rd, et cetera, and the y-axis is the
size of the so-ranked ﬁrm. Converting to this form is left as a n exercise to the reader. ( Hint: use /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/B9/D7/D3/D6/D8.)
gsl_stats March24,2009
254 CHAPTER 7
• The last step is a model estimation, to which we will return i n a few pages. Its
output is printed to /D7/D8/CS/CT/D6/D6, aka the screen, so that the pipe to Gnuplot is not
disturbed.
SIMULATION Feinet al.(1988)found that their depressivepatients respondedwell
toacombinationofLithiumandamonoamineoxidaseinhibito r(MAOI).
Butbothtypesofdrugrequirecarefulmonitoring:Lithiumo verdosesarecommon
and potentially damaging,while the combination of MAOIs an d chocolatecan be
fatal.
#include <apop.h>
doubleﬁnd_lambda( doublehalf_life){
doublelambda =−half_life/log(1/2.);
returngsl_cdf_exponential_Q(1, lambda);
}
intmain(){
doubleli= 0, maoi = 0;
intdays = 10;
gsl_matrix *d= gsl_matrix_alloc(days *24,4);
doublehourly_decay1 =ﬁnd_lambda(20.); //hours;lithium carbonate
doublehourly_decay2 =ﬁnd_lambda(11.); //hours;phenelzine
for(size_ti=0;i < days *24; i ++){
li*= hourly_decay1;
maoi*= hourly_decay2;
if(i% 24 == 0)
li+= 600;
if((i+12) % 24== 0)
maoi+= 45;
APOP_MATRIX_ROW(d,i,onehour);
apop_vector_ﬁll(onehour, i/24., li/10., maoi, maoi/li *100.);
}
printf("plot ’maoi.out’ using 1:2withlines title’Li/10’ , \
’maoi.out’using 1:3withlines title’MAOI’,\
’maoi.out’using 1:4withlines title’MAOI/Li, pct\n");
remove("maoi.out");
apop_matrix_print(d,"maoi.out");
}
Listing7.13 Asimulationofthebloodstreamofapersontaki ngtwodrugs.Onlinesource: /D1/CP/D3/CX/BA.
Listing7.13simulatesapatient’sbloodstreamasshefollo wsaregimeofLithium
carbonate (average half life: about 20 hours, with high vari ance) and an MAOI
named phenelzine (average half life: 11 hours). As per the st ory on page 247,
whenthedrugleavesthebloodstreamviaaPoissonprocess,t heamountofadrug
remainingin thebloodis describedbyanExponentialdistri bution.
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 255
020406080100120
012345678910AmountLi andMAOI; PercentMAOI/Li
DayLi/10
MAOIMAOI/Li, pct
Figure7.14 Thetypical sawtooth patternof decay andrenewa l.
• Theﬁrststepis toconvertfrom thehalflife commonlyusedb ypharmaciststothe
λparameterin theexponentialdistribution. The /CU/CX/D2/CS/CN/D0/CP/D1/CQ/CS/CP functiondoesthis.
• Given λ, /CV/D7/D0/CN/CS/CU/CN/CT/DC/D4/D3/D2/CT/D2/D8/CX/CP/D0/CN/C9/B4/BD/B8 /D0/CP/D1/CQ/CS/CP/B5 answers the question of what
percentageofa giveninitial levelis remainingafteroneho ur.
• The main simulation is a simple hourly /CU/D3/D6loop, that decrements the amount of
drug in the blood stream by the amount calculated above, then checks whether it
is time for our patientto take one ofher meds,and then record s the variouslevels
onherchart.
• The ungainly /D4/D6/CX/D2/D8/CUstatement at the end plots the result. Gnuplot does not save
data,soitneedsto rereadthedataﬁle threetimes to plotthe three columns.
Figure 7.14 shows the density in blood as our subjecttakes 60 0 mg of Lithium at
midnight every day, and 45 mg of MAOI at noon every day. For con venience in
scalingoftheplot,theamountofLithium inthebloodstream isdividedbyten.In
the later days, after the subject’s system has reachedits dy namic equilibrium, she
takes in 600 mg of Li per day, and loses about 600 mg per day; sim ilarly for the
45 mg of MAOI. The ratio of MAOI/Li jumps constantly over the r ange of 187%
to 824%.
Q7.9Deriveorverifythatthe /CU/CX/D2/CS/CN/D0/CP/D1/CQ/CS/CP functioncorrectlyconvertsbetween
halflife andtheExponentialdistribution’s λparameter.
gsl_stats March24,2009
256 CHAPTER 7
Q7.10Let there be two stocks: employed and unemployed. Let the hal f-life of
employment (i.e., transition to unemployment) be 365 days, and the half-
life ofunemployment(i.e., ﬁndinga job)be3weeks(21 days) .
ModifytheLithium/MAOIprogramtomodelthesituation.For eachperiod,
calculatethelossfromboththeemploymentandtheunemploy mentstocks,
andthentransfertheappropriatenumberofpeopletotheoth erstock.What
isthe equilibrium unemploymentrate?
FITTING EXISTING DATA Thecommongoalthroughoutthebookistoestimatethe
parameters of the model with data, so given a data set,
howcanweﬁndthe parametersfor thevariousdistributions a bove?
You can see above that almost every parameter can be solved—s ometimes over-
solved—usingthemeanandvariance.Forexample,Equations 7.2.1and7.2.2(de-
scribing the parameters of a Binomial distribution) are a sy stem of two equations
in two unknowns:
µ=np
σ2=np(1−p)
It is easyto calculateestimates of µandσfrom data, ˆµandˆσ, and we could plug
those estimates into the above system of equations to ﬁnd the parameters of the
distribution. Youcanverify thatforthesetwoequationswe wouldhave
ˆn=ˆµ2
ˆµ−ˆσ2
ˆp= 1−ˆσ2
ˆµ.
This ismethod of moments estimation (see, e.g., Greene (1990, pp 117 ff)). To
summarize the method, we write down the parameter estimates as functions of
the mean, variance, skew, and kurtosis, then we ﬁnd estimate s of those parame-
ters from the data, and use those parameter estimates to solv e for the parameter
estimatesofthe modelitself.
But problems easily crop up. For example, we can just count ob servations to ﬁnd
thevalueof nforourdataset,sogiven n,ˆµ,andˆσ2,oursystemofequationsisnow
two equations with only one unknown ( p). The Poisson distribution had a similar
butsimplerstory, becauseits singleparameterequalstwo d ifferentmoments:
µ=λ
σ2=λ.
Soifourdatasetshows ˆµ= 1.2andˆσ2= 1.4,whichdoweusefor ˆλ?Apophenia
doesn’tfretmuchaboutthisissueandjustuses ˆµ,becausethisisalsothemaximum
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 257
likelihood estimator (MLE) of λ(where MLE will be discussed fully in Chapter
10).
FortheUniform,themethodofmomentsdoesn’tworkeither:t heexpression (β−
α)is oversolved with the two equations, but there is no way to so lve for αorβ
alone. However, a few moments’ thought will show that the mos t likely value for
(α,β)givendata xissimply (min(x),max(x)).
Most of the above distributions have an /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 associated ( /CP/D4/D3/D4/CN/D2/D3/D6/D1/CP/D0 ,/CP/D4/D3/D4/CN/CV/CP/D1/D1/CP , /CP/D4/D3/D4/CN/D9/D2/CX/CU/D3/D6/D1 , et cetera), and if you have a data set on hand, you
canquicklyestimate theaboveparameters:
apop_data *d=your_data;
apop_model *norm = apop_estimate(d,apop_normal);
apop_model *beta = apop_estimate(d, apop_beta);
apop_model_show(norm);
apop_model_show(beta);
apop_model_show(apop_estimate(d,apop_gamma));
Q7.11Listing 7.12 produces a data set that should be Zipf distribu ted. Add an
estimationin the /CT/D7/D8/CX/D1/CP/D8/CT functionto seehowwell itﬁts.
Better still, run a tournament. First, declare an array of se veralmodels, say
the Lognormal, Zipf, Exponential, and Gamma. Write a /CU/D3/D6loop to esti-
mate each model with the data, and ﬁll an array of conﬁdencele vels based
on log-likelihood tests. [Is such a tournament valid? See th e notes on the
multiple testingproblem on316.]
The method of moments provides something of a preview of the w orking of the
variousmodel-basedestimationsin theremainderofthe boo k.It tookin data,and
produced an estimate of the model parameters, or an estimate of a statistic using
theestimate ofthe modelparametersthatwere producedusin gdata.
Asthereadermayhavenoticed,alltheseinteractionsbetwe endata,modelparam-
eters, and statistics create many opportunities for confus ion. Here are some notes
to bearin mind:
• The expected value, variance, and other such measures of a data set, when no
modelis imposed,is afunctionofthe data.[E.g., E(x).]
• Theexpectedvalue,variance,andothersuchmeasuresofa modelarefunctionsof
theidealparameters,notanyonedataset.[E.g., E(x|β)is onlya functionof β.]
• Ourestimateof model parameters given a data set is a function of the given data
set (and perhaps any known parameters, if there are any on han d). For example,
the Normalparameter µis a partof themodelspeciﬁcation,butthe estimate of µ,
gsl_stats March24,2009
258 CHAPTER 7
whichwewriteas ˆµ,isafunctionofthedata.Anyvariablewithahat,like ˆp,could
benotatedasa functionofthedata, ˆp(x).
• We will often have a statistic like E(x)that is a function of the data—in fact,
we deﬁne a statisticto bea function of data . But models often have data-free
analoguestothesestatistics.Givenaprobabilitydistrib utionP(x,β),theexpected
value E(f(x)|β) =/integraltext
∀xf(x)P(x,β)dx, meaning that we integrate over all x,
and so E(f(x)|β)is a function of only β. The model in which βlives is almost
always taken as understood by context, and many authors take the parameters as
understoodbycontextaswell,leavingtheexpectedvalueto bewrittenas E(f(x)),
eventhoughthis expressionisa functionof β, notx.
BAYESIAN UPDATING The deﬁnition of a conditional probability is based on the
statement P(A∩B) =P(A|B)P(B); in English, the like-
lihoodof AandBoccurringatthesametimeequalsthelikelihoodof Aoccurring
given that Bdid, times the likelihood that Boccurs. The same could be said re-
versing AandB:P(A∩B) =P(B|A)P(A). Equating the two complementary
forms andshuntingover P(B)givesusthe commonform ofBayes’srule:
P(A|B) =P(B|A)P(A)
P(B).
Now to apply it. Say that we have a prior belief regarding a par ameter, such as
thatthedistribution ofthemeanofa datasetis ∼N(0,1); letthis be Pri(β). We
gather a data set X, and can express the likelihood that we would have gathered
thisdatasetgivenanyhaphazardvalueof β,P(X|β).LetBbetheentirerangeof
values that βcould take on. We can then use Bayes’s rule to produce a posterior
distribution :
Post(β|X) =P(X|β)Pri(β)
P(X)
So on the right-hand side, we had a prior belief about β’s value expressed as a
distribution, and a likelihood function P(X|β)expressing the odds of observing
the data we observed given any one parameter. On the left-han d side, we have a
new distribution for β, which takes into account the fact that we have observed
the data X. In short, this equation used the data to update our beliefs a bout the
distribution of βfromPri(β)toPost(β).
The numerator is relatively clear, and requires only local i nformation, but we can
writeP(X)in its fullform—
Post(β|X) =P(X|β)Pri(β)/integraltext
∀B∈BP(X|B)Pri(B)dB
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 259
—torevealthatthedenominatorisactuallyglobalinformat ion,becausecalculating
itrequirescoveringtheentirerangethat βcouldtakeon.Localinformationiseasy
and global information is hard (see pages 325 ff), so Bayesian updating is often
describedviaa form thatjustignoresthe globalpart:
Post(β|X)∝P(X|β)Pri(β).
Thatis,theposteriorequalstheamountontheright-handsi detimesaﬁxedamount
(the denominator above) that does not depend on any given val ue of β. This is
already enough to compare ratios like Post(β1|X)/Post (β2|X), and given the
right conditions, such a ratio is already enough for running likelihood ratio tests
(asdiscussedin Chapter10).
Computationally,therearetwopossibilitiesformovingfo rwardgiventheproblem
of determining the global scale of the distribution. First, there are a number of
conjugate distribution pairs that can be shown to produce an output model that
matches the prior in form but has updated parameters. In this case, the /CP/D4/D3/D4/CN/B9/D9/D4/CS/CP/D8/CTfunction simply returns the given model and its new paramete rs; see the
examplebelow.
Chapter 11 will present a computationally-intensive metho d of producing a pos-
terior distribution when the analytic route is closed (i.e. ,Monte Carlo Maximum
Likelihood ). But for now we can take /CP/D4/D3/D4/CN/D9/D4/CS/CP/D8/CT as a black box that takes in
twomodelsandoutputsanupdatedconjugateformwherepossi ble,andanempiri-
caldistributionotherwise.Wecouldthenmakedrawsfromth eoutputdistribution,
plot it, use it as the prior to a new updating procedure when a n ew data setcomes
in, etcetera.
An example: Beta ♥Binomial For now, assume that the likelihood that someone
has a tattoo is constantfor all individuals, regard-
less of age, gender, ...(we will drop this clearly false assu mption in the section
on multilevel modeling, page 288). We would like to know the v alueof that over-
all likelihood. That is, the statistic of interest is p≡(count of people who have
tattoos)/(total numberofpeoplein thesample).
Because we have weak knowledge of p, we should describe our beliefs about its
valueusingadistribution: phassmalloddsofbeingnearzeroorone,areasonable
chanceof beingabout10%, and so on. The Beta distribution is a good way to de-
scribethedistribution, becauseitis positiveonlyforinp utsbetweenzeroandone.
LetBindicate the Beta distribution; then B(1,1)is a Uniform(0, 1) distribution,
which is a reasonably safe way to express a neutral prior beli ef about p. Alterna-
tively, setting Pri(p)to beB(2,2)will put more weight around p= 1/2and less
attheextremes,andraisingthesecondparameteralittle mo rewillbringthemode
ofourbeliefs about pbelow 1/2[SeeFigure7.11].
gsl_stats March24,2009
260 CHAPTER 7
Given p,thedistributionoftheexpectedcountoftattooedindivid ualsisBinomial.
For each individual, there is a pchance of having a tattoo—a simple Bernoulli
draw. The overall study makes n= 500such draws, and thus ﬁts the model un-
derlying the Binomial distribution perfectly. But we do not yet know p, so this
paragraph had to begin by taking pas given. That is, the Binomial distribution
describes P(data|p).
It so happens that the Beta and Binomial distributions are co njugate. This means
that,giventhat Pri(p)isaBetadistributionand P(data|p)isaBinomialdistribu-
tion,theposterior Post(p|data)isaBetadistribution,justliketheprior.Tablesof
othersuchconjugatepairsare readilyavailableonline.
However,the parametersare updatedto accommodatethe newi nformation. Let x
be the number of tattoos observed out of nsubjects, and the prior distribution be
B(α,β). Thenthe posterioris a B(α+x,β+n−x)distribution. Thediscussion
oftheprior offeredpossibilities like α=β= 1orα=β= 2. Butthe surveyhas
500subjects;the countoftattooed individualsalone dwarf sα= 2. Therefore,we
canapproximatetheposteriorassimply B(x,n−x).
The catalog above listed the expected value of a Beta distrib ution asα
α+β. With
α=xandβ=n−x, this reducessimply to x/n. Thatis, the expectedposterior
valueof pisthepercentageofpeopleinoursamplewhohavetattoos( ˆp).Bayesian
updatinggaveusaresultexactlyaswewould expect.
Thevarianceofa Betadistribution is
αβ
(α+β)2(α+β+ 1).
Again, with Naround 500, the 1 in the denominator basically disappears. F illing
inα=xandβ=n−x, weget
ˆp(1−ˆp)
n.
Again,this is whatwewould getfrom the Binomialdistributi on.
WecallaB(α,β)distributionwithsmall αandβaweakprior ,bywhichwemean
that a moderately-sized data set entirely dwarfs the belief s we expressed in the
prior. So what is the point of the updating process? First, we could use a stronger
prior, like α= 200 ,β= 300, which would still have some effect on the posterior
distribution evenafterupdatingwith the dataset.
Second,the system providesa consistentmechanismfor comb ining multiple data
sets. The posterior distribution that you have after accoun ting for a data set will
have a form appropriate for use as a prior distribution to be u pdated by the next
dataset.Thus,Bayesianupdatingprovidesanaturalmechan ismforrunningmetas-
tudies.
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 261
Q7.12Verifythat /CP/D4/D3/D4/CN/D9/D4/CS/CP/D8/CT usingaBetaprior,aBinomiallikelihoodfunction,
andthetattoodatadoesindeedproducetheestimatedmeanan dvarianceas
the simple x/nestimate. Gather the data from the column /D8/CP/D8/D8/D3/D3/D7/BA/B3/CT/CV/D3/CW/CP/D7 /D8/CP/D8/D8/D3/D3/D7/B3 , which is coded1=yes,2=no,and calculate ˆµand/hatwideσ2using
theformulæ inthe abovefewparagraphs.
Whatresultsdoyougetwhenyouassumeastrongerprior,like B(200,800)
orB(800,200)?
7.4 N ON-PARAMETRIC
DESCRIPTIONSay that we have a data set and would like to know
the distribution from which the data was drawn. To
this point, we assumed the form of the distribution
(Normal, Binomial, Poisson, et cetera) and then had only to e stimate the parame-
tersofthedistribution fromdata.Butwithoutassumingasi mpleparametricform,
howelsecouldwe describethedistribution from whichtheda tawasdrawn?
The simplest answer would be a plain old histogram of the draw n data. This is
oftensufﬁcient.Butespeciallyforsmalldatasets,thehis togramhasdissatisfactory
features.Ifwemakefourdraws,andthreehavevalue20andon ehasvalue22,does
thismeanthat21hasprobabilityzero,orwejustdidn’thave theluckofdrawinga
21this time?
Thus, a great deal of nonparametric modeling consists of ﬁnd ing ways to smooth
a histogram based on the claim that the actual distribution i s not as lumpy as the
data.
The histogram Thehistogramisthemostassumption-freewaytodescribeth elike-
lihood distribution from which the data was drawn. Simply la y
down a row of bins, pile each data point into the appropriate b in, normalize the
bins to sum to oneif so desired,andplot. Becausethe mostcom mon useof a his-
togram (afterjustplotting it) is usingitto makerandomdra ws,thefull discussion
ofhistogramproductionwillappearinthechapteronrandom draws,onpage361.
The key free variable in a histogram is the bandwidth —the range over the x-axis
that goes into each data point. If the bandwidth is too small, then the histogram
will have many slices and generally be as spiky as the data its elf. A too-large
bandwidthoversmooths—ataninﬁnitebandwidth,thehistog ramwouldhaveonly
one bar, which is not particularly informative. Formally, t here is a bias-variance
trade-offbetweenthe two extremes,butmostofusjusttry a f ewbandwidthsuntil
we get something that looks nice. See Givens & Hoeting (2005, ch 11) for an
extensivediscussionofthequestionin thecontextofdatas moothing.
gsl_stats March24,2009
262 CHAPTER 7
Moving average The simplest means of smoothing data is a moving average, re-
placingeachdatapointwiththemeanoftheadjacent bdatapoints
(where bis the bandwidth). You could use this for histograms or for an y other
series. For example, /D1/D3/DA/CX/D2/CV/CP/DA/CV/BA in the online code supplement plots the tem-
perature deviances as shown in /CS/CP/D8/CP/B9/D0/CX/D1/CP/D8/CT/BA/CS/CQ , and a moving average that
replaces each data point with the mean deviation over a two-y ear window, based
onthe /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/D1/D3/DA/CX/D2/CV/CN/CP/DA/CT/D6/CP/CV/CT function.
00.2 0.4 0.6 0.8 11.2 1.4 1.6 1.8 
-2000 0 2000 4000 6000 8000 10000 12000 line 1 
00.5 11.5 22.5 33.5 
-2000 0 2000 4000 6000 8000 10000 12000 line 1 
012345678
-2000 0 2000 4000 6000 8000 10000 12000 line 1 
0246810 12 
-2000 0 2000 4000 6000 8000 10000 12000 line 1 
Figure 7.15 Aseriesofdensityplots.As hrises,thekerneldensitysmoothsoutandhasfewerpeaks.
Kernel smoothing Thekerneldensityestimate is basedonthis function:
ˆf(t,X,h ) =/summationtextn
i=1N((t−Xi)/h)
n·h,
where X1,X2,... X n∈Rarethe ndatapointsobserved, N(y)isaNormal (0,1)
density function evaluated at y, andh∈R+is the bandwidth. Thus, the overall
curve is the sum of a set of subcurves, each centered over a dif ferent data point.
Figure 7.15 shows the effect of raising hon the shape of a set of ﬁtted curves.9
When his very small, the Normal distributions around each data poi nt are sharp
spikes, so there is a mode at every data point. As hgrows, the spikes spread out
andmerge,untilthesumofsubdistributionsproducesasing lebellcurve.Seepage
9Thedata is the maleviewership for 86 TVspecials, from Chwe ( 2001).
gsl_stats March24,2009
DISTRIBUTIONS FOR DESCRIPTION 263
376formore onhowtheseplotswere generated;seealsoSilve rman(1985).
As usual, there is a simple form for codeto produce a default k erneldensity from
a data set, and a more extensive form that allows more control . Try Listing 7.16,
whichplotsthehistogramofprecipitationﬁguresandtheke rnel-densitysmoothed
version based on a N(0,0.1)kernel. Also try σ= 0.001,0.01, and0.2to see the
progressionfrom the data’sspikesto asmoothbellcurve.
#include <apop.h>
intmain(){
apop_db_open("data −climate.db");
apop_data *data = apop_query_to_data("selectpcp from precip");
apop_model *h= apop_estimate(data,apop_histogram);
apop_histogram_normalize(h);
remove("out.h");remove("out.k");
apop_histogram_print(h,"out.h");
apop_model *kernel = apop_model_set_parameters(apop_normal,0.,0.1 );
apop_model *k= apop_model_copy(apop_kernel_density);
Apop_settings_add_group(k,apop_kernel_density,NULL, h,kernel, NULL);
apop_histogram_print(k,"out.k");
printf("plot ’out.h’ withlinestitle’data’,’out.k’ with lines title’smoothed’\n");
}
Listing7.16 A histogram before and after smoothing via kern el densities. Run via /D7/D1/D3/D3/D8/CW/CX/D2/CV /DG/CV/D2/D9/D4/D0/D3/D8. Online source: /D7/D1/D3/D3/D8/CW/CX/D2/CV/BA .
Q7.13Plotthe /CS/CP/D8/CP/B9/D8/DA setusing:
• ahistogram,using40and100bins,
• asmoothedversionofthe40-bin histogram,via amovingave rageof
bandwidthfour,
• the40-binhistogramsmoothedviaaNormal( x,100.0)kerneldensity,
• the40-binhistogramsmoothedviaaUniform( x−500.0,x+ 500.0)
kerneldensity.
gsl_stats March 24,2009
8
LINEAR PROJECTIONS
Our weakness forbids our considering the entire universe an d makes us cut it up into
slices.
—Poincaré (1913, p1386)
Thischaptercoversmodelsthatmakesenseofdatawithmored imensionsthanwe
humanscanvisualize.Theﬁrstapproach,takenin Section8. 1andknownasprin-
cipal component analysis (PCA), is to ﬁnd a two- or three-dim ensional subspace
that best describes the ﬁfty-dimensional data, and ﬂatten t he data down to those
fewdimensions.
The second approach, in Section 8.2, provides still more str ucture. The model la-
belsone variableasthe dependentvariable,and claimsthat it is a linear combina-
tion of the other, independent, variables. This is the ordin ary least squares (OLS)
model, which has endless variants. The remainder of the chap ter looks at how
OLScanbeappliedbyitselfandincombinationwith thedistr ibutionsintheprior
chapter.
One way to characterize the two projection approachesis tha t both aim to project
N-dimensional data onto the best subspace of signiﬁcantly fe wer than Ndimen-
sions, but they have different deﬁnitions of best. The standard OLS regression
consists of ﬁnding the one-dimensional line that minimizes the sum of squared
distances between the data and that line, while PCA consists of ﬁnding the few
dimensionswherethevarianceoftheprojectionofthedatao ntothosedimensions
ismaximized.
gsl_stats March24,2009
LINEAR PROJECTIONS 265
8.1 /F4PRINCIPAL COMPONENT ANALYSIS PCAis closelyrelated to factor
analysis, and in some ﬁelds is
known as spectral decomposition. The ﬁrst phase (calculati ng the eigenvalues)
is sometimes called the singular value decomposition . It is a purely descriptive
method. The idea is that we want a few dimensions that will cap ture the most
variancepossible—usuallytwo, becausewecanplottwodime nsionson paper.
Afterplottingthedata,perhapswithmarkersforcertainob servations,wemayﬁnd
intuitivedescriptionsforthedimensionsonwhichwehadju stplottedthedata.For
example, Poole & Rosenthal (1985) projected the votes cast b y all Congressmen
in all US Congresses, and found that 90% of the variance in vot e patterns could
be explained by two dimensions.1One of these dimensions could be broadly de-
scribed as ‘ﬁscal issues’ and the other as ‘social issues.’ T his method stands out
because Poole & Rosenthal did not have to look at bills and pla ce them on either
scale—thedataplaceditself, andtheyjusthadto namethe sc ales.
Shepard & Cooper (1992) asked their sighted subjects questi ons regarding color
words (red, orange, ...), and did a principal component anal ysis on the data to
place the words in two dimensions, where they formed a famili ar color wheel.
Theydidthesamewithblindsubjects,andfoundthattheproj ectioncollapsedtoa
singledimension,withviolet,purple,andblueononeendof thescale,andyellow
andgoldontheother.Thus,thedataindicatesthattheblind subjectsthinkofcolors
onaunivariatescalerangingfrom darkcolors tobrightcolors .
It can be shown that the best naxes, in the senseabove,are the neigenvectors of
thedata’scovariancematrix with the nlargestassociatedeigenvalues.
Theprogramsdiscussedbelowquerythreevariablesfromthe USCensusdata:the
population,medianage,andmalesper100femalesforeachUS stateandcommon-
wealth, the District of Columbia and Puerto Rico. They do a fa ctor analysis and
then project the original data onto the space that maximizes variance, producing
theplotin Figure8.1.
The programs also display the eigenvectors on the screen. Th ey ﬁnd that the ﬁrst
eigenvector is approximately (0.06,−1,0.03). among the three variables given,
the second term—population—by itself describes the most va riance in the data.
TheX-axis inthe plotfollowspopulation2
The eigenvalues for the Y-axis are (0.96,0.05,−0.29), and are thus a less one-
sidedcombinationoftheﬁrstvariable(malesperfemale)an dthelast(medianage).
Thatsaid,howcanweinterpretthe Yaxis?ThosefamiliarwithUSgeographywill
observethatthestatesprimarily coveredbycities(atthee xtreme,DC)arehighon
1They actually did the analysis using an intriguing maximum l ikelihood method, rather than the eigenvector
method here. Nonetheless, the end result and its interpreta tion are thesame.
2Asof the 2000 census, California ≈33.8million, Texas≈20.8, New York≈19.0,Florida≈16.0, etcetera.
gsl_stats March24,2009
266 CHAPTER 8
-94-92-90-88-86-84-82-80-78-76-74
-10 -5 0 5 10 15 20 25 30Second eigenvector
First eigenvectorAL
AKAZAR
CACOCT
DEDC
FL
GA
HIIDIL INIA
KSKYLAMEMDMA
MI
MNMSMO
MTNE
NVNHNJ
NMNY
NC
NDOH
OK
ORPARI
SC
SDTN
TX
UTVT
VA
WAWV
WI
WYPR
Figure 8.1 States decomposed into population on the Xaxis, and a combination of median age and
gender balance (urban-ness?) on the Yaxis.
theY-axis,whilestatesthatare farmoreruralthanurban(atthe extreme,Alaska)
are toward the bottom. Thus, the principal component analys is indicates that we
couldplausiblyinterpretthevariationinmedianageandma le/femalebalancebya
singlevariablerepresentingastate’surban–ruralbalanc e.Becauseinterpretingthe
meaningofanartiﬁcialaxisisasubjectiveexercise,other storiesarealsopossible;
forexample,onecouldalso arguethatthis secondaxisinste adrepresentsastate’s
East-to-Westlocation./F4CODING IT As with many algorithms, the process of coding is straightfo rward,
butinvolvesanumberofdetails.Thissectionwillshowyout hecom-
putation of a principal component analysis on two levels. Th e ﬁrst goes through
thestepsofcalculatingeigenvectorsyourself;thesecond is asinglefunctioncall.
• Theinputandoutputfunctionsareidenticalforbothprogr ams,sotheredundancy-
minimizing method of implementing these functions is via a s eparateﬁle, Listing
8.2, and a corresponding header, which is too simple to be rep eated here but is
includedin theonline codesupplementas /CT/CX/CV/CT/D2/CQ/D3/DC/BA/CW .
• The /D5/D9/CT/D6/DD/CN/CS/CP/D8/CP function is self-explanatory. With the clause /D7/CT/D0/CT/D8 /CV/CT/D3/CN/B9/D2/CP/D1/CT/D7 /CP/D7 /D6/D3/DB/CN/D2/CP/D1/CT/D7 , Apophenia will use the state names as row names rather
thanplaindata.
• These programs are intended to be run via pipe to Gnuplot, li ke /CT/CX/CV/CT/D2/CT/CP/D7/DD /DG/CV/D2/D9/D4/D0/D3/D8 /B9/D4/CT/D6/D7/CX/D7/D8 . So if we want additional information that Gnuplot will not
gsl_stats March24,2009
LINEAR PROJECTIONS 267
1#include "eigenbox.h"
2
3apop_data *query_data(){
4 apop_db_open("data −census.db");
5returnapop_query_to_data(" selectpostcode as row_names, \n\
6 m_per_100_f,population/1e6as population,median_age \ n\
7 from geography, income,demos,postcodes \n\
8 where income.sumlevel= ’040’ \n\
9 and geography.geo_id =demos.geo_id \n\
10 and income.geo_name = postcodes.state \n\
11 and geography.geo_id =income.geo_id ");
12 }
13
14voidshow_projection( gsl_matrix *pc_space, apop_data *data){
15 apop_opts.output_type = ’p’;
16 apop_opts.output_pipe = stderr;
17 fprintf(stderr,"The eigenvectors:\n");
18 apop_matrix_print(pc_space,NULL);
19 apop_data *projected = apop_dot(data,apop_matrix_to_data(pc_spac e),0, 0);
20 printf("plot ’ −’using 2:3:1withlabels\n");
21 apop_data_show(projected);
22 }
Listing8.2 The tools used below, including the query and a me thod for displaying labeled points.
Online source: /CT/CX/CV/CT/D2/CQ/D3/DC/BA .
understand,we needto send it to a different location. Thus, lines 15–18send out-
put to /D7/D8/CS/CT/D6/D6, so the eigenvectors are printed to screen instead of sent do wn the/D7/D8/CS/D3/D9/D8pipelineto Gnuplot.
• The /D4/D0/D3/D8command on line 20 is /DB/CX/D8/CW /D0/CP/CQ/CT/D0/D7, meaning that instead of points,
wegetthetwo-letter postalcodes,asseenin Figure8.1.
• Asfortheactualmath,Listing8.3showseverystepinthepr ocess.3Theonlyhard
part is ﬁnding the eigenvalues of X′X; the GSL saw us coming, and gives us the/CV/D7/D0/CN/CT/CX/CV/CT/D2/CN/D7/DD/D1/D1 functions to calculate the eigenvectors of a symmetric matr ix.
The /CU/CX/D2/CS/CN/CT/CX/CV/CT/D2/D7 function shows how one would use that function. The GSL is
toopoliteto allocatelargevectorsbehindourbacks,soita sksthatwepassin pre-
allocated workspaces when it needs such things. Thus, the /CU/CX/D2/CS/CT/CX/CV/CT/D2/D7 function
allocatestheworkspace,calls theeigenfunction,thenfre esthe workspace.Itfrees
the matrix whose eigenvalues are being calculated at the end because the matrix
is destroyedin the calculations,andshouldnot bereferred to again.To make sure
future tests in the way of /CX/CU /B4/AX/D7/D9/CQ/CY/CT/D8/B5/BA/BA/BA work, the last line sets the pointer
to /C6/CD/C4/C4.
3There is one cheat: the /CP/D4/D3/D4/CN/D7/DA/CN/CS/CT/D3/D1/D4/D3/D7/CX/D8/CX/D3/D2 function would use the /CP/D4/D3/D4/CN/D2/D3/D6/D1/CP/D0/CX/DE/CT/CN/CU/D3/D6/CN/B9/D7/DA/CS/B4/DC/D4/DC/B9/BQ/D1/CP/D8/D6/CX/DC/B5 function to ensure that for each row, x′x= 1. You can erase line 28 of /CT/CX/CV/CT/D2/CW/CP/D6/CS/BA ,
input this SVD-speciﬁc normalization function after the /CP/D4/D3/D4/CN/CS/D3/D8 step, and look for subtle shifts.
gsl_stats March24,2009
268 CHAPTER 8
1#include "eigenbox.h"
2
3voidﬁnd_eigens( gsl_matrix **subject,gsl_vector *eigenvals, gsl_matrix *eigenvecs){
4 gsl_eigen_symmv_workspace *w= gsl_eigen_symmv_alloc(( *subject)−>size1);
5 gsl_eigen_symmv( *subject,eigenvals, eigenvecs, w);
6 gsl_eigen_symmv_free (w);
7 gsl_matrix_free( *subject);*subject = NULL;
8 }
9
10gsl_matrix *pull_best_dims( intds,intdims,gsl_vector *evals,gsl_matrix *evecs){
11size_tindexes[dims],i;
12gsl_matrix *pc_space = gsl_matrix_alloc(ds,dims);
13 gsl_sort_vector_largest_index(indexes,dims, evals) ;
14 for(i=0; i<dims;i++){
15 APOP_MATRIX_COL(evecs,indexes[i],temp_vector);
16 gsl_matrix_set_col(pc_space,i,temp_vector);
17 }
18 returnpc_space;
19 }
20
21intmain(){
22intdims = 2;
23apop_data *x= query_data();
24apop_data *cp= apop_data_copy(x);
25intds = x−>matrix−>size2;
26gsl_vector *eigenvals = gsl_vector_alloc(ds);
27gsl_matrix *eigenvecs = gsl_matrix_alloc(ds, ds);
28 apop_matrix_normalize(x −>matrix,’c’,’m’);
29 apop_data *xpx =apop_dot(x,x,1, 0);
30 ﬁnd_eigens(&(xpx −>matrix),eigenvals,eigenvecs);
31 gsl_matrix *pc_space = pull_best_dims(ds, dims,eigenvals,eigenvecs );
32 show_projection(pc_space, cp);
33 }
Listing8.3 The detailedversion. Online source: /CT/CX/CV/CT/D2/CW/CP/D6/CS/BA .
• If the space of the data has full rank, then there will be thre e eigenvectors for
three-dimensional data. The /D4/D9/D0/D0/CN/CQ/CT/D7/D8/CN/CS/CX/D1/CT/D2/D7/CX/D3/D2/D7 function allocates a new
matrix that will have only /CS/CX/D1/D7dimensions, and the best eigenvectors are in-
cluded therein. Again, the GSL saw us coming, and provides th e /CV/D7/D0/CN/D7/D3/D6/D8/CN/B9/DA/CT/D8/D3/D6/CN/D0/CP/D6/CV/CT/D7/D8/CN/CX/D2/CS/CT/DC function, which returns an array of the indices of the
largestelementsofthe /CT/DA/CP/D0/D7vector.Thus, /CX/D2/CS/CT/DC/CT/D7/CJ/BC℄ istheindexofthelargest
eigenvalue, /CX/D2/CS/CT/DC/CT/D7/CJ/BD℄ isthepointinthevectorofvalueswiththesecondlargest
eigenvector,et cetera.Given this information, it is an eas y /CU/D3/D6loop (lines 14–17)
to copycolumnsfrom thesetofall eigenvectorsto the /D4/CN/D7/D4/CP/CT matrix.
• Finally,aftertheprincipalcomponentvectorshavebeenc alculated, /D7/CW/D3/DB/CN/D4/D6/D3/CY/CT/B9/D8/CX/D3/D2producesagraphicalrepresentationoftheresult.Itproje ctsthedataontothe
gsl_stats March24,2009
LINEAR PROJECTIONS 269
spaceviathesimpledotproduct /CS/CP/D8/CP· /D4/CN/D7/D4/CP/CT ,andthenproducesGnuplottable
outputasperthetricks discussedabove.
• Given all these functions, the main routine is just declara tions and function calls
to implementtheaboveprocedure:pullthe data,calculate X′X, sendthe resultto
theeigencalculator,projectthedata,andshowtheresults .
#include "eigenbox.h"
intmain(){
intdims = 2;
apop_data *x= query_data();
apop_data *cp= apop_data_copy(x);
apop_data *pc_space = apop_matrix_pca(x −>matrix, dims);
fprintf(stderr,"totalexplained: %Lf\n", apop_sum(pc_s pace−>vector));
show_projection(pc_space −>matrix,cp);
}
Listing8.4 The easy way: just let /CP/D4/D3/D4/CN/D7/DA/CN/CS/CT/D3/D1/D4/D3/D7/CX/D8/CX/D3/D2 do the work. Online source:/CT/CX/CV/CT/D2/CT/CP/D7/DD/BA .
Listing8.4presentsthesameprogramusingthe /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D4/CP functiontodo
the singularvaluedecompositionin one quick function call . That function simply
does the normalization and bookkeeping necessary to use the /CV/D7/D0/CN/D0/CX/D2/CP/D0/CV/CN/CB/CE/CN/B9/CS/CT/D3/D1/D4function.Allthatisleftforthe /D1/CP/CX/D2functioninListing8.4istoquerythe
inputdatatoa matrix, calltheSVDfunction, anddisplaythe outputresults.
Q8.1A matrix is positive deﬁnite (PD) iff all of its eigenvalues are greater than
zero, and positive semideﬁnite (PSD) iff all of its eigenvalues are greater
than or equal to zero. Similarly for negative deﬁnite (ND) and negative
semideﬁnite (NSD).
Theseareoftenusedasmultidimensionalanaloguestoposit iveornegative.
For example, just as x2≥0,∀x∈R,X·Xis PSD for any Xwith real
elements. An extremum of f(x)is a maximum when the second derivative
f′′(x)is negative,and a minimum when f′′(x)is positive; f(x)is a maxi-
mumwhenthematrixofsecondpartialderivativesisNSD,and aminimum
whenthematrixofsecondpartialsisPSD(otherwiseit’sasa ddlepointrep-
resenting a maximum along one direction and a minimum along a nother,
andis thusa falseextremum). ≫
gsl_stats March24,2009
270 CHAPTER 8
Q8.1≫
Writeafunction /D1/CP/D8/D6/CX/DC/CN/CX/D7/CN/CS/CT/CU/CX/D2/CX/D8/CT thattakesinamatrixandoutputsa
single character, say /B3/C8/B3, /B3/D4/B3, /B3/C6/B3, or /B3/D2/B3, to indicate whether the matrix
is one of the above types (and another character, say /B3/DC/B3, if it is none of
them). Write a test function that takes in any data matrix X(your favorite
datasetorarandomly-generatedmatrix) andchecksthat X·Xis PSD.
®Principal component analysis projects data of several dime nsions
ontothedimensionsthatdisplaythemostvariance.
®Giventhedatamatrix X,theprocessinvolvesﬁndingtheeigenvalues
of the matrix X′Xassociated with the largest eigenvalues, and then
projectingthedataonto thespacedeﬁnedby thoseeigenvect ors.
® /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D4/CP runs the entire process for the efﬁciently lazy
user.
8.2 OLS AND FRIENDS Assume that our variable of interest, y, is described
by a linear combination of the explanatoryvariables,
the columns of X, plus maybe a Normally-distributed error term, ǫ. In short, y=
Xβ+ǫ, where βis the vector of parameters to be estimated. This is known as
the ordinary least squares ( OLS) model, for reasons discussed in the introduction
to thischapter
To a great extent, the OLS model is the null prior of models: it is the default that
researchers use when they have little information about how variables interrelate.
Likeagoodnullprior,itissimple,itiseasyforthecompute rtoworkwith,itﬂex-
ibly adapts to minor digressions from the norm, it handles no nlinear subelements
(despite often being called linear regression), it is excep tionally well-studied and
understood,anditissometimesthecasethat yreallyisalinearcombinationofthe
columnsof X.
OLS is frequently used for solving the snowﬂake problem from the last chapter:
we had a series of very clean univariate models that stated th at the outcome of
interest is the result of a series of identical draws with equ al probability, but in
most real-world situations, each draw is slightly differen t—in the terminology of
OLS,weneedtocontrolfortheothercharacteristicsofeach observation.Theterm
control for is an analogy to controlled experiments where nuisance vari ables are
ﬁxed, but the metaphor is not quite appropriate, because add ing a column to X
representing the control leads to a new projection onto a new space (see below),
gsl_stats March24,2009
LINEAR PROJECTIONS 271
and may completely change the estimate of the original OLS pa rameters.4Later
sections will present other options for surmounting the sno wﬂake problem when
usingthedistributions from the lastchapter.
Because linear models are so well-studied and documented, t his book will only
brieﬂy skim over them.5This chapter puts OLS in the context from the ﬁrst page
of this book: a model that claims a relationship between Xandyand whose pa-
rameters can be estimated with data, whose computational to ols provide several
conveniences.ThenextchapterbrieﬂycoversOLS forhypoth esistesting.
Unlikethemodelstothispoint,OLSimplicitlymakesacausa lclaim:thevariables
listedin Xcauseytotakethevaluestheydo.However,thereisnotrueconcepto f
causalityinstatistics.Thequestionofwhenstatisticale videnceofcausalityisvalid
is a tricky one that will be left to the volumes that cover this question in detail.6
For the purposes here, the reader should merely note the shif t in descriptive goal,
from ﬁtting distributions to telling a causalstory.
A brief derivation Part of OLS’s charm is that it is easy (and instructive) to de-
riveˆβfor the OLS case.We seekthe parameter estimate ˆβthat
minimizesthe squarederror, ǫ′ǫ, where y=Xˆβ+ǫ.
This is smallest when the error term ǫis orthogonal to the space of X, meaning
thatX′ǫ=0. IfXandǫ=y−Xˆβwere not orthogonal, then we could always
reducethe sizeof ǫbytwiddling ˆβbyaniota to either ˆβ+ιorˆβ−ι./F4Proof:Afteradding ιtoˆβ,thenewequationwouldbe y=Xˆβ+Xι+(ǫ−Xι),
meaningthatthe newerrorterm isnow ǫn≡ǫ−Xι, and
ǫ′
nǫn= (ǫ−Xι)′(ǫ−Xι)
=ǫ′ǫ−2ι′X′ǫ+ι′X′Xι.
Thelastterm, ι′X′Xι,isalwaysanon-negativescalar,justas x·xisnon-negative
for any real value of x. So the only way that ǫ′
nǫncan be smaller than ǫ′ǫis if
2ι′X′ǫ>0. Butif X′ǫ=0, thenthisis impossible.
The last step of the proof is to show that if ι′X′ǫis not zero, then there is always
a way to pick ιsuch that ǫ′
nǫn<ǫ′ǫ.Q: Prove this. ( Hint: ifι′X′ǫ∝\e}atio\slash= 0, then the
4Thatis, regression results can be unstable, so never trust a single regression.
5Economists are especially dependent on linear regression, because it is difﬁcult to do controlled studies on
the open economy. Thus, econometrics texts such as Maddala ( 1977), Kmenta (1986), or Greene (1990) are a
good place to start when exploring linear models.
6See Perl (2000) or any book on structural equation modeling. The typical full causal model is a directed
acyclic graphrepresenting thecausalrelationships among nodes,andthedatacanrejectorfailtorejectitlikeany
other model.
gsl_stats March24,2009
272 CHAPTER 8
sameis true for ιd= 2ιandιh=ι/2.) /diamondsolid
Projection So we seek ˆβthatwill leadto an error suchthat X′ǫ= 0. Expanding ǫ
toy−Xˆβ, wecansolvefor ˆβ:
X′[y−Xˆβ]= 0
X′y=X′Xˆβ
(X′X)−1X′y=ˆβ
Thisis thefamiliar form from page3.
Nowconsiderthe projectionmatrix ,whichis deﬁnedas
XP≡X(X′X)−1X′.7
It is sonamedbecause,aswill bedemonstratedbelow, XPvprojectsthe vector v
ontothespaceof X.
Start with XPX. Writing this out, it reduces instantly: X(X′X)−1X′X=X. So
theprojectionmatrix projects Xonto itself.
Theexpression XPǫalsosimpliﬁesnicely:
XPǫ=X(X′X)−1X′[y−Xˆβ]
=X(X′X)−1X′[y−X(X′X)−1X′y]
=X(X′X)−1X′y−X(X′X)−1X′X(X′X)−1X′y
=X(X′X)−1X′y−X(X′X)−1X′y
=0.
Theprojection matrix projects ǫonto the spaceof X, butǫandXare orthogonal,
sotheprojectedvectorisjust 0.
What does the projection matrix have to do with OLS? Since ˆβ= (X′X)−1X′y,
Xˆβ=X(X′X)−1X′y=XPy. Thus, the OLS estimate of y,ˆy≡Xˆβ, is the
projectionof yontothe spaceof X:ˆy=XPy.
And that, in a nutshell, is what OLS is about: the model claims thatycan be
projectedontothespaceof X,andﬁndstheparametersthatachievethatwithleast
squarederror.
7This issometimes called the hat matrix , because (as will beshown), it links yandˆy.
gsl_stats March24,2009
LINEAR PROJECTIONS 273
A sample projection Atthispointinthenarrative,moststatisticstextbookswo uld
includeapictureofa cloudofpointsandaplaneonto which
they are projected. But if you have a Gnuplot setup that lets y ou move plots, you
can take the data and projected points in your hands, and get a feel for how they
move.
1#include "eigenbox.h"
2gsl_vector *do_OLS(apop_data *set);
3
4gsl_vector *project(apop_data *d,apop_model *m){
5apop_data *d2 =apop_data_copy(d);
6 APOP_COL(d2,0, ones);
7 gsl_vector_set_all(ones, 1);
8returnapop_dot(d2, m−>parameters, 0,’v’) −>vector;
9 }
10
11intmain(){
12 apop_data *d= query_data();
13 apop_model *m = apop_estimate(d,apop_ols);
14 d−>vector = project(d,m);
15 //d−>vector =do_OLS(d);
16 d−>names−>rowct = 0;
17 d−>names−>colct = 0;
18 apop_data_print(d,"projected");
19 FILE*cmd =fopen("command.gnuplot","w");
20 fprintf(cmd, "set view 20, 90\n\
21 splot ’projected’using 1:3:4withpoints, ’projected’u sing 2:3:4\n");
22 }
Listing8.5 Code to project data onto a plane via OLS. Compile with /CT/CX/CV/CT/D2/CQ/D3/DC/BA from earlier.
Online source: /D4/D6/D3/CY/CT/D8/CX/D3/D2/BA .
Listing8.5queriesthesamedataaswasplottedinFigure8.1 ,doesanOLSprojec-
tion, andproducesa Gnuplotcommandﬁle to plot both theorig inal andprojected
data.
• Ignore lines 2 and 15 for now; they will allow us to do the proj ection manually
lateron.
• Line 13doesthe OLS regression.The /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT function estimatesthe pa-
rameters of a model from data. It takes in a data set and a model , and returns an/CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 structurewith the parametersset.
• The /D4/D6/D3/CY/CT/D8 function makes a copy of the data set and replaces the depende nt
variable with a column of ones, thus producing the sort of dat a on the right-hand
sideofanOLSregression.Linesevencalculates Xβ.
• Whenthedatasetisprintedonline18,theﬁrstcolumnwillb etheXβvectorjust
calculated,thesecondwillbetheoriginal ydata,andthethirdandfourthcolumns
gsl_stats March24,2009
274 CHAPTER 8
will bethenon-constantvariablesin X.
• Gnuplot has some awkwardness with regards to replotting da ta (see page 170).
Lines16–18write the datato a ﬁle (with the row andcolumnnam esmaskedout),
thenlines19–20writeatwo-line commandﬁle.Youcanrunitf romthecommand
line via /CV/D2/D9/D4/D0/D3/D8 /D3/D1/D1/CP/D2/CS/BA/CV/D2/D9/D4/D0/D3/D8 /B9, and should then have on your screen a
plotthatyoucanmoveabout.
The view set on line 20 is basically a head-on view of the plane onto which the
datahasbeenprojected,andyoucanseehowthedata(probabl yingreen)shiftsto
aprojected value(red). It is a somewhatdifferentpicture f rom the PCAin Listing
170. [ Q: Add the /DB/CX/D8/CW /D0/CP/CQ/CT/D0commands to put labels on the plot.] Spinning the
graph a bit, to /D7/CT/D8 /DA/CX/CT/DB /BK/BF/B8 /BE, shows that all of the red points are indeed on a
single plane, while in another position, at /D7/CT/D8 /DA/CX/CT/DB /BL/BC/B8 /BL/BC, you can verify that
thepointsdoindeedmatchontwo axes.8
THE CATALOG Because OLS is so heavily associated with hypothesis testin g, this
sectionwillplanaheadandpresentboththeestimatesof βproduced
by each model, its expectedvalue, and its variance.This giv esus all that we need
to testhypothesesregardingelementsofourestimate of β,ˆβ.
OLSThemodel:
•y=Xβ+ǫ
•n=the numberofobservations,so yandǫaren×1matrices.
•k=the numberofparametersto beestimated. Xisn×k;βiskby1.
• Manyresultsthatwillappearlaterassumethattheﬁrstcol umnof βisacolumnof
ones.Ifitisn’t,thenyouneedtoreplaceeverynon-constan tcolumn xibelowwith
xi−xi, the equivalenceof which is left as an exercisefor the reade r.9See below
fortheactualformat to usewhenconstructingyour /CP/D4/D3/D4/CN/CS/CP/D8/CP set.
Assumptions:
•E(ǫ) = 0.
•var(ǫi) =σ2, aconstant,∀i.
8If your Gnuplot setup won’t let you spin the plot with a pointi ng device, then you can modify the Gnuplot
command ﬁle to print three separate static graphs in three ﬁl es viathe /D7/CT/D8 /DA/CX/CT/DBcommands here, or you can try
acommand like /D7/CT/D8 /DA/CX/CT/DB /BK/BF/B8 /BE/BN /D6/CT/D4/D0/D3/D8atthe Gnuplot command prompt.
9Ifyouwould liketo take therouteofnormalizing each column to havemeanzero, try /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D2/D3/D6/D1/B9/CP/D0/CX/DE/CT/B4/CS/CP/D8/CP/D7/CT/D8/B8 /B3/D1/B3/B5. This will normalize a 1column to 0, so after calling the normalize function, you may
need to do something like /BT/C8/C7/C8/CN/BV/C7/C4/B4 /DD/D3/D9/D6/CN/CS/CP/D8/CP /B8 /BC/B8 /D3/D2/CT/D3/D0 /B5/BN /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/D7/CT/D8/CN/CP/D0/D0/B4 /D3/D2/CT/D3/D0 /B8 /BD/B5.
gsl_stats March24,2009
LINEAR PROJECTIONS 275
•cov(ǫi,ǫj) = 0,∀i∝\e}atio\slash=j. Along with the above assumption, this means that the
n×ncovariancematrix forthe observations’errors is Σ≡σ2I.
• Thecolumnsof Xarenotcollinear(i.e., det(X′X)∝\e}atio\slash= 0, so(X′X)−1exists).10
•n > k.
Noticethatwedonotassumethat ǫhasaNormaldistribution,butthatassumption
will be imposed in the next chapter, when we apply ttests to ˆβ. When all of that
holds,then
ˆβOLS= (X′X)−1(X′y)
E(ˆβOLS) =β
var(ˆβOLS) =σ2(X′X)−1
Almostanythingcanhaveavariance,whichoften createscon fusion.A columnof
datahasavariance,thecolumnoferrors ǫhasavariance,theestimate ˆβOLShasa
covariancematrix, and(if soinclined)youcouldevenestim atethevarianceofthe
variance estimate ˆσ2. The variance listed above is the K×Kcovariance matrix
fortheestimate ˆβOLS,andwill beusedfortestinghypothesesregarding βinlater
chapters.Itisacombinationoftheothervariances:thevar ianceoftheerrorterm ǫ
isσ2,andthevariouscolumnsofthedatasethavecovariance X′X,sothevariance
ofˆβOLSis theﬁrsttimes theinverseofthesecond.
INSTRUMENTAL VARIABLES The proofs above gave us a guarantee that we will
calculate a value of ˆβsuch that Xwill be uncorre-
latedto ˆǫ=y−xˆβ.
Our hope is to estimate a ‘true’ model, claiming that y=Xβ+ǫ, where Xis
uncorrelated to ǫ, and so on. But if it is the case that a column of Xreally is
correlatedtotheerrorinthismodel,thenthereisnowaytha tˆβ(whichguarantees
that the estimated error and the columns of Xare not correlated) could match β
(which is part of a model where error and a column of Xare correlated). This
createsmajorproblems.
Forexample,saythatonecolumnofthedata, xi,ismeasuredwitherror,soweare
actually observing xi+ǫi. This means that the error term in our equation is now
10If this assumption is barely met, so det(X′X)is not zero but is very small, then the resulting estimates
willbeunstable, meaning that very smallchanges in Xwould lead to large changes in (X′X)−1and thus in the
parameter estimates. This is known as the problem of multicollinearity . Theeasiest solution is to simply exclude
some of the collinear variables from the regression, or do a p rincipal component analysis to ﬁnd a smaller set of
variables and then regress on those. See, e.g., Maddala (197 7, pp 190–194) for further suggestions.
gsl_stats March24,2009
276 CHAPTER 8
thetrueerrorjoinedwithanoffsettothemeasurementerror ,ˆǫ=ǫ−ǫi.Ifthetrue
xiandthetrue ǫhavenocorrelation,then xi+ǫiandǫ−ǫialmostcertainlydo.
As above,the OLS estimate of βisˆβOLS= (X′X)−1X′y, or taking a step back
in the derivation, (X′X)ˆβOLS=X′y. Also, the true βis deﬁned to satisfy y=
Xβ+ǫ.Withafewsimplemanipulations,wecanﬁndthedistancebet weenβand
ˆβ:
y=Xβ+ǫ
X′y=X′Xβ+X′ǫ
(X′X)ˆβOLS=X′Xβ+X′ǫ
(X′X)(ˆβOLS−β) =X′ǫ
ˆβOLS−β= (X′X)−1X′ǫ (8.2.1)
IfX′ǫ= 0, then the distance between ˆβOLSandβis zero— ˆβOLSis a consis-
tent estimator of β. But if Xandǫare correlated, then ˆβOLSdoes not correctly
estimate β. Further, unless we have a precise measure of the right-hand side of
Equation 8.2.1, then we don’t know if our estimate is off by a p ositive, negative,
large or small amount. Still further, every column of Xaffects every element of
(X′X)−1, so mismeasurement of one column can throw off the estimate o f the
OLScoefﬁcientforeveryothercolumnaswell.
The solution is to replace the erroneously-measured column of data with an in-
strument, a variable that is not correlated to ǫbut is correlated to the column of
data that it will replace. Let xibe the column that is measured with error (or is
otherwisecorrelatedto ǫ),letzbeacolumnofalternatedata(theinstrument),and
letZbetheoriginaldataset Xwiththecolumn xireplacedby z.Ifcov(z,ǫ) = 0,
thenthefollowing holds:
ˆβIV= (Z′X)−1(Z′y)
E(ˆβIV)=β
var(ˆβIV)=σ2(Z′X)−1Z′Z(X′Z)−1
Whedet(Z′X)is small, (Z′X)−1—and thus the variance—is large; this happens
when cov(z,xi)→0. We want the variance of our estimator to be as small as
possible, which brings us to the usual rule for searching for an instrument: ﬁnd
a variable that can be measured without signiﬁcant error, bu t which is as well-
correlatedaspossibleto theoriginalvariableofinterest .
gsl_stats March24,2009
LINEAR PROJECTIONS 277
GLSGeneralized Least Squares generalizes OLS by allowing ǫ′ǫto be a known
matrix Σ, with no additional restrictions. Note how neatly plugging σ2Iin to
theestimatorof βandits varianceherereducestheequationstothe OLSversio ns
above.
ˆβGLS= (X′Σ−1X)−1(X′Σ−1y)
E(ˆβGLS)=β
var(ˆβGLS)= (X′Σ−1X)−1
But there is a computational problem with GLS as written here . For a data set of
a million elements, Σis106×106= 1012(a trillion) elements,and it is often the
case that all but a million of them will be zero. A typical comp uter can only hold
tens of millions of /CS/D3/D9/CQ/D0/CTs in memory at once, so simply writing down such a
matrix is difﬁcult—let alone inverting it. Thus, although t his form is wonderfully
general,wecanuseit onlywhenthere isaspecialform of Σthatcanbeexploited
to makecomputationtractable.
WEIGHTED LEASTSQUARES Forexample,let Σbeadiagonalmatrix.Thatis,er-
rors among different observations are uncorrelated,
but the error for each observation itself is different. This isheteroskedastic data.
The classic example in Econometrics is due to differences in income: we expect
that our errors in measurement regarding the consumption ha bits of somebody
earning $10,000/year will be about a thousandth as large as o ur measurement er-
rors regardingconsumptionby somebodyearning$10million /year.
It can be shown (e.g., Kmenta (1986)) that the optimum for thi s situation, where
σiis known for each observation i, is to use the GLS equations above,with Σset
to zeroeverywherebutthediagonal,wherethe ith elementis1
σ2
i.
TheGLSequationsabout βnowapplydirectlytoproduceWeightedLeastSquares
estimates—and there is a trick that lets us do computation us ing just a vector of
diagonal elements of Σ, instead of the full matrix. Let√σbe a vector where the
ith element is the square root of the ith diagonal element of Σ. For WLS, the ith
element of√σis thus1
σi. Now let yΣbe a vector whose ith element is the ith
elementof ytimesthe ith elementof√σ,andXΣbethecolumn-wiseproductof
Xand√σ. Thatis,
gsl_stats March24,2009
278 CHAPTER 8
voidcolumnwise_product( gsl_matrix *data,gsl_vector *sqrt_sigma){
for(size_ti=0;i< data−>size2;i++){
Apop_matrix_col(data,i,v);
gsl_vector_mul(v,sqrt_sigma);
}
}
Thenyoucanverifythat X′
ΣXΣ=X′ΣX,X′
ΣyΣ=X′Σy, andso
ˆβWLS=/parenleftbig
X′
ΣXΣ/parenrightbig−1(X′
ΣyΣ)
E(ˆβWLS)=β
var(ˆβWLS)=σ2/parenleftbig
X′
ΣXΣ/parenrightbig−1
Thus,we can solvefor the Weighted LeastSquareselements wi thouteverwriting
down the full Σmatrix in all its excess. This is the method used by /CP/D4/D3/D4/CN/DB/D0/D7
(whichis whatyouwouldusein practice,ratherthancalcula tingXΣyourself).
FITTING IT If you already have a data matrix in /CP/D4/D3/D4/CN/CS/CP/D8/CP /B6/D7/CT/D8, then you can
estimate anOLSmodelin oneline:
apop_estimate_show(apop_estimate(set, apop_ols));
Ifyourdatasethasanon- /C6/CD/C4/C4 /DB/CT/CX/CV/CW/D8/D7 vector,thenyoucouldreplace /CP/D4/D3/D4/CN/D3/D0/D7
in theabovewith /CP/D4/D3/D4/CN/DB/D0/D7 .
If you would like more controloverthe details of the estimat ion routine, seepage
145 on the format for changing estimation settings, and the o nline references for
the detailed list of options. The /CP/D4/D3/D4/CN/C1/CE modelrequires the settings setting treat-
ment,becausethatmodelrequiresthatthesettings’ /CX/D2/D7/D8/D6/D9/D1/CT/D2/D8/D7 elementis set.
Q8.2In the exercise on page 232, you found a relationship between males per
female (the dependent variable) and both density and male–f emale wage
ratios(theindependentvariables).Produceanappropriat edatasetandsend
it to /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT/B4 /DD/D3/D9/D6/CN/CS/CP/D8/CP /B8 /CP/D4/D3/D4/CN/D3/D0/D7/B5 to check the coefﬁcients
whenbothindependentvariablesareincluded.
gsl_stats March24,2009
LINEAR PROJECTIONS 279
If the assumptionsof OLSdo notﬁt, thenyouwill needto berea dyto modify the
innards of the OLS estimation to suit, so the remainder of thi s section goes back
to the linear algebra layer of abstraction, to go over the ste ps one would take to
estimate β.
Listing 8.6 extends the example in Listing 8.5 (page 273) by d oing every step
in the linear algebra of OLS. Uncomment Line 15 in that code, l ink it with this
(by adding /D4/D6/D3/CY/CT/D8/CX/D3/D2/D8/DB/D3/BA/D3 to the /C7/BU/C2/BX/BV/CC/CB line in the makeﬁle), and re-run to
producethenewprojection,whichshouldbeidenticalto the old.
1#include <apop.h>
2
3gsl_vector *do_OLS(apop_data *set){
4apop_data *d2 =apop_data_copy(set);
5 APOP_COL(d2,0, ﬁrstcol);
6apop_data *y_copy = apop_vector_to_data(apop_vector_copy(ﬁrstcol ));
7 gsl_vector_set_all(ﬁrstcol,1);
8
9apop_data *xpx = apop_dot(d2,d2,’t’,0);
10 gsl_matrix *xpxinv = apop_matrix_inverse(xpx −>matrix); //(X′X)−1
11 apop_data *second_part = apop_dot(apop_matrix_to_data(xpxinv),d2 ,0,’t’);
12
13 apop_data *beta = apop_dot(second_part,y_copy,0, 0); //(X′X)−1X′y
14 strcpy(beta −>names−>title,"The OLSparameters");
15 apop_data_show(beta);
16
17 apop_data *projection_matrix = apop_dot(d2,second_part,0,0); //X(X′X)−1X′
18 returnapop_dot(projection_matrix,y_copy, 0,0) −>vector;
19 }
Listing8.6 The OLSprocedure and its use for projection, spe lled out ingreat detail. Online source:/D4/D6/D3/CY/CT/D8/CX/D3/D2/D8/DB/D3/BA .
• Typically, the yvalues are the ﬁrst column of the data matrix, so the ﬁrst step
is to extract the data into a separate vector. Lines 4–7 do thi s, and end up with
one /CP/D4/D3/D4/CN/CS/CP/D8/CP set named /DD/CN/D3/D4/DDwhich copies off the ﬁrst column of the input
matrix, and a second set named /CS/BE, which is a copy of the input matrix with the
sameﬁrstcolumnsetto 1.
• Lines 9–11 ﬁnd (X′X)−1X′. If you like, you can use the debugger to check the
valueofanyofthe intermediateelementsallalongthecalcu lation.
• Now that we have (X′X)−1X′, Lines 13–15 do the single additional dot product
to ﬁnd β= (X′X)−1X′y, anddisplaytheresult.
• Line 17 produces the projection matrix X(X′X)−1X′, and given the projection
matrix, anotherdotproductprojects yontoit.
gsl_stats March24,2009
280 CHAPTER 8
Q8.3The GSL has a function to solve equations of the type Aβ=Cusing
Householder transformations, and this happens to be exactl y the form we
havehere— (X′X)β= (X′y).Given /CP/D4/D3/D4/CN/CS/CP/D8/CP setsfor X′X,X′y,anda/CV/D7/D0/CN/DA/CT/D8/D3/D6 allocated for /CQ/CT/D8/CP, this line would ﬁll /CQ/CT/D8/CPwith the solution
tothe equation:
gsl_linalg_HH_solve (xpx −>matrix, xpy−>vector,*beta);
In practice, it is almost necessary to take the inverse to sol ve for OLS pa-
rameters,becausethecovariancematrixof ˆβisσ2(X′X)−1.ButtheHouse-
holdermethodmanagesto avoid explicitly ﬁndingthe invers e ofX′X, and
may thus be quicker in situations like the Cook’s distance co de (page 133)
wherea /CU/D3/D6loopsolvesforthousandsofOLSparametersets.
Rewrite /D4/D6/D3/CY/CT/D8/CX/D3/D2/D8/DB/D3/BA to use the Householder transformation to ﬁnd/CQ/CT/D8/CP. Check that the results using this alternate method match th e /CQ/CT/D8/CP
foundvia inversion.
®The Ordinary Least Squares model assumes that the dependent vari-
able is an afﬁne projection of the others. Given this and other as-
sumptions, the likelihood-maximizing parameter vector is βOLS=
(X′X)−1(X′Y).
®IfΣ∝\e}atio\slash=I,thenβGLS= (X′ΣX)−1(X′ΣY). Dependingon the value
ofΣ,onecandesignanumberofmodels.
®In most cases, you can use /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT . But if need be, coding
theseprocessesisasimplequestionofstringingtogetherl inesoflin-
earalgebraoperationsfrom Chapter4.
8.3 D ISCRETE VARIABLES To this point, the regression methods have been
assuming that both yand the elements of Xare
all continuous variables ∈R. If they are discrete variables ∈{0,1,2,...}, then
weneedto makemodiﬁcations.
There are a number of distinctions to be made. First, the appr oaches to handling
columns of discrete variables in Xare different, and simpler, than approaches to
handling discrete values of the outcome variable y. Ifyonly takes on integer
values,orworse,isjustzeroorone,thentherecan’tpossib lybea βandaNormally
distributed ǫthatsatisfy y=Xβ+ǫ. Thereare convolutionslike stipulating that
for observations where xβ<0we force ǫsuch that xβ+ǫ= 0and where
xβ>1we force xβ+ǫ= 1, but then ǫis non-Normal, which makes a mess of
gsl_stats March24,2009
LINEAR PROJECTIONS 281
the hypothesis tests we’ll run in later chapters. More gener ally, such an approach
lacksgrace,andrequiresacascadeoflittle ﬁxes(Greene,1 990,p637).
Howweproceedin eithercasedependsonthe typeofdiscretev ariableathand:
• A discrete binary variable takes on exactly two values, suc h as male/female or
case/control,andcanberewritten assimply eitherzerooro ne.
• Ordered,discretedataaretypicallyacount,suchasthenu mberofchildrenorcars
apersonowns.
• Most qualitative categorizations lead to multi-valued an d unordered data. For ex-
ample,aMetrostationcouldbeontheRed,Blue,Green,Orang e,andYellowline,
oravotercouldalignhimselfwith a Red,Blue,Green,orOthe rparty.
DUMMY VARIABLES Foracolumnofzero–onedatain theindependentdata X,we
don’t really haveto modify OLS at all, but we changethe in-
terpretation slightly: taking zero as observations in the b aseline and one as the
observationsin the treatment group, the OLS coefﬁcienton t his zero–one dummy
variable can indicate how effective the treatment is in changing the o utcome.
Tests for the signiﬁcance of the dummy variable can be shown t o be equivalent
to ANOVAtests ofacategory’ssigniﬁcance.
Asanextension,ifthecategoriesareorderedbutdiscrete, likethenumberofchil-
dren, then we again don’t have to do anything: if a jump from x= 0tox= 1
induces a shift of size βin the outcome, then a jump from x= 1tox= 2would
dothesameunderalinearmodel,andajumpfrom x= 0tox= 2wouldproduce
a jumpofsize 2β. If it isnaturalto presumethis,then themodeldoesnoviole nce
to reality.11
Butifthecategoriesarediscreteandunordered,thenwecan ’tuseonevariablewith
the values{0,1,2,...}, because the implied linear relationship makes no sense.
With 0=Green,1=Blue,2=Red,doesitmakesensethatashiftf rom GreentoBlue
will haveexactlythesameeffectas ashiftfrom Blueto Red,a ndthata shiftfrom
Green to Red would have exactly twice that effect? In this cas e, the solution is to
have a separate variable for all but one of the choices, and th us to produce n−1
coefﬁcientsfor noptions.Theexcludedoptionisthebaseline,likethezeroo ption
in the binary case. Here, the function /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D8/D3/CN/CS/D9/D1/D1/CX/CT/D7 saves the day: it
takesthe ithcolumnfromthedatasetandoutputsatablewith n−1binarydummy
variables;seetheexamplebelowforusage.
Given multiple categories, you could even produce interaction terms to repre-
sent membership in multiple categories: e.g., control ×male, control×female,
11If the perfectly linear form is implausible, it may be sensib le to transform the input variable, to the square
ofxor√x.
gsl_stats March24,2009
282 CHAPTER 8
treatment×male, treatment×female. The easiest way to do this is to sim-
ply create a column with two other columns mashed together: i n SQLite, the
query /D7/CT/D0/CT/D8 /B3/D0/CT/CU/D8/B3 /DG /DG /B3/D6/CX/CV/CW/D8/B3 produces the string /D0/CT/CU/D8/D6/CX/CV/CW/D8 ; in mySQL,/D3/D2/CP/D8/B4/B3/D0/CT/CU/D8/B3/B8 /B3/D6/CX/CV/CW/D8/B3/B5 does the same. Then break the column down into
n−1dummyvariablesasabove.
The underlying claim with zero–one dummy variables is y=Xβ+k, where
kindicates a constant value that gets added to the controls bu t not the cases, for
example. But say that we expect the slopes to differ from case s to controls; for
casestheequationis y=x1β1+x2β2andforcontrolsitis y=x1(β1+k)+x2β2.
Thewaytogetastandardregressiontoproduce kinthiscasewouldbetoproduce
a data set which has the appropriate value x1for each control, but zero for each
case. Then the regression would be equivalent to y=x1β1+x1k+x2β2for
controlsand y=x1β1+x2β2for cases,asdesired.
1#include <apop.h>
2
3apop_model *dummies( intslope_dummies){
4apop_data *d= apop_query_to_mixed_data("mmt","selectriders,year −1977, line \
5 fromriders,lines \
6 where riders.station=lines.station");
7apop_data *dummiﬁed= apop_data_to_dummies(d, 0,’t’,0);
8if(slope_dummies){
9 Apop_col(d,1, yeardata);
10 for(inti=0; i <dummiﬁed−>matrix−>size2;i++){
11 Apop_col(dummiﬁed,i,c);
12 gsl_vector_mul(c, yeardata);
13 }
14 }
15 apop_data *regressme = apop_data_stack(d, dummiﬁed,’c’);
16 apop_model *out = apop_estimate(regressme, apop_ols);
17 apop_model_show(out);
18 returnout;
19 }
20
21#ifndefTESTING
22intmain(){
23 apop_db_open("data −metro.db");
24 printf("Withconstant dummies:\n");dummies(0);
25 printf("Withslope dummies:\n");dummies(1);
26 }
27#endif
Listing8.7 Tworegressions withdummy variables. Online so urce: /CS/D9/D1/D1/CX/CT/D7/BA .
Listing 8.7 runs a simple regressionof ridership at eachsta tion in the Washington
Metro on a constant, the year, and a set of dummy variables for Green, Orange,
gsl_stats March24,2009
LINEAR PROJECTIONS 283
Red,andYellow lines(meaningtheBlue lineis the baseline) .
• The query on line four pulls two numeric columns (ridership and year) and one
textcolumn.
• Line 7 converts text column zero into an /CP/D4/D3/D4/CN/CS/CP/D8/CP set consisting of dummy
variables.If youaskthe debuggerto display the /CS/D9/D1/D1/CX/CU/CX/CT/CS dataset, you will see
thateveryrowhasa1 in atmostasinglecolumn.
• Line 15 stacks the dummies to the right of the other numeric d ata, at which point
the data set is in the right form to be regressed, as on line 16. Again, it is worth
askingthe debuggerto showyouthe datasetin its ﬁnal,regre ssableform.
• We will test the claim that these two tests are equally likel y on page 354; the/AZ/CX/CU/D2/CS/CT/CU wrapper on lines 21 and 27 will let us read this ﬁle into the tes ting pro-
gram.Here,the wrapperis innocuous.
• The /D7/D0/D3/D4/CT/CN/CS/D9/D1/D1/CX/CT/D7 switch determines whether the dummies will be constant
dummies or slope dummies. For constant dummies, we need only zeros or ones,
soasabove, /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D8/D3/CN/CS/D9/D1/D1/CX/CT/D7 givesuswhatweneed.Forslopedummies,
we need to replace every 1 with the current year, which is what the column-by-
columnvectormultiplication achievesoverlines9–13.
PROBIT AND LOGIT Now we move on to the question of discrete outcome vari-
ables. For example, a person either buys a house or does not,
whichmakeshousepurchasingabinaryvariable.Saythatthe valueofahouseisa
linearsumofthevalueofitscomponents:anextrabedroomad dssomanydollars,
a nearby highly-rated school adds so many more, each square m eter is worth a
few thousand dollars, et cetera. That is, one could write dow n a linear model that
total value U=β1·cost + β2·bedrooms + β3·school quality + β4·square meters
+···+ǫ, where β1is typicallynormalizedto −1andǫis the usualerrorterm.12
Tophrasethemodelbrieﬂy: U=xβ+ǫ.Butratherthanleavingthemodelinthe
standardlinearform, weaddtherule thatapersonbuysiff U >0. Thus,theinput
is the samesetofcharacteristics x(ofconsumersor ofhouses)and weightings β,
andtheoutputisabinaryvariable:thepersonactedordidno t;thebuyerconsumed
ordidnot;the geysereruptedordid not,etcetera.
From here, the details of the decision model depend on whethe r the outcome is
binary,multivaluedbutunordered,orordered.
• Logitwith two choices:Theﬁrst alternative,the logit model orlogistic model ,as-
sumes that ǫ∼aGumbel distribution . The Gumbel is also known as the Type I
12Real estate economists call this the hedonic pricing model , whose implementation typically differs in some
respects from the logit model discussed here. SeeCropper et al.(1993) for acomparison.
gsl_stats March24,2009
284 CHAPTER 8
ExtremeValuedistribution,meaningthatitexpressesthed istribution ofthestatis-
ticmax(x)under appropriate conditions. McFadden (1973) won a Nobel p rize
partly by showingthat the aboveassumptions,includingthe rather eccentricerror
term, reduceto thefollowing simpleform:
P(0|x) =1
1 + exp( xβ1)
P(1|x) =exp(xβ1)
1 + exp( xβ1)
Thereisno β0becauseisit normalizedto 0,soexp(xβ0) = 1.
• Probit:The probitmodel hasasimilar setupto the logit, but ǫ∼N(0,1).
Themodelcanberephrasedslightly. Saythat U(x)is deterministic, butthe prob-
ability of consuming given some utility is random. To descri be such a setup, let
U=−xβratherthan−xβ+ǫ(theintroductionofaminussignwillbediscussed
in detailbelow),andletthe probabilitythatthe agentacts be
P(x|β) =/integraldisplayU(−xβ)
−∞N(y|0,1)dy,
whereN(y|0,1)indicates the Normal PDF at ywithµ= 0andσ= 1, so the
integralis theCDF upto U(−xβ).
As you can see, this is a much more ornery form, especially sin ce the CDF of the
Normal (what engineers call the error function , or more affectionately, erf) does
not simplify further and is not particularly easy to calcula te. This partly explains
the prevalence of the logit form in existing journal article s, but is not much of an
issuenowthatmaximumlikelihoodestimationischeap,even whenerfisinvolved.
• With kdifferentoptions,thelogitmodelgeneralizesneatlyfort hecaseofmultiple
values,to the multinomiallogit :
P(0|B) =1
1 +/summationtextk
i=1exp(xβi)and
(8.3.1)
P(k|B)=exp(xβx)
1 +/summationtextk
i=1exp(xβi),k∝\e}atio\slash= 0
where Bis the setof choicesfrom which xis chosen,and βkis a different vector
ofcoefﬁcientsforeachoption k∝\e}atio\slash= 0.Youcanseethat β0isonceagainnormalized
to0, and given only options zero and one, the form here reduces to the binomial
form above.13
• Ordered multinomial probit: Presume that there is an under lying continuous vari-
ableY∗=−Xβsuch that the true Yi= 0ifY∗
i≤0;Yi= 1if0< Y∗
i≤A1;
Yi= 2ifA1< Y∗
i≤A2;andsoon.Thatis,
13The generalization is so clean that Apophenia doesn’t even i nclude separate binary and multinomial logit
models: the /CP/D4/D3/D4/CN/D0/D3/CV/CX/D8 modeljust counts the options and acts accordingly.
gsl_stats March24,2009
LINEAR PROJECTIONS 285
P(Yi= 0) =/integraldisplayA1−Xβ
−∞N(y|0,1)dy
P(Yi= 1) =/integraldisplayA2−Xβ
A1−XβN(y|0,1)dy
P(Yi= 2) =/integraldisplay∞
A2−XβN(y|0,1)dy
Rather than ﬁnding a single cutoff between acting and not act ing, we estimate
several cutoffs, between choosing zero, one, two, ...items ; estimating /CP/D4/D3/D4/CN/B9/D1/D9/D0/D8/CX/D2/D3/D1/CX/CP/D0/CN/D4/D6/D3/CQ/CX/D8 willthereforereturntheusualvectorofparameters β,plus
avectorof A1,A2,... ,A k−1forkoptions.
Parameter overload Very reasonablemodelscan produceanoverwhelmingnum-
ber of parameters. For the multinomial logit model above,
withkoptionsand nelementsineachobservation x,thereare n×(k−1)param-
eters to be estimated. Your goals will dictate upon which par ameters you should
focus,andhowyougetmeaningfrom them.
If the solegoalis to provethat Acauses B, thenthe univariatetestthatthe coefﬁ-
cienton Ais signiﬁcantisallwe will lookatfrom oneoftheabovetests .
If we want to predict how comparable people will act in the fut ure, then we need
the model’s estimate for the odds that each individual will s elect any one choice,
and the predicted most likely selection. Perhaps you will wa nt the full catalog, or
justtheaverageprobabilitiesvia /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D7/D9/D1/D1/CP/D6/CX/DE/CT/B4 /D3/D9/D8/D1/D3/CS/CT/D0 /BA/CT/DC/D4/CT/D8/CT/CS/B5 .
Or, you may want to know the dynamic shifts: what happens to BwhenArises
by1%?Economistscallthis the marginalchange ,thoughvirtually everyﬁeldhas
some interest in such questions. This is closely related to t he question of whether
the parameter on Ais statistically signiﬁcant: you will see in the chapteron m ax-
imum likelihood estimates that their variance (used to meas ure conﬁdence for a
hypothesis tests) is literally the inverse of the second der ivative (used to measure
changein outcomevariablegivenchangein incomevariable) .
For a linear model, the marginal change is trivial to calcula te: we proposed that
y=xβ, meaning that ∂y/∂x i=βi. That is, a 1% change in xileads to a β%
changein y.
Interpreting the marginal changes in the above models can be more difﬁcult. For
the probit, the cutoff between drawsthat induce a choiceof o ption zero and those
that lead to option one was −xβ. As+xβgrows (either because of a marginal
expansioninanelementof xorofβ),thecutofffallsslightly,andthesetofdraws
gsl_stats March24,2009
286 CHAPTER 8
thatleadto optiononegrows.This ﬁtsourintiution, becaus ewecharacterizedthe
elementsofthe linearsum xβasincreasingtheproclivity to chooseoptionone.
Fortheorderedprobit,therearemultiplecutoffs.Amargin alchangein βwillper-
hapsraisethecutoffbetweenoptionstwoandthree,lowerin gtheoddsofchoosing
three, but atthe sametime raise the cutoff betweenoptions t hree and four, raising
theoddsofchoosingthree.SeeGreene(1990,p672)oryoures timationprogram’s
documentationfor moreonmakingproductiveuseofthe estim atedmodel.
IIAReturn to the multinomial logit formula, Equation 8.3.1, an d consider the ratio
oftheprobability oftwo events, E1andE2.
P(E1|x,B)
P(E2|x,B)=exp(xβ1)P
y∈Bexp(xβy)
exp(xβ2)P
y∈Bexp(xβy)
=exp(xβ1)
exp(xβ2)
The key point in this simple result is that this ratio does not depend on what else
is in the set of options. The term for this property is independence of irrelevant
alternatives , orIIA. The term derives from the claim that the choice between one
optionandanotherin noway dependsuponthe otheroptionsel sewhere.
The standard example is commuters choosing among a red bus, a blue bus, and a
train, where the red bus and blue bus are identical except for their paint job. We
expectthattheratioofP(red)/P(blue)= 1,andletP(red)/P(train)=P(blue)/P(train)
=1
x. If the train were out of service, then P(red)/P(blue) would still be 1, because
asmanyformertrainriderswouldnowpickthebluebusaswoul dpickthered,but
if the blue bus were knocked out of commission, then everybod y who was riding
it would likely just switch to the red bus, so without the blue bus, P(red)/P(train)
=2
x. In short, the train option is irrelevant to the choice of red or blue bus, but the
bluebusoptionis notirrelevantin the choicebetweentrain andredbus.
Inthecodesupplement,youwillﬁnd /CS/CP/D8/CP/B9/CT/D0/CT/D8/CX/D3/D2/BA/CS/CQ ,whichincludesasmall
selectionofsurveydataregardingtheUnitedStates’s2000 election,fromNational
Election Studies (2000). The survey asked respondents thei r opinion of various
candidates (including the two candidates for Vice Presiden t) on a scale from 0 to
100;inthedatabase,youwillﬁndthepersonthattherespond entmostpreferred.14
14Duverger’s law tells us that a ﬁrst-past-the-post system such as that of the United States tends to lead to
a stable two-party system, due to the various strategic cons iderations that go into a vote. We see this in the
data: question 793 of the survey (not included in the online s upplement) asked the respondent for whom he or
she expects to vote, and the totals were: (Gore, 704), (Bush, 604), (everybody else, 116). The favorite from the
thermometer score avoids the strategic issues involved in v ote choice, and produces a much broader range of
preferences: (Gore,711),(Bush,524),(Nader,157),(Chen ey, 68),etcetera. Q:Writeaqueryto getthecomplete
count for each candidate from the survey data.
gsl_stats March24,2009
LINEAR PROJECTIONS 287
TheIIA condition dictatesthat the logitestimates ofthe re lative oddsofchoosing
candidateswon’t changeas other candidatesenter and exit, though intuitively, we
would expect some sort of shift. The examples also suggest a t wo-level model,
wherein people ﬁrst choose a category (bus/train, Republic an/Democrat/Green),
and then having chosen a category, select a single item (such as red bus/blue bus,
Buchanan/McCain). Such a model weakens IIA, because a choic e’s entry or exit
may affect the choice of category. These hierarchies of clas s and item are a type
ofmultilevelmodel ;the nextsectionwill giveanoverviewofmultilevelmodeli ng
possibilities,includingsomefurther discussionofthe ne stedlogit.
ThetheoreticalIIApropertyisirrefutable—thereisnotmu chroomforerrorinthe
twolinesofalgebraabove.Butmanytheoreticalmodelscanb epushedtoproduce
mathematically clean results that are just not relevant in t he application of the
modeltorealdata.DoesIIAhaveastronginﬂuenceonreal-wo rldlogitestimates?
We would test IIA by running one unconstrained logit, and ano ther logit estima-
tionrestrictedsothatoneoptionismissing;thisﬁtstheli kelihoodratio(LR)form
whichwillappearonpage351,andafewvariantsonthisteste xistintheliterature.
Cheng& Long(2007)built anumberofartiﬁcialdatasets,som edesignedaround
agents who make choices conforming to IIA, and some designed to not have the
IIA property.TheyfoundthattheLRtestswereineffective: theunconstrainedand
constrained odds ratios sometimes did not differ (demonstr ating IIA) and some-
times did (againstIIA), butthere was nosufﬁciently reliab le relationshipbetween
when the underlying data had the IIA property and when the par ameter estimates
demonstratedIIA. Fry & Harris (1996)useda lessbroad metho dthat had slightly
moreoptimisticresults,butstillencounteredglitches,s uchasproblemswithpower
andresultsthatweresensitiveto whichoptionwasremoved.
The probit model matches the logit save for the type of bell cu rve that describes
the error term, so one expects the parameters and predicted o dds to be similar.
In fact, Amemiya (1981) points out that logit parameters typ ically match probit
parameters, but that they are scaled by a factor of about 1.6. That is, for each
option i,βL
i≈1.6βP
i. Yet, the logit parameters have the IIA property, while the
probit parameters do not. This is hard to reconcile, unless w e accept that the IIA
propertyofthe logitis theoreticallyabsolutebutempiric ally weak.
®Fordiscreteexplanatoryvariables,youcanusethestandar dfamilyof
OLSmodels,byaddingdummyvariables.
®The standard linear form Xβcan be pluggedin to a parentfunction,
like the Probit’s comparison of Xβto a Normal distribution or the
logit’s comparison to a Gumbel distribution, to generate mo dels of
discretechoice. ≫
gsl_stats March24,2009
288 CHAPTER 8
≫
®TheLogitmodelhasthepropertythattheratiooftheoddsofs electing
twochoices,e.g., p(A)/p(B),doesnotdependonwhatotherchoices
exist.
®The computationalpleasantries that OLS demonstratesare n o longer
applicable, and we usually need to do a maximum likelihood se arch
to ﬁndthebestparameters.
8.4 M ULTILEVEL MODELING Retakethesnowﬂakeproblemfrompage236:
themodelstothis pointallassumedthateach
observation is independently and identically distributed relative to the others, but
this isfrequentlynotthecase.
Onewayinwhichthismaybreakisifobservationsfallintocl usters,suchasfami-
lies,classrooms,orgeographicalregion.Aregressiontha tsimplyincludesafami-
ly/classroom/regiondummyvariableassertsthateachobse rvationisiid relativeto
the others, but its outcomerises or falls by a ﬁxedamountdep endingon its group
membership. But the distribution of errors for one family ma y be very different
from that of another family, the unobserved characteristic s of one classroom of
students is likely to be different from the unobserved chara cteristics of another,
andsoon.
Abetteralternativemaybetodoamodelestimationforeachg roupseparately.At
thelevelofthesubgroup,unmodeledconditionsaremorelik ely to beconstantfor
allgroupmembers.Then,onceeachgrouphasbeenestimated, theparameterscan
beusedto ﬁtamodelwherethe observationalunitis thegroup .
The other type of multilevel model is that where there are no d istinct subclusters,
but we would like to give more detail about the derivation of t he parameters. For
example, say that we feel that the propensity to consume a goo d is Normally dis-
tributed,butweknowthatthelikelihoodofconsumptionisa lsobasedonanumber
of factors. We just saw this model—it is the probit, which ass erted that the likeli-
hoodofconsumingis simply the CDF of a Normaldistribution u p to a parameter,
and that parameter has the form Xβ. The logit asserted that the probability of
consumingwas exp(θ)/(1 + exp( θ)), where θis oftheform Xβ.
These are examples of multilevel models . There is a parent model, which is typ-
ically the primary interest, but instead of estimating it wi th data, we estimate it
using the results from subsidiarymodels. To this point, we h avebroadly seentwo
types of model: simple distributions, like the Normal( µ,σ) or the Poisson( λ), and
models asserting a more extensive causal structure, like th e OLS family. Either
formcouldbetheparentinamultilevelmodel,andeitherfor mcouldbethechild.
gsl_stats March24,2009
LINEAR PROJECTIONS 289
Clustering A classroom model may assume a distribution of outcomes for e ach
classroomandestimate µiandσiforeachclass,andthenassertalinear
formthattheoutcomevariableis β1µi+β2σi.Unemploymentmodelsaretypically
modeledasPoissonprocesses,soonecouldestimate λiforeachregion i, butthen
link thoseestimatestogetherto assertthatthe λ’s haveaNormaldistribution.
1#include <apop.h>
2
3voidwith_means(){
4apop_data *d2 =apop_query_to_data("select avg(riders),year −1977 \
5 from riders,lines \
6 where riders.station=lines.station\
7 group bylines.line,year");
8 apop_model_show(apop_estimate(d2,apop_ols));
9 }
10
11voidby_lines(){
12apop_data *lines =apop_query_to_text("select distinct line from lin es");
13intlinecount = lines−>textsize[0];
14apop_data *parameters = apop_data_alloc(0,linecount,2);
15 for(inti=0; i< linecount; i++){
16 char*color = lines−>text[i][0];
17 apop_data *d=apop_query_to_data("select riders,year −1977 from riders,lines\n\
18 where riders.station= lines.stationandlines.line = ’% s’", color);
19 apop_model *m= apop_estimate(d,apop_ols);
20 APOP_ROW(parameters,i,r);
21 gsl_vector_memcpy(r,m −>parameters−>vector);
22 }
23 apop_data_show(parameters);
24 apop_data *s = apop_data_summarize(parameters);
25 apop_data_show(s);
26 }
27
28intmain(){
29 apop_db_open("data −metro.db");
30 printf("Regression parent, Normal child:\n\n");with_ means();
31 printf("Normal parent,regression child:\n\n");by_li nes();
32 }
Listing8.8 Two model estimations: with a regression parent and with a Normal parent. Online
source: /D6/CX/CS/CT/D6/D7/CW/CX/D4/BA .
Listing8.8estimatestwomodelsofthechangeinridersipof theWashingtonMetro
overtime.Youalreadysawtwomodelsofthisdataset,inthef ormoftwodummy-
variable regressions, on page 282. Here, we take a multileve l approach: ﬁrst with
aregressionparentanddistribution child,andthenthe oth erwayaround.
gsl_stats March24,2009
290 CHAPTER 8
Having SQL on hand pays off immensely when it comes to cluster ing, because
it is so easy to select data where its group label has a certain value, or calculate
aggregatesusing a /CV/D6/D3/D9/D4 /CQ/DDclause.It will notbe apparentin this exampleusing
justunder2,000datapoints,butbecauseSQLtablescanbein dexed,groupingand
aggregationcanbe muchfasterthansifting througha tablel ine byline.
The ﬁrst model is a regression parent, distribution child: w e estimate a Normal
model for each Metro line for each year, and then regress on th e set of ˆµ’s thus
estimated.Ofcourse,ﬁnding ˆµistrivial—it’s themean,whichevenstandardSQL
can calculate, so the output from the query on line 4 is alread y a set of statistics
from a set of Normal distribution estimations. Then, the reg ression estimates the
parametersofaregressiononthosestatistics.
The second model is a distribution parent, regression child : we run a separate re-
gression for every Metro line and then ﬁnd the mean and varian ce of the OLS
parameters. Line 12 queries a list of the ﬁve colors (Blue lin e, Red line, ...), and
then lines 15–22are a /CU/D3/D6loop thatruns a separateregressionfor eachcolor, and
writes the results in the /D4/CP/D6/CP/D1/CT/D8/CT/D6/D7 matrix. Then, line 24 ﬁnds ˆµandˆσfor the
setofparameters.
Theestimationstelldifferentstories,andproducediffer entestimatesforthe slope
of ridership with time. Notably, the Green line added some re latively unused sta-
tions in the 1990s, which means that the slope of the Green lin e’s ridership with
time is very different from that of the other lines. This is ve ry clear in the second
case where we run a separate regression for every line, but is drowned out when
thedatasetincludeseveryline.
Noticealsothatthesizeoftheparentmodel’sdatasetchang eswithdifferentspec-
iﬁcations: in the ﬁrst model, it was 150; in the second, it was 5. Thus, the ﬁrst
model had greater conﬁdence that the slope was different fro m zero.15Gelman
& Hill (2007) point out that we test parameters only on the par ent model, which
means that if nis very small for some of the clusters, then this should have n o
effectontheparent—even n= 1forsomeclustersisnotaproblem.Clusterswith
smallnshould show large natural variation in child parameter esti mates, and that
would be reﬂected in the quality of the estimation of the pare nt parameters. But
sincewe neithermakenor testclaims aboutthe child paramet ers,there is no need
to concernourselvesdirectly with the‘quality’ ofthechil dparameters.
15Inthesecondspeciﬁcation, withﬁvedatapoints,onehasane gativeslopeandfourapositiveslope.Nonethe-
less, themean is still about three times ˆσ/√n,giving usabout 99% conﬁdence that the mean issigniﬁcant.
gsl_stats March24,2009
LINEAR PROJECTIONS 291
Q8.4Togetabetterhandleonwhatdiffersamongthelinesandwith intheoverall
regression,drawsomegraphs:
• totalridership peryear
• averageridershipperyear
• totalridership foreachline.
• averageridershipforeachline.
The difference between the total and average ridership is ba sed on the fact
thatthenumberofstationsisnotconstantovertime—produc eacrosstabof
thedatato seetheprogressionofnewstation additions.
The plots for eachline are bestwritten via a /CU/D3/D6loop basedon the one be-
ginningonlineﬁfteenofListing8.8.Howdothegraphsadvis ethestatistics
calculatedbythetwo dummyandtwo multilevelmodels?
An example: multi-level logit We can break down the processof choosinga pres-
idential candidateinto two steps: ﬁrst, the voter de-
cides whether to choose a Democrat, Republican, or Green can didate, and then
chooses among the offered candidates in the chosen party. Th e probability of se-
lectingacandidateisthus P(candidate ) =P(candidate|party )P(party).Wewould
thusneedtodoafewlogitestimations:onefortheDemocrati ccandidates,onefor
theRepublicancandidates,andoneforthepartychoice.16TheIIApropertywould
continue to hold within one party, but among parties, the cha nge in candidates
could shift P(party), so the proportional odds of choosing a given Democrat ver-
sus choosing a given Republican may shift. Listing 8.9 does s ome of these logit
estmationsalongthe wayto themultilevelmodel.
• Onceagain,SQL savesthe dayin doingthesemultilevelesti mations. In this case,
the explanatory variables won’t change from model to model, so they are ﬁxed
in the /D0/D3/CV/CX/D8function, but the outcome variable will change. Thus, the fu nction
takesin thevaryingtailofthe queryandappendsit to theﬁxe dlist ofexplanatory
variablesto pulloutconsistentdata.
• The tails of the queries, in /D1/CP/CX/D2, are straightforward: get all candidates, get all
Democrats,getallRepublicans,getonly partynames.
• Out of the overwhelming amount of data, the /D0/D3/CV/CX/D8function displays on screen
onlythe meanoddsofselectingeachoption.
16Therewas only one Green candidate, Ralph Nader, so P(Nader) =P(Green).
gsl_stats March24,2009
292 CHAPTER 8
1#include <apop.h>
2
3apop_model *logit(char*querytail){
4apop_data *d= apop_query_to_mixed_data("mmmmmt", "select 1, age, ge nder,\
5 illegal_immigrants,aid_to_blacks,%s", querytail);
6 apop_text_to_factors(d,0, 0);
7apop_model *m =apop_estimate(d, apop_logit);
8apop_data *ev= apop_expected_value(d,m);
9 apop_data_show(apop_data_summarize(ev));
10 returnm;
11 }
12
13intmain(){
14 apop_db_open("data −nes.db");
15 logit("favoritefrom choices");
16 logit("favoritefrom choices c,party pwhere p.person = c .favoriteandp.party= ’R’");
17 logit("favoritefrom choices c,party pwhere p.person = c .favoriteandp.party= ’D’");
18 logit("p.partyfrom choices c,party pwhere p.person = c. favorite");
19 }
Listing8.9 Logit models with and without grouping of candid ates by party. Online source:/CP/D2/CS/CX/CS/CP/D8/CT/D7/BA .
Q8.5The example is not quite complete: we have the probability of choosing a
candidate given a party and the probability of choosinga par ty, but not the
productofthetwo.Fillintheremainderofthecodebyﬁnding thepredicted
oddsforeachcandidateforeachobservation.
You can count how often a person chose the candidate that the m odel says
the person is most likely to pick. Did the multilevel logit do a better job of
pickingcandidatesthanthestandardone-levellogit?
Thesimpleconceptofnestingtogethermodelsis akin to McFa dden’snestedlogit
(McFadden,1978).Infact,ifthesearen’tenoughpossibili tiesforyou,seeGelman
& Hill (2007),whoofferseveralmore.
Describing snowﬂakes Now consider the multilevel model as used to model pa-
rameters that are used as inputs to other models. This is
the typical form for when we want to use one of the stories from Chapter 7, like
the one about the Negative Binomial model or the one about the Poisson, but we
wanttheparameterto varyaccordingto per-observationcon ditions.Asabove,the
probit model from the last section ﬁts this description, as e ach agent has a cutoff
basedon a linear model and that agent’s characteristics (i. e., the cutoff for person
iisxiβ), andthatcutoffis thenfed intoa parentNormaldistributi on.
gsl_stats March24,2009
LINEAR PROJECTIONS 293
Because many of Apophenia’s model-handling functions can w ork with a model
that hasonly a log likelihood speciﬁed,the processof writi ng a log likelihood for
sucha modelissupremelysimple:
• Find the linear estimates of the parameters for each observ ation, probably using/CP/D4/D3/D4/CN/CS/D3/D8 ontheinputmatrix andinputparameters.
• Usethestock /D0/D3/CV/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS functiontoﬁndtheloglikelihoodoftheoutcome
datagiventheparameterestimatesfrom the laststep.
Listing8.10implementssuchaprocess.Theﬁrststepisbuil dingthemodel,which
basically consists of reusing existing building blocks.Th e log likelihood function
is simplythetwo stepsabove:ﬁnd Xβ,thenrun a /CU/D3/D6loopto estimatea separate
Poissonmodelforeachrow,basedonthe ithoutcomevariableandthe ithPoisson
parameter.The /D1/CP/CX/D2programdeclaresthemodel,pullsthedata,andthenrunsthe
datathroughboththenewmodelandthestandardOLSmodel.
#include <apop.h>
doublepplc_ll(apop_data *d,apop_model *child_params){
apop_data *lambdas = apop_dot(d,child_params −>parameters,0);
apop_data *smallset = apop_data_alloc(0, 1, 1);
doublell =0;
for(size_ti=0; i< d−>vector−>size; i++){
doublelambda =apop_data_get(lambdas,i, −1);
apop_model *pp= apop_model_set_parameters(apop_poisson,lambda);
apop_data_set(smallset,0,0, apop_data_get(d,i, −1));
ll+= pp−>log_likelihood(smallset,pp);
}
returnll;
}
intmain(){
apop_model pplc = {"Poissonparent,linear child", −1,
.log_likelihood= pplc_ll, .prep=apop_probit.prep};
apop_db_open("data −tattoo.db");
apop_data *d= apop_query_to_data("select \
tattoos.’ct tattoos ever had’ct, tattoos.’year of birth’y r,\
tattoos.’number of days drankalcohol inlast30 days’booze \
from tattoos \
where yr+0.0< 97and ct+0.0< 10and booze notnull");
apop_data *d2 =apop_data_copy(d);
apop_model_show(apop_estimate(d, pplc));
apop_model_show(apop_estimate(d2,apop_ols));
}
Listing8.10 Amultilevel model. Online source: /D4/D6/D3/CQ/CX/D8/D0/CT/DA/CT/D0/D7/BA .
gsl_stats March24,2009
294 CHAPTER 8
Inthiscase,youcaninterprettheparametersinasimilarma nnertothediscussion
oftheprobitandlogitcasesabove.Theparentparameter λiscalculatedas Xβ,so
a1%shiftin xileadsto a βi% shiftin λ.Thus,aftercheckingwhethertheparam-
eters are signiﬁcantly different from zero, you can directl y compare the relative
magnitudesof the parameters to see the relative effectof a 1 % shift in the various
inputs.
Statistics is a subjective ﬁeld At this point, you have seen quite a range of mod-
els: you saw the distribution models from Chapter
7,thelinearmodelsfrom earlierin this chapter,andhereyo ucanseethatyoucan
embed any one model into any other to form an inﬁnite numberof richer models.
Plus, there are the simulation and agent-based models, stan ding alone or nested
with a different type of model. The Metro data has already bee n modeled at least
four different ways (depending on how you count), and the mal e-to-female ratio
amongcountiesin still more ways.Whichmodeltochoose?
Amodelisasubjectivedescriptionofasituation,andmanys ituationsaffordmul-
tiple perspectives. This is rare advice from a statistics te xtbook, but be creative .
We’renotlivinginthe1970sanymore,andwehavethetoolsto tailorthemodelto
ourperceptionsoftheworld,insteadofforcingourbeliefs toﬁtacomputationally
simple model. Try as many models as seem reasonable. Having m any different
perspectives on the same situation only raises the odds that you will come away
with atrue andcorrectunderstandingofthe situation.
We also have some more objective tools at our disposal for sel ecting a model:
Chapter10willdemonstrateameansoftestingwhichoftwodi sparatemodelshas
a better ﬁt to the data. For example, running the code in Listi ng 8.10 here reveals
that the likelihood of the alternative model is higher than t he log likelihood of the
OLS model. You can use the test on page 353 to test whether the d ifference in
likelihoodis truly signiﬁcant.
®Wecancreatemodelswherethedatausedtoestimatetheparam eters
in onemodelisgeneratedbyestimation in anothermodel.
®Onecommonuseisclustering:developamodelforindividual groups
(states,classrooms,families)andthendiscusspatternsa mongasetof
groups(the country,school,orcommunity).
®Wecanalsousemultiplelevelstosolvethesnowﬂakeproblem ,spec-
ifying a different probability of an event for every observa tion, but
stillretainingasimplebasicmodelofevents.Forexample, theprobit
is based on plugging the output from a standard linear form in to a
NormalCDF.
gsl_stats March24,2009
9
HYPOTHESIS TESTING WITH THE CLT
I’m looking for the patterns instatic:Theystarttomake sen se
the longer I’mat it.
—Gibbard(2003)
The purpose of descriptive statistics is to say something ab out the data you have.
The purpose of hypothesis testing is to say something about t he data you don’t
have.
Say that you took a few samples from a population, maybe the he ight of several
individuals, and the mean of your sample measurements is ˆµ= 175cm. If you
didyoursumsright,thenthisisanindisputable,certainfa ct.Butwhatisthemean
heightofthepopulationfromwhichyoudrewyourdataset?To guessattheanswer
to this question, you need to make some assumptions about how your data set
relatesto thepopulationfrom whichit wasdrawn.
Statisticians have followed a number of threads to say somet hing about data they
don’t have. Each starts with a data set and some assumptions a bout the environ-
ment and data generation method, and concludes with an outpu t distribution that
can be compared to the data. Here is a list of some common assum ptions. It is
impossible for it to be comprehensive, and many of the catego ries overlap, but it
offersa reasonablelay ofthe discussionin the followingch apters.
•Classical methods : Claim that the data was produced via a process that allows
applicationoftheCentralLimitTheorem.
gsl_stats March24,2009
296 CHAPTER 9
•Maximum likelihood estimation : Write down a likelihood function for any given
data/parameterpairing, andﬁndthe mostlikely parameterg iventhe data.
•Bayesiananalysis :Claimadistribution expressingpriorbeliefsaboutthepa rame-
ters anda likelihood functionfor the dataon hand,then comb inethem to produce
aposteriordistribution forthe parameters.
•Resampling methods : Claim that random draws from the data are comparable to
random draws from the population (the bootstrap principle ), then generate a dis-
tribution via randomdrawsfrom thedata.
•Kernel/smoothingmethods :Claimthatthehistogramoftheexistingdataisalumpy
versionofthetruedistribution;smooththedatatoproduce theoutputdistribution.
All of these approaches will be discussed over the remainder of this book. This
chapter will focus on the ﬁrst: making inferences about the p opulation via use
of the Central Limit Theorem ( CLT). The CLT describes the distribution of the
samplemean, x, andworks regardlessof the form of the underlying data. Tha tis,
no matter the true distribution of the data, the distributio n of the samplemean has
averyspeciﬁcform—as longas nislarge enough.Forrelatively small n, another
of the abovemethods of inference,such as the Monte Carlo met hods discussedin
Chapter11,maybepreferable.
Metadata
Metadataisdataaboutdata.Anystatisticisafunction
of data, so it is by deﬁnition metadata. Be careful not
toconfuse thecharacteristicsofthedataandmetadata;
forexample,thevarianceofthemeanisalmostalways
smaller than the variance of the base data. Like many
hypothesis tests,the Central LimitTheorem isprimar-
ilyconcerned notwiththedistributionofthebase data
set,but the distributionof the mean of the data set.The CLT gives us a basis for the
Normal distribution; we can then
produce variants based on the Nor-
mal. The square of a Normally dis-
tributed variable xwill have a Chi
squared distribution (which is writ-
ten as x2∼χ2
1, and read as:
the statistic is distributed as a Chi
squared with one degree of free-
dom). Dividing a Normal distribu-
tion by a transformed χ2distribution produces another distribution (the tdistri-
bution),andtheratiooftwo χ2’sproducesan Fdistribution.Becauseallofthisis
rooted in the CLT, the statements are true regardless of the v agaries of the under-
lyingpopulationthatthestatistics describe.
Having found a means of describing the distribution of the un observable popula-
tion parameter β, Section 9.3 will then look a number of simple tests regardin g
β. They are direct applications of the above distributions, a nd so are often given
nameslike the ttest,χ2test,and Ftest.
Theremainderofthechapterappliesthesebuildingblocksi nmorecomplexstruc-
tures to test hypothesesabout more elaborate statistics. F or example, if two inde-
pendentstatistics β1andβ2are∼χ2
1,thenβ1+β2∼χ2
2.Soifthesquareddistance
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 297
betweenahistogramsegmentandahypothesizeddistributio nis∼χ2
1,thentheto-
tal distance between a thousand such segments and the hypoth esized distribution
is∼χ2
1000, and that total distance could thus be used to test the aggreg ate claim
thatthedatahistogramis closetothe distribution.
9.1 T HECENTRAL LIMITTHEOREM The CLT is the key piece of magic
for this chapter. Make a series of n
independent ,identically distributed draws, x1,x2,... x n, from a ﬁxed underlying
population.Theunderlyingpopulationmayhave anynondegeneratedistribution.1
Let the mean of this sequence of draws be x, and the true mean of the overall
populationbe µ. Thenas n→∞,
√n(x−µ)
σ∼N(0,1). (9.1.1)
Thatis, nomatter theunderlyingpopulation,thedistribut ion ofameanofa series
ofdrawswill approachaNormaldistribution.
Put another way, if we repeated the procedure and drew kindependent data sets
from the population and plotted a histogram of x1,... ,xk, we would eventually
seea familiar bellcurve.
Becauseitisaboutthedistributionof x,theCLTembodiesatwo-stageprocedure:
we ﬁrstproducethe meansofa seriesof ksetsofdraws—metadatafrom thebase
distribution—andthenseekthedistribution ofthemetadat a(thekmeans),notthe
data itself. Listing 9.1 demonstrates exactly how this two- stage procedure works,
andisworth understandingin detail.
• Onlinefour(andtheﬁrstpanelofFigure9.2),youcanseeth edatafromwhichthe
programmakesdraws.Itisnowherenearabellcurve:everyth ingiseither≤11or
≥90.
• The inner loop of the /D1/CP/CZ/CT/CN/CS/D6/CP/DB/D7 function (the /CY-indexed loop) takes /D8draws
from the CDF, and adds them to /D8/D3/D8/CP/D0. When /D8/D3/D8/CP/D0is divided by /D8in the
line after the loop, it becomes the mean of /D8draws from the distribution. The
outer loop (the /CX-indexed loop) records /CS/D6/CP/DB/D8such means. Line 23 plots the
distribution ofthis setofseveralmeans.
This double-loop is the baseof the CLT, and is reﬂectedin the assumptionsabout
data sets below. Say that we have /CS/D6/CP/DB/D8data points in our data set, and we are
1By‘nondegenerate’ Imeanthatmorethanoneoutcomehasposi tiveprobability.Ifyourdataisﬁftyitemsthat
all have value 10, the mean of your samples will be 10 no matter how you slice them. However, if your sample
takes as few as two distinct values, the CLT will eventually p rovide you with abell curve. You can verify this by
modifying thecodeinListing 9.1.Therearealso theoretica l distributions with inﬁnitevariance, which alsocause
problems for the CLT,butthis is of course notan issuefor ﬁni te data sets.
gsl_stats March24,2009
298 CHAPTER 9
1#include <apop.h>
2
3intdrawct = 10000;
4doubledata[] ={1, 2, 3,10, 11, 10, 11, 90, 91, 90, 91};
5
6gsl_vector *make_draws( intct,gsl_rng*r){
7doubletotal;
8gsl_vector *out = gsl_vector_alloc(drawct);
9for(inti=0; i< drawct; i++){
10 total =0;
11 for(intj=0; j< ct;j++)
12 total+= data[gsl_rng_uniform_int(r, sizeof(data)/sizeof(data[0]))];
13 gsl_vector_set(out,i,total/ct);
14 }
15 returnout;
16 }
17
18intmain(){
19gsl_rng*r= apop_rng_alloc(23);
20 for(intct=1; ct<= 1018; ct+=3){
21 printf("set title’Mean of %idraws’\n", ct);
22 gsl_vector *o=make_draws(ct,r);
23 apop_plot_histogram(o, 200, NULL);
24 gsl_vector_free(o);
25 printf("pause 0.6\n");
26 }
27 }
Listing9.1 Take the mean of an increasing number of draws. Th e distribution of the means
approaches a Normaldistribution. Online source: /D0/D8/CS/CT/D1/D3/BA .
claiming that they are Normally distributed. We presume tha t they are Normally
distributed(andnotjustconstant)becauseamultitudeofe ventshaveaffectedeach
datapointin somesortof haphazardway.Thatis, eachindivi dualdatapointwent
through a process like the inner loop in lines 11–12, absorbi ng a large number of
random shocks. After all the little shocks, we gathered a sin gle data point, as in
line 13.
• The /D1/CP/CX/D2function is intended to show that the CLT works best when each data
point is the mean of several draws from the base distribution . Line 22 repeatedly
calls /D1/CP/CZ/CT/CN/CS/D6/CP/DB/D7 . At the ﬁrst call, /D8/BP/BP/BD, so /D1/CP/CZ/CT/CN/CS/D6/CP/DB/D7 makes 10,000 draws
from the distribution itself. The next call produces10,000 data points where each
isthemeanoffourdraws,andsoonuptoeachdatapointbeingt hemeanof1018
draws.Theprogramdumpsplotsofthehistogramsto /CB/CC/BW/C7/CD/CC,soruntheprogram
via /BA/BB/D0/D8/CS/CT/D1/D3 /DG /CV/D2/D9/D4/D0/D3/D8.
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 299
Figure 9.2 shows a few frames of output from the program. The ﬁ rst frame of the
animation is simply a set of spikes representing the base dat a. The second frame,
where each data point is the mean of four draws, has a series of humps, because
somedrawshavealllargenumbers,somehavethreelargenumb ersandonesmall,
somehavetwoofeach,andsoon.Inthethird frame,therearem orecombinations
possible, so there are more humps. As the frames progress, th e humps merge to-
gether to form a familiar bell curve. This is a re-telling of t he counting story on
page237, which explainedwhy the Binomial distribution app roachesa bell curve
aswell.
0200400600800100012001400160018002000
0 20 40 60 80 100Frequency
xMeans of 1 draw
01002003004005006007008009001000
0 20 40 60 80 100Frequency
xMeans of 4 draws
050100150200250300
010203040506070Frequency
xMeans of 22 draws
020406080100120140160180
3032343638404244Frequency
xMeans of 1018 draws
Figure 9.2 Sample outputs from the CLTdemo inListing9.1
gsl_stats March24,2009
300 CHAPTER 9
Finally, notice the x-axes of the snapshots: the original data was plotted from 0–
100, but the scale in the fourth frame only goes from 30 to 45.2So not only does
the distribution of xapproach a bell curve, but it approaches a rather narrow bell
curve.
Q9.1Modify line 4to try differentbasedistributions from which the systemwill
draw. [Thanks to the creative use of /D7/CX/DE/CT/D3/CUon line 12, you don’t need
to specify the size of the array. But see the footnote on page 1 25 on why
this could be bad form.] Deleting the elements {1,2,3}producessome es-
pecially interesting patterns. What sort of data sets lead q uickly to a bell
curve,and whatdata sets require averagingtogether thousa ndsof elements
beforeachievinga decentapproximationto the Normal?
Equation9.1.1putthestorymoreformally:ifwehaveadatas etxwithnelements,
truemean µ,andvariance σ2,thenas n→∞,(¯x−µ)/slashbigσ√napproachesaN(0,1)
distribution.Fromthatregularityofnature,wecanderive allofthedistributionsto
follow.
Variants on variance Thereisoftenconfusionaboutwhentouse σ2,σ,orσ/√n,
soitis worth aquickreview.
• For any data set or distribution, the varianceis notated as σ2. The formula for the
varianceofadatasetis/summationtextn
i=1(xi−µ)2/n,soitmakessensethatitssymbolwould
haveasquareincluded.
• For the Normal distribution, the square root of the varianc e is known as the stan-
darddeviation, σ,andisusedtodescribethe‘width’ofthedistribution.For exam-
ple, just over 95% of a Normal distribution is within plus or m inus two standard
deviationsofthemean.Outsideofthe Normaldistribution, σisrarely used.
• Letussaythatwehavea dataset xwhosevarianceis σ2.Thenthevarianceofthe
meanof x,var(x), isσ2/n,andthestandarddeviationof xisσ/√n. Onceagain,
itis importantto bearin mindwhetheryouare dealingwith da taormetadata.
®The Central Limit Theorem states that if each observation xiis the
mean of some draws from an iid distribution, then as n→∞, the
distribution of xifollows Equation9.1.1.
®That is, if µis the overall mean and σis the square root of the vari-
anceofthe setof xi’s, then (xi−µ)/(σ/√n)approachesaN(0,1)
distribution.
2If the shift in x-axis bothers you, you could ask Gnuplot to hold a constant sc ale by adding a line like/D4/D6/CX/D2/D8/CU/B4Ꜽ/D7/CT/D8 /DC/D6/CP/D2/CV/CT /CJ/BC/BM/BD/BC/BC℄ \ /D2Ꜽ/B5/BNat the top of /D1/CP/CX/D2.
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 301
9.2 M EET THE GAUSSIAN FAMILY With the exception of the Normal, the
distributionsbelowaredistinctfromthe
distributions of Section 7.2. The distributions there are t ypically used to describe
data that we have observed in the real world. The distributio ns here are aimed at
describingmetadata,suchasthemeansandvariancesofmode lparameters.
NORMAL The Normal distribution, presented on page 241, will also be used to de-
scribe some of the parameters derived below. The big problem with the
Normal distribution is that it depends on σ, an unknown. It also depends on µ,
but we are frequently testing a claim that µhas some ﬁxed value, so we assume
ratherthanderiveit.Thus,muchofthetrickeryinthissect ioninvolvescombining
distributions in wayssuchthatthe unknown σ’s cancelout.
χ2DISTRIBUTION Thesquareofavariablewithdistribution N(0,1)hasaχ2distri-
butionwithonedegreeoffreedom,andthesumof nindependent
χ2-distributedvariablesisalso ∼χ2,withndegreesoffreedom.Figure9.3shows
thedistribution forafew differentdegreesoffreedom.
• IfX∼N(0,1), then X2∼χ2
1.
• IfXi∼N(0,1)fori= 1,... ,n, thenX2
1+···+X2
n∼χ2
n.
• IfXi∼χ2
n, thenE(Xi) =n.
Thesummationpropertyisimmenselyuseful,becauseweofte nhavesumsofvari-
ables to contend with. The most common case is the sample vari ance, which is a
sum of squares. Being a sum of squares of Normally-distribut ed elements, it is
easyto showthat(Snedecor& Cochran,1976,p 74)
/bracketleftbig/summationtext
n(x−x)2/bracketrightbig
σ2∼χ2
n−1. (9.2.1)
The numerator is the estimate of the sample variance times n−1, so we can use
this to test that the sample variance equals a given σ2, or establish a conﬁdence
interval around an estimate of the variance. But we will see t hat it is useful for
muchmorethanjustdescribingvarianceestimates.
The sample variance is ∼χ2
n−1, notχ2
n, becausegiven the ﬁrst n−1data points
and the mean, the last one can actually be calculatedfrom tha t data, meaning that
we effectively have the sum of n−1variables∼χ2
1, plus a no longer stochastic
constant.Formore ondegreesoffreedom,seethesidebaronp age222.
It is worth mentioning the origin of the χ2distribution as a common form. Pear-
son(1900)did aTaylorexpansionoferrors from whatwe nowca llaMultinomial
gsl_stats March24,2009
302 CHAPTER 9
00.050.10.150.20.25
0 2 4 6 8 10 12 14 16P(x,d f)
x1df
3df
10df
Figure 9.3 The χ2distribution for 3, 5, and 10 degrees of freedom. Being a sum o f squares, it is
always greater than zero. As more elements are added in to the sum, the distribution
becomes less lopsided, andapproaches a Normal distributio n.
distribution,oftheform k1χ+k2χ2+k3χ3+···,wherethe ki’s areappropriate
constants.He found that one canget satisfactoryprecision using only the χ2term
ofthe series.TheANOVA family of testsis basedonthis appro ximation,because
those tests claim that the data are random draws that ﬁt the st ory of the Multino-
mial distribution (as on page 240), so a sum of such distribut ions leads to a χ2
distribution aswell.
STUDENT’StDISTRIBUTION Letxbe a vector of data (such as the error terms in
aregression).Then
x−µ
ˆσ/√n∼tn−1,
where ˆσ=x′x/n(a scalar). It might look as thoughthis is just an approximat ion
of the Normal, with ˆσreplacing σ, but it is not. To see where the form of the t
distribution camefrom, considerdividingtheCLTequation (Equation9.1.1),
x−µ
σ√n∼N(0,1),
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 303
00.050.10.150.20.250.30.350.4
-4 -2 0 2 4P(x,d f)
x1df
3df
10df
Figure 9.4 The tdistribution for 1, 3, and 10 degrees of freedom. For one degr ee of freedom, the
distribution has especially heavy tails—the variance is in ﬁnite—but as d fgrows, the
distributionapproaches a N(0,1).
by
/radicalbigg
ˆσ2
σ2∼/radicaligg
χ2
n−1
n−1.
Then
/parenleftigg
x−µ
σ√n/slashigg/radicalbigg
ˆσ2
σ2/parenrightigg
=x−µ
ˆσ/√n.
The key stumbling block, the unknown value of σ, cancels out from the numera-
tor and denominator. This is a work of genius by Mr. Student, b ecause he could
calculate the exactshapeof the distribution through strai ghtforward manipulation
oftheNormaland χ2tables.3Some tdistributions forvariousdegreesoffreedom
arepicturedin Figure 9.4.
• The t1distribution (i.e., n= 2)is calledaCauchydistribution.
• Asn→∞, thetndistribution approachesthe N(0,1)distribution.
3Studentis actually Mr. William Sealy Gosset, who published the tdistribution in 1908 based on his work as
an employee of the Guinness Brewery.
gsl_stats March24,2009
304 CHAPTER 9
00.20.40.60.811.2
0 0.5 1 1.5 2 2.5 3 3.5 4P(x,d f1,d f2)
x10, 10 df
2, 2 df
10, 1 df
1, 10 df
Figure 9.5 The Fdistributionforvarious pairs of numerator/denominator d egrees of freedom.
FDISTRIBUTION Insteadofaratio ofan Nanda/radicalbig
χ2,youcouldalsotakethera-
tio oftwo χ2-distributedvariables.The σ’s in bothdenominators
wouldagaincancelout,leavingadistributionthatcouldbe calculatedfromthe χ2
tables.This isthe derivationanddeﬁnitionofthe Fdistribution:
[χ2
m/m]/[χ2
n/n]∼F(m,n).
SeeFigure 9.5forsomesample Fdistributions.
Also, considerthe square of a tdistribution. The numerator of a tndistribution is
a Normal distribution, so its square is a χ2
1; the denominator is the square root of
aχ2
ndistributedvariable,soitssquareis a χ2
n. Thus,thesquareofa tn-distributed
variablehasan F1,ndistribution aswell.
TheFdistribution allows us to constructtests comparingone χ2-distributed vari-
able in the numerator to another χ2-distributed variable in the denominator, and
either of these χ2variables could be the sum of an arbitrary number of elements .
Wecanthususethe Fdistributiontoconstructcomparisonsamongrelativelyco m-
plexstatistics.
LOOKUP TABLES There are three things that covermost of what you will be doin g
with a distribution: ﬁnding values of its PDF, values of its C DF,
and occasionally values of its inverse CDF. For a single quic k number, see the
command-line program /CP/D4/D3/D4/CN/D0/D3/D3/CZ/D9/D4 . For getting the the value of the PDFs at a
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 305
givenpointfrom insideaprogram,herearetheheadersforth eGSL’sPDFlookup
functions:
doublegsl_ran_gaussian_pdf ( doublex,doublesigma);
doublegsl_ran_tdist_pdf ( doublex,doubledf);
doublegsl_ran_chisq_pdf ( doublex,doubledf);
doublegsl_ran_fdist_pdf ( doublex,doubledf1,doubledf2);
• The preﬁx /CV/D7/D0/CN/D6/CP/D2 indicates that these functions are from the random number
generationmodule( /AZ/CX/D2/D0/D9/CS/CT /BO/CV/D7/D0/BB/CV/D7/D0/CN/D6/CP/D2/CS/CX/D7/D8/BA/CW/BQ ).Randomnumbergener-
ationitself will bedelayedto Chapter11.
• ThemeanfortheNormalfunctionisﬁxedatzero,somodify Xaccordingly,e.g.,if
XisdrawnfromaN(7,1), thenasktheGSLfor /CV/D7/D0/CN/D6/CP/D2/CN/CV/CP/D9/D7/D7/CX/CP/D2/CN/D4/CS/CU/B4/CG/B9/BJ/B8/BD/B5.
Thenextmostcommondistributioncalculationfoundintabl esinthebackofstatis-
tics texts is calculating the CDF above or below a point. The /C8/B9functions below
calculatetheCDFbelowapoint,i.e./integraltextX
−∞f(y)dy,whilethe /C9/B9functionscalculate
theCDFaboveapoint,i.e./integraltext∞
Xf(y)dy.Thesesumtoone,soyoucanexpressany
areain termsofwhicheverfunctionis clearest.
Hereis thelist offunctions:
doublegsl_cdf_gaussian_P ( doublex,doublesigma);
doublegsl_cdf_tdist_P ( doublex,doubledf);
doublegsl_cdf_chisq_P ( doublex,doubledf);
doublegsl_cdf_fdist_P ( doublex,doubledf1,doubledf2);
...plusallofthesewith the /C8replacedbya /C9.
Thesewill be usedto test hypotheses ,which in this contextare claims like µ >0.
If you are shaky with hypothesis tests, see the next section. But if you are well-
versed with the traditional notation for hypothesis tests, notice that the overuse
of the letter Pcan easily lead to confusion. The /CV/D7/D0/CN/CS/CU/CN/CV/CP/D9/D7/D7/CX/CP/D2/CN/C8 function
gives what is known as the p-value for the one-tailed test that the mean is less
than zero, and the /CV/D7/D0/CN/CS/CU/CN/CV/CP/D9/D7/D7/CX/CP/D2/CN/C9 function gives the infrequently-used q-
value for the same hypothesis. Put another way, if we ﬁnd that the mean of our
Normallydistributeddatais2.2standarddeviationsbelow zero,thenwerejectthe
one-tailed hypothesis that the mean is less than or equal to z ero with conﬁdence/BD /B9 /CV/D7/D0/CN/CS/CU/CN/CV/CP/D9/D7/D7/CX/CP/D2/CN/C8/B4/BE/BA/BE/B8 /BD/B5 /BP/BP /CV/D7/D0/CN/CS/CU/CN/CV/CP/D9/D7/D7/CX/CP/D2/CN/C9/B4/BE/BA/BE/B8 /BD/B5.
For a hypothesis that µ >0, everything is reversed. Here is a table that strives to
clarifywhichfunctiongoeswiththeconﬁdencewithwhichth enullisrejectedand
gsl_stats March24,2009
306 CHAPTER 9
whichgoeswith the p-value,andwhen:
H0:µ >0H0:µ <0
conﬁdence /CV/D7/D0/CN/BA/BA/BA/CN/C8 /CV/D7/D0/CN/BA/BA/BA/CN/C9
p-value /CV/D7/D0/CN/BA/BA/BA/CN/C9 /CV/D7/D0/CN/BA/BA/BA/CN/C8
Foracenteredtwo-tailed test,the p-valuetakestheform
2*GSL_MIN(gsl_ran_gaussian_P(mu, sigma),gsl_ran_gaussi an_Q(mu, sigma))
//or equivalently,
2*gsl_ran_gaussian_Q(fabs(mu),sigma)
Theconﬁdencewith whichwe failto rejectthetwo-tailed nul lis oneminusthis.
In the other direction, we may want to know where we will need t o be to reject a
hypothesiswith95%certainty.Forexample,avalue-at-ris korientedregulatorwill
wanttoknowtheworstone-daylossabankcanexpectoveramon th.Toformalize
thequestion,whatisthevalueofthe1-in-20,or5%,pointon theCDF?Assuming
a Normal( µ,σ) distribution of proﬁt and loss,4the bank will report a value at risk
of /CV/D7/D0/CN/CS/CU/CN/CV/CP/D9/D7/D7/CX/CP/D2/CN/C8/CX/D2/DA /B4/BC/BA/BC/BH/B8 σ /B5 /B7µ. Here are the requisite function
declarations:
doublegsl_cdf_gaussian_Pinv ( doublep,doublesigma);
doublegsl_cdf_tdist_Pinv ( doublep,doubledf);
doublegsl_cdf_chisq_Pinv ( doublep,doubledf);
doublegsl_cdf_fdist_Pinv ( doublep,doubledf1,doubledf2);
...plusall ofthesewith the /C8/CX/D2/DAsreplacedby /C9/CX/D2/DAs.
Q9.2Thepowerof a test is the likelihood of successfully rejecting the nul l hy-
pothesisiftherereallyisaneffectinthedataandthenulls houldberejected
(see page 335 for more). When designing an experiment, you wi ll need to
estimate the power of a given design so you can decide whether to gather
tensamplesoramillion.
IexpectthemeanofmyNormally-distributeddatatobe0.5,a ndˆσtobe1.1.
Giventheseassumptions,whatmust nbetorejectthenullhypothesis µ= 0
with 99.9% conﬁdence? What if the Normal approximation assu mption is
deemedinapplicable,sothe datais takento be t-distributed?
4This assumption is false. Securities typically have leptok urtic (fat-tailed) returns; seepage 230.
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 307
®ThesquareofaNormaldistribution is a χ2distribution.
®Both of these distributions rely on an unknown variance σ2. We can
guess at σ2, but then our conﬁdence intervals are mere approxima-
tions aswell.
®The ratio of a Normal over the square root of a transformed χ2dis-
tribution is a tdistribution. By taking the ratio of the form of the
two distributions, the unknown σ’s cancel out, so a valid conﬁdence
regioncanbeconstructedfrom aﬁnite amountofdata.
®The ratio of two χ2distributions is an Fdistribution. Again, the un-
known σ’s cancelout.
9.3 T ESTING A HYPOTHESIS The chapter to this point has discussed how
certain manners of gathering data and aggre-
gatingit into a statistic, suchastaking its meanor taking t he sum ofsquares,lead
tocertainknowndistributions.Thus,ifwehaveastatistic producedinsuchaman-
ner, we can evaluatethe conﬁdencewith which a claim aboutth at statistic is true.
For example, the mean of a data set can be transformed to somet hing having a t
distribution (assuming the CLT holds). Similarly for the di fference between the
meansfortwodatasets,soapreciseprobabilitycanbeplace donclaimsaboutthe
differencein twomeans.
CLAIMING A FIXED MEAN This test is sometimes called a z-test, but see the foot-
note below. The claim is that the mean of a column of
datais equalto µH. Theprocedureto thetest:
• Findthe meanofthe data ˆµ.
• Given the variance of the data set ˆσ2
d, estimate the standard deviation of the mean
viaˆσm= ˆσd/√n.
• For a one-tailed test, ﬁnd the percentage of the tn−1distribution that is over
|µH−ˆµ|/(ˆσ/√n), i.e., /CV/D7/D0/CN/CS/CU/CN/D8/CS/CX/D7/D8/CN/C9/B4/CU/CP/CQ/D7/B4 µH−ˆµ /B5/BBˆσm
/B8 /D2/B9/BD/B5. Report
this asthe p-value.
• Fora two-tailed test,reporttwice thecalculatednumbera sthep-value.
Q9.3Can we reject the claim H0: The typical Puerto Rican county has over a
50% poverty rate ? Use the county-level info from the /D4/D3/DA/CT/D6/D8/DD/CN/D4/D8/CN/CP/D0/D0
columnfrom the /CX/D2/D3/D1/CTtableof /CS/CP/D8/CP/B9/CT/D2/D7/D9/D7/BA/CS/CQ asyourdataset.Given
thattheUSCensusBureaudeﬁnespovertybythecostofliving inthemain
partoftheUnitedStates,howwouldyouinterpretyourresul t?
gsl_stats March24,2009
308 CHAPTER 9
Consider the parameters ˆβfrom the OLS regression, which you will recall takes
the form ˆβ= (X′X)−1X′y. This is a more complex expression than a simple
mean, but each element of the ˆβvector, ˆβ0,ˆβ1,..., can still be shown to have a
simple tdistribution. Thus, the standard test that a regressionpar ameter βiis sig-
niﬁcantly different from zero is a variant of the test here re garding a t-distributed
scalar.Thefull detailswill begivenin the sectiononregre ssiontestsbelow.
COMPARING THE MEAN
OF TWO SETSAmong the most common and simplest questions is: are
two sets of observationsfrom the same process?Chapter
3 (page 109) already showed how to do a ttest to test
this claim.5You are encouraged to reread that section with an eye toward t he test
procedure.
Reportingconﬁdence
Thereissometraditionofreportingonlywhetherthe
pvalue of a test is greater than or less than some ar-
tiﬁcial threshold, such as p >0.05orp <0.05. But
Gigerenzer (2004) cites Fisher(1956) as stating:
...noscientiﬁcworkerhasaﬁxedlevel
of signiﬁcance at which from year to
year, and in all circumstances, he re-
jects hypotheses; he rather gives his
mindtoeachparticularcaseinthelight
of his evidence and hisideas.
Based on this observation, it would be better form
to list the actual conﬁdence calculated, and allow the
reader to decide for herself whether the given value
provides small or great conﬁdence in the results. The
errorbars from Chapter5provide aconvenient wayto
dothis.The paired ttest is a common vari-
anttothestandard ttest.Saythatthe
data are paired in the sense that for
eachelementin the ﬁrst set, there is
an element in the second set that is
related;putanotherway, this means
that for each element ai, there is a
corresponding element bisuch that
the difference ai−bimakes real-
world sense.Forexample,we could
look at student scores on a test be-
fore a set of lessons and scores by
the same students after the lessons.
Then, rather than looking at the t
distribution for the beforedata and
comparingitto the tdistributionfor
5Thereis no standardized naming scheme for tests. A test basi cally consists ofthree components:
1.the context,
2.the statistic to becalculated, and
3.the distribution that the statistic is compared to.
Thus,there aretestswith nameslikethepaired datatest(us ing component1),sumofsquarestest(component 2),
orFtest (component 3).
There is no correct way to name a procedure, but you are encour aged to avoid approach #3 where possible.
First, there are really only about four distributions (Norm al,χ2,t,F) that are used in most real-world applica-
tions,which means thatapproach #3gives usonly fournames f ormyriad tests. Twopeople could both betalking
aboutrunning a chi-squared test and ﬁnd that they aretalking about entirely different conte xts and statistics.
ThereisanoddanomalyregardingnamingcustomsfortheNorm aldistribution: ratherthancalling thestatistic
tobecompared totheNormala normalstatistic orGaussian statistic , itistypically called a zstatistic. Thereisa
zdistribution, but it has nothing to do with the ztest: it is one half the log of an Fdistribution, and is no longer
commonly used because the Fis slightly moreconvenient.
Finally, which distribution to use depends on the context an d data: if a statistic has a tdistribution for small
n, then it approaches Normal as n→∞, so we could easily ﬁnd ourselves in a situation where we are l ooking
up the statistic for what is called a ttest on the Normal distribution tables, or looking up a zstatistic in the t
distribution tables.
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 309
theafterdata, we could look at the vector of differences ai−biand ﬁnd the con-
ﬁdence with which zero falls in the appropriate tdistribution. This is generally a
morepowerfultest,meaningthatwearemorelikelytoreject thenullhypothesisof
no difference between the two vectors, and therefore the pai redttest is generally
preferable over the unpaired version (when it is applicable ). Apophenia provides
the /CP/D4/D3/D4/CN/D4/CP/CX/D6/CT/CS/CN/D8/CN/D8/CT/D7/D8 functionto runthis testwhereappropriate.
χ2-BASED TESTS Onequickapplicationofthe χ2distributionisfortestingwhether
avariancetakesonacertainvalue.Wepositthatthedenomin ator
of Equation 9.2.1 is a ﬁxed number, and then check the χ2tables for the given
degreesoffreedom.Thisis arelatively rareuseofthedistr ibution.
A more common use is to take advantage of the summation proper ty to combine
individual statistics into more elaborate tests. Any time w e have statistics of the
form (observed−expected)2/expected, where (observed −expected) should be
Normally distributed, we can use Pearson’s Taylor series ap proximation to piece
together the statistics to form a χ2test. There are examples of this form in the
sectionon ANOVAandgoodness-of-ﬁttestingbelow.
F-BASED TESTS Becauseofallthesquaringthatgoesintoa χ2distributedstatistic,
xand−xare indistinguishable, and so it becomes difﬁcult to test
one-tailed claims of the form a > b. We could usethe ttest for a one-tailed claim
aboutasinglevariable,oran Ftestfora combinationofmultiple variables.
LetH0be the claim that Q′β=c. This is a surprisingly versatilehypothesis.For
example,saythat βisavectorwiththreeelements,
β1
β2
β3
,Q=
1
0
0
,andc= [7].
ThenH0isβ1= 7. Or,Q=
1
−1
0
andc=/bracketleftbig
0/bracketrightbiggivesH0:β1=β2. Or, say
we want to test H0:β2= 2β3. Then let Q=
0
1
−2
andc= 0. In ANOVA
terminology,ahypothesisaboutalinearcombinationofcoe fﬁcientsisknownasa
contrast.
Totestallthreehypothesesatonce,simply stackthem, oneh ypothesisto a row:
Q′=
1 0 0
1−1 0
0 1−2
c=
7
0
0
. (9.3.1)
gsl_stats March24,2009
310 CHAPTER 9
Any linear (or afﬁne) hypothesis having to do with a paramete rβcan be ﬁt into
this form.
Deﬁne qto be the number of constraints (rows of Q′),nthe sample size, and
kthe number of parameters to be estimated ( β). As before, let Xrepresent X
normalized so that each column but the ﬁrst has mean zero, and the ﬁrst column
is the constant vector 1. Now, if H0is true and βwas estimated using OLS, then
Q′β∼N(c,σ2Q′(X′X)−1Q),6andwecanconstructa χ2-distributedlinearcom-
binationofthesquareof qstandardNormals via
(Q′ˆβ−c)′[Q′(X′X)−1Q]−1(Q′ˆβ−c)
σ2∼χ2
q. (9.3.2)
Alternatively, say that we are testing the value of the varia nce of the regression
error, and ǫ∼N;then
ǫ′ǫ
σ2∼χ2
n−k. (9.3.3)
As above, we can divide scaled versions of Equation 9.3.2 by E quation 9.3.3 to
giveusa statisticwith an Fdistribution andnounknown σ2element:
n−k
q(Q′ˆβ−c)′[Q′(X′X)−1Q]−1(Q′ˆβ−c)
ǫ′ǫ∼Fq,n−k. (9.3.4)
If you have read this far, you know how to code all of the operat ions in Equation
9.3.4.Butfortunately,Apopheniaincludesafunctionthat willcalculateitforyou.
To do this, you will need to feed the function an estimate of βand an /CP/D4/D3/D4/CN/B9/CS/CP/D8/CPset indicating the set of contrasts you wish to test, whose ve ctor element is
cand matrix element is Q′. As in Equation 9.3.1, each rowof the input matrix
represents a hypothesis,so to test all three equality const raints at once, you could
usea vector/matrixpairlike this:
doubleline= {
7,1, 0, 0
0,1,−1,0
0,0, 1,−2};
apop_data *constr = apop_line_to_data(line, 3, 3,3);
6For any other method, the form of the variance is Q′(the variance from Section 8.2) Q. See, e.g., Amemiya
(1994).
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 311
The ﬁnal [vector|matrix] form for the constraint matches the form used for con -
straints onpp152–153,butin this casetheconstraintsarea llequalities.
Listing 9.6presentsafull example.
• It runs a regressionon the males-per-femaledata from page 267,so link this code
togetherwith thatcode.
• Theconstraintis onlyonecondition:that β3= 0.
• The /CP/D4/D3/D4/CN/BY/CN/D8/CT/D7/D8 function takes in a set of regression results, becausethe Ftest
ascommonlyusedissocloselymarried to OLS-typeregressio ns.
#include "eigenbox.h"
intmain(){
doubleline[]= {0, 0,0, 1};
apop_data *constr = apop_line_to_data(line,1, 1,3);
apop_data *d =query_data();
apop_model *est = apop_estimate(d,apop_ols);
apop_model_show(est);
apop_data_show(apop_f_test(est,constr));
}
Listing9.6 Runan F-teston analready-run regression. Online source: /CU/D8/CT/D7/D8/BA.
Hereisausefulsimpliﬁcation.Let R2bethecoefﬁcientofdetermination(deﬁned
further below), nbe the number of data points, kbe the number of parameters
(including the parameter for the constant term), and φbe the F-statistic based on
Q=Iandc=0.Thenit canbeshownthat
(n−k)R2
k(1−R2)=φ. (9.3.5)
Q9.4Verify the identity of Equation 9.3.5 using Equation 9.3.4 a nd these deﬁni-
tions(from page228):
yest≡Xβ(the estimatedvalueof y),
SSR≡/summationdisplay
(yest−y)2,
SSE≡ǫ′ǫ,and
R2≡SSR
SSE.
gsl_stats March24,2009
312 CHAPTER 9
Statisticalcustomisbasedontheavailability ofcomputat ionalshortcuts,sothe F
statistic of Equation 9.3.5 often appears in the default out put of many regression
packages.7It is up to you to decide whetherthis particular test statist ic is relevant
for the situation you are dealingwith, butbecauseit is a cus tomto report it, Apo-
pheniafacilitates this hypothesistest by assumingit as th e defaultwhen you send
in /C6/CD/C4/C4variables,asin /CP/D4/D3/D4/CN/BY/CN/D8/CT/D7/D8/B4/CT/D7/D8/CX/D1/CP/D8/CT/B8 /C6/CD/C4/C4/B5.
Q9.5Verify the identity of Equation 9.3.5 by running a linear reg ression on the
datasetyouproducedfortheexerciseonpage278,thenpassi ngthe /CP/D4/D3/D4/CN/B9/D1/D3/CS/CT/D0thusproducedto /CP/D4/D3/D4/CN/BY/CN/D8/CT/D7/D8 toﬁndthe FstatisticandApohenia’s
R2-ﬁndingfunctionto ﬁndtheSSEandSSR.
®The simplest hypothesis test regarding the parameters of a m odel is
thettest.Itclaimsthatthemeanofadatasetisdifferentfromag iven
value of µ. A specialcaseis the claim that the mean of two data sets
differ.
®Theχ2testallowsthecomparisonoflinearcombinationsofallege dly
Normalparameters.Butsinceeverythingis squaredto getth eχ2pa-
rameter, itcannottestasymmetricone-tailedhypotheses.
®TheFtest provides full generality, and can test both one-tailed and
two-tailed hypotheses, and claims that several contrasts a re simulta-
neouslytrue.
9.4 ANOVA ANOVAis a contraction for analysis of variance , and is a catch-
all term for a variety of methods that aim to decompose a data
set’s variance into subcategories.Givena few variables an d a few groups, is there
morevariationbetweengroupsorwithingroups?Canthevari ationinadependent
variablebeattributed primarily to someindependentvaria blesmore thanothers?
The descriptive portion of ANOVA techniques was covered bac k on pages 224–
227.This sectioncoversthehypothesistestingpartofANOV A.
You may want to re-run /D1/CT/D8/D6/D3/CP/D2/D3/DA/CP/BA , which ﬁrst appeared as Listing 7.2 on
page 226. It produces an ANOVA table that includes several su ms of squared er-
rors,andtheratiobetweenthem.Atthispoint,youwillreco gnizeasumofsquared
errors as having a χ2distribution (assuming the errors are Normally distribute d),
and the d f-weighted ratio of two sums of squared errors as being F-distributed.
7Scheffé (1959) parodies the singular focus on this form by ca lling it“the” Ftest throughout the book.
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 313
Thus, the traditional ANOVA table includes an Ftest testing the claim that the
among-group variation is larger than the within-group vari ation, meaning that the
groupingexplainsa more-than-randomamountofvariationi n the data.
Independence The crosstab represents another form of grouping, where the rows
divide observations into the categories of one grouping, an d the
columnsdividetheobservationsinto categoriesofanother .Are thetwo groupings
independent?
Togiveaconcreteexample,saythatwehaveatwo-by-twoarra yofevents,wherein
178peoplechosebetweenup/downandleft/right:
Left Right Σ
Up30 86 116
Down 24 38 62
Σ 54 124 178
Is the incidence of Up/Down correlated to the incidence of Le ft/Right, or are the
two independent? Draws from the four boxes should follow a Mu ltinomial dis-
tribution: if Up/Down were a Bernoulli draw with probabilit iespUandpD, and
Left/Right were a separate,independentBernoulli draw wit h probabilities pLand
pR, then the expected value of Up/Left would be EUL=npUpL, and similarly
forEDL,EUR, andEDR. Notating the actualincidenceof Up/Left as OUL= 30,
we can use the fact (from page 301) that the χ2is a reasonable approximation of
errors from a Multinomial distribution to say that the obser ved variance over the
expectedvalue (OUL−EUL)2/EUL∼χ2. Similarly for the other three cells, so
thesum
(OUL−EUL)2
EUL+(OUR−EUR)2
EUR+(ODL−EDL)2
EDL+(ODR−EDR)2
EDR∼χ2
1.
(9.4.1)
This expression has one degree of freedom because the horizo ntal set has two
elements and one mean ⇒one df; similarly for the vertical set; and 1 df ×1 df =
1df. If therewerethree rowsandsixcolumns,there wouldbe 2×5 = 10df.
Listing9.7calculatesthis,oncethelongwayandtwicethes hortway.The /CP/D0/CN/B9/CW/CX/CN/D7/D5/D9/CP/D6/CT/CS function calculatesEquation9.4.1,using the /D3/D2/CT/CN/CW/CX/CN/D7/D5 function
tocalculateeachindividualterm.Finally, /D1/CP/CX/D2gathersthedataandcallstheabove
functions. After all that, it also calls /CP/D4/D3/D4/CN/D8/CT/D7/D8/CN/CP/D2/D3/DA/CP/CN/CX/D2/CS/CT/D4/CT/D2/CS/CT/D2/CT , which
doesallthis work foryouononeline.
ThedistributionofmeansofaseriesofBinomialdrawswilla pproachaNormalas
n→∞, butfor manysituations, nis closerto aroundten.Forsuchacase,Fisher
gsl_stats March24,2009
314 CHAPTER 9
#include <apop.h>
doubleone_chi_sq( apop_data *d,introw,intcol,intn){
APOP_ROW(d,row,vr);
APOP_COL(d,col, vc);
doublerowexp = apop_vector_sum(vr)/n;
doublecolexp = apop_vector_sum(vc)/n;
doubleobserved = apop_data_get(d, row,col);
doubleexpected = n *rowexp*colexp;
returngsl_pow_2(observed −expected)/expected;
}
doublecalc_chi_squared( apop_data *d){
doubletotal= 0;
intn= apop_matrix_sum(d −>matrix);
for(introw=0; row <d−>matrix−>size1;row++)
for(intcol=0; col <d−>matrix−>size2; col++)
total+= one_chi_sq(d,row, col,n);
returntotal;
}
intmain(){
doubledataline[] = {30,86,
24,38 };
apop_data *data = apop_line_to_data(dataline,0, 2, 2);
doublestat,chisq;
stat= calc_chi_squared(data);
chisq= gsl_cdf_chisq_Q(stat,(data −>matrix−>size1−1)*(data−>matrix−>size2−1));
printf("chi squared statistic: %g; p, Chi −squared:%g\n", stat,chisq);
apop_data_show(apop_test_anova_independence(data));
apop_data_show(apop_test_ﬁsher_exact(data));
}
Listing9.7 Pearson’s χ2test andFisher’s Exacttest. Online source: /CU/CX/D7/CW/CT/D6/BA .
(1922) calculatedthe probability of a given table using dir ect combinatorial com-
putation.TheequationsfortheFisherexacttestareamess, butthestoryisthesame
as above—its null hypothesis is that Up/Down and Left/Right are independent—
and its calculation is trivial: just call /CP/D4/D3/D4/CN/D8/CT/D7/D8/CN/CU/CX/D7/CW/CT/D6/CN/CT/DC/CP/D8 , as in the last
line ofListing 9.7./F4Scaling How would the calculation be affected if we replicated every count in
the data set into kcounts, so O′
UL=kOULandE′
UL=kEUL? Then
(O′
UL−E′
UL)2/E′
UL=k(OUL−EUL)2/EUL. Thatis, scaling the data setby k
scales the test statistic by kas well. For almost any data set, there exists a kfor
whichthenullhypothesiswill berejected.
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 315
Across data sets, the scale can easily be different, and stat istical signiﬁcance will
be easier to achieve in the set with the larger scale. General ly, it is tenuous to as-
sert that a data set with a test statistic in the 96thpercentile of the χ2distribution
divergesfromindependencelessthanadatasetwhosetestst atisticisinthe 99.9th
percentile. Use the test to establish whether the data rejec ts the null hypothesis,
thenuseothermethods(a simplecovariancewilloften do)to establishthemagni-
tudeofthedifference.
For comparison, prior tests involving the mean are not as sen sitive to scale. No-
tably, consider the ratio upon which the Central Limit Theor em is based, after
everyelementofthedatavector xis scaledby k:
mean/radicalbig
var/n=/summationtext(kx−kx)/n/radicalbig/summationtext(kx−kx)2/n2
=/summationtext(x−x)/radicalbig/summationtext(x−x)2.
Allelseequal,theratioofthemeanto/radicalbig
ˆσ2/n(oftenwritten ˆσ/√n)isnotaffected
by the scale of x, or even the number of elements in the data set, the way the χ2
statistic abovewasaffectedbyrescaling.
9.5 R EGRESSION In the priorchapter, weusedthe linearregressionmodelfor
purelydescriptivepurposes,toﬁndthebestwaytoproject y
ontoX. If we addthe assumptionthat ǫis Normally distributed, then we can also
test hypotheses regarding the parameter estimates. Given t his assumption, it can
beshownthatthe coefﬁcientsontheindependentvariables( theβvector)havea t
distribution,andthereforetheconﬁdencewithwhichanele mentof βdiffersfrom
anyconstantcanbecalculated(see,e.g.,Greene(1990,p15 8)).
The covariance matrix of βOLSisΣ =σ2(X′X)−1, where σ2is the variance of
the regression’s error term: if ǫis the vector of errors, and there are ndata points
andkregressors (including any constant column 1), then ǫ′ǫ/(n−k)provides
an unbiased estimate of σ2.8The estimated variance of β1is the ﬁrst diagonal
element, Σ11; the estimated variance of β2is the second diagonal element, Σ22;
andsoonforall βi.
As is typical for a test of a statistic of the data, the count of degrees of freedom
is data points minus constraints; speciﬁcally, for ndata points and kregression
parameters(including theoneattachedto theconstantcolu mn),d f=n−k.
8The form of the variance of the error term analogizes directl y with the basic one-variable unbiased estimate
of variance,Pn
i=1(xi−x)2/(n−1). First, the setup of OLS guarantees that ǫ= 0, soǫi−ǫ=ǫi, and
thusǫ′ǫmatches the numerator in the basic formula. Thedenominator in all cases is the degrees of freedom; for
example, with kregressors and ndata points, there are n−kdegrees of freedom.
gsl_stats March24,2009
316 CHAPTER 9
Giventhe estimatedvariance ˆσ2forβiand anyconstant c, we could write downa
test statistic|βi−c|/ˆσ, and then check that statistic against the tn−kdistribution
to test the claim that βi=c. This test bears a close resemblance to the test for
the mean of a data set (also a t-distributed scalar statistic) presentedon page 307.
If you have a joint hypotheses about contrasts among the elem ents of β, you can
directly apply the above discussion of Ftests: just use the estimated mean of β,
its covariancematrix Σ,andn−kdegreesoffreedom.
Comparison with ANOVA If a regression consists of nothing but dummy vari-
ables, then it can be shown that the process is equiv-
alentto theANOVA-style categorizationmethodsabove.
Q9.6Alaska is famously low on females, due to its many features th at distin-
guishitfromthelower48states.Createadummyvariablewhe re1=Alaska,
0=otherstate,andregressmalesperfemaleagainstboththe Alaskadummy
andpopulationdensity(andaconstant 1,ofcourse).Areoneorbothofthe
independentvariablessigniﬁcant?
Q9.7Run an independence test on the two-by-two table whose row ca tegories
are Alaska and not-Alaska, and whose column categories are m ales and
females. ( Hint: you will need to combine the population and males per fe-
males columns to produce a count for each region, then sum ove r all re-
gions.)
How does the test differ if you compare the percent male/fema le or the
totalcountofmales andfemalesin eachregion?What changes in the story
underlyingthe test,andwhichversionbetterrepresentsth ehypothesis?
OLS (along with its friends) has two real advantages over tes ting via crosstab
approaches like ANOVA. First, it readily handles continuou s variables, which
ANOVAcanhandleonlyvia approximationby roughcategories .
Second,itallowsthecomparisonofavastnumberofvariable s.ANOVAstypically
topoutatcomparingtwoindependentvariablesagainstoned ependent,butanOLS
regression could project the dependent variable into a spac e of literally hundreds
of independent variables. In fact, if you run such a regressi on, you are basically
guaranteedthatsomenumberofthosevariableswill besigni ﬁcant.
The multiple
testing problemFreedman (1983) showed the dangers of data snooping by ran-
domly generating a set of 51 columns of 100 random numbers
each.9He set one column to be the dependent variable to be ex-
9Data snooping used to also be called data mining , but that term has lost this meaning, and is now used to
refer to categorization techniques such as classiﬁcation t rees.
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 317
plained, and the other ﬁfty to be potential regressors. Usin g a simple exploratory
technique,heculledtheﬁfty potentialexplanatoryvariab lesdownto 15variables.
He then ran a 15-variable regression, and found that 14 varia bles were signiﬁcant
with a p-value better than 25%, and six were signiﬁcant with pbetter than 5%.
Other tests of the regressionalso indicated a good ﬁt. But th e data was pure noise
byconstruction.
Recall from the ﬁrst paragraph of this book that there are two goals of statistical
analysis, and they directly conﬂict. If a researcher spends too much time looking
fordescriptivestatisticsaboutthedata,thenheiscommit tinginformaldatasnoop-
ing, akin to Freedman’sinitial exploratoryregression,an dthus biasesthe chances
ofrejectinganullinherfavor.Butitwouldbefollyforther esearchertonotcheck
the data for outliers or other quirks before running the regr ession, or to embark
uponproducinganentirelynewdatasetfor everyregression .
What is the correct balance?Statistics has no answerto this , though most statisti-
ciansdo.Thoseinthedescriptive-orientedcampareveryse riousabouttheimpor-
tance of good graphical displays and viewing the data every w ay possible, while
thoseinthetesting-orientedcampbelievethatsomuchpre- testsearchingissimply
askingfor apophenia.
Here is another spin on the issue: people who are testing exac tly one hypothesis
tendtodevelopanaffectionforit, andbecomereluctantto r ejecttheirpethypoth-
esis. Thus, research as conducted by humans may improve if th ere are multiple
hypothesessimultaneouslycompeting.Chamberlin(1890,p 93)explains:
Lovewas long since representedas blind, and whatis true in t he per-
sonal realm is measurably true in the intellectual realm... . The mo-
mentonehasofferedanoriginalexplanationforaphenomeno nwhich
seems satisfactory, that moment affection for his intellec tual child
springs into existence; and as the explanation grows into a d eﬁnite
theory, his parental affections cluster about his intellec tual offspring,
and it grows more and more dear to him, so that, while he holds i t
seemingly tentative, it is still lovingly tentative.... Th e mind lingers
with pleasure upon the facts that fall happily into the embra ce of the
theory, and feels a natural coldness toward those that seem r efrac-
tory....Therespringsup,also,anunconscious...pressin gofthefacts
tomakethemﬁtthetheory....Thesearchforfacts,theobser vationof
phenomenaandtheirinterpretation,arealldominatedbyaf fectionfor
the favored theoryuntil it appearsto its authoror its advoc ateto have
beenoverwhelminglyestablished.Thetheorythenrapidlyr isestothe
ruling position, and investigation, observation, and inte rpretation are
controlledanddirectedbyit. Fromanundulyfavoredchild, it readily
becomesmaster,andleadsits authorwhithersoeverit will.
His solution, as above, is to test multiple hypotheses simul taneously. “The inves-
gsl_stats March24,2009
318 CHAPTER 9
tigator thus becomes the parent of a family of hypotheses; an d, by his parental
relation to all, he is forbidden to fasten his affections und uly upon any one.” He
also points out that maintaining multiple hypothesesallow s for complex explana-
tions about how an outcome was partly caused by one factor, pa rtly by another,
partly by another. After all, Nature is not compelled to conf orm to exactly one
hypothesis.
Apophenia’smodel-as-objectmakesitveryeasytotestormi xdiversehypotheses,
as per Chamberlin’s suggestion, and you will see more method s of comparing
modelsinlaterchapters.Butasthenumberofmodelsgrows,t heoddsoffailingto
rejectatleastonemodelpurelybychancegrowsaswell.Ther eisnohard-andfast
rule for determiningthe “correct”numberof modelsto test; justbearin mind that
thereis atensionamongmultiple goalsandabalanceto bestr uckbetweenthem.
Correcting for multiple testing Moving on from informally poking at the data,
considerthe casewhen the experiment’sbasic de-
sign involves a systematic, ﬁxed series of tests, like runni ng a separate test for
everygeneticmarkeramonga list of a million. Thisis knowna s themultiple test-
ingproblem ,andthereis asimple meansofcorrectingforit.
Saythatanumberisdrawnfrom [0,1],andthedrawislessthan pwithprobability
p. Then the probability that a draw is greater than pis1−p, and the probability
thatnindependentdrawsare all greaterthan pis(1−p)n, which canbe reversed
to saythatthe probabilitythatatleastoneof nindependentdrawsis lessthan pis
1−(1−p)n.
Thus, the probability that, out of ntests with a ﬁxed p-value, at least one will
indicateapositiveresultis ρ= 1−(1−p)n.Forexample,with p= 0.05andn=
100,thelikelihoodofrejectingthenullatleastonceis 1−(1−0.05)100≈99.4%.
Wecaninsteadﬁx ρatavaluelike 0.05or0.01, andreversetheaboveequationto
ﬁndthe p-valuefortheindividualteststhatwouldleadtorejection ofallnullswith
5% or1% likelihood.A line or two of algebrawill showthat p= 1−(1−ρ)1/n.
Forn= 100andρ= 0.05, you would need to set the p-value for the individual
tests to 0.0005128. In the example of testing n= 1,000,000genetic markers, if
the desired overall ρ= 0.05, then the p-value for the individual tests would be
5.129e−8.
There is a wonderfully simple approximation for the above ex pression: just let
p=ρ/n. For the ﬁrst example above, this approximation is 0.05/100 = 0 .0005;
for the second it is 0.05/1,000,000 = 5e−8. Both of these approximations are
within about±2.5%ofthe truevalue.
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 319
Thus,wehaveasimplerule,knownasthe Bonferronicorrection ,formultipletests:
justdividethedesiredoverall p-valuebythenumberofteststogettheappropriate
individual p-values.Thecorrectionisstandardinbiometricsbutvirtu allyunknown
in the socialsciences.When readingpapers with pagesof reg ressionsand no cor-
rections for multiple testing, you can easily apply this equ ation in your head, by
multiplying the reported individual p-value by the numberof tests and comparing
thatlargerﬁgureto theusualsigniﬁcancelevelsof 0.05or0.01.
®Because we know their expected mean and covariances, the reg res-
sion parameters for OLS, IV, WLS, and other such models can be
tested individually using the standard ttest, or tested as a group via
anFtest.
®Whenrunningabatteryofseveraltests(basedonaregressio noroth-
erwise), use the Bonferroni correction to create a more stri ngent sig-
niﬁcance level. The common form of calculating the more stri ngent
p-valueistosimplydividetheone-test p-valuebythenumberoftests.
9.6 G OODNESS OF FIT Thissectionwillpresentvariouswaystotestclaimsof
theformtheempiricaldistributionofthedatamatches
a certain theoretical distribution . For example, we often want to check that the
errors from aregressionare reasonablyclosetoa Normaldis tribution.
The visually appealing way to compare two distributions is t he Q–Q plot, which
stands for quantile–quantile plot. The ﬁrst (x,y)coordinate plotted is x1=the
ﬁrst percentile of your data and y1=the ﬁrst percentile of the distribution you
are testing, the second is x2=the second percentile of your data and y2=the
secondpercentileofthe idealdistribution, etcetera.Tot he extentthatthe dataﬁts
the ideal distribution, the points will draw out the x=yline, while digressions
from the line willstandout.
The ﬁrst half of Listing 9.9 presents an example, displaying a plot to check whe-
ther precipitation is Normally distributed. It gathers the data in the usual /CP/D4/D3/D4/CN/B9/D5/D9/CT/D6/DD/CN/D8/D3/CN/CS/CP/D8/CP manner, estimates the closest-ﬁtting Normal distribution , and
plots the percentiles of the data against the percentiles of the just-estimated dis-
tribution. As Figure 9.8 shows, the data set closely ﬁts the N ormal distribution
(thoughthe extremesofthe bottom tail is a bit more elongate dandthe extremeof
thetop taila bitlessso).
Q9.8Modify Listing 9.9 to test whether temperature or log of temp erature is
Normally distributed.Wouldanyotherdistribution ﬁtbett er?
gsl_stats March24,2009
320 CHAPTER 9
0.511.522.533.544.5
0.5 11.5 22.5 33.5 44.5Data percentiles
Normal percentiles+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Figure 9.8 Percentiles of precipitation on the yaxis plottedagainst percentiles of the Normal distri-
butionalong the xaxis.
#include <apop.h>
intmain(){
apop_db_open("data −climate.db");
apop_data *precip= apop_query_to_data("selectPCPfrom precip");
apop_model *est =apop_estimate(precip,apop_normal);
Apop_col_t(precip,"PCP", v);
apop_plot_qq(v, *est, "outﬁle.gnuplot");
doublevar = apop_vector_var(v);
doubleskew = apop_vector_skew(v)/pow(var, 3/2);
doublekurt = apop_vector_kurtosis(v)/gsl_pow_2(var) −3;
doublestatistic= v−>size*(gsl_pow_2(skew)/6.+ gsl_pow_2(kurt)/24.);
printf("The skew is %g,the normalized kurosis is %g, "
"and wereject the null that your data isNormal with%gconﬁde nce.\n",
skew,kurt,gsl_cdf_chisq_P(statistic, 2));
}
Listing9.9 Pull data; estimate the Normal that best ﬁts the d ata; plot the data against the ideal
distribution.The output ispresented inFigure 9.8. Online source: /D5/D5/D4/D0/D3/D8/BA .
HIGHER MOMENTS A slightly more rigorous alternative means of testing for No r-
mality is to check the higher moments of the Normal distri-
bution (Bowman & Shenton, 1975; Kmenta, 1986, pp 266–267). T here is a more
generalchi-squaredgoodness-of-ﬁttestforanydistribut ion below.
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 321
A Normal distribution has only two parameters, the mean and t he standard de-
viation, and everything else about the Normal distribution is deﬁned therefrom.
Notably,thethird momentis zero,andthe fourth momentis 3σ4.
Wealreadyhaveeverythingweneedtocalculatethedistribu tionofthesestatistics.
The skew and kurtosis are both the mean of an iid process(reca ll their deﬁnitions
on page 230: a sum divided by n), so their square is ∼χ2. Letsbe the third
moment of the data divided by σ3and let κbe the fourth moment divided by σ4.
Then
Ls=n/bracketleftbiggs2
6/bracketrightbigg
hasaχ2distribution with onedegreeoffreedom,asdoes
Lk=n/bracketleftbigg(κ−3)2
24/bracketrightbigg
.
Somepreferto testbothsimultaneouslyusing
Lsk=n/bracketleftbiggs2
6+(κ−3)2
24/bracketrightbigg
,
whichhasa χ2distribution with two degreesoffreedom.
The second half of Listing 9.9 translates this formula into c ode. Given the Q–Q
plot,itisnosurprisethatthetestsoundlyfailstorejectt henullhypothesisthatthe
datais Normally distributed.
Another alternative, keeping with the theme of this book, wo uld be to bootstrap
thevarianceofthekurtosis,whichwouldletyouﬁndaconﬁde nceintervalaround
3σ4andstatewithsomepercentageofcertaintythatthekurtosi sisorisnotwhere
it shouldbe;this suggestionisputinto practiceonpage365 .
CHI-SQUARED GOODNESS -OF-FIT TEST Saythatwehaveahistogramandavec-
tor of points that we claim was drawn
from that histogram. It would be nice to test the conﬁdencewi th which our claim
holds;this is agoodness-of-ﬁttest.
Mathematically, it is simple. We have kbins, and two histograms: /CW/BCholds the
histogram from which the draws were allegedly made, and /CW/BDholds the data.10
Then
10Recallfrompage314thatscaling mattersfora χ2test:thehistogramsrepresenting twoPDFswilleachsum
toone(bydeﬁnition),whileahistogramrepresenting thede nsityofapopulation ofsize nwillhavebinssumming
ton(bydeﬁnition). Thatmeansthat the χ2statistics foratestofthePDFsandatestofthedistributio n ofcounts
will be different, with the null more likely to be rejected fo r the distribution of counts. So when investigating a
histogram, be careful that you are testing the right hypothe sis; claims about the distribution of a population are
typically best represented by atest of the PDFs( Σ = 1) rather than the counts ( Σ =n).
gsl_stats March24,2009
322 CHAPTER 9
k/summationdisplay
i=0(h0−>bins[i]−h1−>bins[i])2
h0−>bins[i]∼χ2
k−1. (9.6.1)
Youwillrecognizethisformasmatchingthe (observed-expected)2/expected form
from the ANOVAtestsearlierin this chapter.
Q9.9On page173, you plotted the leading digit of an arbitrary dat a set, and saw
that it sloped sharply down. Now use a chi-squared goodness o f ﬁt test to
formally checkthatyourdatasetﬁts Equation5.4.1.
• Write a functionto producea vectorofnineelements,with t hecount
of elements in each slot equal to the number of data points wit h the
givenleadingdigit.Don’tforgetthatvectorscountfrom ze robutyou
want the ﬁrst slot to represent leading digit one, and to resc ale your
ﬁnalvectorsothatitis aPMF (i.e., its elementssumto one).
• Equation 5.4.1 isn’t quite a PMF: the sum of its values from o ne to
nine isn’t one. Thus, you will need to get the total mass, and r escale
yourcalculationsfrom Benford’sequationaccordingly.
• Once you have two nine-element vectors of equal mass, you ca n di-
rectly apply Expression 9.6.1 to ﬁnd the χ2statistic and run the χ2
test.
1#include <apop.h>
2
3intmain(){
4 apop_db_open("data −climate.db");
5apop_data *precip= apop_query_to_data("selectPCPfrom precip");
6apop_model *est =apop_estimate(precip,apop_normal);
7gsl_rng*r =apop_rng_alloc(0);
8apop_model *datahist = apop_estimate(precip,apop_histogram);
9apop_model *modelhist = apop_histogram_model_reset(datahist,est,1 e6, r);
10 apop_data_show(apop_histograms_test_goodness_of_ﬁ t(datahist,modelhist));
11 }
Listing9.10 The same precipitationdata, another test.Onl ine source: /CV/D3/D3/CS/CU/CX/D8/BA .
Listing 9.10 tests whether the precipitation data is Normal ly distributed using the
χ2goodness-of-ﬁttest.
• Lines1–6are arepeatofthequeryandestimationfrom /D5/D5/D4/D0/D3/D8/BA (page320).
gsl_stats March24,2009
HYPOTHESIS TESTING WITH THE CLT 323
• Lineeightturnstheinputdataintoahistogram.Noticetha titusesthesame /CP/D4/D3/D4/CN/B9/CT/D7/D8/CX/D1/CP/D8/CT form as other models, because a histogram is just another mea ns of
expressingamodel.
• You can’t do a goodness-of-ﬁt test on just any two histogram s: the bins have to
match,inthesensethattherangeofeachbinintheﬁrsthisto gramexactlymatches
therangeinthecorrespondingbinofthesecond.Theeasiest waytoensurethattwo
histogramsmatchistogeneratethesecondhistogramusingt heﬁrstasatemplate,
which is what /CP/D4/D3/D4/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1/CN/D1/D3/CS/CT/D0/CN/D6/CT/D7/CT/D8 does. If we wanted to compare
two vectorsviathis test, this linewould use /CP/D4/D3/D4/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1/CN/DA/CT/D8/D3/D6/CN/D6/CT/D7/CT/D8 .
• Thenewhistogramgetsﬁlledviarandomdrawsfromthemodel ,whichmeansthat
we need to give /CP/D4/D3/D4/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1/CN/D1/D3/CS/CT/D0/CN/D6/CT/D7/CT/D8 the number of draws to make
(here, 1e6), and a /CV/D7/D0/CN/D6/D2/CV to provide random numbers. The use of the /CV/D7/D0/CN/D6/D2/CV
is coveredin fullon page357.
• Bylineten,wehavetwohistogramsrepresentingthedataan dthemodel,andthey
are in sync. Thus, it is a simple matter to send the histograms to /CP/D4/D3/D4/CN/CW/CX/D7/D8/D3/B9/CV/D6/CP/D1/D7/CN/D8/CT/D7/D8/CN/CV/D3/D3/CS/D2/CT/D7/D7/CN/D3/CU/CN/CU/CX/D8 to calculatethe statistic in Expression9.6.1.
KOLMOGOROV ’S
METHODKolmogorov(1933)suggestedconsideringthestepsinahist ogram
to be a Poisson process, and developed a test based upon this
parametrization[seealsoConover(1980)].Giventwohisto grams
produced using one of the above-mentioned methods, /CP/D4/D3/D4/CN/D8/CT/D7/D8/CN/CZ/D3/D0/D1/D3/CV/D3/D6/D3/DA
ﬁnds the maximum difference in the CMFs and ﬁnd the probabili ty that such a
CMF would occur if both histograms were from the same base dat a set. Because
thistestusestheorderingoftheslicesofthePMF,whilethe Chi-squaredtestdoes
not,this testgenerallyhashigherpower.
Kolmogorov’stestservesasyetanothertestforNormality, becauseitcancompare
adataset’sCDF to thatofaNormaldistribution.
Q9.10Is GDPpercapitalog-normally distributed?
• Pullthe logofGDPpercapitadatafrom the /CS/CP/D8/CP/B9/DB/CQ/BA/CS/CQ dataset.
• Createa histogram(i.e.,estimate an /CP/D4/D3/D4/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1 model).
• Fit a Normal distribution and use it to create a matching his togram
using /CP/D4/D3/D4/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1/CN/D1/D3/CS/CT/D0/CN/D6/CT/D7/CT/D8 .
• Sendthetwo histogramsto /CP/D4/D3/D4/CN/D8/CT/D7/D8/CN/CZ/D3/D0/D1/D3/CV/D3/D6/D3/DA .
• How do the test results compare with those produced by /CP/D4/D3/D4/CN/B9/CW/CX/D7/D8/D3/CV/D6/CP/D1/D7/CN/D8/CT/D7/D8/CN/CV/D3/D3/CS/D2/CT/D7/D7/CN/D3/CU/CN/CU/CX/D8 ?
gsl_stats March24,2009
324 CHAPTER 9
Q9.11Howaboutprecipitation?Figure9.8gavethestrongsuggest ionthatthedata
is Normally distributed; modify the code from the lastexamp leto formally
test the hypothesis that the data set is drawn from a Normal di stribution
usingthe Kolmogorov–Smirnovmethod.
®The Q–Q (quantile-to-quantile) plot gives a quick visual im pression
of whether the distribution of the data matches that of a theo retical
distribution.
®We can test the claim that a data set is Normally distributed u sing
the fact that the skew and kurtosis of a Normal distribution a re ﬁxed
(giventhe meanandvariance).
®More generally, we can compare any two distributions by divi ding
them into bins and comparing the square of the deviation of on e dis-
tribution from anotherviaa χ2test.
®The Kolmogorov–Smirnov test offers another method for comp ar-
ing two distributions, which typically has more power than t he Chi-
squaredmethod.
gsl_stats March24,2009
10
MAXIMUM LIKELIHOOD ESTIMATION
Since the fabric of the universe is most perfect and the work o f a most wise Creator,
nothingatalltakesplaceintheuniverseinwhichsomeruleo fmaximumorminimum
does not appear.
—Leonhard Euler1
Whetherbydivinedesignorhumanpreference,problemsinvo lvingthesearchfor
optimaareeverywhere.Tothispoint,mostmodelshavehadcl osed-formsolutions
for the optimal parameters, but if there is not a nice computa tional shortcut to
ﬁndingthem,youwillhavetohuntforthemdirectly.Therear eavarietyofroutines
toﬁndoptima,andApopheniaprovidesaconsistentfront-en dtomanyofthemvia
its /CP/D4/D3/D4/CN/D1/CP/DC/CX/D1/D9/D1/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS function.
Given a distribution p(·), the value at one input, p(x), islocal information : we
need to evaluatethe function at only one point to write down t he value. However,
the optimum of a function is global information , meaning that you need to know
thevalueofthedistribution ateverypossibleinputfrom x=−∞uptox=∞in
orderto knowwheretheoptimum is located.
This chapter will begin with the simple mathematical theory behind maximum
likelihood estimation ( MLE), and then confront the engineering question of how
wecanﬁndtheglobaloptimumofafunctionbygatheringlocal informationabout
asmallnumberofpoints.Oncetheprerequisitesareinplace ,theremainderofthe
chaptercoversMLEsin practice,bothfordescriptionandte sting.
1Letter to Pierre-Louis Moreau de Maupertuis, c. 1740–1744, cited in Kline (1980, p 66).
gsl_stats March24,2009
326 CHAPTER 10
10.1 L OG LIKELIHOOD
AND FRIENDSTo this point, we have met many probability distri-
butions,whosePDFswerelisted in Sections7.2and
9.2.Thissectiontakessuchaprobabilitydistribution
P(X,β)as given, and from that produces a few variant and derivative functions
thatwillprovetobeeasiertoworkwith.Also,areminder:th ereisalistofnotation
forthebookonpage12.
Letx1andx2be twoindependent, identical draws (iid) from a distribution. The
independence assumption means that the joint probability i s the product of the
individual probabilities; that is, P({x1andx2},β) =P(x1,β)·P(x2,β). The
assumption of identical distributions (i.e., that both are draws from the same dis-
tribution P(·,β)) allowsusto write this more neatly,as
P({x1andx2},β) =/productdisplay
i={1,2}P(xi,β).
A probability function gives the probability that we’d see t he data that we have
given some parameters; a likelihood function is the probability that we’d see the
speciﬁed set of parameters given some observeddata. The phi losophicalimplica-
tionsofthis distinctionwill bediscussedfurther below.
There are three basic transformations of the likelihood fun ction that will appear
repeatedly,andareworth gettingto know.
Deﬁnethe loglikelihoodfunction asLL≡lnP(x,β)|x,thescoreasitsderivative
with respectto β:
S≡
∂lnP
∂β1...
∂lnP
∂βn
=
∂LL
∂β1...
∂LL
∂βn
,
and theinformation matrix as the negation of derivative of the score with respect
toβ.
I=−∂S
∂β
=−
∂2LL
∂β2
1···∂2LL
∂βnβ1.........
∂2LL
∂β1βn···∂2LL
∂β2
n
.
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 327
An example: Bernoulli SaythatwehaveninedrawsfromaBernoullidistribution,
whichyouwillrecallfrompage237meansthateachdraw
isonewithprobability pandiszerowithprobability 1−p,andsaythatinourcase
ﬁve draws were ones and four were zeros. The likelihood of dra wing ﬁve ones is
p5; the likelihood of drawing four zerosis (1−p)4; putting them togethervia the
independenceassumption,the likelihood of an arbitrary va lue of pgiven this data
setxis
P(x,p)|x=p5·(1−p)4.
Theloglikelihood isthus
LL(x,p) = 5ln( p) + 4ln(1−p).
Thescore,in this caseaone-dimensionalvector,is
S(x,p) =5
p−4
(1−p), (10.1.1)
andtheinformation value(a 1×1matrix) is
I(x,p) =5
p2+4
(1−p)2.
Both intuitively and for a number of reasons discussed below , it makes sense to
focusonthemostlikelyvalueof p—thatis,thevaluethatmaximizes P(x,p)given
our observed data x. Since the log is a monotonic transformation, pmaximizes
P(x,p)if and only if it maximizes LL(x,p). Recall from basic calculus that a
necessary condition for a smooth function f(x)to be at a maximum is thatd f
dx=
0—in the case of LL(x,p), thatS(x,p) = 0. Setting Equation 10.1.1 to zero and
solvingfor pgivesp=5
9.
But a zero derivativecanindicate either a maximum or a minim um; to tell which,
look at the second derivative. If the second derivative is ne gative when the ﬁrst
derivative is zero, then the ﬁrst derivative is about to beco me negative—thefunc-
tion is beginning to dip downward. At this point, the functio n must be at a maxi-
mum andnotaminimum.
Since the information matrix is deﬁned as the negation of the score’s derivative,
we can check that we are at a maximum and not a minimum by verify ing that the
information value is positive—and indeed it is: for p= 5/9,I≈4.05. In more
dimensions,theanalogisthattheinformationmatrixmustb epositivedeﬁnite ;see
theexerciseonpage269.
Tosummarize,given p=5
9,P≈0.0020649,LL≈−6.182,S= 0,andI≈4.05.
It is easyto checkothervaluesof pto verify thattheyproducelowerprobabilities
ofobservingthegivendata.
gsl_stats March24,2009
328 CHAPTER 10
Q10.1Verify theabovestatements.
• Generateadatasetwhosematrixelementincludesﬁveonesa ndfour
zeros(in anyorder). Putthe datasetin aglobalvariable.
• Produceanoutputmodelvia /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT/B4 /DD/D3/D9/D6/CN/CS/CP/D8/CP /B8 /CP/D4/D3/D4/CN/B9/CQ/CT/D6/D2/D3/D9/D0/D0/CX/B5 .
• Displaytheoutputmodelvia /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0/CN/D7/CW/D3/DB ;checkthattheprob-
ability is asitshouldbe(i.e., 5/9 =.555).
• Write a function that takes in an /CP/D4/D3/D4/CN/CS/CP/D8/CP struct holding a vector
with one item, and returns the log likelihood of that paramet er given
theglobaldata,using /CP/D4/D3/D4/CN/D0/D3/CV/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS .
• Send that function to your /D4/D0/D3/D8/CP/CU/D9/D2/D8/CX/D3/D2 routine from page 191
(withtherange [0,1])andverifythattheloglikelihoodisatitshighest
wheretheparameteris 5/9.
An example: Probit Recall the Probit model from page 283. It speciﬁed that an
agent would act iff its utility from doing so is greater than a
Normally-distributed errorterm. Thatis, actwith probabi lity
P(x,β) =/integraldisplayxβ
−∞N(y|0,1)dy,
whereN(y|0,1)indicatesthestandardNormalPDFat y(andsotheintegralisthe
CDFupto xβ).
Reversingthis,let xAbethesetof x’s thatledto actionand xNbethesetthatled
to non-action.Thenthe likelihoodof βgiventhedatasetis
P(x,β)|x=/productdisplay
i∈AP(xA
i,β)·/productdisplay
i∈N/parenleftbig
1−P(xN
i,β)/parenrightbig
,
so
LL(x,β)|x=/summationdisplay
i∈AlnP(xA
i,β) +/summationdisplay
i∈Nln/parenleftbig
1−P(xN
i,β)/parenrightbig
.
Bythe way,thelogit(Equation8.3.1,page284)tells the sam estory,butit simpli-
ﬁessigniﬁcantly,to
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 329
LL(x,β)|x=/summationdisplay
i∈AxA
iβ−/summationdisplay
∀iln/parenleftig
1 +exiβ/parenrightig
,
where the ﬁrst term counts only those who act, while the secon d includes every-
body.[ Q: Verify thelog likelihoodusingEquation8.3.1.]
Unlike the binomial example above, we can not ﬁnd the optimum of the log like-
lihoodfunctionforeithertheprobitorlogitusingjustade rivativeandsomequick
algebra.Wewill insteadneedtouseasearchmethodsuchasth osediscussedlater
in this chapter./F4ADIGRESSION : THE
PHILOSOPHY OF NOTATIONThe probability function has a frequentist interpre-
tation: if you give me a ﬁxed distribution, the story
behind it, and a ﬁxed parameter β, then after a few
million draws, xwill occur P(x,β)|β·100percent of the time. The likelihood
functionhasnosuchinterpretation,becauseweassumethat thedatawasproduced
using one model that had a ﬁxed β, that we happen to be ignorant of. There is no
mysteriouspoolof β’s from whichourswasdrawnwith someprobability.
Thus, the probability of xgivenβ(and a model) is in many cases an objectively
veriﬁable fact; the likelihood of βgivenx(and a model) is a subjective construct
that facilitates various types of comparison among β’s. The integral over all xis
always one (i.e., for any ﬁxed β,/integraltext
∀xP(x,β)dx= 1). The integral over all βof
thelikelihood function,however,couldbeanything.
RonaldAylmerFisher, the famed eugenicistandstatisticia n whosetechniquesap-
pearthroughoutthisbook,wasvehementaboutkeepingaclea rdistinction:“...[I]n
1922,Iproposedtheterm‘likelihood,’inviewofthefactth at,withrespectto[the
parameter],itis nota probability,anddoesnotobeythelaw sofprobability, while
at the same time it bears to the problem of rational choice amo ng the possible
values of [the parameter] a relation similar to that which pr obability bears to the
problemofpredictingeventsingamesofchance....Whereas ,however,inrelation
to psychological judgment, likelihood has some resemblanc e to probability, the
twoconceptsarewhollydistinct....”(Fisher,1934,p287) SeePawitan(2001)for
moreon theinterpretation oflikelihoodfunctions.
But as a simple practical matter, the probability of xgiven ﬁxed parameter βis
P(x,β), and the likelihood of βgiven ﬁxed data xis the very same P(x,β). At
the computer, there is no point writing down separate functi ons /D4/B4/DC/B8 /CQ/CT/D8/CP/B5and/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS/B4/CQ/CT/D8/CP/B8 /DC/B5—a single function will serveboth purposes.Justﬁx xto
producea likelihood function over β, and ﬁx βto get a probability distribution of
valuesof x.
gsl_stats March24,2009
330 CHAPTER 10
We have two choices for notation, both of which can lead to con fusion. The ﬁrst
is to use two distinct function names for probability and lik elihood— P(x)and
L(x)aretypical—whichclariﬁesthephilosophicaldifferences andleavesittothe
readerto recognizethattheyarenumericallyidentical, an dthatbothare functions
ofxandβ. The secondoption is to use a single function for both, which clariﬁes
the computational aspects, but leaves the reader to ponder t he philosophical im-
plications of a single function that produces an objective p robability distribution
whenviewedonewayandasubjectivelikelihoodfunctionwhe nviewedthe other
way.2Because this book is centrally focused on computation, it ta kes the second
approachoflisting both probabilityandlikelihoodusingt hesame P(x,β)form.
MORE ON LL,S,ANDIThe log of the likelihood function has a number of di-
vineproperties,whichadduptomakingtheloglikelihood
preferable to the plain likelihood in most cases—and wait un til you see what the
scorecando.
First, due to all that exponentiation in the distributions o f Sections 7.2 and 9.2,
lnPis often much easier to deal with, yet is equivalent to P(·)for most of our
purposes—notably, if we have found a maximum for one, the we h ave found a
maximumforthe other.
Also, considercalculatingan iid likelihood function give na thousanddatapoints.
The probability of observing the data set will have the form/producttext1000
i=1P(xi). Since
eachP(xi)∈(0,1], this product is typically on the order of 1×10−1000. As
discussed on page 137, such a number is too delicate for a comp uter to readily
dealwith. Takinglogs,eachvalueof piis now a negativenumber(e.g., ln(0.5)≈
−0.69andln(0.1)≈−2.3), andthe productaboveisnowasum:
ln/bracketleftigg1000/productdisplay
i=1P(xi)/bracketrightigg
=1000/summationdisplay
i=1ln(P(xi)).
Thus, the log likelihood of our typical thousand-point data set is on the order of
−1000instead of 1×10−1000—much more robust and manageable. You saw an
example of these different scales with the nine-point sampl e in the Bernoulli ex-
ample,whichhad p≈0.002butLL≈−6.
Analytically,themaximumoftheloglikelihoodfunctionis usefulfortworeasons
with four names:the Cramér–Rao lower bound and the Neyman–P earsonlemma.
Itall beginswith thisusefulproperty ofthescore:3
2There are consistent means of describing subjective probab ility that accommodate both ways of slicing
P(x, β). Thesubjectivist approach (closely related to the Bayesian approach) takes all views of P(x, β)as
existing onlyinourminds—nomatter howyousliceit,theren eed notbeaphysical interpretation. Theaxiomatic
approach, led by Ramsey, Savage, and de Finetti, posits a few rules that lead to ‘consistent’ subjective beliefs
when followed, butplaces no further constraints on either p robability or likelihood. Again, once both probability
and likelihood areaccepted as subjective beliefs, there is less reason to distinguish them notationally.
3Allproofsherewillbeinthecasewhere βisascalar. Proofsforthemultidimensional caseareanalog ous but
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 331
Theorem 10.1.1. IfP(x,β)satisﬁes certain regularity conditions as described
in thefootnote,4thenfor anystatistic f(x),
Ex(S·f) =∂Ex(f)
∂β.
That is, the score is a sort of derivative machine: the expect ed value of the score
timesastatisticisequivalenttothederivativeoftheexpe ctedvalueofthestatistic.
Findinganoptimumrequiresﬁndingthepointwherethederiv ativeiszeroandthe
second derivative is negative, and this theorem gives us an e asy trick for ﬁnding
thosederivatives.Thenextfew pageswill showhowthistric k isused.
Whenreading this theorem, it is worth recalling the sleight -of-notation from page
257:f(x)isa functiononlyofthedata,but Ex(f(x))(where xisproducedusing
acertain modelandparameters)is afunction onlyofthepara meters./F4Proof:Theexpectedvalueofthescoretimes thestatistic is
Ex(S·f)=/integraldisplay
∀xS(β)f(x)P(x,β)dx
=/integraldisplay
∀x∂lnP(x,β)
∂βf(x)P(x,β)dx (10.1.2)
=/integraldisplay
∀x∂P(x,β)
∂β
P(x,β)f(x)P(β,x)dx (10.1.3)
=/integraldisplay
∀xf(x)∂P(x,β)
∂βdx
=∂/parenleftbig/integraltext
∀xf(x)P(x,β)dx/parenrightbig
∂β(10.1.4)
=∂Ex(f(x))
∂β(10.1.5)
require moreinvolved notation.
4Equation 10.1.4oftheproofusestheclaimthatR
f·dP
dβdx=d
dβR
f·Pdx.Ifwecan’treverse theintegral
and derivative like this, none of this applies.
The common explanation for when the switch is valid is in the c ase of any exponential family; the deﬁnition
of an exponential family will not be covered in this book, but rest assured that it applies to the Normal, Gamma,
Beta, Binomial, Poisson, et cetera—just about every distri bution butthe Uniform.
But it also applies more generally: we need only uniform conv ergence of the PDF as its parameters go to any
given limit (Casella & Berger, 1990, Section 2.4).Roughly, this is satisﬁed for any PDF whosevalue and deriva-
tive are always ﬁnite. For those who prefer the exponential f amily story, note that any PDF can be approximated
arbitrarily closely by a sum of exponential-family distrib utions (Barron & Sheu, 1991), so for any distribution
that fails, there is an arbitrarily close distribution that works. For example, the Uniform [β1, β2]distribution fails
because of the inﬁnite slope at either end, but a distributio n with a steep slope up between β1−1e−10andβ1
and a steep slopedown between β2andβ2+ 1e−10works ﬁne.
gsl_stats March24,2009
332 CHAPTER 10
The sequence of events consisted of substituting in the deﬁn ition of the score
(Equation 10.1.2), then substituting the familiar form for the derivative of the log
(Equation 10.1.3), and canceling out a pair of P(x,β)’s. At this point, the simple
weighting P(x)(ﬁrst introducedonpage221)hasbeenreplacedwith the weig ht-
ingdP(x). Before, if x1was twice as likely as x2(i.e.,P(x1) = 2P(x2)), then
f(x1)would get double weighting. Now, if the slope of P(x)atx1is twice as
steepasthe slopeat x2, thenf(x1)getsdoubleweighting.
The ﬁnal steps state that, under the right conditions, the in tegral of f(x)using a
measurebasedon dP(x)isequivalenttothederivativeoftheintegralof f(x)using
a measure based on P(x). Equation 10.1.4 switched the integral and derivative,
using the assumptions in the theorem’s footnote, and Equati on 10.1.5 recognized
theintegralasanexpectationunderthegivenprobability d ensity. /diamondsolid
Corollary 10.1.2.
E(S) = 0.
Proof:Letthestatistic f(x)bethetrivialfunction f(x) = 1.ThenTheorem10.1.1
tells usthat E(S·1) =∂E(1)/∂β= 0.
Q10.2Verify that the expectedvalue of the score is zero for a few of the distribu-
tions given in Chapter 7, such as the Exponential on page 248. (Hint: you
willneedtocalculatetheintegraloftheexpectedvalueoft hescoreoverthe
rangefrom zerotoinﬁnity; integrationbypartswill help.)
Lemma 10.1.3. Theinformationequality
var(S) =E(S·S) =E(I)./F4Proof:Theﬁrsthalfcomesfromthefactthat var(S) =E(S·S)−E(S)·E(S),
butwe justsawthat E(S) = 0.
Forthesecondhalf,writeout E(I),usingtheexpansionof S=/parenleftbigg
∂P(x,β)
∂β
P(x,β)/parenrightbigg
andthe
usualrules fortakingthe derivativeofa ratio.
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 333
E/bracketleftbigg∂2lnP(x,β)
∂β/bracketrightbigg
=E
∂/parenleftbigg
∂P(x,β)
∂β
P(x,β)/parenrightbigg
∂β

=E
P(x,β)∂2P(x,β)
∂β2−/parenleftig
∂P(x,β)
∂β/parenrightig2
(P(x,β))2

=E
∂2P(x,β)
∂β2
P(x,β)−S·S

=−E[S·S]
Q:Provetheﬁnalstep,showingthat E/bracketleftbigg
∂2P(x,β)
∂β2
P(x,β)/bracketrightbigg
= 0.(Hint:usethelessonsfrom
the proof of Theorem10.1.1 to write the expectationas an int egraland switch the
integralandoneofthederivatives.) /diamondsolid
The information equality will be computationally convenie nt because we can re-
place a variance, which can be hard to directly compute, with the square of a
derivativethatweprobablyhadto calculateanyway.
For the culmination of the sequence, we need the Cauchy–Schw arz inequality,
which ﬁrst appeared on page 229. It said that the correlation between any two
variablesrangesbetween −1and1. Thatis,
−1≤ρ(f,g) =cov(f,g)/radicalbig
var(g)var(f)≤1
cov(f,g)2
var(g)var(f)≤1
cov(f,g)2
var(g)≤var(f). (10.1.6)
Lemma 10.1.4. TheCramér–Raolowerbound
Letf(x,β)be any statistic, and assume a distribution P(x,β)that meets the cri-
teria from the priorresults.Then
−(∂Ex(f(x,β))/∂β)2
E(I)≤var(f(x,β)). (10.1.7)
gsl_stats March24,2009
334 CHAPTER 10
The proof consists of simply transforming the Cauchy–Schwa rz inequality using
theabovelemmas.Let ginEquation10.1.6bethescore;thentheequationexpands
to
(Ex(f(x)·S)−Ex(f(x))Ex(S))2
var(S)≤var(f(x)) (10.1.8)
The left-hand side has three components, each of which can be simpliﬁed using
oneofthe aboveresults:
•Ex(f(x,β)·S) =∂f(x,β)/∂β, byTheorem10.1.1.
• Corollary10.1.2said E(S)iszero,sothesecondhalfofthenumeratordisappears.
• Theinformation equalitystatesthatthat var(S) =E(I).
Applyingalltheseatoncegivesthe Cramér–Raolowerbound.
Further, MLEs have a number of properties that let us further tailor the CRLB to
say still more.5Let the statistic f(x)be the maximum likelihood estimate of the
parameter, MLE (x,β).
• MLEscanbebiasedforﬁnitedatasets,butcanbeshowntobea symptoticallyun-
biased. This means that for nsufﬁciently large, E(MLE (x,β)) =β. Therefore,
∂MLE (x,β)/∂β= 1, so the numerator on the left-hand side of Equation 10.1.7
isone.
• It can be proven that maximum likelihood estimators actual ly achieve the CRLB,
meaningthatin this casetheinequalityin Equation10.1.7i san equality.
• Theinformationmatrix isadditive:Ifonedatasetgivesus I1andanothergivesus
I2,thenthetwotogetherproduce Itotal=I1+I2.Forasetofiiddraws,eachdraw
has the same amountof information (i.e., the expectedinfor mation matrix, which
isapropertyofthedistribution,notanyonedrawofdata),s othetotalinformation
fromndatapoints is nI.
The end result is the following form, which we can use to easil y calculate the
covariancematrix oftheMLE parameterestimates.
var(MLE (x,β)) =1
nEx(I). (10.1.9)
Equation10.1.9makesMLEsthecornerstoneofstatisticsth attheyare.Giventhat
MLEs achieve the CRLB for large n, they are asymptotically efﬁcient, and if we
want to test the parameter estimates we ﬁnd via a torFtest, there is a relatively
5SeeCasella & Berger (1990, pp 310–311) for formal proofs of t he statements in this section.
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 335
easycomputationfor ﬁnding the varianceswe would needto ru n sucha test.6For
many models (simulations especially), we want to know wheth er the outcome is
sensitive to the exact value of a parameter, and the informat ion matrix gives us a
sensitivitymeasureforeachparameter.
HOW TO EVALUATE A TEST Ahypothesistestcanbefooledtwoways:thehypoth-
esiscouldbetruebutthetestrejectsit, orthehypoth-
esiscouldbefalsebutthetestfails to rejectit.
Evaluationvocab
Here are some vocabulary terms; if you are in a stats
classright now, youwillbe testedonthis:
Likelihood of a Type I error≡α: rejecting the null
whenitis true.
Likelihood of a Type IIerror≡β: accepting the null
whenitis false.
Power≡1−β: the likelihood of rejecting a false
null.
Unbiased :(1−β)≥αfor allvalues of the parame-
ter.I.e.,you arelesslikelytoaccept the nullwhenitis
false thanwhenit istrue.
Consistent : the power→1asn→∞.There is a balance to be struck be-
tween the two errors: as one rises,
the other falls. But not all tests are
bornequal.Ifahypothesishasa50–
50 chance of being true, then the
coin-ﬂip test, ‘heads, accept; tails,
reject’ gives us a 50% chance of
a Type I error and a 50% chance
of a Type II error, but in most sit-
uations there are tests where both
errors are signiﬁcantly lower than
50%. By any measure we would
call those better tests than the coin-
ﬂippingtest.
A big help in distinguishing Type I from Type II error is that o ne minus the Type
II error rate hasthe surprisingly descriptivenameof power.To a high-powertele-
scope, every star is slightly different—some things that se em like stars are even
galaxies or planets. But to a low-power lens like the human ey e, everything just
looks like a little dot. Similarly, a high-power test can det ect distinctions where a
low-powertestfails to rejectthe nullhypothesisofnodiff erence.Or, forthemore
cynical:sincemostjournalshavelimitedinterestinpubli shingnullresults,ahigh-
power test increases the odds that you will be able to publish results. As you can
imagine,researchersare veryconcernedwith maximizingpo wer.
THENEYMAN–PEARSON LEMMA TheNeyman–Pearsonlemma(Neyman&Pear-
son, 1928a,b) states that a likelihood ratio test
will have the minimum possible Type II error—the maximum pow er—of any test
with a given level of α. After establishing this fact, we can select a Type I error
level and be conﬁdent that we did the best we could with the Typ e II errors by
usingalikelihoodratio test.
6Of course, if we run one of the tests from Chapter 9 derived fro m the CLT, then we need to make sure the
CLT holds for the maximum likelihood estimate of the statist ic in question. This could be a problem for small
data sets; for large data sets or simulations based on millio ns of runs,it is less of aconcern.
gsl_stats March24,2009
336 CHAPTER 10
Likelihood ratios Say the cost of a test that correctly accepts or rejects the hy -
pothesis is zero, the cost to a Type I error is CI, and the cost
to a Type II error is CII. Then it is sensible to reject H0iff the expected cost
of rejecting is less than the expected cost of not rejecting. That is, reject H0iff
CIP(H0|x)< CIIP(H1|x). Wecantranslatethiscost-minimizationruleintothe
ratio oftwo likelihoods.
RecallBayes’srule from page258:
P(A|B) =P(B|A)P(A)
P(B).
To applyBayes’srule to the rejection test, set A=H0andB=x, soP(A|B) =
P(H0|x)andP(B|A) =P(x|H0)(andsimilarly for H1). Then:
CIP(H0|x)< CIIP(H1|x) (10.1.10)
CIP(x|H0)P(H0)
P(x)< CIIP(x|H1)P(H1)
P(x)(10.1.11)
c <P(x|H1)
P(x|H0)(10.1.12)
Inequality10.1.10istherejectionrulefromabove;Inequa lity10.1.11usesBayes’s
ruletoinsertthelikelihoodfunctions;Inequality10.1.1 2doessomecross-division,
cancelingoutthe P(x)’sanddeﬁningthe criticalvalue c≡CIP(H1)/CIIP(H0),
i.e., everythingthat doesn’t dependon x. If you tell me the shapeof P(·|H1)and
P(·|H0)and some number α∈(0,1), then I can give you a value of csuch that
Inequality 10.1.12 is true with probability α.7The test will then be: gather the
data, calculate the likelihood ratio on the right-hand side of Inequality 10.1.12,
andreject H0iff theinequalityis true.
The Neyman–Pearson lemma states that this test is the ‘best’ in the sense that
for a Type I error ﬁxed at α, the LR test minimizes the probability of a Type II
error.8Sowecandesignanytestwelikebyjustﬁxing αatavaluewith whichwe
are comfortable (custom says to use 95 or 99%) and calculatin g a few likelihood
functions, and we are assured that we did the best we could reg arding Type II
errors. Most standard tests can be expressed in a likelihood ratio form, and so
Type II errors pretty much never get mentioned, since they’r e considered taken
careof.9
7Alternatively, you could give me aratio of costs CI/CIIand I could again give you a value of c.Thus, one
could draw arelation between the relative costs and thechoi ce ofα.
8For aproof, seee.g. Amemiya(1994, pp 189–191).
9Every test has a Type I and TypeII error, but thanks to the Neym an–Pearson Lemma,we just describe a test
using the Type I level, with phrases like a test with 5% p-value. The introductory chapter of Hunter & Schmidt
(2004) is an excellent essay on how such description can be se verely misleading. The extreme-case test always
fail to reject the null has a 0% Type I error rate, but if the null hypothesis is false, then it is wrong 100% of the
time.
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 337
®Foranysufﬁcientlywell-speciﬁedmodel,youcanﬁndthepro bability
thatagivendatasetwasproducedvia themodel.
®If the data set consists of independent and identically dist ributed el-
ements, then the likelihood is a product with one term for eac h data
point.Forbothcomputationalandanalyticreasons,thelog likelihood
is easiertowork with; theproductthenbecomesa sum.
®Theparametersthatmaximizethelikelihoodfunctionforam odel(or
identically,maximizetheloglikelihood)willhavethemin imumvari-
ance among all unbiased estimators. The variance is a known q uan-
tity, givenbytheCramér–Raolowerbound.
®Type I and Type II errors are complementary: as one goes up, th e
othergenerallygoesdown.However,givenaTypeIerrorleve l,differ-
enttestswillhavedifferentTypeIIerrorlevels.TheNeyma n–Pearson
lemma guaranteesthat a likelihood ratio test has the minimu m prob-
ability ofTypeII errorfor aﬁxedTypeI errorlevel.
10.2 D ESCRIPTION : MAXIMUM
LIKELIHOOD ESTIMATORSApopheniaprovides one function to ﬁnd a
model’s optimum, /CP/D4/D3/D4/CN/D1/CP/DC/CX/D1/D9/D1/CN/D0/CX/CZ/CT/B9/D0/CX/CW/D3/D3/CS—but what a function it is. It pro-
vides a standardized interface to several types of optimiza tion routines that take
very different approaches toward ﬁnding optima. You will ha ve to provide a log
likelihoodfunction,butifyouareunabletoprovidetheder ivatives,themaximiza-
tion routines will ﬁnd them for you. Since the Cramér–Rao low er bound tells us
the variance of a most-likely parameter, /CP/D4/D3/D4/CN/D1/CP/DC/CX/D1/D9/D1/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS will return
a parametrized /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 with the variances, along with other useful informa-
tion. This section gives an overview of some standard optimi zation methods, and
how to choose among them to raise the odds that they will ﬁnd an optimum for
yourfunctions.
Youmaybewonderingwhyyouneedtoknowthesedetails.Isn’t ﬁndingtheopti-
mum ofa likelihoodfunctiona solvedproblem?
The answer is decidedly no. Most standard optimization algo rithms are built to
work well with a smooth,closed-form, globally concavefunc tion, suchas ﬁnding
the value of xthat maximizes f(x) =−x2. If your function more-or-less meets
suchconditions,theoddsaregoodthatthedefaultoptimiza tionroutineinanystats
packageof your choosing will work ﬁne. But anything that produces a likelihood
value could be a model: a simulation could be a model, where th e likelihood is a
functionofhowwellthemodelmatchesareal-worlddataset. Adynamicprogram-
gsl_stats March24,2009
338 CHAPTER 10
ming problem could be a model. The consumerchoosingamong go odsat the end
of Chapter 4.7 was a model. If your model has a stochastic elem ent, has multiple
equilibria, or otherwise fails to fulﬁll the expectation of being a simple globally
concave function, then you will need to tailor a method and se ttings around the
problemathand.10
1#include <apop.h>
2
3doublesin_square( apop_data *data,apop_model *m){
4doublex= apop_data_get(m −>parameters, 0,−1);
5return−sin(x)*gsl_pow_2(x);
6 }
7
8apop_model sin_sq_model ={"−sin(x) times x^2",1,.p= sin_square};
Listing10.1 A model tobe optimized. Online source: /D7/CX/D2/D7/D5/BA.
01234
−4−3−2−10 1x2sin(x)
x01234
−4−3−2−1 0x2sin(x)
x
−4−3−2−101234
−4−3−2−1012x2sin(x)
x−3e−24−3e−24−2e−24−2e−24−1e−24−1e−24−5e−2505e−25
−2e−
0902e−
094e−
096e−
098e−
091e−
081e−
081e−
082e−
08x2sin(x)
x
Figure 10.2 Toprow:Thesimplexmethodandconjugategradie nts;bottomrow:simulatedannealing
androot search. [Online source: /D0/D3/CP/D0/D1/CP/DC/CN/D4/D6/CX/D2/D8/BA ]
10The problem of ﬁnding an optimum is so broad that there are lar ge sections of optimization research that
thisbook doesnotmention.Forexample, there isthebroad an d active ﬁeld of combinatorial optimization , which
coversquestions liketheoptimalordering of nelements given anoptimization function (which isaproblem with
n!options). See, e.g.,Papadimitriou &Steiglitz (1998) for m oreon combinatorial optimization methods.
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 339
1#include <apop.h>
2
3apop_model sin_sq_model;
4
5voiddo_search( intm,char*name){
6doublep[] = {0};
7doubleresult;
8 Apop_settings_add(&sin_sq_model,apop_mle,starting_ pt,p);
9 Apop_settings_add(&sin_sq_model,apop_mle,method, m) ;
10 apop_model *out = apop_maximum_likelihood(NULL, sin_sq_model);
11 result= gsl_vector_get(out −>parameters−>vector,0);
12 printf("The %s algorithm found %g.\n", name, result);
13 }
14
15intmain(){
16 apop_opts.verbose ++;
17 Apop_settings_add_group(&sin_sq_model,apop_mle,&s in_sq_model);
18 do_search(APOP_SIMPLEX_NM, "N −MSimplex");
19 do_search(APOP_CG_FR, "F −RConjugate gradient");
20 do_search(APOP_SIMAN,"Simulatedannealing");
21 do_search(APOP_RF_NEWTON,"Root −ﬁnding");
22 }
Listing10.3 Using /CP/D4/D3/D4/CN/D1/CP/DC/CX/D1/D9/D1/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS andfourtypesofmethodtosolveforamaximum.
Compile with /D7/CX/D2/D7/D5/BA. Online source: /D0/D3/CP/D0/D1/CP/DC/BA .
Listing 10.1 presentsa simple model, consisting of the equa tion−x2sin(x). This
isaverysimpleequation,butithasaninﬁnitenumberofloca lmodes.As x→∞,
the value of the function at these modes rises in proportion t ox2, so there is no
global maximum. Figure 10.2 shows various attempts to searc h the function, one
ofwhichgivesaverygoodpicture oftheshapeofthecurve.
• On lines 3–6, the function is deﬁned. Because the system is o riented toward data
analysis, the function takes in a data set and an /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 holding the parame-
ters.In this case,thedatasetissimply ignored.
• Line eight declares a new model with some of the information the MLE function
willneed,likethename,thenumberofparameters(one)andt heprobabilityfunc-
tion.
Listing 10.3doesthe optimizationfourways.
• The /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 struct can hold an array of groups of settings. Line 17 adds to
themodelagroupofMLE-appropriatesettings.Thatgroupin cludesthingslikethe
starting point,method,tolerance,andmanyotherdetailst hatyouwill seebelow.
gsl_stats March24,2009
340 CHAPTER 10
• Lineseightandninechangethe /D7/D8/CP/D6/D8/CX/D2/CV/CN/D4/D8 and /D1/CT/D8/CW/D3/CSelementsofthemodel’s
MLEsettingsgroupto /D4and /D1,respectively.
• Alltherealworkisdonebylineten,whichcallsthemaximiz ation.Thesubsequent
two linesinterrogatetheoutput.
• The /D1/CP/CX/D2routine doesthe optimizationwith fourdifferentmethods.
Byinserting /BT/D4/D3/D4/CN/D7/CT/D8/D8/CX/D2/CV/D7/CN/CP/CS/CS/B4/B2/D7/CX/D2/CN/D7/D5/CN/D1/D3/CS/CT/D0/B8 /CP/D4/D3/D4/CN/D1/D0/CT/B8 /D8/D6/CP/CT/CN/D4/CP/D8/CW/B8Ꜽ /D3/D9/D8/CU/CX/D0/CT Ꜽ/B5somewhere around line eight or nine, the system writes down t he
points it tests during its search for an optimum; you can then produce plots like
those in Figure 10.2. You can already see disparate styles am ong the four meth-
ods:thesimplexandconjugategradientmethodsaresomewha tsimilarinthiscase,
but simulated annealing is much more exhaustive—youcan cle arly see the shape
of the curve—while the root search barely leaves zero before deciding that it is
closeenough.
Chapter 11 will demonstrate another method of producing a pi cture of a function
viarandom walk,butin the meantime,simulatedannealingan d /D8/D6/CP/CT/CN/D4/CP/D8/CW pro-
videapretty effectivewayto getagraphofacomplexandunfa miliarfunction.
When you run the program, you will see that asking four differ ent methods gives
you three different answers,which leads to an important les son:nevertrust a sin-
gle optimization search . By redoing the optimization at different points with dif-
ferent methods, you can get a better idea of whether the optim um found is just a
local peakor the optimum for the entire function. See below f or tips on restarting
optimizations.
METHODS OF FINDING
OPTIMAHere is the problem: you want to ﬁnd the maximum of
f(x), but only have time to evaluate the function and its
derivativeatalimitednumberofpoints.Forexample, f(x)
couldbea complexsimulation thattakesin afewparametersa ndrunsforanhour
beforespitting outa value,andyouwould liketo haveanansw erthis week.
Here are the methods that are currently supported by Apophen ia. They are basi-
cally a standardization of the various routines provided by the GSL. In turn, the
GSL’s choice of optimization routines bears a close resembl ance to those recom-
mendedbyPress etal.(1988),soseethatreferenceforaverythoroughdiscussion
of how these algorithms work, or see below for some broad advi ce on picking
an algorithm. Also, Avriel (2003) provides a thorough, math ematician-oriented
overviewofoptimization,andGill etal.(1981)providesamorepractical,modeler-
orientedoverviewofthe sametopics.
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 341
Simplex method—Nelder–Mead/CJ/BT/C8/C7/C8/CN/CB/C1/C5/C8/C4/BX/CG/CN/C6/C5℄For addimensional search, this method draws
a polygonwith d+ 1corners and,ateachstep,
shifts the cornerof the polygonwith the small-
estfunctionvaluetoanewlocation,whichmaymovethepolyg onormaycontract
it to a smaller size.Eventually,the polygonshouldmoveto a ndshrink aroundthe
maximum. When the average distance from the polygon midpoin t to the d+ 1
cornersislessthan /D8/D3/D0/CT/D6/CP/D2/CT , thealgorithm returnsthe midpoint.
Thismethoddoesn’trequirederivativesatall.
Conjugate gradient Including:
Polak–Ribiere /CJ/BT/C8/C7/C8/CN/BV/BZ/CN/C8/CA℄
Fletcher–Reeves /CJ/BT/C8/C7/C8/CN/BV/BZ/CN/BY/CA℄
Broyden–Fletcher–Goldfarb–Shanno /CJ/BT/C8/C7/C8/CN/BV/BZ/CN/BU/BY/BZ/CB℄
Beginbypickingastartingpointandadirection,thenﬁndth eminimumalongthat
single dimension, using a relatively simple one-dimension al minimization proce-
dure like Newton’s Method. Now you have a new point from which to start, and
theconjugategradientmethodpicksa newsingleline alongw hichto search.
Given a direction vector d1, vector d2isorthogonal iffd′
1d2= 0. Colloquially,
two orthogonal vectors are at right angles to each other. Aft er doing an optimiza-
tionsearchalong d1,itmakesintuitivesensetodothenextone-dimensionalsea rch
along an orthogonal vector. However, there are many situati ons where this search
strategy does not do very well—the optimal second direction is typically not at
rightanglesto the ﬁrst.
Instead, a conjugate gradient satisﬁes d′
1Ad2= 0, for some matrix A. Orthog-
onality is the special case where A=1. For quadratic functions of the form
f(x) =1
2x′Ax−bx, a search along conjugate gradients will ﬁnd the optimum
in as many steps as there are dimensions in A. However, your function probably
onlyapproximatesaquadraticform—andadifferentquadrat icformateverypoint,
meaningthatfor approximationsatpoints oneandtwo, A1∝\e}atio\slash=A2. It is notneces-
sary to actually calculate Aat any point, but the quality of the search dependson
howclosetoaquadraticform yourfunctionis;thefurtherfr om quadratic,theless
effectivethe method.
Polak–Ribiere and Fletcher–Reevesdiffer only in their cho ice of method to build
thenextgradientfrom theprior; Press etal.(1988)recommendPolak–Ribiere.
The BFGS method is slightly different, in that it maintains a running best guess
about the Hessian, and uses that for updating the gradients.11However, the same
11Formally, one could argue that this means that it is not a conj ugate gradient method, but I class it with the
gsl_stats March24,2009
342 CHAPTER 10
generalrules aboutits underlying assumptionshold:the cl oseryourfunction is to
aﬁxedfunctionwith smoothderivatives,thebetterBFGSwil l do.
Here is the pseudocode for the three algorithms. The variabl es in /D8/CT/D0/CT/D8/DD/D4/CT are
settings that can be tuned before calling the routine, as on l ines 8 and 9 of Listing
10.3.Forallroutines,set /DA/CT/D6/CQ/D3/D7/CT to /BDtoseetheprogressofthesearchonscreen.
Startat p0=starting _pt, andgradientvector g0.
While (pi·gi<tolerance|pi||gi|)
Pick anewcandidatepoint, pc=pi+gi·step_size/|gi|.
Ifpc> pi
pi+1←pc
Else
pi+1←the minimum pointonthe line between piandpc(to
within /D8/D3/D0/CT/D6/CP/D2/CT12).
Findgi+1usingamethod-speciﬁcequation.
We are guaranteed that pi+1∝\e}atio\slash=pibecause we followed the gradient uphill. If the
functioncontinuesuphillin thatdirection, then pcwillbethenextpoint,butifthe
function along that path goes uphill and then downhill, the n ext point will be in
between piandpc.
The step to calculate gi+1is the only step that differs between the three methods.
In all three cases, it requires knowing derivatives of the fu nction at the current
point. If yourmodel has no /CS/D0/D3/CV/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS function, then the system will use
anumericalapproximation.
Root ﬁnding Including:
Newton’smethod /CJ/BT/C8/C7/C8/CN/CA/BY/CN/C6/BX/CF/CC/C7/C6℄
Hybridmethod /CJ/BT/C8/C7/C8/CN/CA/BY/CN/C0/CH/BU/CA/C1/BW℄
Hybridmethod;no internalscaling /CJ/BT/C8/C7/C8/CN/CA/BY/CN/C0/CH/BU/CA/C1/BW/CN/C6/C7/CB/BV/BT/C4/BX℄
A root search ﬁnds the optimum of the function by searching fo r the point where
the ﬁrst derivative of the function to be maximized is zero. N otice that this can’t
distinguish between maxima and minima, though for most like lihood functions,
theminima areat β=±∞.13
FRand PRmethods because allthree routines bear avery close resemblance, and allsharethesamepseudocode.
12Do not confuse the tolerance in these algorithms with a promi se (for example, the promise in a Taylor
expansion) that if the tolerance is τand the true value of the parameter is β, then the MLEestimate will be such
that|ˆβMLE−β|< τ. There is no way to guarantee such a thing. Instead, the toler ance indicates when the
internal measure of change (for mostalgorithms, ∆f(β)) is smallenough to indicate convergence.
13In fact, it is worth making sure that your models do not have a d ivergent likelihood, where the likelihood
increases as β→∞or−∞.Divergent likelihoods areprobably asign of amisspeciﬁed model.
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 343
Letf(x)be the function whose root we seek (e.g., the score), and let ∇fbe the
matrix of its derivatives(e.g., the information matrix). T hen one step in Newton’s
methodfollows
xi+1←xi−(∇f(xi))−1f(xi).
Youmaybefamiliarwiththeone-dimensionalversion,which beginsatapoint x1,
andfollowsthetangentatcoordinate (x1,f(x1))downtothe x−axis;theequation
for this is x2=x1−f(x1)/f′(x1), which generalizes to the multidimensional
versionabove.
The hybrid edition of the algorithm imposesa region around t he currentpoint be-
yondwhich thealgorithm doesnotventure.If thetangentsen dsthesearchtoward
inﬁnity,thealgorithmfollowsthetangentonlyasfarasthe edgeofthetrustregion.
The basic hybrid algorithm uses a trust region with a differe nt scale for each di-
mension,whichtakessomeextragradient-calculatingeval uationsandcouldmake
thetrustregionuselessforill-deﬁnedfunctions;theno-s calingversionsimplyuses
thestandardEuclidiandistancebetweenthecurrentandpro posedpoint.
The algorithm repeats until the function whosezero is sough t(e.g., the score)has
avaluelessthan /D8/D3/D0/CT/D6/CP/D2/CT .
Simulated annealing /CJ/BT/C8/C7/C8/CN/CB/C1/C5/BT/C6℄ Acontrolledrandomwalk.Aswiththeother
methods, the system tries a new point, and
if it is better, switches. Initially, the system is allowed t o make large jumps, and
then with eachiteration, the jumps getsmaller, eventually converging.Also, there
is some decreasing probability that if the new point is lesslikely, it will still be
chosen. One reason for allowing jumps to less likely paramet ers is for situations
where there may be multiple local optima. Early in the random walk, the system
can readily jump from the neighborhood of one optimum to anot her; later it will
ﬁne-tune its way toward the optimum. Other motivations for t he transition rules
will beelucidatedin thechapteronMonteCarlo methods.
Hereis thealgorithm in greaterdetail,with setting namesi n appropriateplaces:
Startwith temp = /D8/CN/CX/D2/CX/D8/CX/CP/D0
Letx0← /D7/D8/CP/D6/D8/CX/D2/CV/CN/D4/D3/CX/D2/D8
While temp≥ /D8/CN/D1/CX/D2
Repeatthefollowing /CX/D8/CT/D6/D7/CN/CU/CX/DC/CT/CS/CN/CC times:
Draw anewpoint xt,atmost /D7/D8/CT/D4/CN/D7/CX/DE/CT units awayfrom xt−1.
Draw arandomnumber r∈[0,1].
Iff(xt)> f(xt−1)
Jumptothe newpoint: xt+1←xt.
Elseif r < exp (−(xt−1−xt)/(k·temp))
Jumptothe newpoint: xt+1←xt.
Elseremain attheoldpoint: xt+1←xt−1.
Cool:Lettemp←temp/ /D1/D9/CN/D8
gsl_stats March24,2009
344 CHAPTER 10
Unlike with the othermethods,the numberof points tested in a simulated anneal-
ing run is notdependenton the function:if you giveit a speci ﬁcationthat reaches/D8/CN/D1/CX/D2in4,000steps,thenthatisexactlyhowmanystepsitwilltak e.Ifyouknow
your model is globally convex (as are most standard probabil ity functions), then
thismethodisoverkill;ifyourmodelisacomplexinteracti on,simulatedannealing
may be your only bet. It does notuse derivatives,so if the der ivativesdo notexist
orareill-behaved,thisisappropriate,butiftheyareavai lableeitheranalyticallyor
viacomputation,the methodsthatusederivativeinformati on will convergefaster.
If your model is stochastic, then methods that build up a pict ure of the space(no-
tablyconjugategradientmethods)couldbefooledbyafewea rlybaddraws.Sim-
ulated annealing is memoryless, in the sensethat the only in puts to the next deci-
siontojumparethecurrentpointandthecandidate.Afewunr epresentativedraws
could send the search in the wrong direction for a while, but w ith enough draws
the search could eventuallymeanderbackto the direction in which it shouldhave
gone.
Global v local optima As you sawin the caseof −x2sin(x), noneof the methods
guarantee that the optimum found is the global optimum,
sincethere is no way for a computerto haveglobal knowledgeo f a function f(x)
for all x∈(−∞,∞). One option is to restartthe searchfrom a variety of startin g
points, in the hope that if there are multiple peaks, then dif ferent starting points
will riseto differentpeaks.
The simulated annealing algorithm deals well with multiple peaks, because its
search can easily jump from the neighborhood of one peak to th at of another. In
fact, as the number of steps in the simulated annealing algor ithm→∞, the algo-
rithmcanbeshowntoconvergetotheglobaloptimumwithprob abilityone.How-
ever,calculatinganinﬁnite numberofstepstendsto take an unreasonableamount
of time, so you will need to select a time-to-conﬁdence trade -off appropriate to
yoursituation.
Q10.3Lines13and14ofListing10.3setthekeyparametersoftheme thodandthe
startingpoint.Tryvariousvaluesofboth.Whichdoabetter job ofjumping
outtowardthelargermodes?[ Bonus:rewritetheprogramtotakecommand-
lineswitchesusing /CV/CT/D8/D3/D4/D8soyoucandothis exercisefrom a batchﬁle.]
Q10.4The /CT/D3/D2/BD/BC/BD models from Chapter 4 provide the relatively rare situation
where we have an optimization and the analytic values. [Hope fully your
ownsimulationshaveatleastonespecialcasewherethis is a lso true.]This
is therefore a ﬁne opportunity to try various methods, value s of delta, step
size, tolerance, method, et cetera Do extreme prices or pref erences create
problems,andunderwhichoptimizationsettings?
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 345
RESTARTING To reiterate a recommendationfrom above: nevertrust a single opti-
mization search . But there are a number of ways by which you can
orderyourmultiple searches.
• You could start with a large step size and wide tolerance, so the search jumps
aroundthe spacequickly, then restart with smaller step siz eand toleranceto hone
in onaresult.
• Along a similar vein, different search methods have differ ent stopping criteria, so
switching between a simplex algorithm and a conjugate gradi ent algorithm, for
example,mayleadto abetteroptimum.
• If you suspect there could be multiple local optima, then tr y different starting
points—eitherdifferentextremesofthe space,orrandomly -generatedpoints.
• If you are running a constrained optimization, and one of th e constraints binds,
then there may be odd interactions between the penalty and th e function being
optimized.Tryaseriesofoptimizationswiththepenaltyde cliningtowardzero,to
seeif theoptimum getscloserto theboundary.
• The /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT/CN/D6/CT/D7/D8/CP/D6/D8 function will help you to run sequences of opti-
mizations;seetheonlinereferencefordetails.
®Given an appropriate /CP/D4/D3/D4/CN/CS/CP/D8/CP set and /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 , the /CP/D4/D3/D4/CN/B9/D1/CP/DC/CX/D1/D9/D1/CN/D0/CX/CZ/CT/D0/CX/CW/D3/D3/CS function will apply any of a number of
maximum-searchingtechniquesto ﬁndtheoptimalparameter s.
®No computational method can guarantee a global optimum, bec ause
the computer can only gather local information about the fun ction.
Restarting the search in different locations may help to est ablish a
uniqueoptimum orﬁndmultiple optima.
®You can try various methods in sequence using /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT/CN/B9/D6/CT/D7/D8/CP/D6/D8. You can also use the restarting technique to do a coarse
search for the neighborhood of an optimum, and then a ﬁner sea rch
beginningwherethecoarsesearchended.
10.3 M ISSING DATA Saythatyourdatasetismostlycomplete,buthasanNaN
in observation ﬁfty, column three. When you run a re-
gression,theNaN’spropagate,andyouwindupwithNaN’sall overtheparameter
estimates.Howcanyouﬁllin the missingdata?
We could turn this into an MLE problem: we seek the most likely valuesto ﬁll in
forthe NaN’s,basedon somemodelofhowthedatawasgenerate d.
gsl_stats March24,2009
346 CHAPTER 10
Infant mortality 
Missingness Income 
Missingness Infant mortality 
Figure 10.4 Two different ﬂows of causation. At left is non-i gnorable missingness: the value of the
infant mortality statistic determines whether infant mort ality data will be missing. At
rightisMAR:lowincomecauses highinfantmortality,andca uses infantmortalitydata
tobe missing. [online source: /D1/CP/D6/BA/CS/D3/D8]
Butﬁrst, weneedto distinguishamongthreetypesofmissing ness.Dataare miss-
ing completely at random (MCAR) when the incidence of missing data is uncor-
related to every variable in the data set. This is truly hapha zard error: somebody
trippedoverthemeter’spowercord,oroneofthesurveyorsw asdrunk.Thecause
ofthemissingdatais nowherein thedataset.
Data are missing at random (MAR) when the incidence of missing data in col-
umniis uncorrelated to the existing data in column ionce we condition on the
observed data in all other columns. For example, poor countr ies tend to have bad
demographicdata, so the incidenceof a missing infant morta lity rate is correlated
to low GNP per capita. Once we have conditioned on GNP per capi ta, there is no
reasontoexpectthatmissingnessiscorrelatedtoinfantmo rtality.Thecauseofthe
missing values in column iis something in the data set, but not column i. As in
the right-hand diagram in Figure 10.4, there is no ﬂow of caus ation from infant
mortality to missingness.
Conversely, say that governments are embarrassed by high in fant mortality rates.
Statistics bureaux are under orders to measure the rate, but release the measure
onlyifitfalls belowacertainthreshold.Inthiscase,thei ncidenceofmissingdata
is directly related to the value of the missing data. The caus e of the missing data
is the valueof the data. This is knownas missing not at random (MNAR) or non-
ignorablemissingness ,and is a serious problem becauseit implies bias almostby
deﬁnition.
There are many methods for dealing with censored or otherwis e non-ignorable
missingnessdiscussed in many sources, such as Greene (1990 ). For a full discus-
sionofthemanytypesofmissingdata,seeAllison (2002).
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 347
Listwise deletion One option for dealing with NaN’s that are MCAR is listwise
deletion. The idea here is supremely simple: if a row is missi ng
data for any variable, then throw out the entire row. This is c onceptually simple,
doesnotimposeanyadditionalstructureormodelonthedata ,andcanbeexecuted
in onelineofcode:
apop_data *nan_free_data = apop_data_listwise_delete(dirty_data) ;
Alternatively,seepage105for thesyntaxto dolistwise del etionon theSQLside.
Butlistwisedeletionisn’talwaysappropriate.Asaworst- casesituation,saythata
survey has a hundred questions, and everybody ﬁlled out exac tly 99 of them. By
listwise deletion,wewouldthrow outthe entire dataset.
Butwithlistwisedeletion,thedatasetisgoingtobeshorte r,meaningthatwelose
information,andifdataisMAR(notMCAR),thenthrowingout observationswith
missingdatameansbiasingtheinformationamongothervari ables.Intheexample
above, if we throw out countries with missing infant mortali ty data, we would
mostlybethrowing outcountrieswith low GDPpercapita.
ML imputation Thisis wheremaximumlikelihoodestimationcomesin (Demps ter
etal., 1977).Letthe missingdata be β, and theexisting data(with
holes)be X,asusual.Thenourgoalisto ﬁndthe mostlikely valueof β.Theﬁrst
stepis tospecifyamodelfrom whichthedatawasallegedlyge nerated,sothatwe
can evaluate the likelihood of any given β. The norm is that the completed data
sethasaMultivariateNormaldistribution, meaningthatth encolumnsofthedata
are distributed as an n-dimensionalbell curvewith mean vector µandcovariance
matrix Σ.However,itmaymakesenseforyourdatatotakeonanyofanum berof
other forms. But given a parametrized distribution, one cou ld search for the data
pointsthataremostlikely tohaveoccurred.
Inthe /CS/CP/D8/CP/B9/D3/D6/D6/D9/D4/D8/CX/D3/D2/BA/CS/CQ database,youwillﬁndTransparencyInternational’s
Corruption Perceptions Index from 2003–2006. Because the i ndex depends on
about a dozen hard-to-gather measures, there are many missi ng data points. List-
ing 10.5 goes through the entire process of ﬁlling in those da ta points, by pulling
thedatafromthedatabase,reducingittoanestimablesubse tvialistwisedeletion,
ﬁtting aMultivariateNormaltothesubset,andthenﬁlling i ntheNaN’sin thefull
data setvia maximum likelihood.It mayrun slowly:ﬁlling in abouteightyNaN’s
means a search in an 80-dimensional space. For more missing d ata than this, you
areprobablybetteroffﬁndinga meansofdividingthe datase torotherwiseincre-
mentallyﬁlling in the blanks.
Youare encouragedto lookatthe resultsanddecidewhethert heyseemplausible.
gsl_stats March24,2009
348 CHAPTER 10
#include <apop.h>
intmain(){
apop_db_open("data −corruption.db");
apop_data *corrupt = apop_db_to_crosstab("cpi", "country","year", "score");
apop_data *clean= apop_data_listwise_delete(corrupt);
apop_model *mlv= apop_estimate(clean,apop_multivariate_normal);
apop_ml_imputation(corrupt,mlv);
apop_crosstab_to_db(corrupt, "cpi_clean","country"," year", "score");
}
Listing10.5 FillinginNaN’s via aMultivariate Normal.Onl ine source: /D3/D6/D6/D9/D4/D8/BA .
Forexample,wouldyouusethedataforYugoslavia?IsaMulti variateNormalthe
mostappropriatemodelofhowthedatawasformed?
On lengthy surveys, few if any people successfully ﬁll out th e entire form. In the
worst case, we may have 100 questions, and all subjects answe red 99 of them.
Listwise deletion would throw out every subject. In this cas e, the best bet is pair-
wise deletion : calculate the mean of each vector by just ignoring NaN’s, an d the
covarianceofeachpairofcolumnsbyremovingonlythoseobs ervationsthathave
anNaNforoneofthosetwo variables.Pairwisedeletioncani ntroduceoddbiases
in thecovariancematrix, soitshouldbeusedasalastresort .
10.4 T ESTING WITH LIKELIHOODS In order to test a hypothesisregarding
a statistic, weneedto haveameansof
describing its theoretical distribution. When the statist ic is an MLE, the standard
meansofdoingthisisviatwointerlockingapproximations: aTaylorexpansionand
a Normal approximation. This is convenient because the Norm al approximation
proves to be innocuous in many settings, and the Taylor expan sion involves the
same cast of characters with which we have been dealing to thi s point— LL,S,
andI.
USING THE INFORMATION MATRIX TheCramér–Raolowerboundgivesusavalue
forthevarianceoftheparameters:theinverse
of the expected information matrix. Given a variance on each parameter, we can
dothesame tandFtestsasbefore.
It is even easier if we make one more approximation. The expected information
matrix is an expectation over all possible parameters, whic h means that it is a
propertyofthemodel,notofanyonesetofparameters.Conve rsely,the estimated
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 349
information matrix is the derivative of the score around the most likely values of
theparameters.Wecanexpectthatitisdifferentfordiffer entparameterestimates.
Efron & Hinkley (1978) found that for most of the application sthey consider, the
inverseoftheestimatedinformationmatrixispreferablea sanestimatorofthevari-
ance as the expectedinformation matrix. For exponentialfamily distributions, the
twoareidenticalattheoptimum.Fromacomputationalpersp ective,itiscertainly
preferable to use the estimated information, because it is a local property of the
optimum,notaglobalpropertyoftheentireparameterspace .Simulatedannealing
does a decent job of sampling the entire space, but the other m ethods go out of
their way to not do so, meaning that we would need to execute a s econd round
of data-gathering to get variances. Apophenia’s maximum li kelihood estimation
returnsa covariancematrix constructedviatheestimatedi nformation matrix.
The covariancematrix provides an estimate of the stability of each individual pa-
rameter, and allows us to test hypothesesaboutindividualp arameters (rather than
testsaboutthemodelasawhole,asdonebythelikelihoodrat iomethodsdiscussed
below).14However, there are a number of approximations that had to be m ade to
gettothispoint.Basically,byapplyinga ttest,weareassumingthatafewmillion
drawsofaparameter’sMLE(generatedviaafewmilliondraws ofnewdata)would
be asymptotically Normally distributed. We already encoun tered this assumption
earlier: when testing parameters of a linear regression we a ssume that the errors
are Normally distributed. So the same caveats apply, and if y ou have a means of
generatingseveraldatasets,youcouldtestforNormality; ifyoudonot,youcould
use the methods that will be discussed in Chapter 11 to bootst rap a distribution;
or if you are working at a consulting ﬁrm, you could just assum e that Normality
alwaysholds.
There is no sample codefor this section becauseyoualready k nowhow to run a t
testgivenastatistic’s meanandits estimatedvariance.
USING LIKELIHOOD RATIOS We can use likelihood ratio (LR) tests to compare
models.Forexample,wecouldclaimthatonemodel
is just like another, but with the constraintthat β12= 0, and then test whetherthe
constraintisactuallybindingviatheratio ofthelikeliho odwiththeconstraintand
the likelihood without. Or, say that we can’t decide between using an OLS model
oraprobitmodel;thentheratio ofthelikelihoodofthetwo m odelscantellusthe
conﬁdencewith whichoneis more likely thantheother.
14In Klemens (2007), I discuss at length the utility of the vari ance of the MLE as a gauge of which of a
simulation’s parameters have avolatile effect on theoutco me and which have little effect.
gsl_stats March24,2009
350 CHAPTER 10
A loose derivation As intimated by the Neyman–Pearsonlemma, the ratio of two
likelihoods is a good way to test a hypothesis. Given the rati o
oftwo likelihoods P1/P2, the logis thedifference ln(P1/P2) =LL1−LL2.
Now consider the Taylor expansion of a log likelihood functi on around ˆβ. The
Taylorexpansionisacommonmeansofapproximatingafuncti onf(x)viaaseries
of derivatives evaluated at a certain point. For example, th e second-degreeTaylor
expansionaroundsevenwouldbe f(x)≈f(7)+(x−7)f′(7)+(x−7)2f′′(7)/2+ǫ,
where ǫis an error term. The approximation is exactly correct at x= 7, and
decreasingly precise (meaning ǫgets larger) for values further from seven. In the
caseofthelog likelihoodexpandedaround ˆβ, theTaylorexpansionis
LL(β) =LL(ˆβ) + (β−ˆβ)LL′(ˆβ) +(β−ˆβ)2
2LL′′(ˆβ) +ǫ.
As per the deﬁnitions from the beginningof the chapter, the d erivativein the sec-
ond term is the score, and the second derivative in the third t erm is−I. When ˆβ
is the optimum, the scoreis zero.Also, asis the norm with Tay lorexpansions,we
will assume ǫ= 0. Thenthe expansionsimpliﬁesto
LL(β) =LL(ˆβ)−(β−ˆβ)2
2I(ˆβ). (10.4.1)
Typically, the likelihood ratio test involves the ratio of a n unrestricted model and
the same model with a constraint imposed. Let LLcbe the constrained log likeli-
hood;thenwecanrepeatEquation10.4.1with the constraine dloglikelihood:
LLc(β) =LLc(ˆβ)−(β−ˆβ)2
2Ic(ˆβ).
Now the hypothesis: the constraint is not binding, and there fore both constrained
andunconstrainedoptimizationsﬁndthesamevalueof ˆβ. Then
−2(LL(β)−LLc(β)) = 2LLc(ˆβ)−2LL(ˆβ) + (β−ˆβ)2I(ˆβ)−(β−ˆβ)2Ic(ˆβ)
= (β−ˆβ)2/parenleftig
I(ˆβ)−Ic(ˆβ)/parenrightig
(10.4.2)
The second equation follows from the ﬁrst because having the same value for ˆβ
forconstrainedandunconstrainedoptimizationsmeanstha tLL(ˆβ) =LLc(ˆβ).
Butwestillhaven’tsaidanythingaboutthedistribution of −2(LL(β)−LLc(β)).
Considerthe caseoftheNormaldistribution with ﬁxed σ(so theonlyfree param-
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 351
eteristhe mean µ); there,the Scoreis
S(x,µ) =/summationdisplay
i(xi−µ)/σ2. (10.4.3)
Q:Verifythisbyﬁnding ∂LL(x,µ)/∂µusingtheprobabilitydistributiononpage
241.
The right-hand side of Equation 10.4.3 takes the familiar me an-like form upon
which the CLT is based, and so is is Normally distributed. Sin ceE(I) =E(S·
S), and a Normally-distributed statistic squared has a χ2distribution, Expression
10.4.2hasa χ2distribution.
And in fact, this holds for much more than a Normal likelihood function (Pawi-
tan, 2001, p 29). Say that there exists a transformation func tiont(x,β)such that
P(x,β)·t(x,β)is Normallydistributed. Then
P(x,β)·t(x,β)
Pc(x,β)·t(x,β)=P(x,β)
Pc(x,β).
Insteadofcancelingoutthetransformationhere,wecoulda lsocancelitoutinthe
loglikelihood step:
LL(x,β) +t(x,β)−LLc(x,β)−t(x,β) =LL(x,β)−LLc(x,β).
Either way, Expression 10.4.2 is the same with or without the transformation—
which means the untransformed version is also ∼χ2. So provided the likelihood
function is sufﬁciently well-behaved that t(x,β)could exist, we don’t have to
worry aboutderiving it. This is a speciﬁccase of the invariance principle of like-
lihood functions, that broadly says that transformations o f the likelihood function
donotchangethe information embeddedwithin thefunction.
This is what we can use to do the likelihood ratio tests that th e Neyman–Pearson
lemmarecommended.Weﬁndtheloglikelihoodofthemodelini tsunconstrained
andconstrainedforms, take two times the difference, andlo ok up the result in the
χ2tables.
The LR test, constraint case As above, the typical likelihood ratio test involves
the ratio of an unrestricted and a restricted model,
and a null hypothesis that the constraint is not binding. Let Pbe the (not-log,
plain)likelihoodoftheoverallmodel,and Pcbethelikelihoodofamodelwith K
restrictions,suchas Kparametersﬁxedaszero.
In this context,theabovediscussionbecomes
−2lnP
Pc=−2[lnP−lnPc]∼χ2
K. (10.4.4)
In modeling terms, the unrestricted model could be any of the models discussed
earlier, such as the /CP/D4/D3/D4/CN/D4/D6/D3/CQ/CX/D8 , /CP/D4/D3/D4/CN/D2/D3/D6/D1/CP/D0 , or even /CP/D4/D3/D4/CN/D3/D0/D7 , because the
gsl_stats March24,2009
352 CHAPTER 10
OLSparameters( βOLS= (X′X)−1Xy) canbe shownto beidenticalto the max-
imum likelihoodestimateof β.
1#include "eigenbox.h"
2
3doublelinear_constraint( apop_data *d,apop_model *m){
4apop_data *constr = apop_line_to_data(( double[]){0, 0,0, 1}, 1,1, 3);
5returnapop_linear_constraint(m −>parameters−>vector, constr, 0);
6 }
7
8voidshow_chi_squared_test( apop_model *unconstrained, apop_model *constrained, int
constraints){
9doublestatistic= 2 *(unconstrained−>llikelihood−constrained−>llikelihood);
10 doubleconﬁdence =gsl_cdf_chisq_P(statistic,constraints);
11 printf("The Chisquared statisticis: %g, soreject thenu ll of non−binding constraint "
12 "with%g%% conﬁdence.\n",statistic, conﬁdence *100);
13 }
14
15intmain(){
16apop_data *d= query_data();
17apop_model *unconstr = apop_estimate(d,apop_ols);
18 apop_model_show(unconstr);
19
20 Apop_settings_add_group(&apop_ols, apop_mle, &apop_ ols);
21 Apop_settings_add(&apop_ols,apop_mle,starting_pt, unconstr−>parameters−>vector−>
data);
22 Apop_settings_add(&apop_ols,apop_mle,use_score,0) ;
23 Apop_settings_add(&apop_ols,apop_mle,step_size,1e −3);
24 apop_ols.estimate = NULL;
25 apop_ols.constraint = linear_constraint;
26apop_model *constr =apop_estimate(d, apop_ols);
27 printf("New parameters:\n");
28 apop_vector_show(constr −>parameters−>vector);
29 show_chi_squared_test(unconstr,constr,1);
30 }
Listing10.6 Comparing three different models using likeli hood ratios: an OLS model, an OLS
model withconstraint, and a logitmodel. Online source: /D0/D6/D8/CT/D7/D8/BA .
Listing 10.6 presents an unconstrainedand a constrained op timization. It uses the
query from page 267 that produces a data set whose outcome var iable is males
per100females,andwhoseindependentvariablesarepopula tionandmedianage.
The question is the coefﬁcient on median age signiﬁcant? can be rephrased to: if
we constrainthe medianage coefﬁcientto zero,doesthat hav ea signiﬁcanteffect
onthelog likelihood?
• The unconstrained optimization, on line 17, is the ordinar y least squares model
(which,asabove,ﬁndsthe MLE).
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 353
• Lines 20–24 mangle the base OLS model into a constrained mod el estimated via
maximum likelihood.By setting the /CT/D7/D8/CX/D1/CP/D8/CT elementto /C6/CD/C4/C4the estimationon
line 25usesthedefaultmethod,whichismaximum likelihood estimation.
• The constraint function is on line 3, and it uses the /CP/D4/D3/D4/CN/D0/CX/D2/CT/CP/D6/CN/D3/D2/D7/D8/D6/CP/CX/D2/D8
function to test that an input vector satisﬁes a constraint e xpressed as an /CP/D4/D3/D4/CN/B9/CS/CP/D8/CPset of the type ﬁrst introduced on page 152. In this case, the c onstraint is
0< β3;sincetheunconstrainedOLSestimationﬁndsthat β3<0,thisisabinding
constraint.
• Line four uses a new syntactic trick: anonymous structures . The type-in-parens
form, /B4/CS/D3/D9/CQ/D0/CT /CJ℄/B5,lookslikeatypecast,anditbasicallyactsthatway,decla ring
that the data in braces is a nameless array of /CS/D3/D9/CQ/D0/CTs. The line is thus equivalent
to two lines of code, as at the top of the /D1/CP/CX/D2routine in the /CU/D8/CT/D7/D8/BA program on
page311:
doubletempvar[]= {0, 0,0, 1};
apop_line_to_data(tempvar, 1,1, 3);
But we can get away with packing it all onto one line and not bot hering with the
temp variable. When used in conjunction with designatedini tializers, anonymous
structs can either convey a lot of information onto one line o r make the code an
unreadablemess,dependingonyouræsthetic preferences.
• By commenting out the constraint-setting on line 24, you wi ll have an uncon-
strained model estimated via maximum likelihood, and can th us verify that the
OLSparametersandthe MLEparametersareidentical.
• You will recognize the function on line nine as a direct tran slation of Expression
10.4.4.It is thusa testof the claim thatthe constraintis no tbinding, andit rejects
the null with about the same conﬁdence with which the ttest associated with the
linearregressionrejectedthe nullthatthethird paramete ris zero.
• The statistic on line nine, LL−LLc, is always positive, because whatever opti-
mum the constrained optimization found could also be used by the unconstrained
model, and the unconstrained model could potentially ﬁnd so mething with even
higher likelihood. If this term is negative, then it is a sign that the unconstrained
optimization is still far from the true optimum, so restart i t with a new method,
newstartingpoint, tightertolerances,orothertweaks.
Besuretocomparetheresultsofthetestherewiththeresult softhe Ftestonpage
311.
The LR test, non-nested case The above form is a test of two nestedmodels,
where one is a restricted form of the other, so un-
derthehypothesisofthe nonbindingconstraint,bothcanﬁn dthesameestimate ˆβ
andsobothcanconceivablyarriveatthesameloglikelihood .Ifthisisnotthecase,
gsl_stats March24,2009
354 CHAPTER 10
then the cancellation of the ﬁrst part of the Taylor expansio n in Equation 10.4.2
doesnothappen.
In thiscase(Cox, 1962;Vuong,1989),thestatistic andits d istribution is
lnP1
P2−E/parenleftig
lnP1
P2/parenrightig
√n∼N(0,1). (10.4.5)
Thedenominatoris simply the squareroot of the samplesize. The ﬁrst partof the
numerator is just LL1−LL2, with which we are very familiar at this point. The
expected value is more problematic, because it is a global va lue of the log likeli-
hoods,whichwewouldconceivablyarriveatbyaprobability -weightedintegralof
LL1(β)−LL2(β)overthe entirespaceof βs.
Alternatively, we could just assume that it is zero. That is, the easiest test to run
withExpression10.4.5isthenullhypothesisofnodifferen cebetweentheexpected
valueofthetwo logs.
#deﬁneTESTING
#include "dummies.c"
voidshow_normal_test( apop_model *unconstrained, apop_model *constrained, intn){
doublestatistic= (unconstrained −>llikelihood−constrained−>llikelihood)/sqrt(n);
doubleconﬁdence =gsl_cdf_gaussian_P(fabs(statistic), 1); //one−tailed.
printf("The Normal statisticis:%g,soreject the null of no difference betweenmodels "
"with%g%% conﬁdence.\n",statistic, conﬁdence *100);
}
intmain(){
apop_db_open("data −metro.db");
apop_model *m0= dummies(0);
apop_model *m1= dummies(1);
show_normal_test(m0, m1, m0 −>data−>matrix−>size1);
}
Listing10.7 ComparethetwoMetroridershipmodelsfrompag e282Onlinesource: /D0/D6/D2/D3/D2/D2/CT/D7/D8/BA .
Listing 10.7 reads in the code for the two OLS estimations of W ashington Metro
ridersiop from page 282, one with a zero-one dummy and one wit h a dummy for
theyear’sslope.
• If you ﬂip back to the /CS/D9/D1/D1/CX/CT/D7/BA ﬁle, you will see that the /D1/CP/CX/D2function is
wrappedbyapreprocessorif-thenstatement: /AZ/CX/CU/D2/CS/CT/CU /CC/BX/CB/CC/C1/C6/BZ.Because /CC/BX/CB/CC/C1/C6/BZ
isdeﬁnedhere,the /D1/CP/CX/D2functionin thatﬁle will bepassedover.
• Therefore, the next line can read in /CS/D9/D1/D1/CX/CT/D7/BA directly, without ending up with
two /D1/CP/CX/D2s.
gsl_stats March24,2009
MAXIMUM LIKELIHOOD ESTIMATION 355
• The /D1/CP/CX/D2function here simply estimates two models, and then calls th e /D7/CW/D3/DB/CN/B9/D2/D3/D6/D1/CP/D0/CN/D8/CT/D7/D8 function, which is a translation of Expression10.4.5under the null
hypothesisthat E(LLOLS−LLlogit) = 0.
Remember, a number of approximations underly both the neste d and non-nested
LRtests.Inthenestedcase,theyaregenerallyconsideredt obeinnocuousandare
rarelyveriﬁedorevenmentioned.Forthenon-nestedprobit andlogitmodels,their
loglikelihoodsbehavein a somewhatsimilar manner(as n→∞), soitis reason-
abletoapplythenon-nestedstatisticabove.Butfortworad icallydifferentmodels,
like an OLS model versus an agent-basedmodel, the approxima tions may start to
strain. You candirectly comparethe two log-likelihoods,a nd the teststatistic will
give you a sense of the scale of the difference, but from there it is up to you to
decidewhatthesestatisticstell youaboutthetwo disparat emodels.
gsl_stats March 24,2009
11
MONTECARLO
Monte Carlo (Italian and Spanish for Mount Carl) is a city in M onaco famous
for its casinos, and has more glamorous associations with it s name than Reno or
Atlantic City.
MonteCarlomethodsarethusaboutrandomization:takingex istingdataandmak-
ing random transformations to learn more about it. But altho ugh the process in-
volves randomness, its outcome is not just the mere whim of th e fates. At the
roulette table, a single player may come out ahead, but with m illions of suckers
testing their luck, casinos ﬁnd that even a 49–51 bet in their favor is a reliable
method of making money. Similarly, a single random transfor mation of the data
willnodoubtproduceasomehowdistortedimpression,butre applyingitthousands
ormillions oftimeswillpresentanincreasinglyaccuratep ictureoftheunderlying
data.
Thischapterwillﬁrstlookatthebasicsofrandomnumbergen eration.Itwillthen
discuss the general process of describing parameters of a di stribution, parameters
ofadataset,oradistributionasawholeviaMonteCarlotech niques.Asaspecial
case,bootstrappingisamethodforgettingavarianceoutof datathat,byallrights,
should not be able to give you a variance. Nonparametric meth ods also make a
return in this chapter, becauseshufﬂingandredrawing from the data cangive you
a feel for the odds that some hypothesizedeventwould have oc curred; that is, we
canwrite hypothesistestsbasedonresamplingfrom thedata .
gsl_stats March24,2009
MONTE CARLO 357
gsl_rng*apop_rng_alloc( intseed){
staticint ﬁrst_use = 1;
if(ﬁrst_use){
ﬁrst_use−−;
gsl_rng_env_setup();
}
gsl_rng*setme = gsl_rng_alloc(gsl_rng_taus2);
gsl_rng_set(setme, seed);
returnsetme;
}
Listing11.1 Allocatingandinitializinga random number ge nerator.
11.1 R ANDOM NUMBER GENERATION We need a stream of random num-
bers, but to get any programming
done,weneeda replicable streamofrandomnumbers.1
Therearetwo placeswhereyouwill needreplication.Theﬁrs tis with debugging,
since you don’t want the segfault you are trying to track down to appear and dis-
appear every other run. The second is in reporting your resul ts, because when a
colleague asks to see how you arrived at your numbers, you sho uld be able to
reproducethemexactly.
Of course, using the same stream of numbers every time create s the possibility
of getting a lucky draw, where luckycan mean any of a number of things. The
compromiseistouseacollectionofdeterministicstreamso fnumbersthathaveno
apparent pattern, where each stream of numbers is indexed by its ﬁrst value, the
seed.2TheGSLimplementssucha process.
Listing 11.1 shows the innards of the /CP/D4/D3/D4/CN/D6/D2/CV/CN/CP/D0/D0/D3 function from the Apo-
phenialibrarytoinitialize a /CV/D7/D0/CN/D6/D2/CV.Inallcases,thefunctiontakesinaninteger,
and then sets up the random number generation (RNG) environm ent to produce
new numbers via the Tausworth routine. Fans of other RNG meth ods can check
the GSL documentation for setting up a /CV/D7/D0/CN/D6/D2/CV with alternative algorithms. On
the ﬁrst call, the function calls the /CV/D7/D0/CN/D6/D2/CV/CN/CT/D2/DA/CN/D7/CT/D8/D9/D4 function to work some
internal magic in the GSL. Listings 11.6 and 11.7 below show a n example using
this function.
1Isitvalidtocallareplicablestreamofseeminglyrandomnu mbersrandom?BecausesuchRNGsarearguably
not random, some prefer the term pseudorandom number generator (PRNG) to describe them. This question is
rooted in a philosophical question into which this book will not delve: what is the difference between perceived
randomness given somelevel of information and true randomn ess? See, e.g.,Good (1972, pp 127–8).
2Formally,theRNGproducesonlyonestream,thateventually cyclesaroundtothebeginning.Theseedsimply
speciﬁes where in the cycle to begin. But because the cycle is so long, there is little loss in thinking about each
seed producing a separate stream.
If you initialize one RNG stream with the value of another, th en they are both at the same point in the cycle,
and they will follow in lock-step from then on. This is to be av oided; if you need a sequence of streams, you are
better off just using asimple list of seeds like 0,1, 2,....
gsl_stats March24,2009
358 CHAPTER 11
RANDOM NUMBER DISTRIBUTIONS Now that you have a random number gener-
ator, here are some functions that use it to
drawfrom allofyourfavorite distributions.InputanRNG as allocatedaboveplus
theappropriateparameters,andtheGSL will transformthe R NG asnecessary.
doublegsl_ran_bernoulli ( gsl_rng*r,doublep);
doublegsl_ran_beta ( gsl_rng*r,doublea,doubleb);
doublegsl_ran_binomial ( gsl_rng*r,doublep,intn);
doublegsl_ran_chisq ( gsl_rng*r,doubledf);
doublegsl_ran_fdist ( gsl_rng*r,doubledf1,doubledf2);
doublegsl_ran_gaussian ( gsl_rng*r,doublesigma);
doublegsl_ran_tdist ( gsl_rng*r,doubledf);
doublegsl_ran_ﬂat ( gsl_rng*r,doublea,doubleb);
doublegsl_rng_uniform ( gsl_rng*r);
• TheﬂatdistributionisaUniform[A,B)distribution.TheUniform[ 0,1)distribution
getsits ownno-optionsfunction, /CV/D7/D0/CN/D6/D2/CV/CN/D9/D2/CX/CU/D3/D6/D1/B4/D6/B5 .
• The Gaussiandraw assumesa mean of zero,so if you intend to d raw from, e.g., a
N(7,2), thenuse /CV/D7/D0/CN/D6/CP/D2/CN/CV/CP/D9/D7/D7/CX/CP/D2/B4/D6/B8 /BE/B5 /B7 /BJ.
• The /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0 struct includes a /CS/D6/CP/DBmethod that works like the above func-
tions to make random draws,and allows standardizationwith more exotic models
like thehistogrambelow;seetheexamplein Listing 11.5,pa ge361.
An example: the Beta distribution TheBetadistributioniswonderfulforallsorts
of modeling, because it can describe such a
wide range of probability functions for a variable ∈[0,1]. For example, you saw
it used as a prior on page 259. But its αandβparameters may be difﬁcult to
interpret; we are more used to the mean and variance. Thus, Ap ophenia provides
a conveniencefunction, /CP/D4/D3/D4/CN/CQ/CT/D8/CP/CN/CU/D6/D3/D1/CN/D1/CT/CP/D2/CN/DA/CP/D6 , that takes in µandσ2and
returnsanappropriateBetadistribution,withthecorresp ondingvaluesof αandβ.
As you know, the variance of a Uniform [0,1]is exactly1
12, which means that
the Beta distribution will never have a variance greater tha n1
12(and close to1
12,
perversethingsmay happencomputationallyfor µ∝\e}atio\slash≈1
2).3Themeanofa function
that has positivedensity iff x∈[0,1]must be∈(0,1). If you send /CP/D4/D3/D4/CN/CQ/CT/D8/CP/CN/B9/CU/D6/D3/D1/CN/D1/CT/CP/D2/CN/DA/CP/D6 valuesof µandσ2that are outsideof these bounds,the function
will return /BZ/CB/C4/CN/C6/BT/C6.
What does a Beta distribution with, say, µ=3
8,σ2=1
24=.04166look like?
Listing 11.2setsup an RNG, makesa million drawsfrom a Beta d istribution, and
plotsthe result.
3Moretrivia: the Uniform [0,1]is symmetric, soits skew is zero. Its kurtosis is1
80.
gsl_stats March24,2009
MONTE CARLO 359
1#include <apop.h>
2
3intmain(){
4intdraws = 1e7;
5intbins = 100;
6doublemu = 0.492; //alsotry 3./8.
7doublesigmasq = 0.093; //alsotry 1./24.
8gsl_rng*r = apop_rng_alloc(0);
9apop_data *d =apop_data_alloc(0, draws,1);
10 apop_model *m = apop_beta_from_mean_var(mu,sigmasq);
11 for(inti=0; i <draws;i++)
12 apop_draw(apop_data_ptr(d,i,0), r,m);
13 Apop_settings_add_group(&apop_histogram,apop_hist ogram,d, bins)
14 apop_histogram_normalize(&apop_histogram);
15 apop_histogram_plot(&apop_histogram, NULL);
16 }
Listing11.2 Buildinga picture of a distributionvia random draws. Online source: /CS/D6/CP/DB/CQ/CT/D8/CP/BA .
00.0020.0040.0060.0080.010.0120.0140.0160.018
00.10.20.30.40.50.60.70.80.91P(x)
x0.0080.010.0120.0140.0160.0180.02
00.10.20.30.40.50.60.70.80.91P(x)
x
Figure 11.3 The ﬂexible Betadistribution. Runvia /CS/D6/CP/DB/CQ/CT/D8/CP /DG /CV/D2/D9/D4/D0/D3/D8.
• Most of the code simply names constants; the ﬁrst real actio n occurs on line 11,
where /CP/D4/D3/D4/CN/CQ/CT/D8/CP/CN/CU/D6/D3/D1/CN/D1/CT/CP/D2/CN/DA/CP/D6 takesin µandσ2andreturnsan /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0
representinga Betadistribution with the appropriatepara meters.
• In line 14, the data set /CSis ﬁlled with random drawsfrom the model. The /CP/D4/D3/D4/CN/B9/CS/D6/CP/DBfunction takes in a pointer-to- /CS/D3/D9/CQ/D0/CTas the ﬁrst argument, and puts a value
in that location based on the RNG and model sent as the second a nd third argu-
ments. Thus, you will need to use /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D4/D8/D6 , /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/D4/D8/D6 , or /CV/D7/D0/CN/B9/D1/CP/D8/D6/CX/DC/CN/D4/D8/D6 with /CP/D4/D3/D4/CN/CS/D6/CP/DB to get a pointer to the right location. The slightly
awkward pointer syntax means that no copying or reallocatio n is necessary, so
thereis lessto slowdowndrawingmillions ofnumbers.
• The ﬁnal few lines of code take the generic /CP/D4/D3/D4/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1 model, set it to use
gsl_stats March24,2009
360 CHAPTER 11
thedata /CSandthegivennumberofbins,normalizethehistogramthuspr oducedto
haveatotaldensityofone,andplotthe result.
Theoutputofthis example(using 1e7draws)isatleft in Figure11.3;by contrast,
thecasewhere µ= 0.492,σ2= 0.093ispicturedatright.
rA(◦) =πr2=π
A(2) = (2 r)2= 4
Figure 11.4 Acircleinscribedinasquare.Theratioofthear ea ofthecircletotheareaofthesquare
isπ/4. Online source: /D7/D5/D9/CP/D6/CT/CX/D6/D0/CT/BA/CV/D2/D9/D4/D0/D3/D8 .
Q11.1As per Figure 11.4, when a circle is inscribed inside a square , the ratio of
the area of the circle to the square is π/4. Thus, if we randomly draw 100
pointsfrom thesquare,weexpect 100π/4to fallwithin thecircle.
Estimate πviarandomdrawsfrom asquare.For iin zeroto about 1e8:
• Draw xifrom a Uniform [−1,1]distribution; draw yifrom a
Uniform [−1,1]distribution.
• Determine whether (xi,yi)falls within the unit circle, meaning that/radicalig
x2
i+y2
i≤1(whichis equivalentto x2
i+y2
i≤1).
• Every10,000draws,displaytheproportionofdrawsinside thecircle
times four. How close to πdoes the estimate come? ( Hint: it may be
clearer to display /CU/CP/CQ/D7/B4/C5/CN/C8/C1 /B9 /D4/CX/CN/CT/D7/D8/CX/D1/CP/D8/CT /B5instead of the esti-
mateitself.)
gsl_stats March24,2009
MONTE CARLO 361
DRAWING FROM YOUR OWN DATA Another possibility, beyond drawing from fa-
mous distributions that yourdata theoretically
approximates,wouldbeto drawfrom youractualdata.
If your data are in a vector, then just draw a random index and r eturn the value
at that index. Let /D6be an appropriately initialized /CV/D7/D0/CN/D6/D2/CV, and let /DD/D3/D9/D6/CN/CS/CP/D8/CP
be a /CV/D7/D0/CN/DA/CT/D8/D3/D6 from which you would like to make draws. Then the following
one-linerwould makea singledraw:
gsl_vector_get(your_data,gsl_rng_uniform_int(r, your _data−>size));/F4Drawing from histograms There are a few reasons for your data to be in a his-
togram form—a rough probability mass function—
like the ones used for plotting data in Chapter 5, for describ ing data in Chapter
7, for goodnessof ﬁt tests in Chapter 9, and as the output from the /CP/D4/D3/D4/CN/D9/D4/CS/CP/D8/CT
function.Here,wewill drawfrom themto produceartiﬁciald atasets.
1#include <apop.h>
2gsl_rng*r;
3
4voidplot_draws( apop_model *m,char*outﬁle){
5intdraws = 2e3;
6apop_data *d= apop_data_alloc(0, draws,1);
7for(size_ti=0; i< draws;i++)
8 apop_draw(apop_data_ptr(d,i,0), r,m);
9apop_model *h3= apop_estimate(d, apop_histogram);
10 apop_histogram_print(h3, outﬁle);
11 }
12
13intmain(){
14 r= apop_rng_alloc(1);
15 apop_db_open("data −wb.db");
16 apop_data *pops = apop_query_to_data("select population+0.0pfrom p op where p>500");
17 apop_model *h= apop_estimate(pops,apop_histogram);
18 apop_histogram_print(h,"out.hist");
19 plot_draws(apop_estimate(pops, apop_lognormal), "lo gnormal_ﬁt");
20 printf("set xrange [0:2e5];set yrange [0:0.12]; \n\
21 plot ’out.hist’withboxes,’lognormal_ﬁt’ withlines\n ");
22 }
Listing11.5 Draw from the actual histogram of country popul ations, and from the exponential
distributionthat most closelyﬁts.Online source: /CS/D6/CP/DB/CU/D6/D3/D1/D4/D3/D4/BA .
For example, say that we would like to generate communities w hose populations
are distributed the way countries of the world are distribut ed. Listing 11.5 does
gsl_stats March24,2009
362 CHAPTER 11
this two ways. The simplest approach is to simply generate a h istogram of world
populationsandmakedrawsfrom thathistogram.
• Line 17 creates a ﬁlled histogram by ﬁlling the un-parametr ized base /CP/D4/D3/D4/CN/B9/CW/CX/D7/D8/D3/CV/D6/CP/D1 modelwith alist ofpopulations.
In somecases,there are simply notenoughdata for the job. Th e World Bankdata
set lists 208 countries; if your simulation produces millio ns of communities, the
repetition of 208 numbers could produce odd effects. The sol ution presentedhere
istoestimateaLognormaldistribution,andthendrawfrom t hatidealdistribution.
Line21doesthemodelﬁtandthensendstheoutputofthe /CP/D4/D3/D4/CN/CT/D7/D8/CX/D1/CP/D8/CT func-
tiontothe /D4/D0/D3/D8/CN/CS/D6/CP/DB/D7 function,whichmakesamultitudeofdrawsfromtheideal
distribution, and then plots those. You can see that the resu lt is smoother, without
thezero-entrybinsthatthe real-world datahas.
• Lines 7–8 ﬁll column zero of /CSwith data, then line 9 turns that data into a his-
togram.
• Theeasiestwaytoputtwodatasetsononeplotistowritebot hofthemtoseparate
ﬁles(lines18and10),andthencallthoseﬁlesfromaGnuplot script(lines20–21)./F4Seeding with the time Therearesituationswhereaﬁxedseedisreallynotwhat
you want—you want different numbers every time you
run your program. The easiest solution is to seed using the /D8/CX/D1/CTfunction. The
standardlibraryfunction /D8/CX/D1/CT/B4/C6/CD/C4/C4/B5 willreturnthenumberofsecondsthathave
elapsedsincethebeginningof1970,whichisroughlywhenUN IXandCwereﬁrst
composed. As I write this, /D8/CX/D1/CTreturns 1,147,182,523—not a very good way to
tellthetime.Thereareanumberoffunctionsthatwillturnt hisintohours,minutes,
or months; see any reference on C’s standard library (such as the GNU C Library
documentation)fordetails. Butthis illegible form provid estheperfectseedforan
RNG,andyougeta newoneeverysecond.
Listing 11.6, /D8/CX/D1/CT/BA, shows a sample program that produces ten draws from an
RNG seeded with the time. This is not industrial-strength ra ndom number gener-
ation, because patterns could conceivably slip in. For an ex ample of the extreme
case, try compiling /D8/CX/D1/CT/BA, and run it continuously from the shell. In a Bourne-
family shell(whatyouareprobablyusingonaPOSIX system), try
whiletrue ;do./time;done
Youshouldseethesamenumbersafewdozentimesuntiltheclo ckticksover,and
then another stream repeated several times. [You can get you r command prompt
gsl_stats March24,2009
MONTE CARLO 363
#include <time.h>
#include <apop.h>
intmain(){
gsl_rng*r = apop_rng_alloc(time(NULL));
for(inti=0; i< 10; i++)
printf("%.3g\t", gsl_rng_uniform(r));
printf("\n");
}
Listing11.6 Seeding anRNGusing the time.Online source: /D8/CX/D1/CT/BA.
back using <ctrl-c>.] If you have multiple processors and run one simulation on
each,thenrunsthatstartinthesamesecondwillbereplicat ingeachother.Finally,
if youeverhopeto debugthisprogram, thenyouwill needto wr ite downthetime
startedsothatyoucanreplicate therunsthatbreak:
//Iassume the database is already open and has aone-column
//table named /D6/D9/D2/D7. The timeis alonginteger
//inthe GNUstandard library,soits printftag is /B1/D0/CX.
longintright_now = time(NULL);
apop_query("insert intoruns (%li);", right_now);
gsl_rng*r= apop_rng_alloc(right_now);
Caveats aside, if you just want to see some variety every time the program runs,
thenseedingwith thetime worksﬁne./F4The standard C RNG If the GSL is not available, the standard C library in-
cludes a /D6/CP/D2/CSfunction to make random draws and an/D7/D6/CP/D2/CSfunctionto setits seed.E.g.:
#include <stdlib.h>
srand(27);
printf("One draw from a U[0,1]: %g", rand()/(RAND_MAX +0.0 ));
TheGSL’sRNGs arepreferable fora few reasons.First, /CV/D7/D0/CN/D6/CP/D2/CN/D1/CP/DC/B4/D6/B5 is typ-
ically greater than /CA/BT/C6/BW/CN/C5/BT/CG , giving you greater variation and precision. Second,
theClanguagestandardspeciﬁesthattheremustbea /D6/CP/D2/CSfunction,butnothowit
works,meaningtwomachinesmaygiveyoudifferentstreamso frandomnumbers
forthe sameseed.
Finally, /D6/CP/D2/CSgivesyourentireprogramexactlyonestreamofnumbers,whi leyou
caninitialize many /CV/D7/D0/CN/D6/D2/CVsthatwillbeindependentofeachother.Forexample,
ifyougiveeveryagentinasimulationitsownRNG,youcanre- runthesimulation
gsl_stats March24,2009
364 CHAPTER 11
withoneagentaddedorremoved(probablyatabreakpointinG DB)andareguar-
anteedthat the variation is due to the agent, not RNG shifts. Here is some sample
codeto clarify howsuchasetupwouldbeinitialized:
typedefstruct agent{
longintagent_number;
gsl_rng*r;
...
} agent;
voidinit_agent(agent *initme,intagent_no){
initme−>agent_number =agent_no;
initme−>r = apop_rng_init(agent_no);
...
}
®Randomnumbergeneratorsproducea deterministic sequence ofval-
ues.Thisisagoodthing,becausewecouldneverdebugaprogr amor
replicateresultswithoutit.Changethestreambyinitiali zingitwitha
differentseed.
®Given a random number generator, you can use it to draw from an y
commondistribution, from ahistogram,orfrom a dataset.
11.2 D ESCRIPTION : FINDING
STATISTICS FOR
A DISTRIBUTIONFormanystatistic-distributionpairs,thereex-
ists a closed-form solution for the statistic:
the kurtosis of aN(µ,σ)is3σ4, the vari-
anceofa Binomial distribution is np(1−p),
etcetera.YoucanalsotakerecourseintheSlutskytheorem, thatsaysthatgivenan
estimate rfor somestatistic ρand a continuousfunction f(·), then f(r)is a valid
estimate of f(ρ). Thus, sums or products of means, variances,and so on are eas y
to calculateaswell.
However, we often ﬁnd situations where we need a global value like a mean or
variance, but have no closed-form means of calculating that value. Even when
thereis aclosed-form theoremthatbegins in the limit as n→∞, it holdsthat... ,
there is often evidence of the theorem falling ﬂat for the few dozen data points
beforeus.
Onewaytocalculatetheexpectedvalueofastatistic f(·)givenprobabilitydistri-
bution p(·)would bea numeric integraloverthe entire domainof thedist ribution.
Foraresolution of100,000slices,write a loopto sum
gsl_stats March24,2009
MONTE CARLO 365
E[f(·)|p(·)] =f(−500.00)·p(−500.00)
100,000+f(−499.99)·p(−499.99)
100,000
+···+f(499.99)·p(499.99)
100,000+f(500.00)·p(500.00)
100,000.
This can be effective, but there are some details to be hammer ed out: if your
distribution has a domain over (−∞,∞), should you integrate over [−3,3]or
[−30,30]? Youmustdecideup-fronthowﬁnetheresolutionwillbe,bec ause(bar-
ringsometricks)eachresolutionisanewcalculationrathe rthanamodiﬁcationof
prior calculations. If you would like to take this approach, the GSL includes a set
ofnumericalintegrationfunctions.
Another approach is to evaluate f(·)at values randomly drawn from the distribu-
tion.JustasListing11.2producedanicepictureoftheBeta distributionbytaking
enough random draws, a decentnumberof random draws can prod uce a good es-
timateofanydesiredstatisticoftheoveralldistribution .Valueswill,bydeﬁnition,
appearin proportion to their likelihood, so the p(·)part takes care of itself. There
isnocutoffsuchthatthetailsofthedistributionareassum edaway.Youcanincre-
mentallymonitor E[f(·)]at1,000randomdraws,at10,000,andsoon,toseehow
muchmoreyouaregetting with the extratime.
An example: the kurtosis of a tdistribution Youprobablyknowthata tdistribu-
tion is muchlike a Normaldistribu-
tion but with fatter tails, but probably not how much fatter t hose tails are. The
kurtosis of a vector is easy to calculate—just call /CP/D4/D3/D4/CN/DA/CT/D8/D3/D6/CN/CZ/D9/D6/D8/D3/D7/CX/D7 . By
taking a million or so draws from a tdistribution, we can producea vectorwhose
valuescoverthedistribution ratherwell, andthenﬁndthek urtosisofthatvector.
Listing 11.7showsaprogram to executethisprocedure.
• The /D1/CP/CX/D2function just sets up the headerof the output table (see Tabl e 11.8) and
calls /D3/D2/CT/CN/CS/CUforeach d f.
• The /CU/D3/D6looponlines6–7doesthe draws,storing themin thevector /DA.
• Once the vector is ﬁlled, line eight calculates the partial ly normalized kurtosis.
That is, it calculates raw kurtosis over variance squared; s ee the box on page 230
onthe endlessdebateoverhowbesttoexpresskurtosis.
The closed-form formula for the partially-normalized kurt osis of a tdistribution
withd f >4degrees of freedom is (3d f−6)/(d f−4). Ford f≤4, the kurtosis
is undeﬁned, just as the variance is undeﬁned for a Cauchy dis tribution (i.e., a t
distribution with d f= 1). Atd f= 5, it is ﬁnite,anditmonotonicallydecreasesas
d fcontinuesupwards.
gsl_stats March24,2009
366 CHAPTER 11
1#include <apop.h>
2
3voidone_df(intdf,gsl_rng*r){
4longinti,runct = 1e6;
5gsl_vector *v= gsl_vector_alloc(runct);
6for(i=0; i< runct;i++)
7 gsl_vector_set(v,i,gsl_ran_tdist(r,df));
8 printf("%i\t%g", df,apop_vector_kurtosis(v)/gsl_pow _2(apop_vector_var(v)));
9if(df > 4)
10 printf("\t%g",(3. *df−6.)/(df−4.));
11 printf("\n");
12 gsl_vector_free(v);
13 }
14
15intmain(){
16intdf, df_max = 31;
17gsl_rng*r= apop_rng_alloc(0);
18 printf("df\tk(est)\tk(actual)\n");
19 for(df=1; df< df_max; df++)
20 one_df(df,r);
21 }
Listing11.7 Monte Carlo calculation of kurtoses for the tdistribution family. Online source:/D8/CS/CX/D7/D8/CZ/D9/D6/D8/D3/D7/CX/D7/BA .
Table 11.8 shows an excerpt from the simulation output, alon g with the true kur-
tosis.
Theexactformatforthevarianceoftheestimateofkurtosis willnotbegivenhere
(Q: use the methods here to ﬁnd it), but it falls with d f: with d f < 4, we may
as well take the variance of the kurtosis estimate as inﬁnite , and it shrinks as d f
grows. Correspondingly, the bootstrap estimates of the kur tosis are unreliable for
d f= 5or6, but are more consistent for d fover a few dozen. You can check this
by re-running the program with different seeds (e.g., repla cing the zero seed on
line 17ofthecodewith /D8/CX/D1/CT/B4/C6/CD/C4/C4/B5 ).
®By making random draws from a model, we can make statements
about global properties of the model that improve in accurac y as the
numberofdraws→∞.
®The variance of the Monte Carlo estimation of a parameter ten ds
to mirror the variance of the underlying parameter. The maxi mum
likelihood estimator for a parameter achievesthe Cramér–R ao lower
bound, so the variance of the Monte Carlo estimate will be lar ger
(perhapssigniﬁcantlyso).
gsl_stats March24,2009
MONTE CARLO 367
df k (est) k(analytic)
1 183640
2 5426.32
3 62.8055
4 19.2416
5 8.5952 9
6 6.00039 6
7 4.92161 5
8 4.52638 4.5
9 4.17413 4.2
10 4.00678 4
15 3.55957 3.54545
20 3.37705 3.375
25 3.281 3.28571
30 3.23014 3.23077
Table 11.8 The fatness ofthe tails of tdistributions at various d f.
11.3 I NFERENCE : FINDING
STATISTICS FOR A
PARAMETERThetdistribution example made random draws
fromaclosed-formdistribution,inordertopro-
duce an estimate of a function of the distribu-
tion parameters. Conversely, say that we want
to estimate a function of the data, such as the variance of the mean of a data set,
/hatwidervar(ˆµ(X)). We have only one data set before us, but we can make random dra ws
fromXtoproduceseveralvaluesofthestatistic ˆµ(Xr),where Xrrepresentsaran-
dom draw from X, and then estimate the variance of those draws. This is known
asthebootstrap methodofestimatingavariance.
BOOTSTRAPPING THE STANDARD ERROR The core of the bootstrap is a simple
algorithm:
Repeatthe following mtimes:
Let˜Xbenelementsrandomlydrawnfrom thedata,with replacement.
Write downthestatistic(s) β(˜X).
Findthestandarderror ofthe mvaluesof β(˜X).
This algorithm bears some resemblance to the steps demonstr ated by the CLT
demo in Listing 9.1 (page 298): draw miid samples,ﬁnd a statistic like the mean
of each, and then look at the distribution of the several stat istics (rather than the
underlying data itself). So if β(˜X)is a mean-like statistic (involving a sum over
gsl_stats March24,2009
368 CHAPTER 11
n), then the CLT applies directly, and the artiﬁcial statisti c approaches a Normal
distribution.Thus,itmakessensetoapplytheusualNormal distribution-basedtest
to testhypothesesaboutthe true valueof β.
1#include "oneboot.h"
2
3intmain(){
4intrep_ct =10000;
5gsl_rng*r= apop_rng_alloc(0);
6 apop_db_open("data −census.db");
7gsl_vector *base_data = apop_query_to_vector("select in_per_capita from income where
sumlevel+0.0 =40");
8doubleRI =apop_query_to_ﬂoat("select in_per_capita from incom e where sumlevel+0.0
=40and geo_id2+0.0=44");
9gsl_vector *boot_sample = gsl_vector_alloc(base_data −>size);
10 gsl_vector *replications = gsl_vector_alloc(rep_ct);
11 for(inti=0; i< rep_ct;i++){
12 one_boot(base_data,r,boot_sample);
13 gsl_vector_set(replications,i, apop_mean(boot_samp le));
14 }
15 doublestderror = sqrt(apop_var(replications));
16 doublemean = apop_mean(replications);
17 printf("mean:%g;standard error: %g; (RI −mean)/stderr:%g;pvalue: %g\n",
18 mean, stderror,(RI −mean)/stderror,2 *gsl_cdf_gaussian_Q(fabs(RI −mean),stderror));
19 }
Listing11.9 Bootstrapping the standard error of the varian ce in state incomes per capita. Online
source: /CS/CP/D8/CP/CQ/D3/D3/D8/BA .
#include "oneboot.h"
voidone_boot( gsl_vector *base_data, gsl_rng*r,gsl_vector *boot_sample){
for(inti=0; i< boot_sample −>size; i++)
gsl_vector_set(boot_sample, i,
gsl_vector_get(base_data, gsl_rng_uniform_int(r,base _data−>size)));
}
Listing11.10 A functiontoproduce abootstrap draw. Online source: /D3/D2/CT/CQ/D3/D3/D8/BA .
Listings 11.10 and 11.9 shows how this algorithm is executed in code. It tests the
hypothesisthatRhodeIsland’sincomepercapitais differe ntfrom themean.
• Lines4–8ofListing11.9areintroductorymaterialandthe queriestopullthereq-
uisite data. For Rhode Island, this is just a scalar, used in t he test below, but for
therestofthecountry,thisisavectorof52numbers(onefor eachstate,common-
wealth,district, andterritory in thedata).
gsl_stats March24,2009
MONTE CARLO 369
• Lines11–14showthemainlooprepeated mtimesinthepseudocodeabove,which
makesthe drawsandthenﬁndsthe meanofthe draws.
• Listing 11.10 is a function to make a single bootstrap draw, which will be used in
a few otherscriptsbelow.The /D3/D2/CT/CN/CQ/D3/D3/D8 functiondrawswith replacement,which
simply requires repeatedly calling /CV/D7/D0/CN/D6/D2/CV/CN/D9/D2/CX/CU/D3/D6/D1/CN/CX/D2/D8 to get a random index
andthenwriting downthevalueatthatindexinthe datavecto r.
• Lines 15 and 16 of Listing 11.10 ﬁnd the mean and standard err or of the returned
data,andthenlines17–18runthestandardhypothesistestc omparingthemeanof
aNormaldistribution to a scalar.
• Recallthediscussiononpage300aboutthestandarddeviat ionofadataset,which
is the square root of its variance, σ; and the standard deviation of the mean of a
dataset,whichis σ/√n.Inthiscase,weareinterestedinthedistribution of β(˜X)
itself, notthedistribution of E(β(˜X))s, soweuse σinsteadof σ/√n.
Q11.2Rewrite /CS/CP/D8/CP/CQ/D3/D3/D8/BA to calculatethe standarderror of /CQ/CP/D7/CT/CN/CS/CP/D8/CP directly
(without bootstrapping), and test the same hypothesis usin g that standard
error estimate rather than the bootstrapped version. Do you need to test
with yourcalculatedvalueof ˆσorwith ˆσ/√n?
1#include <apop.h>
2
3intmain(){
4intdraws = 5000, boots =1000;
5doublemu= 1., sigma = 3.;
6gsl_rng*r =apop_rng_alloc(2);
7gsl_vector *d =gsl_vector_alloc(draws);
8apop_model *m =apop_model_set_parameters(apop_normal,mu, sigma);
9apop_data *boot_stats =apop_data_alloc(0, boots,2);
10 apop_name_add(boot_stats −>names,"mu",’c’);
11 apop_name_add(boot_stats −>names,"sigma",’c’);
12 for(inti=0; i< boots;i++){
13 for(intj =0; j< draws;j++)
14 apop_draw(gsl_vector_ptr(d, j), r,m);
15 apop_data_set(boot_stats,i,0, apop_vector_mean(d)) ;
16 apop_data_set(boot_stats,i,1, sqrt(apop_vector_var (d)));
17 }
18 apop_data_show(apop_data_covariance(boot_stats));
19 printf("Actual:\nvar(mu)%g\n",gsl_pow_2(sigma)/dr aws);
20 printf("var(sigma):%g\n",gsl_pow_2(sigma)/(2 *draws));
21 }
Listing11.11 Estimate the covariance matrix for the Normal distribution Online source:/D2/D3/D6/D1/CP/D0/CQ/D3/D3/D8/BA .
gsl_stats March24,2009
370 CHAPTER 11
A Normal example Say that we want to know the covariance matrix for the esti-
matesoftheNormaldistributionparameters, (ˆµ,ˆσ).Wecould
lookit upandﬁndthatit is
/bracketleftigg
σ2
n0
0σ2
2n/bracketrightigg
,
but that would require effort and looking in books.4So instead we can write a
programlikeListing11.11togeneratethecovarianceforus .Runningtheprogram
will show that the computational method comes reasonably cl ose to the analytic
value.
• The introductory material up to line 11 allocates a vector f or the bootstrap sam-
ples and a data set for holding the mean and standard deviatio n of each bootstrap
sample.
• Insteadofdrawingpermutationsfrom a ﬁxeddata set,this v ersionofthe program
produces each artiﬁcial data vector via draws from the Norma l distribution itself,
onlines13–14,andthenlines15–16write downstatistics fo reachdataset.
• Inthiscase,weareproducingtwostatistics, µandσ,soline18ﬁndsthecovariance
matrix ratherthanjustascalarvariance.
Q11.3On page 321, I mentioned that you could test the claim that the kurtosis of
aNormaldistributionequals 3σ4viaabootstrap.Modify /D2/D3/D6/D1/CP/D0/CQ/D3/D3/D8/BA to
testthishypothesis.Wheretheprogramcurrentlyﬁndsmean sandvariances
of the samples, ﬁnd each sample’s kurtosis. Then run a ttest on the claim
thatthe meanofthe vectorofkurtosesis 3σ4.
®To test a hypothesis about a model parameter, we need to have a n
estimateoftheparameter’svariance.
®If there is no analytic way to ﬁnd this variance, we can make mu lti-
ple draws from the data itself, calculate the parameter, and then ﬁnd
the variance of that artiﬁcial set of parameters. The Centra l Limit
Theoremtellsusthattheartiﬁcialparametersetwillappro achawell-
behavedNormaldistribution.
4E.g.,Kmenta(1986,p182).Thattextprovidesthecovarianc ematrixfortheparameters (ˆµ,ˆσ2).Thevariance
ofˆµis thesame, butthe variance of ˆσ2=2σ4
n.
gsl_stats March24,2009
MONTE CARLO 371
11.4 D RAWING A DISTRIBUTION To this point, we have been searching for
global parameters of either a distribution
or a data set, but the output has been a single number or a small matrix. What if
wewantto ﬁndtheentire distribution?
WehaveatourdisposalstandardRNGstodrawfromNormalorUn iformdistribu-
tions, and this section will present are a few techniques to t ransform those draws
into draws from the distribution at hand. For the same reason s for which random
drawswerepreferableto brute-force numericintegration, it canbemuchmoreef-
ﬁcienttoproduceapictureofadistributionviarandomdraw sthanvia gridsearch :
the draws focus on the most likely points, the tails are not cu t off at an arbitrary
limit, andadesiredlevelofprecisioncanbereachedwith le sscomputation.
And remember, anything that produces a nonnegative univariate measure can be
read asa subjectivelikelihood function. Forexample,sayt hat we havereal-world
data about the distribution of ﬁrm sizes. The model on page 25 3 also gives us an
artiﬁcialdistributionofﬁrmsizesgiveninputparameters suchasthestandarderror
(currently hard-coded into the model’s /CV/D6/D3/DB/D8/CWfunction). Given a run, we could
ﬁndthedistance d(σ)betweentheactualdistributionandtheartiﬁcial.Noticet hat
itisafunctionof σ,becauseevery σproducesanewoutputdistributionandthere-
foreanewdistancetotheactual.Themostlikelyvalueof σisthatwhichproduces
the smallest distance, so we could write down L(σ) = 1 /d(σ), for example.5
Then we could use the methods in this chapterand the last to ﬁn d the most likely
parameters, draw a picture of the likelihood function given the input parameters,
calculate the variance given the subjective likelihood fun ction, or test hypotheses
giventhesubjectivelikelihood.
IMPORTANCE
SAMPLINGThere are many means of making draws from one distribution to in-
form draws from another; Train (2003, Chapter 9) catalogs ma ny of
them.
For example, importance sampling is a means of producing draws from a new
function using a well-known function for reference. Let f(·)be the function of
interest,andlet g(·)beawell-knowndistribution like theNormalorUniform. We
want to use the stock Normal or Uniform distribution RNGs to p roduce an RNG
foranarbitrary function.
Fori= 1to afew million:
Drawanewpoint, xi,from thereferencedistribution g(·).
Givethe pointweighting f(xi)/g(xi).
Bin thedatapointsinto a histogram(weightingeachpointap propriately).
5Recall the invariance principle from page 351, that basic tr ansformations of the likelihood function don’t
change the data therein, so we don’t have to fret over the exac t form of the subjective likelihood function, and
would get thesame results using 1/das using 1/d2or1/(d+ 0.1),for example.
gsl_stats March24,2009
372 CHAPTER 11
Attheendofthis,wehaveahistogramthatisavalidrepresen tationof f(·),which
can be used for making draws, graphing the function, or calcu lating global infor-
mation.
What reference distribution should you use? Theoretically , any will do, but engi-
neering considerations advise that you pick a function that is reasonably close to
the one you are trying to draw from—you want the high-likelih ood parts of g(·)
to match the high-likelihood parts of f(·). So if f(·)is generally a bell curve, use
a Normal distribution; if it is focused near zero, use a Logno rmal or Exponential;
andifyoutrulyhavenoinformation,fallbacktotheUniform (perhapsforarough
exploratorysearchthatwill letyoumakeabetterchoice).
MARKOVCHAINMONTECARLOMarkov Chain Monte Carlo is an iterative al-
gorithm that starts at one state and has a rule
deﬁning the likelihood of transitioning to any other given s tate from that initial
state—aMarkovChain.Inthecontexthere,thestateissimpl yapossiblevaluefor
the parameter(s) being estimated. By jumping to a parameter value in proportion
to its likelihood, we can get a view of the probability densit y of the parameters.
The exact probability of jumping to another point is given a s peciﬁc form to be
presentedshortly.
This is primarily used for Bayesian updating, so let us revie w the setup of that
method. The analysis begins with a prior distribution expre ssing current beliefs
about the parameters, Pprior(β), and a likelihood function PL(X|β)expressing
the likelihood of an observation given a value of the paramet ers. The goal is to
combinethese two to form a posterior; as per page258, Bayes’ sRule tells us that
this is
Ppost(β|X) =PL(X|β)Pprior(β)/integraltext
∀B∈BPL(X|B)Pprior(β)dB
Thenumeratoriseasytocalculate,butthedenominatorisag lobalvalue,meaning
that we can not know it with certainty without evaluating the numerator at an
inﬁnite number of points. The Metropolis–Hastings algorit hm, a type of MCMC,
offersa solution.
Thegistis thatwestartatanarbitrary point,anddrawanewc andidatepointfrom
the prior distribution. If the candidate point is more likel y than the current point
(accordingto PL),jumptoit,andifthecandidatepointislesslikely,perha psjump
to it anyway.After a burn-in period, record the values.The h istogram of recorded
valueswill bethehistogramoftheposteriordistribution. Tobemoreprecise,here
isa pseudocodedescriptionofthe algorithm:
gsl_stats March24,2009
MONTE CARLO 373
Beginbysetting β0to anarbitrary starting value.
Fori= 1to afew million:
Drawanewproposedpoint, βp, from Pprior.
IfPL(X|βp)> PL(X|βi−1)
βi←βp
else
Draw avalue u∼U[0,1]
Ifu < P L(X|βp)/PL(X|βi−1)
βi←βp
else
βi←βi−1
Ifi >1,000orso,record βi.
Reportthe histogramof βis astheposteriordistribution of β.
As should be evident from the description of the algorithm, i t is primarily used
to go from a prior to a posterior distribution. To jump to a new pointβnew, it
must ﬁrst be chosen by the prior (which happens with probabil ityPprior(βnew))
and then will be selected with a likelihood roughly proporti onal to PL(x|βnew),
so the recorded draw will be proportional to Pprior(βnew)PL(x|βnew). This rough
intuitive argument can be made rigorous to prove that the poi nts recorded are a
validrepresentationofthe posterior;seeGelman etal.(1995).
Why not just draw from the prior and multiply by the likelihoo d directly, rather
than going through this business of conditionally jumping? It is a matter of efﬁ-
ciency. The more likely elements of the posterior are more li kely to contribute a
large amount to the integral in the denominator of the updati ng equation above,
sowecanestimatethatintegralmoreefﬁcientlybybiasingd rawstowardthemost
likely posterior values, and the jumping scheme achieves th is with fewer draws
thanthenaïvedraw-from-the-prior schemedoes.
You have already seen one concrete example of MCMC: the simul ated annealing
algorithm from Chapter 10. It also jumps from point to point u sing a decision
ruleliketheoneabove.Theproposaldistributionisbasica llyanimproperuniform
distribution—anypointisaslikelyasanyother—andthelik elihoodfunctionisthe
probability distribution whose optimum the simulated anne aling is seeking. The
difference is that the simulated annealing algorithm makes smaller and smaller
jumps;combinedwith thefactthatMCMC isdesignedtotendto wardmorelikely
points,itwilleventuallysettleonamaximumvalue,atwhic hpointwethrowaway
all the prior values. For the Bayesian updating algorithm he re, jumps are from a
ﬁxedprior,andtendtowardthemostlikelyvaluesofthepost erior,butthe 1,000th
jump is as likely to be a long one as the ﬁrst, and we use every po int found to
producetheoutputdistribution.
Atthecomputer,thefunctiontoexecutethisalgorithmis /CP/D4/D3/D4/CN/D9/D4/CS/CP/D8/CT .Thisfunc-
tion takes in a parametrized prior model, an unparametrized likelihood and data,
andoutputsa parametrizedposteriormodel.
gsl_stats March24,2009
374 CHAPTER 11
Theoutputmodelwillbeoneoftwotypes.AswiththeBeta/Bin omialexampleon
page259,therearemanywell-known conjugatedistributions ,wheretheposterior
will be of the same form as the prior distribution, but with up dated parameters.
For example, if the prior is named Gamma distribution (which the /CP/D4/D3/D4/CN/CV/CP/D1/D1/CP
modelisnamed)andthelikelihoodisnamed Exponentialdistribution (and /CP/D4/D3/D4/CN/B9/CT/DC/D4/D3/D2/CT/D2/D8/CX/CP/D0 is so named), then the output of /CP/D4/D3/D4/CN/D9/D4/CS/CP/D8/CT will be a closed-
form Gammadistribution with appropriatelyupdatedparame ters.Butif thetables
of closed form conjugates offer nothing applicable, the sys tem will fall back on
MCMC andoutputan /CP/D4/D3/D4/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1 modelwith theresultsofthe jumps.
Q11.4CheckhowclosetheMCMC algorithmcomesto theclosed-formm odel.
• PickanarbitraryparameterfortheExponentialdistribut ion,βI.Gen-
erateten ortwenty thousandrandomdatapoints.
• Pick a few arbitrary values for the Gamma distribution para meters,
βprior.
• Estimate the posterior, by sending the two distributions, the
randomly-generateddata,and βpriorto /CP/D4/D3/D4/CN/D9/D4/CS/CP/D8/CT .
• Make a copy of the /CP/D4/D3/D4/CN/CT/DC/D4/D3/D2/CT/D2/D8/CX/CP/D0 model and changeits name
tosomethingelse(sothat /CP/D4/D3/D4/CN/D9/D4/CS/CP/D8/CT won’tﬁnditintheconjugate
distribution table). Re-sendeverythingto /CP/D4/D3/D4/CN/D9/D4/CS/CP/D8/CT .
• Useagoodness-of-ﬁttesttoﬁndhowwellthetwooutputdist ributions
match.
Q11.5The output to the updating process is just another distribut ion, so it can be
usedasthepriorforanewupdatingstep.Intheory,distribu tionsrepeatedly
updatedwithnewdatawillapproachputtingallprobability massonthetrue
parametervalue.Continuingfrom thelastexercise:
• Regenerate a new set of random data points from the Exponent ial
distribution usingthesame βI.
• Sendthe newdata,the closed-form posteriorfrom the prior exercise,
andthesameExponentialmodelto theupdatingroutine.
• Plottheoutput.
• Onceyou havethe generate/update/plotroutine working, c allit from
a /CU/D3/D6loop to generate an animation beginning with the prior and
continuingwith abouta dozenupdates.
• Repeatwith the MCMC-estimatedposteriors.
gsl_stats March24,2009
MONTE CARLO 375
11.5 N ON-PARAMETRIC TESTING Section 11.3 presented a procedure for
testinga claim abouta datasetthatcon-
sisted of drawing a bootstrap data set, regenerating a stati stic, and then using the
many draws of the statistic and the CLT to say something about the data. But we
can test some hypotheses by simply making draws from the data and checking
theircharacteristics,withoutbotheringto produceastat istic andusethe CLT.
To give a concrete example of testing without parametric ass umptions, consider
the permutationtest. Saythatyou drawten red cardsandtwen tyblackcardsfrom
what may be a crooked deck. The hypothesis is that the mean val ue of the red
cards you drew equals the mean of the black cards (counting fa ce cards however
you like). You could put the red cards in one pile to your left, the black cards in a
piletoyourright,calculate xred,ˆσred,xblack,andˆσblack,assume xblack−xred∼t
distribution, andruna traditional ttestto comparethe two means.
But if µredreally equals µblack, then the fact that some of the cards you drew are
black and some are red is irrelevant to the value of xleft−xright. That is, if you
shufﬂedtogetherthestacksofblackandred cards,anddealt outanothertencards
to yourleft andtwenty to yourright, then xleft−xrightshould notbe appreciably
different. If youdealouta few thousandsuchshufﬂedpairs o f piles, thenyou can
draw the distribution of values for xleft−xright. Ifxred−xblacklooks as if it is
very far from the center of that distribution, then we can rej ect the claim that the
colorofthe cardsis irrelevant.
Whatis the beneﬁtofall this shufﬂingandredealingwhenwe c ouldhavejustrun
attest to compare the two groups? On the theoreticallevel, thi s method relies on
the assumption of the bootstrap principle rather than the as sumptions underlying
theCLT.Insteadofassumingatheoreticaldistribution,yo ucanshufﬂeandredraw
to produce the distribution of outcome values that matches t he true sample data
(undertheassumptionthat µred=µblack),andthenrelyonthebootstrapprinciple
to say that what you learned from the sample is representativ e of the population
from whichthe samplewasdrawn.
On a practical level, the closer match to the data provides re al beneﬁts. Lehmann
&Stein(1949)showedthatthepermutationtestismorepower ful—itislesslikely
to failto rejecttheequality hypothesiswhenthe two meansa reactuallydifferent.
In pseudocode,hereisthe testprocedure:6
6ThetestisattributedtoChung&Fraser(1958).Fromp733:“T hecomputationtookonedayforprogramming
and two minutes of machine time.”
gsl_stats March24,2009
376 CHAPTER 11
µ←|xred−xblack|
d←thejoinedtestandcontrolvectors.
Allocateamillion-element vector v.
Fori= 1to amillion:
Draw (withoutreplacement)from davectorthesamesizeas xred,L.
Puttheotherelementsof dinto a secondvector, R.
vi←|L−R|.
α←the percentageof vilessthan µ.
Rejecttheclaim that µ= 0with conﬁdence α.
Failto rejecttheclaim that µ= 0with conﬁdence 1−α.
Q11.6Baumet al.(2008) sampled genetic material from a large number of cases
with bipolar disorder and controls who were conﬁrmed to not h ave bipo-
lar disorder. To save taxpayer money, they pooled the sample s to form the
groups listed in the ﬁle /CS/CP/D8/CP/B9/CV/CT/D2/CT/D7 in the code supplement. Each line of
thatﬁleliststhepercentofthepoolwherethegivenSNP(sin glenucleotide
polymorphism)hasa givenmarker.
ForwhichoftheSNPscanwerejectthehypothesisofnodiffer encebetween
the cases and controls? Write a program to read the data into a database,
then usethe abovealgorithm to test whetherwe rejectthe hyp othesisof no
difference in marker frequency for a given SNP, and ﬁnally wr ite a /D1/CP/CX/D2
that runs the test for each SNPs in the database. The data here is cut from
550,000SNPs,sobasetheBonferronicorrectiononthatmany tests.
Other nonparametric tests tend to follow a similar theme: gi ven a null hypothesis
that some bins are all equiprobable, we can develop the odds t hat the observed
data occurred. See Conover (1980) for a book-length list of s uch tests, including
Kolmogorov’smethodfrom page323ofthis book.
TESTING FOR BIMODALITY Astheﬁnaletothebook,Listing11.12showstheuse
of kernel densities to test for multimodality. This in-
volves generating a series of kernel density estimates of th e data, ﬁrst with the
original data, and then with a few thousand bootstrap estima tes, and then doing a
nonparametrictest of the hypothesisthat the distribution has fewerthan nmodes,
foreachvalueof n.
Recallthekerneldensityestimatefrom page262,whichwasb asedonthe form
ˆf(t,x,h) =/summationtextn
i=1N((t−xi)/h)
n·h,
wherexis the vector of ndata points observed, N(y)is a Normal (0,1)PDF
evaluated at y, andh∈R+is the bandwidth. Let kbe the number of modes.
gsl_stats March24,2009
MONTE CARLO 377
Figure 7.15 (p 262) showed that as hrises, the spike around each point spreads
out and merges with other spikes, so kfalls, until eventually the entire data set is
subsumed under one single-peaked curve, so k= 1. Thus, there is a monotonic
relationship between hand the number of modes in the density function induced
byh.
Silverman(1981)offersabootstrapmethodoftestinganull hypothesisoftheform
thedistributionhasmorethan kmodes.Leth0bethesmallestvalueof hsuchthat
ˆf(t,X,h 0)hasmorethan kmodes;thenthenullhypothesisisthat h0isconsistent
with the data.
We then draw a few hundredbootstrapsamplesfrom the data, x′
1, ...,x′
200; write
down ˆf(t,x′
1,h0), ...,ˆf(t,x′
200,h0); and count the modes of each of these func-
tions. Silverman shows that, thanks to the monotonic relati onship between hand
the number of modes, the percentage of bootstrap distributi ons with more than k
modesmatchesthe likelihood that ˆf(t,x,h0)is consistentwith the data.If were-
ject this hypothesis, then we would need a lower value of h, and therefore more
modes,to explainthe data.
Listing 11.12 shows the code used to produce these ﬁgures and test a data set of
television program ratings for bimodality. Since it draws a few hundred bootstrap
samples,link itwith /D3/D2/CT/CQ/D3/D3/D8/BA from page368.
• The /D3/D9/D2/D8/D1/D3/CS/CT/D7 function makes two scans acrossthe range of the data. The ﬁrs t
generatesahistogram:ateachpointonthe x-axis,itpilesupthevalueatthatpoint
ofaNormaldistributioncenteredateverydatapoint.There sultwillbeahistogram
like those pictured in Figure 7.15, page 262, or those that ar e produced in the
Gnuplot animation the program will write to the /CZ/CT/D6/D2/CT/D0/D4/D0/D3/D8 ﬁle. The second
pass checks for modes, by simply asking each point whether it is higher than the
pointsto its left andright.
•h→k: For each index /CX, /CZ/D8/CP/CQ/CJ/CX℄ is intended to be the smallest value of /CWthat
producesfewer than /CXmodes. The /CU/CX/D0/D0/CN/CZ/D1/CP/D4 function calls /D3/D9/D2/D8/D1/D3/CS/CT/D7 to ﬁnd
the number of modes produced by a range of values of /CW. The function runs from
the largest /CWto the smallest, so the last value of /CWwritten to any slot will be the
smallestvaluethatproducesthatmodecount.7
•k→p:Now that we havethe smallestbandwidth hthatproducesa given kusing
the actual data, /CQ/D3/D3/D8does the bootstrapping: /D3/D2/CT/CN/CQ/D3/D3/D8 (p 368) uses a straight-
forward /CU/D3/D6loop to produce a sample, then the same /D3/D9/D2/D8/D1/D3/CS/CT/D7 function used
aboveis applied to the artiﬁcial sample. If the mode countis larger than the num-
ber of modes in the original, it is a success for the hypothesi s. The function then
7Also,the /CU/D3/D6loopinthisfunctiondemonstratesapleasanttrickforscan ningawiderange:insteadofstepping
by a ﬁxed increment, it steps by percentages, so it quickly sc ans the hundreds but looks at the lower end of the
range in moredetail.
gsl_stats March24,2009
378 CHAPTER 11
returns the percentsuccesses,which we can report as a pvaluefor the hypothesis
thatthedistribution hasmorethan kmodes.
• In some parts of the output, such as for k= 12, the battery of tests ﬁnds low
conﬁdence that there are more than kmodes and high conﬁdence that there are
morethan k+1modes.Ifbothtestswererunwiththesamevalueof h,thiswould
be inconsistent, but we are using the smallest level of smoot hing possible in each
case,so the tests for kandk+ 1parameters have little to do with each other. For
smallk,theoutputismonotonic,andshowsthatwecanbeveryconﬁde ntthatthe
datasethasmorethanthreemodes,andreasonablyconﬁdentt hatithasmorethan
four.
#include "oneboot.h"
doublemodect_scale, modect_min, modect_max,
h_min=25, h_max=500, max_k = 20,
boot_iterations = 1000,
pauselength =0.1;
charoutﬁle[]= "kernelplot";
voidplot(apop_data *d,FILE*f){
fprintf(f, "plot ’−’withlines\n");
apop_data_print(d, NULL);
fprintf(f, "e\npause %g\n", pauselength);
}
intcountmodes( gsl_vector *data,doubleh,FILE*plothere){
intlen=(modect_max−modect_min)/modect_scale;
apop_data *ddd= apop_data_calloc(0, len,2);
doublesum, i=modect_min;
for(size_tj=0;j < ddd−>matrix−>size1; j++){
sum = 0;
for(size_tk= 0; k< data−>size;k++)
sum += gsl_ran_gaussian_pdf((i −gsl_vector_get(data,k))/h,1)/(data −>size*h);
apop_data_set(ddd, j,0, i);
apop_data_set(ddd, j,1, sum);
i+=modect_scale;
}
intmodect =0;
for(i= 1; i<len−1;i++)
if(apop_data_get(ddd,i,1)>=apop_data_get(ddd,i −1,1)
&&apop_data_get(ddd,i,1)>apop_data_get(ddd,i+1,1))
modect++;
if(plothere)plot(ddd, plothere);
apop_data_free(ddd);
returnmodect;
}
voidﬁll_kmap( gsl_vector *data,FILE*f,double*ktab){
for(doubleh= h_max;h> h_min; h *=0.99){
gsl_stats March24,2009
MONTE CARLO 379
intval = countmodes(data,h, f);
if(val <max_k)
ktab[val−1] = h;
}
}
doubleboot(gsl_vector *data,doubleh0,intmodect_target, gsl_rng*r){
doubleover_ct =0;
gsl_vector *boots = gsl_vector_alloc(data −>size);
for(inti=0;i < boot_iterations;i++){
one_boot(data,r,boots);
if(countmodes(boots, h0, NULL) >modect_target)
over_ct++;
}
gsl_vector_free(boots);
returnover_ct/boot_iterations;
}
apop_data *produce_p_table( gsl_vector *data,double*ktab,gsl_rng*r){
apop_data *ptab= apop_data_alloc(0,max_k,2);
apop_name_add(ptab −>names,"Mode", ’c’);
apop_name_add(ptab −>names,"Likelihood ofmore", ’c’);
for(inti=0;i< max_k; i++){
apop_data_set(ptab, i, 0,i);
apop_data_set(ptab, i, 1,boot(data,ktab[i], i, r));
}
returnptab;
}
voidsetvars(gsl_vector *data){//rescale based onthe data.
doublem1 =gsl_vector_max(data);
doublem2 =gsl_vector_min(data);
modect_scale = (m1 −m2)/200;
modect_min = m2−(m1−m2)/100;
modect_max = m1+(m1 −m2)/100;
}
intmain(){
APOP_COL(apop_text_to_data("data −tv",0,0), 0,data);
setvars(data);
FILE*f = fopen(outﬁle,"w");
apop_opts.output_type = ’p’;
apop_opts.output_pipe = f;
double*ktab= calloc(max_k, sizeof(double));
ﬁll_kmap(data,f,ktab);
fclose(f);
gsl_rng*r = apop_rng_alloc(3);
apop_data_show(produce_p_table(data, ktab, r));
}
Listing11.12 Silverman’skernel densitytest for bimodali ty. Online source: /CQ/CX/D1/D3/CS/CP/D0/CX/D8/DD/BA
gsl_stats March24,2009
380 CHAPTER 11
Another way to speed the process in /CQ/CX/D1/D3/CS/CP/D0/CX/D8/DD/BA is to clump the data before
summing the Normal distributions. If there are three points at−.1,0, and.1, then
thiswillrequirethreecalculationsoftheNormalPDFforev erypointalongthereal
line. If they are clumped to 0, then we can calculate the Norma l PDF for µ= 0
timesthree, whichwill runthree timesasfast.
Q11.7Write a function to group nearby data points into a single poi nt with a
given weight (you can use the /DB/CT/CX/CV/CW/D8element of the /CP/D4/D3/D4/CN/CS/CP/D8/CP struc-
turetorecordit). Rewritethe /D3/D9/D2/D8/D1/D3/CS/CT/D7 functiontousetheclumpedand
weighteddataset.Howmuchclumpingdoyouneedtodobeforet heresults
degradesigniﬁcantly?
®Via resampling, you can test certain hypotheses without ass uming
parametricforms like the tdistribution.
®The typical kernel density estimate consists of specifying a distribu-
tion for everypoint in the data set, and then combiningthem t o form
aglobaldistribution.Theresultingdistributionisinman ywaysmuch
morefaithful to thedata.
®Asthebandwidthofthesub-distributionsgrows,theoveral ldistribu-
tion becomessmoother.
®One can test hypotheses about multimodality using kernel de nsities,
by ﬁnding the smallest level of smoothing necessary to achie ven-
modality,andbootstrappingto seetheoddsthatthatlevelo fsmooth-
ingwould produce n-modality.
gsl_stats March24,2009
A: ENVIRONMENTS AND MAKEFILES
SinceCisastandard,notaproductfromasinglecorporation orfoundation,differ-
entC developmentenvironmentshaveminor, potentiallymad deningdifferences.
The problem of whether a decent compiler and useful librarie s are available on
a given system has basically been surmounted: if something i s missing, just ask
the package manager to install it from the Internet. But then the next question is:
wheredidthepackagemanagerputeverything?Somesystemsl iketoputlibraries
in /BB/D9/D7/D6/BB/D0/D3/CP/D0 , some like to put them in /BB/D3/D4/D8/BB, and neither of these locations
evenmakessensefor theever-eccentricWindowsoperatings ystem.
The solution is to set environment variables that will specify how your compiler
will ﬁnd the various elements it needs to produce your progra m. These variables
aremaintainedbythe operatingsystem,asspeciﬁedbythe PO SIXstandard.1
A.1 E NVIRONMENT VARIABLES If you type /CT/D2/DAat the command prompt,
youwill geta list of the environmentvari-
ablessetonyoursystem.Here isa samplingfrom myownprompt :
SHELL=/bin/bash
USER=klemens
1Later members of the Windows family of operating systems cla im POSIX compliance, meaning that most
of this works from the Windows command prompt, although this may require downloading Microsoft’s Interix
package. However, the Cygwin system has its own prompt which basically keeps its own set of environment
variables, and Iwill assume you areusing Cygwin’s shell rat her than that of Windows.
gsl_stats March24,2009
382 APPENDIX A
LD_LIBRARY_PATH=/usr/local/lib:
PATH=/home/klemens/tech/bin:/usr/local/bin:/usr/bin :/bin:/usr/games:/sbin
HOME=/home/klemens
Every time a program spawns a new subprogram, the environmen t variables are
duplicated and passed to the child program. Notably, when yo u start a program
from the shell prompt, all of the environment variables you s aw when you typed/CT/D2/DAare passedonto the program.
The /CT/D2/DAcommandworks wellwith /CV/D6/CT/D4(seepage404).Forexample,to ﬁndout
whichshellyouareusing,try /CT/D2/DA /DG /CV/D6/CT/D4 /CB/C0/BX/C4/C4.
Setting Now that you know which shell you are using, the syntax for set ting envi-
ronmentvariablesdiffers slightly from shellto shell.
You are probably using /CQ/CP/D7/CWor another variant of the Bourne shell.2In these
systems,setenvironmentvariablesusingtheshell’s /CT/DC/D4/D3/D6/D8command:
exportUSER=Stephen
Someshellsarepickyaboutspacing,andwillcomplainifthe reisaspacebeforeor
aftertheequalssign.Othersdonotevenacceptthis syntax, andrequire atwo-line
version:
USER=Stephen
exportUSER
Thisformclariﬁesthattheprocessofsettinganenvironmen tveriablein /CQ/CP/D7/CWcon-
sistsofﬁrstsettingalocalvariable(whichisnotpassedon tochildprograms)and
then moving it from the set of local variables to the set of env ironment variables.
If you do not do much shell programming, there is no loss in set ting all variables
in theenvironment.
TheotherfamilyofshellsistheCshell,whichbearsavague, passingresemblance
to theC programminglanguage.In /D7/CW, use /D7/CT/D8/CT/D2/DA:
setenvUSERStephen
2/CQ/CP/D7/CW=Bourne-again shell, since itis an overhaul of theshell Ste phen Bourne wrote for UNIX in 1977.
gsl_stats March24,2009
ENVIRONMENTS AND MAKEFILES 383
Getting Inallshells,andmanyshell-likeprograms,youcangetthev alueofavari-
ablebyputting adollarsignbeforethevariablename.Forex ample,
echo$USER
willprintthecurrentvalueofthe /CD/CB/BX/CAvariabletothescreen.Togiveamoreuseful
example,
exportPATH=$PATH:$HOME/bin
will extend the /C8/BT/CC/C0, replacing that variable with a copy of itself plus another
directoryattheend.Formyownalreadylengthypath,listed above,thiscommand
wouldresultin thefollowing newpath:
PATH=/home/klemens/tech/bin:/usr/local/bin:/usr/bin :/bin:/usr/games:/sbin:/home/klemens/bin
Setting for good Every time your shell starts, it reads a number of conﬁgurati on
ﬁles;seeyourshell’smanualpage( /D1/CP/D2 /CQ/CP/D7/CW, /D1/CP/D2 /D7/CW,...)for
details.Butmostallofthemreadaﬁleinyourhomedirectory whosenamebegins
with a dotandendsin /D6,suchas /BA/CQ/CP/D7/CW/D6 or /BA/D7/CW/D6.
ItisaPOSIXcustomthatifaﬁlebeginswithadot,thenitishi dden,meaningthat
the usual directory listing such as /D0/D7will not show these ﬁles. However, if you
explicitly ask for hidden ﬁles, via /D0/D7 /B9/CP, /D0/D7 /B9/CS /BA/B6, or your GUI ﬁle browser’s
show hidden option, you will certainly ﬁnd a number of /BA/D6ﬁles in your home
directory.3
The shell’s /BA/D6ﬁles are plain text, and generally look like the sort of thing you
would type on a command line—because that is what they are. If you put an/CT/DC/D4/D3/D6/D8or /D7/CT/D8/CT/D2/DAcommand in this ﬁle, then those commands will be read ev-
erytime yourshellstarts,andthevariableswill thusbeset appropriatelyfor allof
yourwork.
• The ﬁle does not auto-execute after you edit. To see the effe cts of your edit, ei-
ther exit and re-enter the shell, or use /D7/D3/D9/D6/CT /BA/CQ/CP/D7/CW/D6 or /D7/D3/D9/D6/CT /BA/D7/CW/D6to
explicitlyasktheshellto readtheﬁle.
3By the way, when making backups of your home directory, it is w orth verifying that hidden ﬁles are also
backed up.
gsl_stats March24,2009
384 APPENDIX A/F4GETTING AND SETTING FROM CIt is easy to read and write environment vari-
ablesin a POSIXsystembecauseit iseasyto
read and write them in C. Listing A.1 shows that the /CV/CT/D8/CT/D2/DAfunction will return
a string holding the value of the given environment variable , and /D7/CT/D8/CT/D2/DAwill set
the given environment variable (on line 6, /CD/CB/BX/CA) to the given value (“Stephen”).
The third argument to /D7/CT/D8/CT/D2/DAspeciﬁeswhether an existing environment variable
should be overwritten. There are a few other useful environm ent-handling func-
tions;seeyourstandardC library referencefordetails.
1#include <stdlib.h> //environment handling
2#include <stdio.h>
3
4intmain(){
5 printf("Youare: %s\n",getenv("USER"));
6 setenv("USER", "Stephen", 1);
7 printf("But now you are: %s\n", getenv("USER"));
8 }
ListingA.1 Gettingand settingenvironment variables. Onl ine source: /CT/D2/DA/BA.
WhyisitsafetoruntheprograminListingA.1,whichwillove rwriteanimportant
environmentvariable?Becauseachildprocess(yourprogra m)canonlychangeits
own copy of the environment variables. It can not overwrite t he variables in the
environmentof a parentprocess(the shell). Overriding thi s basic security precau-
tionrequiresagreatdealofcooperationfrom theparentpro cess.Butthisdoesnot
make /D7/CT/D8/CT/D2/DAuseless: if your program starts other programs via a functio n like/D7/DD/D7/D8/CT/D1or /D4/D3/D4/CT/D2, then they will inherit the current set of environment varia bles.
When the shell opened your program, it passed in its environm ent in exactly this
manner.
®The operatingsystem maintainsa setof variablesdescribin gthe cur-
rentoverallenvironment,suchastheuser’snameorthecurr entwork-
ingdirectory.
®Theseenvironmentvariablesarepassedto allchild program s.
®They can be set or read on the command line or from within a pro-
gram.
gsl_stats March24,2009
ENVIRONMENTS AND MAKEFILES 385
A.2 P ATHS Onto the problemofgettingyourCcompilerto ﬁndyourlibrar ies.
When you type a command, such as /CV, the shell locates that program on your
hard drive and loads it into memory. But given that an executa ble could be any-
where (maybe /BB/CQ/CX/D2, /BB/D3/D4/D8, or /BM\ /C8/D6/D3/CV/D6/CP/D1 /BY/CX/D0/CT/D7), how does the shell know
wheretolook?Itusesanenvironmentvariablenamed /C8/BT/CC/C0thatlistsasetofdirec-
tories separated by colons (except on non-Cygwin Windows sy stems, where they
are separated by semicolons). You saw a number of examples of such a variable
above,andcanrun /CT/D2/DA /DG /CV/D6/CT/D4 /C8/BT/CC/C0to checkyourownpath.
When you type a command,the shellchecksthe ﬁrst directory o n the path for the
programyourequested.Ifitﬁndsanexecutablewiththerigh tname,thentheshell
runsthatprogram;elseit movesonto thenextelementofthep athandtries again.
If it makes its way through the entire path without ﬁnding the program, then it
givesupandsendsbackthefamiliar commandnotfound errormessage.
The current directory, /BA/BB, is typically not in the path, so programs you can see
with /D0/D7will not be found by searchingthe path.4The solution is to either give an
explicitpath,like /BA/BB/D6/D9/D2/CN/D1/CT , orextendthecurrentdirectory to yourpath:
exportPATH=$PATH:./
Recall that by adding this line to your /BA/CQ/CP/D7/CW/D6 or /BA/D7/CW/D6, the path will be ex-
tendedeverytime youlog in.
There are two paths that are relevant to compilation of a C pro gram: the include
pathandthelibrarypath.5Theprocedureisthesameaswiththeshell’sexecutable
path: when you /AZ/CX/D2/D0/D9/CS/CT a ﬁle (e.g., lines 1 and 2 of Listing A.1), the prepro-
cessor steps through each directory listed in the include pa th checking for the re-
quested header ﬁle. It uses the ﬁrst ﬁle that matches the give n name, or gives up
with aheadernotfound error. Whenthelinkerneedsto getafunctionorstructure
from a library, itsearchesthelibrary pathin the samemanne r.
But unlike the executablepath, there are severalways for a d irectory to appearon
theincludeorlibrary path.
4Many consider putting the current directory in the path to be a security risk (e.g., Frisch (1995, p 226)); in
security lingo, it allows a current directory attack . If the current directory is at the head of the path, a malicio us
usercould putascriptnamed /D0/D7inacommondirectory, wherethescriptcontains thecommand /D6/D1 /B9/D6/CU /B0/C0/C7/C5/BX.
When you switch to that location and try to get a directory lis ting, the shell instead ﬁnds the malicious script,
and your home directory is erased. Putting the current direc tory at the end of the path provides slightly more
protection, but the malicious script could instead be named after a common typo, such as or /D1/D6. But given that
many of today’s POSIX computers are used by one person or afew close associates, adding /BA/BBto the path is not
areal risk in mostsituations.
5Java users will notice a close resemblance between these pat hs and the /BV/C4/BT/CB/CB/C8/BT/CC/C0 environment variable,
which is effectively an include and alibrary path in one.
gsl_stats March24,2009
386 APPENDIX A
• There is a default include path and a default library path, b uilt in to the compiler
and linker. This typically includes /BB/D9/D7/D6/BB/CX/D2/D0/D9/CS/CT and /BB/D9/D7/D6/BB/D0/D3/CP/D0/BB/CX/D2/D0/D9/CS/CT in
theincludepath,and /BB/D9/D7/D6/BB/D0/CX/CQ and /BB/D9/D7/D6/BB/D0/D3/CP/D0/BB/D0/CX/CQ in the libpath.
• Theenvironmentvariables /C1/C6/BV/C4/CD/BW/BX/C8/BT/CC/C0 and /C4/C1/BU/C8/BT/CC/C0 arepartofthepath.These
names are sometimes different, depending on the linker used : /CVuses /D0/CS, so it
looksfor /C4/BW/CN/C4/C1/BU/CA/BT/CA/CH/CN/C8/BT/CC/C0 —exceptonMacsystems,whereitlooksfor /BW/CH/C4/BW/CN/B9/C4/C1/BU/CA/BT/CA/CH/CN/C8/BT/CC/C0 .OnHP-UX systems,try /CB/C0/C4/C1/BU/CN/C8/BT/CC/C0 .Ormoregenerally,try /D1/CP/D2/D0/CSor /D1/CP/D2 to ﬁndtheright environmentvariablefor yoursystem.
• Youcanaddto thepathsonthe compiler’scommandline. Theﬂ ag/B9/C1/BB/D9/D7/D6/BB/D0/D3/CP/D0/BB/CX/D2/D0/D9/CS/CT
wouldaddthatdirectory to theincludepath,andtheﬂag/B9/C4/BB/D9/D7/D6/BB/D0/D3/CP/D0/BB/D0/CX/CQ
wouldaddthatdirectory to thelibrary path.
Also, some libraries are shared, which in this context means that they are linked
not during compilation, but when actually called in executi on. Thus, when you
executeyournewly-compliedprogram, you could still geta m issing library error;
toﬁxthisyouwouldneedtoaddthedirectorytoyourlibpathe nvironmentvariable.
Searching So, now that you know the syntax of adding a directory to your /C8/BT/CC/C0s,
which directory should you add? Say that you know you need to a dd
the header for the TLA library, which will be a ﬁle with a name l ike /D8/D0/CP/BA/CW. The
command /CU/CX/D2/CS /CS/CX/D6 /B9/D2/CP/D1/CT /D8/D0/CP/BA/CWwillsearch /CS/CX/D6andeverysubdirectoryof /CS/CX/D6
foraﬁlewiththegivenname.Searchingtheentirehierarchy beginningattheroot
directory, via /CU/CX/D2/CS /BB /B9/D2/CP/D1/CT /D8/D0/CP/BA/CW, typically takes a human-noticeable amount
oftime,sotrysomeofthetypicalcandidatesfor /CS/CX/D6ﬁrst: /BB/D9/D7/D6, /BB/D3/D4/D8, /BB/D0/D3/CP/D0,or
forMacOS X, /BB/D7/DB.
Compiledlibrarieshavedifferentnamesondifferentsyste ms,soyourbestbetisto
searchforallﬁlesbeginningwithagivenstring,e.g., /CU/CX/D2/CS /CS/CX/D6 /B9/D2/CP/D1/CT /B3 /D8/D0/CP/BA/B6 /B3.
Assembling the compiler command line There is nothing in your source code
thattells thesystemwhichlibraries are
to belinkedin,sothe libraries mustbelisted onthecommand line. First, youwill
list the non-standard directories to search, using the capi tal /B9/C4ﬂag, then you will
needanotherlower-case /B9/D0ﬂagforeachlibrary to becalledin.
Ordermatterswhenspecifyinglibraries. Beginwiththemost-dependentlibraryor
objectﬁle,andcontinuetotheleastdependent.TheApophen ialibrarydependson
SQLite3 and the GSL library—which depends on a BLAS library l ike the GSL’s
companion CBLAS. If your program already has an object ﬁle na med /D7/D3/D9/D6/CT/BA/D3
gsl_stats March24,2009
ENVIRONMENTS AND MAKEFILES 387
and you want the output program to be named /D6/D9/D2/CN/D1/CT, then you will need to
specifysomethinglike
gcc source.o−lapophenia−lgsl−lcblas−lsqlite3
or
gcc source.o−lapophenia−lsqlite3−lgsl−lcblas
The Sqlite3 library and GSL/CBLAS are mutually independent , so either may
comeﬁrst.Therestoftheorderingmustbeasaboveforthecom pilationtowork.6
You may also need to specify the location of some of these libr aries; the path ex-
tensionwill havetocomeﬁrst, sothecommandnowlookslike
gcc−L/usr/local/libsource.o −lapophenia−lgsl−lcblas−lsqlite3
This is an immense amount of typing, but fortunately, the nex t section offers a
programdesignedto saveyoufrom suchlabor.
®Many systems, including the shell, the preprocessor, and th e linker,
searcha speciﬁeddirectorypath forrequesteditems.
®The default path for the preprocessorand linker can be exten ded via
both environment variables and instructions on the compile r’s com-
mandline.
A.3 M AKEThe /D1/CP/CZ/CTprogram providesa convenientsystem for you to specify
ﬂags for warnings and debugging symbols, include paths, lib raries
to link to, and who knows what other details. You write a makeﬁ le that describes
what source ﬁles are needed for compilation and the ﬂags the c ompiler needs on
your system, and then /D1/CP/CZ/CTassembles the elaborate command line required to
invoke the compiler. Many programs, such as /CV/CS/CQ, /DA/CX, and /BX/C5/BT/BV/CB, will even let
yourun /D1/CP/CZ/CTwithoutleavingtheprogram.Becauseassemblingthecomman dline
by hand is so time consuming and error-prone, you are strongl y encouraged to
haveamakeﬁleforeachprogram.
Fortunately,onceyouhaveworkedouttheﬂagsandpathstoco mpileoneprogram,
the makeﬁle will probably work for every program on your syst em. So the effort
ofwriting amakeﬁlepaysoffasyoureusecopiesforeverynew program.
The discussion below is based on Listing A.2, a makeﬁle for a p rogram named
6With some linkers, order does not matter. If this is the case o n your system, consider yourself lucky, but try
to preserve the ordering anyway to ease any potential transi tion to another system.
gsl_stats March24,2009
388 APPENDIX A/D6/D9/D2/CN/D1/CT, which has two /BAﬁles and one header ﬁle. It is not very far removed
from the samplemakeﬁleinthe onlinecodesupplement.
1 OBJECTS= ﬁle1.oﬁle2.o
2 PROGNAME= run_me
3 CFLAGS=−g−Wall−Werror−std=gnu99
4 LINKFLAGS= −L/usr/local/lib−lgsl−lgslcblas−lsqlite
5 COMPILE= gcc $(CFLAGS) −c$<−o$@
6
7 executable:$(OBJECTS)
8 gcc $(CFLAGS)$(OBJECTS) $(LINKFLAGS) −o$(PROGNAME)
9
10 ﬁle1.o:ﬁle1.cmy_headers.h
11 $(COMPILE)
12
13 ﬁle2.o:ﬁle2.cmy_headers.h
14 $(COMPILE)
15
16 run: executable
17 ./$(PROGNAME) $(PARGS)
ListingA.2 A sample makeﬁle for a program withtwosource ﬁle s.
The /D1/CP/CZ/CTprogram does two types of operation: expanding variable nam es and
followingdependencies.
Variable expansion Variablenamesinamakeﬁlelookmuchlikeenvironmentvari-
ables, and behave much like them as well. They are slightly
easier to set—as on lines 1–5, just use /CE/BT/CA /BP /DA/CP/D0/D9/CT. When referencing them,
use a dollar sign and parens, so line ﬁve will replace /B0/B4/BV/BY/C4/BT/BZ/CB/B5 with /B9/CV /B9/CF/CP/D0/D0/B9/CF/CT/D6/D6/D3/D6 /B9/D7/D8/CS/BP/CV/D2/D9/BL/BL . All of the environment variables are also available this
way,soyourmakeﬁlecanincludedeﬁnitionslike:
INCLUDEPATH=$(INCLUDEPATH):$(HOME)/include
As with environment variables, variables in makeﬁles are cu stomarily in all caps,
and as with constants in any program, it is good form to group t hem at the top of
theﬁle foreaseofreferenceandadjustment.
The /B0and /B0/BOvariables on line ﬁve are special variables that indicate th e target
and the ﬁle used to build it, respectively, which brings us to the discussion of
dependencyhandling.
gsl_stats March24,2009
ENVIRONMENTS AND MAKEFILES 389
Dependencies Theremainderoftheﬁle isa seriesoftarget/dependencypai rsand
actions. A targetis something to be produced.Here the targets are
object ﬁles and an executable,and on page 188, there is a make ﬁle whose targets
are PDFs and graphics. The dependency is the source containing the data used
to produce the target. An object ﬁle depends on the C source co de deﬁning the
functions and structures, an executable depends on the obje ct ﬁles being linked
together, and a PDF document depends on the underlying text. In most of these
cases, the dependency is data that you yourself wrote, while the target is always
computergenerated.
The lines with colons, such as line ten, are target/dependen cy descriptions: the
single item before the colon is the target name, and the one or several items after
thecolonarethe ﬁlesorothertargets uponwhich thetargetd epends.
After each target line, there are instructions for building the target from the de-
pendencies.For a simple C program, the instructions are one line (typically a call
to /CV). The makeﬁle on page 188 shows some more involved target bui ld scripts
thatspanseverallines.
Animportantannoyance:thelinesdescribingthebuildingp rocessareindentedby
tabs, not spaces. If your text editor replaces tabs with a set of spaces, /D1/CP/CZ/CTwill
fail.7
Having described the format of the makeﬁle, let us go over the process that the
systemwill go throughwhenyoutype /D1/CP/CZ/CTon the commandline. Theﬁrsttarget
inamakeﬁleisthedefaulttarget,andiswhere /D1/CP/CZ/CTbeginsifyoudonotspecifya
targetonthecommandline.So /D1/CP/CZ/CTlooksatthetargetspeciﬁcationonlineseven
and,usingitspowersofvariableexpansion,seesthat /D6/D9/D2/CN/D1/CTdependson /CU/CX/D0/CT/BD/BA/D3
and /CU/CX/D0/CT/BE/BA/D3. Let us assume that this is the ﬁrst time the program is being b uilt,
so neither object ﬁle exists. Then /D1/CP/CZ/CTwill search for a rule to build them, and
thus digresses to the later targets. There, it executes the c ommand speciﬁed by/B0/B4/BV/C7/C5/C8/C1/C4/BX/B5 on lines 11 and 14. Having created the subsidiary targets, it then
returnstotheoriginaltarget,andrunsthecommandtolinkt ogetherthetwoobject
ﬁles.
Let us say that you then modify /CU/CX/D0/CT/BD/BA (but none of the other ﬁles) and then
call /D1/CP/CZ/CTagain.Theprogramagainstarts atthe topofthetree oftarge ts,andsees
that it needs to check on /CU/CX/D0/CT/BD/BA/D3 and /CU/CX/D0/CT/BE/BA/D3. Checking the dependencies for/CU/CX/D0/CT/BD/BA/D3,itseesthattheﬁleisnotup-to-date,becauseitsdependen cyhasanewer
time stamp.8So /CU/CX/D0/CT/BD/BA/D3 is recompiled, and /D6/D9/D2/CN/D1/CTthen recreated. The system
knows that /CU/CX/D0/CT/BE/BA/D3 does not need to be recompiled, and so it does not bother to
doso.Inalargerproject,whererecompilationofthewholep rojectcantakeseveral
secondsorevenminutes, /D1/CP/CZ/CTwill thussaveyoutime aswellastyping.
7The odds are good that /BO/D8/D6/D0/B9/CE/BQ will let you insert an odd character into your text. E.g., /BO/D8/D6/D0/B9/CE/BQ/BO/D8/CP/CQ/BQ
will insert atab without converting itto spaces.
8Whatshouldyoudoifthetimestamponaﬁleisbroken,because itwascopied fromacomputerinadifferent
timezoneorwasotherwisemis-stamped?The /D8/D3/D9/CWcommand(e.g., /D8/D3/D9/CW /B6/BA)willupdatethetimestampon
aﬁle to the current time. Ifyou want maketo recompile /CU/CX/D0/CT/BD/BA/D3, you can do so with /D8/D3/D9/CW /CU/CX/D0/CT/BD/BA/BN /D1/CP/CZ/CT.
gsl_stats March24,2009
390 APPENDIX A
Compile && run Almostwithoutfail, the nextstep aftera successfulcompil eis to
run the program. The makeﬁle abovegivesyou the option of do-
ingthisviathe /D6/D9/D2dependencyonlines16–17,whichdependsonthe /CT/DC/CT/D9/D8/CP/CQ/D0/CT
dependencyonline7.Youcanspecifytargetsonthecommandl ine;ifyousimply
type /D1/CP/CZ/CT, then the system assumes the ﬁrst target in the ﬁle (line 7), a nd if you
typethecommand /D1/CP/CZ/CT /D6/D9/D2,thenitwillusetheinstructionsunderthe /D6/D9/D2target./D1/CP/CZ/CThalts on the ﬁrst error, so if the program fails to compile, th e system stops
and lets you make changes; if it compiles correctly, then /D1/CP/CZ/CTgoes on to run the
program. It considers a compilation with warnings but no err ors to be successful,
but you should heed all warnings. The solution is to add /B9/CF/CT/D6/D6/D3/D6 to the /BV/BY/C4/BT/BY/CB
commandline,to tell thecompilerto treatwarningsaserror s.
There is no easy way to pass switches and other command-line i nformation from/D1/CP/CZ/CT’s commandline to thatof yourprogram.The makeﬁlehere uses the hackof
deﬁning an environment variable /C8/BT/CA/BZ/CB. On the command line, you can /CT/DC/D4/D3/D6/D8/C8/BT/CA/BZ/CB/BP/B3 /B9/CQ /DG/CV/D2/D9/D4/D0/D3/D8 /B9/D4/CT/D6/D7/CX/D7/D8/B3 ,and /D1/CP/CZ/CTwillrunyourprogramwiththe /B9/CQ
ﬂagandpipethe outputthrough /CV/D2/D9/D4/D0/D3/D8.
If you ﬁnd the /C8/BT/CA/BZ/CBhack to be too hackish, you can just run the program from
the command line as usual. Recall that in C syntax, the /CQin /B4/CP /B2/B2 /CQ/B5is eval-
uated only if /CPis true. Similarly on the command line: the command /D1/CP/CZ/CT /B2/B2/BA/BB/D6/D9/D2/CN/D1/CT will ﬁrst run /D1/CP/CZ/CT, then either halt if there are errors or continue on to/BA/BB/D6/D9/D2/CN/D1/CT if /D1/CP/CZ/CTwas successful. Again, you have one command line that does
bothcompilationandexecution;coupledwithmostshells’a bilitytorepeatthelast
commandline(try theup-arrowor /AX/AX),youhaveaveryfastmeansofrecompiling
andexecuting.
gsl_stats March24,2009
ENVIRONMENTS AND MAKEFILES 391
QA.1TakeoneofthesampleprogramsyouwroteinChapter2andcrea teadirec-
tory forit.
• Createa newdirectory, andcopyoverthe /BAﬁle.
• Copyoverthe sample /D1/CP/CZ/CT/CU/CX/D0/CT from the onlinesamplecode.
• Modify the /C8/CA/C7/BZ/C6/BT/C5/BX and /C7/BU/C2/BX/BV/CC/CB line to correspond to your
project.
• If you get errors that the system can not ﬁnd certain headers , then
you will need to modify the /C1/C6/BV/C4/CD/BW/BX/C8/BT/CC/C0 line. If you get errors
from the linker about symbols not found, you will need to chan ge
the /C4/C1/C6/C3/BY/C4/BT/BZ/CB line.
• Type /D1/CP/CZ/CTand verify that the commands it prints are what they
should be, and that you get the object and executable ﬁles you ex-
pected.
Now that you have a makeﬁle that works for your machine, you ca n copy
it for use for all your programs with only minimal changes (pr obably just
changingthe /C8/CA/C7/BZ/C6/BT/C5/BX or /C7/BU/C2/BX/BV/CC/CB).
®Themakeﬁlesummarizesthemethodofcompilingaprogramony our
system.
®At the head of the makeﬁle, place variables to describe the ﬂa gs
neededbyyourcompilerandlinker.
®The makeﬁle also speciﬁeswhat ﬁles depend on what others, so that
onlythe ﬁlesthatneedupdatingare updated.
gsl_stats March 24,2009
B: TEXT PROCESSING
If you are lucky, then your data set is in exactly the format it needs to be in to be
readbyyourstatspackage,Apophenia,Graphviz,etcetera.
Bydeﬁnition,youwillrarelygetlucky,sothisappendixwil l explainhowto mod-
ify atextﬁleto conform toaninputstandard.
Thebookso farhasincludeda greatdealon writing newtextﬁl es via the /D4/D6/CX/D2/D8/CU
family, but not much on the process of modifying existing ﬁle s. That is because
modifyingﬁlesin placeis,simply put,frustrating. Someth ingassimpleasreplac-
ing /BD/BCwith /BD/BC/BCrequiresrewriting the entire ﬁlefrom thatpointon.
Thus, this appendix will look at some means of modifying text via existing pro-
grams that go through the tedium of modifying ﬁles for you. It s goal, narrowly
deﬁnedby the rest of the text, is to showyou howto converta da ta ﬁle eitherinto
theinputformatrequiredbyastatspackageorintoacommand ﬁleinthelanguage
ofGnuplot,aGraphviz-family tool,orSQL.
As with the rest of the analysis, you should be able to execute these procedures
in a fully automated manner. This is because you will no doubt receive a revised
datasetnextweekwitheithercorrectionsormoredata,andb ecausewriting down
a script produces an audit trail that you or your colleagues c an use to check your
work.
The primary technique covered in this appendix is the parsin g ofregular expres-
sions,whereinyouspecifyacertainregularity,suchas numbersfollowedbyletters ,
gsl_stats March24,2009
TEXT PROCESSING 393
and a program searches for that regular expression in text an d modiﬁes it as per
yourinstructions.
AsecondarythemeisthePOSIXwatermetaphor.Dataﬂowsinas treamfromone
location to another, burbling out of data ﬁles and piping thr ough ﬁlters like /D7/CT/CS
(the stream editor). Eventually, the stream of data reaches its ﬁnal destination: a
graphic,a database,oranotherﬁleholdingclean,ﬁltered d ata.
Along the way, you will see how to effectively search your ﬁle s. As your projects
getlarge,youwilldesiretoolsthatﬁndeveryuseof,say, /CQ/D9/CV/CV/DD/CN/DA/CP/D6/CX/CP/CQ/D0/CT inyour
program or every reference to an author in your documents. Re gular expression
toolswill helpyouwith this.
After the discussion of how one assembles a pipeline from sma ll parts, this ap-
pendixwill coversimple searching,asan introductionto re gularexpressions.The
ﬁnalsectionappliesthesetoolstoproduceseveralscripts toreformattextﬁlesinto
aformat appropriatefor yourdata-handlingsystems.
B.1 S HELL SCRIPTS As with Gnuplot or SQLite’s command-line utility, you
can operate the shell(what many just call the command
line) by typing in commands or by writing a script and having t he shell read the
script. Thus, you can try the commands below on the command li ne, and when
theyworkasdesired,cutandpastethem into ascriptasaperm anentrecord.
Your script can do more than just reformat text ﬁles:it can be gin with some /D4/CT/D6/D0
or /D7/CT/CScommandstoreformatthedataﬁle,thencallyourCprogramto processthe
ﬁle,andﬁnallycallGnuplotto displayagraph.
The quickest way to make a script executable is to use the /D7/D3/D9/D6/CTcommand.
Given a list of commands in the text ﬁle /D1/DD/D7/D6/CX/D4/D8 , you can execute them using/D7/D3/D9/D6/CT /D1/DD/D7/D6/CX/D4/D8 .1
QB.1Write a short script to compile and execute /CW/CT/D0/D0/D3/CN/DB/D3/D6/D0/CS/BA . On the ﬁrst
line of the script, give the compilation command (as per the e xercise on
page 18), and on the second line, execute /BA/BB/CP/BA/D3/D9/D8. Then run your script
from the commandline.
1If you are going to run the script more than a few times, you may want to make it directly executable. This
is not the place for a full POSIX tutorial, but /CW/D1/D3/CS /BJ/BH/BH /D1/DD/D7/D6/CX/D4/D8 or /CW/D1/D3/CS /B7/DC /D1/DD/D7/D6/CX/D4/D8 will do the trick.
Having made the script executable, you can call a script in th e current directory (aka /BA/BB) from the shell using/BA/BB/D1/DD/D7/D6/CX/D4/D8 . [Whydo you need the /BA/BB? See thediscussion of paths in Appendix A.]
gsl_stats March24,2009
394 APPENDIX B
Shellsymbol Meaning Cequivalent/BQ sendoutputto aﬁle /CU/D3/D4/CT/D2/B4Ꜽ /CU/CX/D0/CT/D2/CP/D1/CT Ꜽ/B8 Ꜽ/DBꜼ/B5/BN/CU/D4/D6/CX/D2/D8/CU/BA/BA/BA/BN/BQ/BQ appendoutputto a ﬁle /CU/D3/D4/CT/D2/B4Ꜽ /CU/CX/D0/CT/D2/CP/D1/CT Ꜽ/B8 Ꜽ/CPꜼ/B5/BN/CU/D4/D6/CX/D2/D8/CU /BA/BA/BA/BN/BO readoutputfrom a ﬁle /CU/D3/D4/CT/D2/B4Ꜽ /CU/CX/D0/CT/D2/CP/D1/CT Ꜽ/B8 Ꜽ/D6Ꜽ/B5/BN/CU/CV/CT/D8/D7/BA/BA/BA/BN/DG redirect output to an-
otherprogram
/D4/D3/D4/CT/D2/B4Ꜽ /D4/D6/D3/CV/D2/CP/D1/CT Ꜽ/B8 Ꜽ/DBꜼ/B5/BN/CU/D4/D6/CX/D2/D8/CU/BA/BA/BA/BN/D4/D3/D4/CT/D2/B4Ꜽ /D4/D6/D3/CV/D2/CP/D1/CT Ꜽ/B8 Ꜽ/D6Ꜽ/B5/BN/CU/CV/CT/D8/D7/BA/BA/BA/BN/BO/BO take input from an in-
linescriptexercise for the reader (use/CU/CV/CT/D8/D7)
Table B.1 Redirection via the command prompt andC
REDIRECTION Each program has a standard input stream and a standard outpu t
stream,named /D7/D8/CS/CX/D2and /D7/D8/CS/D3/D9/D8,plusathirdstreamtypicallyused
for error messages, /D7/D8/CS/CT/D6/D6. This section will coverthe various meansof bending
and redirecting these streams, and the nextsection will cov era few tools you join
togetherto ﬁlterstreamsoftext.
By default /D7/D8/CS/CX/D2and /D7/D8/CS/D3/D9/D8are the keyboard and screen, respectively. For ex-
ample, /D7/CT/CSreadsfrom /D7/D8/CS/CX/D2andwrites to /D7/D8/CS/D3/D9/D8,sothe command
sed−np
simply /D4rints to the screenwhateveris typedin. If youtry it, youwil l seethatthis
meanssimplythat /D7/CT/CSrepeatswhateveryoutype.
shell prompt> sed−np
Hello.
Hello.
How are you?
How are you?
Stopimitatingme.
Stopimitatingme.
<ctrl−D>
Now for the shifting of the streams, via the shell symbols lis ted in Table B.1. A
clause of the form /BQ /CU/CX/D0/CT/D2/CP/D1/CT tells the system to write whatever it would have
gsl_stats March24,2009
TEXT PROCESSING 395
put on the screen to a ﬁle. Thus, if you put the command /D7/CT/CS /B9/D2 /D4 /BQ /D3/D9/D8/CU/CX/D0/CT
on the commandline, then nothing will print to the screen, bu twhateveryou type
(until youhit /BO/D8/D6/D0/B9/BW/BQ to exit)will bewritten to /D3/D9/D8/CU/CX/D0/CT.
As a variant, /BQ/BQ /D3/D9/D8/CU/CX/D0/CT will append to a ﬁle, rather than overwriting it as /BQ/D3/D9/D8/CU/CX/D0/CT would.
A /BOtells the system that it should take input not from the keyboa rd but from a
ﬁle. Thus, /D7/CT/CS /B9/D2 /D4 /BO /CX/D2/D4/D9/D8/CN/CU/CX/D0/CT will dump the contents of /CX/D2/D4/D9/D8/CN/CU/CX/D0/CT to
thescreen.
QB.2Use /D7/CT/CS /B9/D2 /D4andredirectionofboth inputandoutputto copya ﬁle.
Shellexpansion
POSIX-compliant shells use both ‘single-ticks’ and
“double-ticks” to delimit strings, but they behave dif-
ferently. The single-tick form does not expand /B0/CE/BT/CA
tothevalue ofthe /CE/BT/CAenvironment variable, anddoes
not treat \or /AXas special. Conversely, the “double-
tick” form makes all of these changes before the
called program sees the string. Single-ticks tend to
be easier to use for regular expressions, because of
the preponderance of special characters. Notably, it
is basically impossible to put a /AXinside double-ticks;
you will need a form like Ꜽ/D7/D8/CP/D6/D8 /D7/D8/D6/CX/D2/CV/AL/B9/D4/CP/D9/D7/CT/D7/D8/D6/CX/D2/CVꜼ \ /AXꜼ/AL/B9/CP/D2/CS /D3/D2/D8/CX/D2/D9/CT/BAꜼYour ﬁnal redirection option is the
pipe. The pipe connects /D7/D8/CS/D3/D9/D8for
oneprogramto /D7/D8/CS/CX/D2for another.
Question: what exponents of four
end in a six? On page 209 (and
in the code supplement), you will
ﬁnd a program, /CV/CT/D8/D3/D4/D8, that prints
exponents to /D7/D8/CS/D3/D9/D8. Below, you
will see that /CV/D6/CT/D4will search its
input for a certain pattern; for ex-
ample, /CV/D6/CT/D4 /B3/BI/B0/B3 /BO /D1/DD/CU/CX/D0/CT will
search /D1/DD/CU/CX/D0/CTfor lines ending in a
six. Thus, we could redirect the output for /CV/CT/D8/D3/D4/D8to a ﬁle, then input that ﬁle to/CV/D6/CT/D4.
./getopt 4> powers_of_four
grep ’6$’ < powers_of_four
Thepipe, /DG,streamlinesthisbydirectlylinking /D7/D8/CS/D3/D9/D8fromtheﬁrstprogramand/D7/D8/CS/CX/D2to thesecond,bypassingthe needfora ﬁlein betweenthe two c ommands.
./getopt 4| grep’6$’
This line prints the ﬁltered output of /CV/CT/D8/D3/D4/D8to the screen, at which point the
patternin the exponentsis eminentlyclear.
Nowthatyouhaveseen /BQ, /BQ/BQ,and /BO,youmaybewonderingabout /BO/BO.Appending
to input does not quite make sense; instead, this form allows you to put small
gsl_stats March24,2009
396 APPENDIX B
scripts that would normally be in a separate ﬁle directly on t he command line.
Hereis asampleusage:
gnuplot << end−of−script
set termpostscript
set out "redirect_test.ps"
plot sin(x)
end−of−script
The /CT/D2/CS/B9/D3/CU/B9/D7/D6/CX/D4/D8 markercanbeanystring( /BX/C7/BYisapopularchoice),andindi-
cates when the script will end. Everything from the ﬁrst line until the concluding
string (onits ownline)is sentto Gnuplotasif itwere typedi n directly./F4 /D7/D8/CS/CT/D6/D6 There is one more stream after /D7/D8/CS/CX/D2and /D7/D8/CS/D3/D9/D8: /D7/D8/CS/CT/D6/D6, which is
intended to print error messagesor diagonstics to the scree n, even when/D7/D8/CS/D3/D9/D8is dumpingdatatoaﬁle.Therearereasonsto redirectthis st reamaswell,
suchaswhenyourprogramisproducingsomanyerrorsthatthe yscrollfasterthan
youcanreadthem.
• In /D7/CW, use /BQ/B2anywhereyou would use /BQto redirect both /D7/D8/CS/D3/D9/D8and /D7/D8/CS/CT/D6/D6to
thegivendestination,e.g., /D1/CP/CZ/CT /BQ/B2 /CT/D6/D6/D3/D6/D7/BA/D8/DC/D8 .
• In /CQ/CP/D7/CW, write /D7/D8/CS/CT/D6/D6to a ﬁle is to use /BE/BQas you would /BQabove. For example,/D1/CP/CZ/CT /BE/BQ/CT/D6/D6/D3/D6/D7/BA/D8/DC/D8 will dumpallcompilationerrors to the /CT/D6/D6/D3/D6/D7/BA/D8/DC/D8 ﬁle./F4Streams and C C and UNIX co-evolved, so all of the above methods of redi-
rectinginputsandoutputshaveaneasyC implementation.
As you saw on pages166 ff, you can use /CU/D4/D6/CX/D2/D8/CU to send data to a ﬁle or another
program. You may havenoticed the close similarity betweeno pening/writing to a
ﬁleandopening/writingto a pipe:
FILE*f = fopen("write_to_me","w");
FILE*g =popen("gnuplot", "w");
fprintf(f,"Thewaves roll out.\n");
fprintf(g, "set label ’Thewaves roll out.’;setyrange [ −1:1]; plot−1");
fclose(f);
pclose(g);
Ifthiscodewereinaprogramnamed /DB/CP/D8/CT/D6,thenthe /CU/D3/D4/CT/D2and /CU/D4/D6/CX/D2/D8/CU instruc-
tions are analogous to /DB/CP/D8/CT/D6 /BQ /DB/D6/CX/D8/CT/CN/D8/D3/CN/D1/CT . The /D4/D3/D4/CT/D2and /CU/D4/D6/CX/D2/D8/CU pair are
analogousto /DB/CP/D8/CT/D6 /DG /CV/D2/D9/D4/D0/D3/D8.
gsl_stats March24,2009
TEXT PROCESSING 397
This book has spent little time on the subject of reading data from /D7/D8/CS/CX/D2(look
up /CU/D7/CP/D2/CUin your favorite C reference), but by changing the Ꜽ/DBꜼs to Ꜽ/D6Ꜽs in the
abovecode,the ﬂow ofdata is from the /BY/C1/C4/BX/B6to the program itself, analogousto/DB/CP/D8/CT/D6 /BO /DB/D6/CX/D8/CT/CN/D8/D3/CN/D1/CT and /CV/D2/D9/D4/D0/D3/D8 /DG /DB/CP/D8/CT/D6.
QB.3Modify /CV/CT/D8/D3/D4/D8/BA to ﬁlterits outputthrough /CV/D6/CT/D4.
• Popen /CV/D6/CT/D4 /B3/BI/B0/B3forwriting.
• Modify the /D4/D6/CX/D2/D8/CUstatementto an /CU/D4/D6/CX/D2/D8/CU statement.
The three standard pipes are deﬁned by C’s standard library, and can be used as
youwouldanyother /D4/D3/D4/CT/D2edstream.Thatis, /CU/D4/D6/CX/D2/D8/CU/B4/D7/D8/CS/D3/D9/D8/B8 Ꜽ/BW/CP/D8/CP /CU/D3/D6/D8/CW/B9/D3/D1/CX/D2/CV/BM \ /D2Ꜽ/B5and /CU/D4/D6/CX/D2/D8/CU/B4/D7/D8/CS/CT/D6/D6/B8 Ꜽ/CS/CP/D2/CV/CT/D6/AX \ /D2Ꜽ/B5will write to /D7/D8/CS/D3/D9/D8and/D7/D8/CS/CT/D6/D6asexpected.Whatisthedifferencebetween /CU/D4/D6/CX/D2/D8/CU/B4/D7/D8/CS/D3/D9/D8/B8 Ꜽ/CS/CP/D8/CPꜼ/B5
and /D4/D6/CX/D2/D8/CU/B4Ꜽ/CS/CP/D8/CPꜼ/B5 ? There is none;use whicheverform is mostconvenientfor
yoursituation.
Finally, there is the /D7/DD/D7/D8/CT/D1function, which simply runs its argumentas if it were
run from the command line. Most POSIX machines come with a sma ll program
named /CU/D3/D6/D8/D9/D2/CT, that prints fortune-cookie type sayings.Most of us can’t e at just
one, but consume a dozen or so at a time. Listing B.2 showsa pro gram that auto-
mates the processvia a /CU/D3/D6loop. The program doesnot use /D4/D6/CX/D2/D8/CUand doesnot/AZ/CX/D2/D0/D9/CS/CT /BO/D7/D8/CS/CX/D3/BA/CW/BQ ,becausetheCprogramitselfisnotprintinganything—the
childprogramsare.2
#include <stdlib.h>
intmain(){
for(inti=0;i< 12; i++){
system("fortune");
system("echo");
system("sleep6");
}
}
ListingB.2 Printfortunes. Online source: /CU/D3/D6/D8/D9/D2/CP/D8/CT/BA .
There are two differences between a /D7/DD/D7/D8/CT/D1command and a /D4/D3/D4/CT/D2command.
First, there is the fact that there is no way for the rest of the program to access/D7/DD/D7/D8/CT/D1’s input and output, while /D4/D3/D4/CT/D2allows input or output from within the
2This program is longer than it needs to be, because all three /D7/DD/D7/D8/CT/D1lines could be summarized to one:/D7/DD/D7/D8/CT/D1/B4Ꜽ/CU/D3/D6/D8/D9/D2/CT/BN /CT/CW/D3/BN /D7/D0/CT/CT/D4 /BIꜼ/B5/BN.Noticealsothatthe /CP/D4/D3/D4/CN/D7/DD/D7/D8/CT/D1 convenience function allows you
togiveacommandwithprintf-style placeholders; e.g., /CP/D4/D3/D4/CN/D7/DD/D7/D8/CT/D1/B4Ꜽ/D4 /B1/D7 /B1/D7Ꜽ/B8 /CU/D6/D3/D1/CN/CU/CX/D0/CT /B8 /D8/D3/CN/CU/CX/D0/CT /B5.
gsl_stats March24,2009
398 APPENDIX B
program.But also, /D7/DD/D7/D8/CT/D1will stopyourprogram andwaitfor the child program
toﬁnish,while /D4/D3/D4/CT/D2willopenthepipeandthenmoveontothenextstepinyour
program. So if the command has to ﬁnish before you can continu e, use /D7/DD/D7/D8/CT/D1,
andifthecommandissomethingthatshouldruninthebackgro undorshouldwait
fordatato becomeavailable,use /D4/D3/D4/CT/D2.
®All programs have standard inputs and outputs, which are by d efault
thekeyboardandscreen.
®Both /D7/D8/CS/CX/D2and /D7/D8/CS/D3/D9/D8can be redirected. /D7/D8/CS/CX/D2can read from a
ﬁle using the /BO /CX/D2/CU/CX/D0/CTform; /D7/D8/CS/D3/D9/D8can write to a ﬁle using the/BQ /D3/D9/D8/CU/CX/D0/CT form. Use /BQ /D3/D9/D8/CU/CX/D0/CT to overwrite and /BQ/BQ /D3/D9/D8/CU/CX/D0/CT to
append.
®Programscansendtheiroutputto otherprogramsusingthepi pe, /DG.
®You can do redirection from inside C, using /CU/D3/D4/CT/D2to effect the
command-line’s /BO /CX/D2/CU/CX/D0/CTand /BQ /D3/D9/D8/CU/CX/D0/CT, and /D4/D3/D4/CT/D2to open a
pipe.
B.2 S OME TOOLS FOR
SCRIPTINGDepending on your system, you can type somewhere
betweenafewhundredandafewthousandcommands
atthecommandprompt.Thissectionpointsoutafew
thatare especiallyusefulforthepurposesofdealingwith d atain textformat; they
are summarized in Table B.3. All but a few ( /D3/D0/D9/D1/D2, /CT/CV/D6/CT/D4, /D4/CT/D6/D0) are POSIX-
standard, and you can expect that scripts based on the standa rd commands will
be portable. The basic ﬁle handling functions ( /D1/CZ/CS/CX/D6, /D0/D7, /D4, ...) are listed for
reference, but are not discussed here. If you are not familia r with them, you are
encouraged to refer to any of an abundance of basic UNIX and PO SIX tutorials
onlineorin print(e.g.,Peek etal.(2002)).
Most of these commands are in some ways redundant with method s elsewhere in
thebook:youcoulduse /D9/D8topullonecolumnofdata,oryoucouldreadthedata
into a databaseand /D7/CT/D0/CT/D8the column; you could use /DBto countdata points, or
use /D7/CT/D0/CT/D8 /D3/D9/D2/D8/B4/B6/B5 to do the same.3Generally, command-line work is good
for pure text manipulation and quick questions (e.g., do I ha ve the thousands of
datapointsIwasexpecting?),whileyouwill needto write ap rogram orqueryfor
any sort of numeric analysis or to answer more detailed quest ions about the data
(e.g.,howmanyrowsareduplicates?).4
3There is even a /CY/D3/CX/D2command, which will do database-style joins of two ﬁles. How ever, it is hard to use
for any butclean numeric codes. For example, try using /CY/D3/CX/D2to merge /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 and /CS/CP/D8/CP/B9/DB/CQ/B9/CV/CS/D4 .
4/CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/D8/D3/CN/CS/D3/D9/CQ/D0/CT/B4Ꜽ/D7/CT/D0 /CT/D8 /D3/D9/D2/D8/B4/B6/B5 /CU/D6/D3/D1 /CS/CP/D8/CP Ꜽ/B5 /B9 /CP/D4/D3/D4/CN/D5/D9/CT/D6/DD/CN/D8/D3/CN/CS/D3/D9/CQ/D0/CT/B4Ꜽ/D7/CT /D0/CT /D8/D3/D9/D2/D8/B4/B6/B5 /CU/D6/D3/D1 /B4/D7/CT/D0/CT/D8 /CS/CX/D7/D8/CX/D2/D8 /B6 /CU/D6/D3/D1 /CS/CP/D8/CP /B5Ꜽ/B5
gsl_stats March24,2009
TEXT PROCESSING 399
Basicﬁlehandling/D1/CZ/CS/CX/D6/ /D6/D1/CS/CX/D6Makeorremoveadirectory/CS Changeto anewcurrentdirectory/D0/D7 Listdirectorycontents/D4/ /D1/DA Copyormove/renameaﬁle/D6/D1 Removea ﬁle
Reading/CP/D8 Listaﬁle, orconcatenatemultiple ﬁles/CW/CT/CP/CS/ /D8/CP/CX/D0 Listonlythe ﬁrst/lastfewlines ofa ﬁle/D0/CT/D7/D7/ /D1/D3/D6/CT Interactivelybrowsethroughaﬁle/D3/D0/D9/D1/D2 Displayaﬁle with its columnsaligned
Writing/D7/D3/D6/D8 Sort/D9/D8/ /D4/CP/D7/D8/CT Modify ﬁlesbycolumnsratherthanlines/D2/D0 Putaline numberatthe headofeachline/D9/D2/CX/D5 Deleteduplicatelines
Information/D1/CP/D2 Manualpagesforcommands/DB Countwords,lines,orcharacters/CS/CX/CU/CU Finddifferencesbetweentwo ﬁles
Regularexpressions/D7/CT/CS Stream editor:add/deletelines,search/replace/CV/D6/CT/D4/BB/CT/CV/D6/CT/D4 Searcha ﬁlefor astring/D4/CT/D6/D0 All ofthe above;usedhereforsearch/replace
TableB.3 Some commands useful for handling text ﬁles.
gsl_stats March24,2009
400 APPENDIX B/D1/CP/D2Whatdoesthe /BJ/BH/BHin /CW/D1/D3/CS /BJ/BH/BHdo?Ask /D1/CP/D2 /CW/D1/D3/CS.Whatdidthe /CT/CW/D3com-
mandinListingB.2do?Try /D1/CP/D2 /CT/CW/D3.Themanualpageslistthebasicfunction
ofaprogramanditsvarious switches.Theyarenotaverygoodwaytolearntouse
aPOSIX system,butarethe deﬁnitivereferencefor command- linedetails./CP/D8The simplest thing you could do with a text ﬁle is print it, and this is what/CP/D8does. Instead of opening a ﬁle in your text editor, you can sim ply type /CP/D8/CU/CX/D0/CT/CN/D8/D3/CN/D6/CT/CP/CS onthe commandpromptforaquicklook.
The other use of /CP/D8, for which it was named,is concatenation.Given two ﬁles /CP
and /CQ, /CP/D8 /CP /CQ /BQ writes /CPand,immediatelythereafter, /CQ, into ./D0/CT/D7/D7/ /D1/D3/D6/CTThesearethepagingprograms,usefulforviewinglongerﬁle s.ThePOSIX
standard, /D1/D3/D6/CT, issonamedbecauseforﬁlesof morethana screenfulof
text, it displays a page of text with a banner at the bottom of t he screen reading/D1/D3/D6/CT. The successor, /D0/CT/D7/D7, provides many more features (such as paging up as
well as down). These programs can also read from /D7/D8/CS/CX/D2, so you can try combi-
nationslike /D7/D3/D6/D8 /CS/CP/D8/CP/CN/CU/CX/D0/CT /DG /D0/CT/D7/D7./CW/CT/CP/CS/ /D8/CP/CX/D0 /CW/CT/CP/CS /D1/DD/CU/CX/D0/CTwillprinttheﬁrsttenlinesof /D1/DD/CU/CX/D0/CT,while /D8/CP/CX/D0 /D1/DD/CU/CX/D0/CT
will print the last ten. These are good for getting a quick ide a of what is
in a large ﬁle. Also, /D8/CP/CX/D0 /B9/CU /D1/DD/CU/CX/D0/CTwill follow /D1/DD/CU/CX/D0/CT, ﬁrst showing the last
ten lines, and then updating as new lines are added. This can p rovide reassurance
thataslow-runningprogramisstill working./D7/CT/CSThe stream editor will be discussed in much more detail below , but for now it
sufﬁcestoknowthatitcanbeusedtoreplicate /CW/CT/CP/CSor /D8/CP/CX/D0.Thecommand /D7/CT/CS/B9/D2 /B3/BD/B8/BF/D4/B3 /BO /CP/CN/CU/CX/D0/CTwill print the ﬁrst through third lines of /CP/CN/CU/CX/D0/CT. The last
lineisindicatedby /B0,so /D7/CT/CS /B9/D2 /B3/BE/B8/B0/D4/B3 /BO /CP/CN/CU/CX/D0/CTwillprintthesecondthrough
lastlines oftheﬁle./D7/D3/D6/D8Thisisasself-descriptiveasacommandcanget.The /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 ﬁle(inthe
code supplement) is sorted by population; /D7/D3/D6/D8 /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 would output
theﬁleinalphabeticalorder.Sorthasmanyusefulswitches ,thatwillsortignoring
blanks,by the second(or nth) column of data, in reverseorder, et cetera. See /D1/CP/D2/D7/D3/D6/D8for details.
gsl_stats March24,2009
TEXT PROCESSING 401
QB.4Sorting /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 like this sorts the two header lines in with all the
countries. Write a command that ﬁrst calls /D7/CT/CSto delete the headers, then
pipesthe outputto /D7/D3/D6/D8./D9/D8/ /D4/CP/D7/D8/CTAlmostallofthecommandshereoperateonrows; /D9/D8and /D4/CP/D7/D8/CToperate
on columns. Specify the delimiter with the /B9/CSﬂag, and then the ﬁeld(s)
withthe /B9/CUﬂag(wheretheﬁrstcolumniscolumnone,notzero).Togetali stofjust
countries from the World Bank data, try /D9/D8 /B9/CSꜼ/DGꜼ /B9/CU /BD /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 ; if you
wouldliketoseejustthepopulationnumbers,use /D9/D8 /B9/CSꜼ/DGꜼ /B9/CU /BE /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 ./D4/CP/D7/D8/CTputsits secondinputto the rightofits ﬁrstinput—itis a ver ticalversionof/CP/D8.
QB.5Use the command string from the last exercise to sort the popu lation
and GDP data into two new ﬁles. /D9/D8the second ﬁle down to include
onlythecolumnofnumbers.Thenuse /D4/CP/D7/D8/CT /D7/D3/D6/D8/CT/CS/CN/D4/D3/D4 /D7/D3/D6/D8/CT/CS/CN/CV/CS/D4/BQ/D3/D1/CQ/CX/D2/CT/CS/CN/CS/CP/D8/CP to produceoneﬁlewith bothtypesofdata.Verify thatthe
linesofdataarealignedcorrectly(i.e.,thattheAlbaniac olumndoesnotlist
theGDP ofAlgeria)./DBThis program (short for word count) will countwords, lines, and characters. The
defaultis toprintallthree,but /DB /B9/DB, /DB /B9/D0,and /DB /B9willgivejustoneofthe
threecounts.
When writing a text document,you could use it for a word count as usual: /DB /B9/DB/D6/CT/D4/D3/D6/D8/BA/D8/CT/DC . If you havea data ﬁle, the numberof data points is probably /DB /B9/D0/CS/CP/D8/CP(if thereis aheader,youwill needtosubtractthoselines).
This program is especially useful in tandem with /CV/D6/CT/D4(also discussed at length
below). How many lines of the /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 ﬁle have missing data (which the
WB indicatesby /BA/BA)? /CV/D6/CT/D4 /B3\ /BA\ /BA/B3 /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 will outputthoselines where
thestring /BA/BAappears; /DB /B9/D0willcountthelinesoftheinput;pipingthemtogether,/CV/D6/CT/D4 /B3\ /BA\ /BA/B3 /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 /DG /DB /B9/D0will countlines with /BA/BAs./D2/D0This command puts line numbers at the beginning of every line . Remember that
SQLite puts a /D6/D3/DB/CX/CSon every row of a table, which is invisible but appears if
explicitly /D7/CT/D0/CT/D8ed.Butifyouwanttoquicklyputacountercolumninyourdata
set,this is thewayto doit.
gsl_stats March24,2009
402 APPENDIX B/D3/D0/D9/D1/D2 [This command is not POSIX-standard, but is common for GNU- o r BSD-
based systems.] Text data will be easy to read for either a com puter or a
human, but rarely both. Say that a data ﬁle is tab-delimited, so each ﬁeld has ex-
actlyonetabbetweencolumns:
Name<tab>Age
Rumpelstiltskin<tab>78
Dopey<tab>35
This will read into a spreadsheet perfectly, but when displa yed on the screen, the
outputwillbemessy,sinceRumpelstiltskin’stabwillnotb ealignedwithDopey’s.
The /D3/D0/D9/D1/D2command addresses exactly this problem, by splitting colum ns and
inserting spaces for on-screen human consumption. For exam ple, /D3/D0/D9/D1/D2 /B9/D7Ꜽ/DGꜼ/B9/D8 /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 will format the /CS/CP/D8/CP/B9/DB/CQ/B9/D4/D3/D4 ﬁle into columns, splitting at the/DGdelimiters. The ﬁrst column will includethe headerlines, b ut you already know
howtoget /D7/CT/CStopipe headerlessdatainto /D3/D0/D9/D1/D2./CS/CX/CU/CU /CS/CX/CU/CU /CU/BD /CU/BEwill print only the lines that differ between two ﬁles. This c an
quickly be overwhelming for ﬁles that are signiﬁcantly diff erent, but after a
long day of modifying ﬁles, you may have a few versions of a ﬁle that are only
marginally different, and /CS/CX/CU/CUcan help to sort them out. By the end of this chap-
ter, that will be the case, so various opportunities to use /CS/CX/CU/CUwill appear below./BX/C5/BT/BV/CB, /DA/CX/D1,andsomeIDEshavemodesthatrun /CS/CX/CU/CUforyouandsimultaneously
displaythe differencesbetweenversionsofaﬁle.
To give another use, say that you have a running program, but w ant to clean up
the code a little. Save your original to a backup, and then run the backup pro-
gram, writing the output to /D3/D9/D8/BD. Then clean up the code as you see ﬁt, and run
the cleaned code, writing to /D3/D9/D8/BE. If you did no damage, then /CS/CX/CU/CU /D3/D9/D8/BD /D3/D9/D8/BE
shouldreturn nothing./D9/D2/CX/D5Thisprogramremovesmanyduplicatelinesfromaﬁle. /D9/D2/CX/D5 /CS/CX/D6/D8/DD /BQ /D0/CT/CP/D2
willwriteaversionoftheinputﬁlewithany successive duplicatelinesdeleted.
Forexample,giventheinput
1 a;
2 b;
3
4 b;
5 c;
6 c;
7 a;
gsl_stats March24,2009
TEXT PROCESSING 403
the output will omit line ﬁve but leave the remainder of the ﬁl e intact. If order
does not matter, then /D7/D3/D6/D8 /DD/D3/D9/D6/CN/CU/CX/D0/CT /DG /D9/D2/CX/D5will ensure that identical lines
aresequential,so /D9/D2/CX/D5willeasilybeabletocleanthemall.Alternatively,readth e
ﬁleto a databaseanduse /D7/CT/D0/CT/D8 /CS/CX/D7/D8/CX/D2/D8 /B6 /CU/D6/D3/D1 /DD/D3/D9/D6/CN/D8/CP/CQ/D0/CT .
B.3 R EGULAR EXPRESSIONS Theremainderofthisappendixwillcoverpro-
grams to parse regular expressions . Regular
expressions comprise a language of their own, which provide s a compact means
of summarizing a text pattern. Knowledge of regexes comes in handy in a wide
variety of contexts, including standard viewers like /D0/CT/D7/D7, a fair number of online
searchtools,andtexteditorslike /DA/CXand /BX/C5/BT/BV/CB.Entirebookshavebeenwrittenon
this oneseeminglysmallsubject,themostcomprehensivebe ingFriedl(2002).
Thischapterwillusegrep,sed,andPerlbecauseitistrivia ltousethemforregular
expression parsing and substitution from the command line. Other systems, such
as C or Python, require a regex compilation step before usage , which is nothing
butanextrastepin ascriptorprogram,butmakesone-lineco mmandsdifﬁcult./F4Standard syntax, lack thereof Unfortunately, there are many variants on the
regex syntax, since so many programs process
them, and the author of each program felt the need to make some sort of tweak
to the standard. Broadly, the basic regular expression ( BRE) syntax derives from/CT/CS, a text editor from back when the only output available to com puters was the
lineprinter.MostPOSIXutilities,suchas /D7/CT/CSor /CV/D6/CT/D4or /CP/DB/CZ,usethisbasicregex
syntax.
There is a barely-modiﬁed variant known as extended regular expression (ERE)
syntax,availablevia /CT/CV/D6/CT/D4andaswitchto manyotherutilities. Newfeatureslike
the special meaning of characters like /B4, /B5, /B7, or /DGevolved after a host of BRE
programs were already in place, so in the BRE syntax, these ch aracters match an
actual /B4, /B5, /B7, or /DGin the text, while they can be used as special operators when
precededbyabackslash(e.g., \ /B7,\ /DG,...).EREsusedthesecharactersto indicate
special operations from the start, so /B7is a special operator, while \ /B7indicates a
plainplussign (andsoonformostothercharacters).
The scripting language Perl introduced a somewhat expanded syntax for regular
expressionswith signiﬁcantlymore extensionsand modiﬁca tions,andmanypost-
PerlprogramsadoptedPerl-compatibleregularexpression s(PCREs).
ThischaptercoversPerlandGNUgrepandsedastheyexistaso fthiswriting,and
you are encouraged to check the manual pages or online refere nces for the subtle
shifts in backslashesamongotherregularexpressionsyste ms.
gsl_stats March24,2009
404 APPENDIX B
THE BASIC SEARCH The simplest search is for a literal string of text. Say that y ou
have a C program, and are searching for every use of a vari-
able, /DA/CP/D6. You can use the command-line program /CV/D6/CT/D4to search for /DA/CP/D6among
yourﬁles.5Thesyntaxissimple: /CV/D6/CT/D4 /DA/CP/D6 /B6/BAwillsearchallﬁlesinthecurrent
directoryendingin /BAforthestring /DA/CP/D6,andprinttheresultonthecommandline.
This is already enough to do a great deal. In olden times, prog rammers would
keep their phone book in a simple text ﬁle, one name/number pe r line. When
they needed Jones’s number, they could just run /CV/D6/CT/D4 /C2/D3/D2/CT/D7 /D1/DD/CN/D4/CW/D3/D2/CT/CN/CQ/D3/D3/CZ
toﬁndit.IfyouneedtoknowVenezuela’sGDP, /CV/D6/CT/D4willﬁnditinnotime: /CV/D6/CT/D4/CE/CT/D2/CT/DE/D9/CT/D0/CP /CS/CP/D8/CP/B9/DB/CQ/B9/CV/CS/D4 .
QB.6Use /CV/D6/CT/D4to searchallofyour.c ﬁlesforusesof /D4/D6/CX/D2/D8/CU.
The /B9/BV /D2option(e.g., /CV/D6/CT/D4 /B9/BV /BE)outputs ncontextlinesbeforeandafter
the match; repeat your search with two context lines before a nd after each/D4/D6/CX/D2/D8/CU.
Bracket expressions Now we start to add special characters from the regex lan-
guage. An expression in square brackets always represents
a single character, but that single character could be one of a number of choices.
For example, the expression /CJ/CU/D7℄will match either /CUor /D7. Thus, the expression/CJ/CU/D7℄/D4/D6/CX/D2/D8/CU will match both /CU/D4/D6/CX/D2/D8/CU or /D7/D4/D6/CX/D2/D8/CU (but not /D4/D6/CX/D2/D8/CU), so /CV/D6/CT/D4/CJ/CU/D7℄/D4/D6/CX/D2/D8/CU /B6/BAwill ﬁnd all such uses in your C ﬁles. More bits of bracket ex-
pressionsyntax:
• Youcanuseranges: /CJ/BT/B9/CI℄searchesforEnglishcapitalletters, /CJ/BT/B9/CI/CP/B9/DE℄ searches
forEnglishcapitalorlowercaseletters, and /CJ/BC/B9/BL℄matchesanydigit.
• You can match any character except those in a given list by pu ttingˆas the ﬁrst
item in the bracketed list. Thus, /CJˆ /CU/D7℄matches one single character that is not /CU
or /D7.6
• There are a few common sets of characters that are named for t he POSIX utili-
ties. For example, /CJ/CJ/BM/CS/CX/CV/CX/D8/BM℄℄ will search for all numbers, /CJ/BC/B9/BL℄. Notice that/CJ/BM/CS/CX/CV/CX/D8/BM℄ is the character class for digits, so /CJ/CJ/BM/CS/CX/CV/CX/D8/BM℄℄ is a bracket expres-
sionmatchinganysingledigit.SeeTableB.4forapartialli st.Thesecharactersets
are locale-dependent. For example, /G4is not in /CJ/BT/B9/CI℄, but if it is a common letter
in thelanguageyourcomputerspeaks,thenitwill beaneleme ntof /CJ/BM/CP/D0/D4/CW/CP/BM℄ .
5The name comes from an old /CT/CScommand (we’ll meet /CT/CSlater) for global regular expression printing:/CV/BB/D6/CT/BB/D4. Many just take it as an acronym for general regular expressi on parser.
6If you are searching for the ˆcharacter itself, just don’t put it ﬁrst in the bracket. Conv ersely, if you need a
literal dash that does not indicate a range, put it ﬁrst. To ﬁn d all lines with carats or dashes, try /CV/D6/CT/D4 Ꜽ/CJ/B9ˆ ℄Ꜽ/D1/DD/CU/CX/D0/CT.
gsl_stats March24,2009
TEXT PROCESSING 405
POSIX Perl English/CJ/BM/CS/CX/CV/CX/D8/BM℄ \d Numericcharacters./CJ/BM/CP/D0/D4/CW/CP/BM℄ Alphabeticcharacters./CJ/BM/D9/D4/D4/CT/D6/BM℄ Uppercasealphabeticcharacters./CJ/BM/D0/D3/DB/CT/D6/BM℄ Lowercasealphabeticcharacters./CJ/BM/CP/D0/D2/D9/D1/BM℄ \w Alphanumericcharacters./CJ/BM/CQ/D0/CP/D2/CZ/BM℄ Spaceandtabcharacters./CJ/BM/D7/D4/CP/CT/BM℄ \s Any white space, including space, tab ( \ /D8),
newline( \ /D2)./CJ/BM/D4/D9/D2/D8/BM℄ Punctuationcharacters/CJ/BM/D4/D6/CX/D2/D8/BM℄ Printable characters,includingwhite space./CJ/BM/CV/D6/CP/D4/CW/BM℄ Printable characters,excludingwhite space.
\D,\W,\S Not numeric chars, not alphanumeric chars,
notwhitespace
Table B.4 Someuseful regular expression character sets.
chars main regexmeaning meaningin brackets/CJ ℄Bracketexpression as /CJ/BM /BM℄, anamedgroup
ˆBeginningofline don’tmatchfollowing chars/BAAnycharacter plain period/B9A plaindash a range,e.g., /BC/B9/BL
Table B.5 Some characters have different meanings inside an d outside brackets.
Allofthesecanbe combinedintooneexpression.Forexample ,
[−+eE[:digit:]]
will match any digit, a minus or plus, or the letter /CT. Or, if you named a variable/D3/D4/D8but /CV/D6/CT/D4 /D3/D4/D8 /B6/BAspitsouttoomanycommentlinesabout /D3/D4/D8/CX/D3/D2/D7,try /CV/D6/CT/D4/D3/D4/D8/CJˆ /CX℄ /B6/BA.
Bracketscanbeabitdisorientingbecausethereisnothingi nthesyntaxtovisually
offset a group from the other elements in the bracket, and no m atter how long the
bracketedexpressionmaybe,theresultstillrepresentsex actlyonecharacterinthe
text.Also,asdemonstratedbyTableB.5,thesyntaxinsideb racketshasnothingto
dowith the syntaxoutsidebrackets.
gsl_stats March24,2009
406 APPENDIX B
Regular expressions are vehemently case-sensitive. /CV/D6/CT/D4 /D4/CT/D6/D0 /D7/CT/CP/D6/CW/CN/D1/CT will
not turn up any instances of /C8/CT/D6/D0. The ﬁrst option is to use the /B9/CXcommand-line
switchtosearchwithoutcase: /CV/D6/CT/D4 /B9/CX /D4/CT/D6/D0 /D7/CT/CP/D6/CW/CN/D1/CT .Thesecondoption,oc-
casionallyusefulformorecontrol,istouseabracket: /CV/D6/CT/D4 /CJ/C8/D4℄/CT/D6/D0 /D7/CT/CP/D6/CW/CN/D1/CT .
Alternatives Recall that Apophenia includes various printing functions , such as/CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D4/D6/CX/D2/D8 and /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D4/D6/CX/D2/D8 . Say that you would
like to see all such examples. Alternatives of the form A or Bare written in ba-
sic regex notation as /B4/BT/DG/BU/B5. Notice how this analogizes nicely with C’s /B4/BT/DG /DG/BU/B5
form.
Thisiswherethevariousﬂavorsofregularexpressiondiver ge,andthebackslashes
starttocreepin.Plain /CV/D6/CT/D4usesBREs,andsoneedsbackslashesbeforetheparens
andpipe: \ /B4/BT\ /DG/BU\ /B5. Whenrunas /CV/D6/CT/D4 /B9/BX, /CV/D6/CT/D4usesEREs.Mostsystemshave
an /CT/CV/D6/CT/D4commandthatis equivalentto /CV/D6/CT/D4 /B9/BX.7
Also, recall the difference between ‘single-ticks’ and “do uble-ticks” on the com-
mandline,asdiscussedin theboxonpage395:thesingle-tic kform doesnottreat
backslashesinaspecialmanner,soforexample,youcanﬁnda singleliteralperiod
with /B3\ /BA/B3insteadof Ꜽ\\ /BAꜼ.
Allthatsaid,hereareafewcommandsthatwillsearchforbot h /CP/D4/D3/D4/CN/CS/CP/D8/CP/CN/D4/D6/CX/D2/D8
and /CP/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D4/D6/CX/D2/D8 :
grep "apop_\\(data\\|matrix\\)_print" *.c
grep ’apop_\(data\|matrix\)_print’ *.c
grep−E "apop_(data|matrix)_print" *.c
egrep "apop_(data|matrix)_print" *.c
A few special symbols You sometimes won’t care at all about a certain segment.
A dot matches any character, and you will see below that
astarcanrepeatthe prioratom.Therefore
grep ’apop. *_print’*.c
will ﬁnd any line that has /CP/D4/D3/D4, followed by anything, eventually followed by/CN/D4/D6/CX/D2/D8.
• Once again, the symbols /BAand /B6mean different things in different contexts. In a
regex, the dot represents any character, and the star repres ents repetition; on the
7Ofﬁcially, /CT/CV/D6/CT/D4is obsolete and no longer part of the POSIXstandard.
gsl_stats March24,2009
TEXT PROCESSING 407
commandline(wherewildcardmatchingisreferredtoas globbing),thedotisjust
adot, andthe starrepresentsanycharacter.
• The caret and dollar sign ( ˆand $) indicate the beginning and end of the line,
respectively. /CV/D6/CT/D4 Ꜽˆ /CX/D2/D8Ꜽ /B6/BAwill only match lines where /CX/D2/D8is right at the
beginningoftheline,and /CV/D6/CT/D4 Ꜽ/DF/B0Ꜽ /B6/BAwillonlymatchopen-bracesattheend
oftheline.8
• A single space or tab are both characters, meaning that a dot will match them. In
grep, the atom \ /CFwill match any single spaceor tab, and the atom \ /DBwill match
anything that is not white space. Since there are frequently an unknown bunch of
tabsandspacesattheheadofcodeﬁles,abetterwaytosearch for /CX/D2/D8declarations
wouldbe
grep ’^\W *int’*.c
®The quickest way to search on the command line is via /CV/D6/CT/D4. The
syntaxis /CV/D6/CT/D4 /B3 /D6/CT/CV/D9/D0/CP/D6 /CT/DC/D4/D6/CT/D7/D7/CX/D3/D2 /B3 /CU/CX/D0/CT/D7/CN/D8/D3/CN/D7/CT/CP/D6/CW .
®Without special characters, /CV/D6/CT/D4simply searches for every line that
matchesthegiventext.Toﬁndeveryinstanceof /CU/CX/DC/D1/CTinaﬁle: /CV/D6/CT/D4/B3 /CU/CX/DC/D1/CT /B3 /CU/CX/D0/CT/D2/CP/D1/CT .
®A bracketedsetindicatesa singlecharacter.
–The set can include single characters: /CJ/C8/D4℄/CT/D6/D0 matches both/C8/CT/D6/D0and /D4/CT/D6/D0(though you maybe want a case-insensitive
searchwith /CV/D6/CT/D4 /B9/CX).
–The set can include ranges: /CJ/BT/B9/CI/CP/B9/DE℄ will match any standard
Englishletter.
–The set can exclude elements: /CJˆ /C8/B9/CB℄will ﬁnd any character
exceptP,Q, R,andS.
®Expressalternativesusingtheform /B4/BT/DG/BU/B5.
®Different systemshavedifferentrules aboutwhatis aspeci alcharac-
ter. The ERE/PCRE form for alternation used by /CT/CV/D6/CT/D4and /D4/CT/D6/D0is/B4/BT/DG/BU/B5;the BREform usedby /CV/D6/CT/D4is\ /B4/BT\ /DG/BU\ /B5.
®A single dot ( /BA) represents any character including a single space or
tab, and grep understands \ /CFto mean any white space character and
\ /DBto meananynon-whitespacecharacter.
8It is difﬁcult to search across lines. Perl has the /D1option ( /D1/BB/BB). A more reliable and universal option is to
simply remove newlines, turning your input stream into a sin gle long line. The easiest way to do this is via a
formlike /D8/D6 /B3\ /D2/B3 /B3/DG/B3 /BO /CX/D2/CU/CX/D0/CT /DG /CV/D6/CT/D4 /BA/BA/BA, where /D8/D6translates elements of the ﬁrstset (in this case, the
newline) into the elements of thesecond (the pipe).
gsl_stats March24,2009
408 APPENDIX B
REPLACING /CV/D6/CT/D4is wonderful for searching,but is a purely read-only progra m. If
you want to change what you ﬁnd, you will need to use a more com-
plexprogram,suchas /D4/CT/D6/D0or /D7/CT/CS(thestreameditor). /D7/CT/CSwilleasilyhandle95%
of data-ﬁltering needs, but /D4/CT/D6/D0adds many very useful features to the traditional
regular expression parsing syntax. If you ﬁnd yourself usin g regexes frequently,
youmaywanttogettoknowhowtheyarehandledinafullPerl-c ompatibleregex
scripting system like Python, Ruby, or Perl itself. These pr ograms complement C
nicely, becausethey provide built-in facilities for strin g handling, which is decid-
edlynotC’s strongestsuit.
Perl and sed syntax /D7/CT/CSis certainly installed on your system, since it is part of
thePOSIXstandard; /D4/CT/D6/D0isalmostcertainlyinstalled,since
manymodernsystemutilities useit.Ifitisnotinstalled,y oucaninstallitviayour
packagemanager.
Bothprogramsgenerallyexpectthatyouwilluseacommandﬁl e,butyoucanalso
givea commanddirectlyon thecommandline viathe /B9/CTcommand.
Forexample,
perl−e ’print "Hello,world.\n"’
will runthe Perlcommand /D4/D6/CX/D2/D8 Ꜽ/C0/CT/D0/D0/D3/B8 /DB/D3/D6/D0/CS/BA \ /D2Ꜽ./D7/CT/CSalwaysoperatesonaninputﬁle,sowemightaswellstartbyem ulatinggrep:9
sed−n−e ’/regex/p’ < ﬁle_to_search
Sedlikes itsregexesbetweenslashes,andthe /D4is shortfor print,sothecommand/BB /D6/CT/CV/CT/DC /BB/D4means ‘print every line that matches /D6/CT/CV/CT/DC.’ Sed’s default is to print
every input line, and then the print command will repeat line s that match /D6/CT/CV/CT/DC,
whichleadsformassiveredundancy.The /B9/D2commandsets /D7/CT/CStoprintonlywhen
askedto,soonly matchinglines print.
Generally,asedcommandhasuptothreeparts:thelinestowo rkon,asingleletter
indicatingthecommand,andsomeoptionalinformation fort hecommand.
Above,thespeciﬁcationoflinestoworkonwasaregularexpr ession,meaningthat
thecommand( /D4) shouldoperateonlyonthoselinesthatmatch /BB/D6/CT/CV/CT/DC/BB.
9As you saw in the /D7/CT/CSexamples in the section on redirection, the /B9/CTﬂag is optional using this form, but it
never hurts.
gsl_stats March24,2009
TEXT PROCESSING 409
• You can replace this regexwith a ﬁxedsetof lines, suchas /BD/B8/BD/BCto mean the ﬁrst
tenlines.
• In this context, /B0means the last line of the ﬁle, so /BD/BD/B8/B0/D4would print everything
buttheﬁrsttenlines.
• You can print everything but a given set of lines using an /AXafter the range, so/BD/B8/BD/BC/AX/D4wouldalsoprinteverythingbuttheﬁrsttenlines.10
Sedcommands/D4Print./D7Substitute./CSDelete./CXInsert before./CPAppend after.Theboxpresentsthe ﬁvesingle-lettersedcommandsdis-
cussedhere; /D7/CT/CShasafewmorebutthisisalreadyenough
for most relevant work. The third part of the command,
followingthesingle-lettercommand,willvarydepending
onthecommand.Asintheexamplesabove,thethird part
is blankfor the /D4command.
Search and
replace syntaxThe basic syntax for a searchand replace is /D7/BB/D6/CT/D4/D0/CP/CT /D1/CT/BB/DB/CX/D8/CW/D1/CT/BB/CV. The slashes distinguish the command ( /D7), the text to search
( /D6/CT/D4/D0/CP/CT /D1/CT), the text for replacement( /DB/CX/D8/CW /D1/CT), and the modi-
ﬁers(the /CV;seebox).11
If youhaveonly oneﬁle to scan,youcanusetheseprogramsasﬁ lters:
perl−p−e"s/replace me/withme/g"<ﬁle_to_modify>modiﬁed_ﬁle
sed−e "s/replace me/withme/g"<ﬁle_to_modify >modiﬁed_ﬁle
Whythe /BB/CV?
Back when regexes were used for real-time editing
of ﬁles, it made sense to ﬁx only one instance of an
expression on a line. Thus, the default was to modify
only the ﬁrst instance, and to specify replacing only
the second instance of a match with /D7/BB/BA/BA/BA/BB/BA/BA/BA/BB/BE ,
thethirdinstancewith /D7/BB/BA/BA/BA/BB/BA/BA/BA/BB/BF ,andallinstances
with /D7/BB/BA/BA/BA/BB/BA/BA/BA/BB/CV (global). This is still valid syntax
that is occasionally useful, but when ﬁltering a data
ﬁle,you willalmost always want the /BB/CVoption.Perl’s /B9/D4switch is the opposite of
sed’s /B9/D2switch. As opposed to sed,
Perl’sdefaultistoneverprintunless
the pattern matches, which means
that if you do not give it the /B9/D4
switch,itwillpassoveranylinethat
does not match the regex. With /B9/D4,
non-matchinglinesappearas-is and
lines that match have the appropri-
ate substitutions made, as we want.
In this case, /D7/CT/CSis doing the right
thing bydefault,soyoudonotneedthe /B9/D2switch.
10The /AXisusedbythebashshellforvariouscommandhistorypurpose s,andasaresulthasabsolutely perverse
behavior in “double-ticks”, so using ‘single-ticks’ is ess ential here. To print all the lines not beginning with a /AZ,
for example, use /D7/CT/CS /B9/D2 /B3/BB/AZ/BB/AX/D4/B3 /BO /CX/D2/CU/CX/D0/CT.
11A convenient trick that merits a foontote is that you can use a ny delimiter, not just a slash, to separate the
parts of a search and replace. For example, /D7/DG/D6/CT/D4/D0/CP/CT /D1/CT/DG/DB/CX/D8/CW /D1/CT/DG/CVworks equally well. This is primarily
useful if the search or replace text has many slashes, becaus e using a slash as a delimiter means you will need
toescape slashes inthetext— /D7/BB\ /BB/D9/D7/D6\ /BB/D0/D3/CP/D0/BB \ /BB/D9/D7/D6/BB/CV—while using adifferent delimiter means slashes are
no longer special, so /D7/DG/BB/D9/D7/D6/BB/D0/D3/CP/D0/DG/BB/D9/D7/D6/DG/CV would work ﬁne. Thenormis slashes, so that is what thetext wi ll
use.
gsl_stats March24,2009
410 APPENDIX B
Since you probably want to search and replace on every line in the ﬁle, there
is nothing preceding the single-letter command /D7. But if you want to replace/D6/CT/D4/D0/CP/CT /D1/CTonly on lines beginning with /AZ, you can specify the sed command/BB/AZ/BB /D7/BB/D6/CT/D4/D0/CP/CT /D1/CT/BB/DB/CX/D8/CW /D1/CT/BB/CV.Inthiscase,sedistakingintworegularexpres-
sions: it ﬁrst searches vertically through the ﬁle for lines that match /AZ. When it
ﬁndssucha line,it searcheshorizontallythroughthe line f or /D6/CT/D4/D0/CP/CT /D1/CT.
QB.7Say that your database manager does not accept pipe-delimit ed text,
but wants commas instead. Write a script to replace every pip e in the/CS/CP/D8/CP/B9/D0/CP/D7/D7/D6/D3/D3/D1 ﬁlewithacomma.Thenmodifythescripttoreplaceonly
thepipesin thedata,leavingthepipein thecommentsunchan ged.
Anotheralternativeis to replace-in-place,usingthe /B9/CXswitch:12
perl−p−i.bak−e ’s/replace me/withme/g’ ﬁles_to_modify
sed−i.bak−e ’s/replace me/withme/g’ﬁles_to_modify
With the /B9/CXoption,Perl andseddo notwrite the substitutionsto the scr eenor the/BQﬁle,butmakethemdirectlyontheoriginalﬁle.The /BA/CQ/CP/CZextensiontellsPerland/D7/CT/CSto make a backup before modiﬁcation that will have a /BA/CQ/CP/CZextension. You
may use any extension that seems nice: e.g., /B9/CX/A3will produce a backup of a ﬁle
named /D8/CT/D7/D8that would be named /D8/CT/D7/D8/A3. If you specifyno sufﬁxat all ( /B9/CX), then
no backup copy will be made before the edits are done. It is up t o you to decide
when(if ever)youaresufﬁcientlyconﬁdenttonotmakebacku ps.13
QB.8Createaﬁlenamed /CP/CQ/D3/D9/D8/CN/D1/CT withoneline,reading /C1 /CP/D1 /CP /D8/CT/CP/D4/D3/D8/BA Use
either /D4/CT/D6/D0or /D7/CT/CSto transform from a teapot to something else, such as a
kettleora toaster.Verify yourchangeusing /CS/CX/CU/CU.
You are welcome to include multiple commandson the line, by t he way. In /D4/CT/D6/D0,
separatethem with a semicolon,as in C. In /D7/CT/CSor /D4/CT/D6/D0, you may simply specify
additional /B9/CTcommands, that will be executed in order—or you can just use a
pipe.
perl−pi.bak−e ’s/replace me/withme/g;s/thenreplace this/withthis/g ’ ﬁles_to_modify
perl−pi.bak−e ’s/replace me/withme/g’ −e’s/thenreplace this/withthis/g’ ﬁles_to_modify
sed−i.bak−e ’s/replace me/withme/g’ −e’s/thenreplace this/withthis/g’ ﬁles_to_modify
12The /B9/CXswitch is not standard in /D7/CT/CS, but works on GNU /D7/CT/CS, which you probably have. Bear this in mind
if you are concerned about ascript’s portability.
13If editing a ﬁle in place is so difﬁcult, how does /D7/CT/CSdo it? By writing a new ﬁle and then switching it for
the original when it is ﬁnished. So if you are ﬁltering a 1GB ﬁl e ‘in place’ with no backup and you do not have
1GB of free space on your hard drive, you will get adisk full er ror.
gsl_stats March24,2009
TEXT PROCESSING 411
perl−p−e’s/replace me/withme/g’< modify_me | perl −p−e’s/thenreplace this/withthis/g’
>modiﬁed_version
sed ’s/replace me/withme/g’<modify_me |sed ’s/then repla ce this/withthis/g’ >
modiﬁed_version
Replacing with modiﬁcations Parentheses,usedaboveto delimitconditionalseg-
ments, can also be used to store sections for later
use. For example, say that your ﬁle reads /CC/CW/CT/D6/CT /CP/D6/CT /BG /D1/D3/D2/CZ/CT/DD/D7 /CP/D8 /D4/D0/CP/DD, but
your copyeditor feels that the sentence as written is imprec ise. You forgot the
number of monkeys, so you are tempted to use /D7/BB/CJ/BC/B9/BL℄ /D1/D3/D2/CZ/CT/DD/D7/BB/BV/CP/D0/D0/CX/D1/CX/D3/CV/D3/CT/D0/CS/CX/CX/BB/CV —butthis willlosethe numberofmonkeys.
However, you can put a segment of the search term in parenthes es, and then use
\ /BDin /D7/CT/CSor /B0/BDinPerltorefertoitinthereplacement.Thus,thecorrectco mmand
linesfor replacinganunknownnumberofmonkeysare
sed−i~−e ’s/\([0−9]*\)monkeys/\1Callimicogoeldii/g’monkey_ﬁle
sed−r−i~−e ’s/([0−9]*) monkeys/\1Callimicogoeldii/g’ monkey_ﬁle
perl−p−i~−e ’s/([0−9]*) monkeys/$1Callimicogoeldii/g’ monkey_ﬁle
• The \ /BDor /B0/BDwillbereplacedbywhateverwasfoundintheparentheses /B4/CJ/BC/B9/BL℄/B6/B5 .
• /D7/CT/CSnormally uses BREs, but the GNU version of /D7/CT/CSuses EREs given the /B9/D6
ﬂag.
If there are multiple substitutions to be made, you will need higher numbers.
Saythatwewouldliketoformalizethesentence /D8/CW/CT /BJ /D1/D3/D2/CZ/CT/DD/D7 /CP/D6/CT /CU/CX/CV/CW/D8/CX/D2/CV/D8/CW/CT /BG /D0/CP/CQ /D3/DB/D2/CT/D6/D7.Do thisusingmultiple parens,suchas
sed−i~−e ’s/\([0−9]*\)monkeys are ﬁghtingthe \([0 −9]*\)labowners/\1Callimicogoeldii
are ﬁghtingthe \2Homo sapiens/g’monkey_ﬁle
Repetition Saythatvaluesunderteninthedataaresuspect,andshouldb ereplaced
with Ꜽ/C6/CP/C6Ꜽ. The search /D7/BB/CJ/BC/B9/BL℄/BBꜼ/C6/CP/C6Ꜽ/BB/CV won’t work, because /BG/BH
willbereplacedby Ꜽ/C6/CP/C6ꜼꜼ/C6/CP/C6Ꜽ ,sinceboth /BGand /BHcountasseparatematches.Or
say that values over ten are suspect. The search /D7/BB/CJ/BD/B9/BL℄/CJ/BC/B9/BL℄/BBꜼ/C6/CP/C6Ꜽ/BB/CV won’t
work,because /BD/BC/BCwouldbereplacedby Ꜽ/C6/CP/C6Ꜽ/BC.Wethusneedameansofspeci-
fying repititions moreprecisely.
Hereare somesymbolsto matchrepetitions orto makeaneleme ntoptional.
gsl_stats March24,2009
412 APPENDIX B/B6thelastatomappearszeroormoretimes/B7thelastatomappearsoneormoretimes (GNU grep/sed: \ /B7)/BRthelastatomappearszerooronetimes(GNU grep/sed: \ /BR)
Toreplaceallofthe integerslessthan100in aﬁle:
perl−pi~−e’s/([^0−9]|^)([0−9][0−9]?)([^0−9]|\$)/$1NaN$3/g’ search_me
sed−i~’s/\([^0−9]\|^\)\([0−9][0−9]\?\)\([^0−9]\|$\)/\1NaN\3/g’search_me
sed−r−i~’s/([^0−9]|^)([0−9][0−9]?)([^0−9]|$)/\1NaN\3/g’search_me
Thisis amess,butaveryprecisemess(which will bemademore legiblebelow).
• The ﬁrst part, /B4/CJˆ /BC/B9/BL℄/DGˆ /B5will match either a non-numeric character or the be-
ginningoftheline.
• The second part, /B4/CJ/BC/B9/BL℄/CJ/BC/B9/BL℄/BR/B5 , matches either one or two digits (but never
three).
• The third part, /B4/CJˆ /BC/B9/BL℄/DG/B0/B5 will match either a non-numeric character or the end
oftheline.
Thus, we have precisely communicated that we want something , then an integer
under 100, then something else. Since the search string used three sets of parens,
the output string can refer to all three. It repeats the ﬁrst a nd last verbatim, and
replacesthesecondwith /C6/CP/C6,asdesired.
Structured regexes Chapter 2 presented a number of techniques for writing code
thatis legibleandeasyto debug:
• Breaklargechunksofcodeinto subfunctions.
• Debugthe subfunctionsincrementally.
• Write teststo verifythatcomponentsactastheyshould.
All of this applies to regularexpressions.You can break exp resssionsdown using
variables, which your shell can then substitute into the exp ression. For example
the illegible regexes above can be somewhat clariﬁed using a few named subex-
pressions.This isthe versionfor /CQ/CP/D7/CWor /D7/CW.14
14You can also replace variables in the shell using a form like /B0/DF/CS/CX/CV/CX/D8/D7/DH . This is useful when the vari-
able name may merge with the following text, such as a search f or exponential numbers of a certain form:/B0/DF/CS/CX/CV/CX/D8/D7/DH/CT/B0/CS/CX/CV/CX/D8/D7 .
gsl_stats March24,2009
TEXT PROCESSING 413
notdigit=’\([^0−9]\|^\|$\)’
digits=’\([0−9][0−9]\?\)’
replacecmd="s/$notdigit$digits$notdigit/\\1NaN\\3/g "
sed−i~$replacecmd search_me
The /CT/CW/D3command is usefulfor testing purposes.It dumps its textto /D7/D8/CS/D3/D9/D8, so
it makesone-linetestsrelativelyeasy.Forexample:
echo 123 |sed $replacecmd
echo 12| sed$replacecmd
echo 00| sed$replacecmd
QB.9Modify the searchto include anoptionaldecimalof arbitrar y length. Write
atestﬁleandtestthatyourmodiﬁcationworkscorrectly.
B.4 A DDING AND DELETING Recalltheformatforthesedcommandtoprint
a line from page 408: /BB/CU/CX/D2/CS/CN/D1/CT/BB/D4 . This con-
sists of a location and a command. With the slashes, the locat ion is: those lines
that match /CU/CX/D2/CS/CN/D1/CT, but you can also explicitly specify a line number or a range
of lines, such as /BJ/D4to print line seven, /B0/D4to print the last line of the input ﬁle, or/BD/B8/B0/D4to printtheentire ﬁle.
Youcanusethesameline-addressingschemeswith /CStodeletealine.Forexample,/D7/CT/CS Ꜽ/B0/CSꜼ /BO/CX/D2/CU/CX/D0/CT will print allof /CX/D2/CU/CX/D0/CTbutthe lastline.
QB.10Use /CSto produce a version of /CS/CP/D8/CP/B9/D0/CP/D7/D7/D6/D3/D3/D1 with the comments re-
moved.
Youcanalsouse /CXtoinsertabovethegivenline(s),and /CPtoappendafterthegiven
line. Afew examples:
#Adda pause aftera Gnuplot data block
sed−i~−e "/^e$/a pause pauselength"plotﬁle
#Putthe text plot ’−’ atthe head of a ﬁle.
sed−i~−e "1i plot ’−’"plotﬁle
#Pretendmissingdata does not exist
sed−i~−e "/NaN/ d"plotﬁle
By the way, if you really want to get /D7/CT/CSto print “Hello, world” you can do it by
insertingatline oneandignoring therestoftheﬁle:
sed−n−e "1i Hello,world."<any_random_ﬁle
gsl_stats March24,2009
414 APPENDIX B
Perl can do all of these things easily from inside a Perl scrip t, but inserting and
deletinglinesfrom thecommandline is notaspleasantasusi ng /D7/CT/CS.15
QB.11Refer to the exercise on page 184, which read in a text ﬁle and p roduced
a Graphviz-readable output ﬁle. That exercise read the text to an /CP/D4/D3/D4/CN/B9/CS/CP/D8/CPset and then wrote the output, which is sensible when pulling many
classesfromadatabase.Butgiventhetextﬁle /CS/CP/D8/CP/B9/D0/CP/D7/D7/D6/D3/D3/D1 inthecode
supplement,youcanmodifyitdirectlyinto Graphviz’sform at. Write a /D7/CT/CS
scriptto
• Deletetheheaderline.
• Replaceeachpipewith a /B9/BQ.
• Replaceeachnumber nwith /D2/D3/CS/CT /D2.
• Addaheader(asonpage184).
• Addtheend-braceonthe lastline.
Pipe your output through /D2/CT/CP/D8/D3to check that your processing produced a
correctly /D2/CT/CP/D8/D3-readableﬁle andtherightgraph.
QB.12Turnthe /CS/CP/D8/CP/B9/D0/CP/D7/D7/D6/D3/D3/D1 ﬁleinto anSQL scriptto createatable.
• Deletetheheaderline.
• Add a header /D6/CT/CP/D8/CT /D8/CP/CQ/D0/CT /D0/CP/D7/D7/B4/CT/CV/D3/B8 /D2/D3/D1/CX/D2/CT/CT/B5 . [Bonus
points: write the search-and-replacethat converts the exi sting header
into this form.]
• Replace each pair of numbers /D2/DG/D1with the SQL command /CX/D2/D7/CT/D6/D8/CX/D2/D8/D3 /D0/CP/D7/D7/B4/D2/B8 /D1/B5/BN.
• Foraddedspeed,puta /CQ/CT/CV/CX/D2/BN— /D3/D1/D1/CX/D8/BN wrapperaroundtheentire
ﬁle.
Pipe the output to /D7/D5/D0/CX/D8/CT/BF to verify that your edits correctly created and
populatedthetable.
15A reader recommends the following for inserting aline:/D4/CT/D6/D0 /B9/D2 /B9/CT /B3/D4/D6/CX/D2/D8/BN /D4/D6/CX/D2/D8 Ꜽ/D4/CP/D9/D7/CT /D4/CP/D9/D7/CT/D0/CT/D2/CV/D8/CWꜼ /CX/CU /BBˆ /CT/B0/BB/B3
For adding aline at the top of aﬁle:/D4/CT/D6/D0 /B9/D4 /B9/CT /B3/D4/D6/CX/D2/D8 Ꜽ/D4/D0/D3/D8 /B3/B9/B3\ /D2Ꜽ /D9/D2/D0/CT/D7/D7 /B0/CP/BN /B0/CP/BP/BD/B3
For deleting aline:/D4/CT/D6/D0 /B9/D2 /B9/CT /B3/D4/D6/CX/D2/D8 /D9/D2/D0/CT/D7/D7 /BB/C6/CP/C6/BB/B3
gsl_stats March24,2009
TEXT PROCESSING 415
®Your best bet for command-line search-and-replace is /D4/CT/D6/D0or /D7/CT/CS.
Syntax: /D4/CT/D6/D0 /B9/D4/CX Ꜽ/D7/BB/D6/CT/D4/D0/CP/CT /D1/CT/BB/DB/CX/D8/CW /D1/CT/BB/CVꜼ /CS/CP/D8/CP/CN/CU/CX/D0/CT or/D7/CT/CS /B9/CX Ꜽ/D7/BB/D6/CT/D4/D0/CP/CT /D1/CT/BB/DB/CX/D8/CW /D1/CT/BB/CVꜼ /CS/CP/D8/CP/CN/CU/CX/D0/CT .
®Ifyouhaveasetofparensin thesearchportion,youcanrefer toit in
Perl’s replace portion by /B0/BD, /B0/BE, ...;and in sed’sreplace via \ /BD,\ /BE,
....
®The /B6, /B7, and /BRlet you repeat the previous character or bracketed
expressionzero ormore, one ormore, and zero orone times, re spec-
tively.
B.5 M ORE EXAMPLES Nowthatyouhavethesyntaxforregexes,theapplica-
tionscomefastandeasy.
Quoting and unquoting Although the dot (to match any character) seems conve-
nient, it is almost never what you want. Say that you are
looking for expressions in quotes, such as Ꜽ/CP/D2/DD/D8/CW/CX/D2/CVꜼ . It may seem that this
translates to the regularexpression Ꜽ/BA/B6Ꜽ, meaningany character,repeated zero or
more times, enclosed by quotes. But consider this line: Ꜽ/CU/CX/D6/D7/D8 /CQ/CX/D8Ꜽ/B8 Ꜽ/D7/CT/D3/D2/CS/CQ/CX/D8Ꜽ.Youmeanttohavetwomatches,butinsteadwillgetonlyone: /CU/CX/D6/D7/D8 /CQ/CX/D8Ꜽ/B8Ꜽ/D7/CT/D3/D2/CS /CQ/CX/D8,sincethisiseverythingbetweenthetwomostextremequote s.What
you meant to say was that you want anything that is not a Ꜽbetween two quotes.
Thatis, use Ꜽ/CJˆ Ꜽ℄/B7Ꜽ, or Ꜽ/CJˆ Ꜽ℄/B6Ꜽif ablanklike ꜼꜼis acceptable.
Say that the program that produced your data put it all in quot es, but you are
reading it in to a program that does not like having quotes. Th en this will ﬁx the
problem:
perl−pi~−e ’s/"([^"] *)"/$1/g’ data_ﬁle
Getting rid of commas Somedata sourcesimprovehumanreadability by separat-
ing data by commas; for example, /CS/CP/D8/CP/B9/DB/CQ/B9/CV/CS/D4 reports
that the USA’s GDP for 2005 was 12,455,068 millions of dollar s. Unfortunately,
if your program reads commas as ﬁeld delimiters, this human- readability conve-
nience ruins computer readability. But commas in text are en tirely valid, so we
want to removeonly commas betweentwo numbers. We can do this by searching
foranumber-comma-numberpattern,andreplacingitwithon lythenumbers.Here
arethe /D7/CT/CScommand-lineversionsoftheprocess:
gsl_stats March24,2009
416 APPENDIX B
sed−i~’s/\([0−9]\),\([0−9]\)/\1\2/g’ﬁxme.txt
sed−r−i~’s/([0−9]),([0−9])/\1\2/g’ﬁxme.txt
Suspicious non-printing
charactersSome sources like to put odd non-printing characters in
their data. Since they don’t print, they are hard to spot,
but they produce odd effects like columns in tables with
nameslike /D4/D3/D4/square /FY/FL/square /D8/CX/D3/D2.Itisahardproblemtodiagnose,butaneasyproblemto
ﬁx. Since /CJ/BM/D4/D6/CX/D2/D8/BM℄ matchesall printing characters, /CJˆ /CJ/BM/D4/D6/CX/D2/D8/BM℄℄ matchesall
non-printing characters, and the following command replac es all such characters
with nothing:
sed−i~’s/[^[:print:]]//g’ﬁxme.txt
Blocks of delimiters Some programs output multiple spaces to approximate tabs,
butprogramsthatexpectinputwithwhitespaceasadelimite r
will read multiple spacesas a long series of blank ﬁelds.16But it is easy to merge
whitespace,byjustﬁndingeveryinstanceofseveralblanks (i.e.,spacesortabs)in
arow, andreplacingthemwith asinglespace.
sed−i~’s/[[:blank:]]\+//g’ dataﬁle
Youcouldusethesamestrategyforreducinganyotherblock
ofdelimiters, whereit wouldbeappropriatetodo so,suchas/D7/BB/B8/B7/BB/B8/BB.
Alternatively, a sequence of repeated delimiters may not ne ed merging, but may
mark missing data: if a data ﬁle is pipe-delimited, then /BJ/DG /DG/BFmay be the data-
producer’s way of saying /BJ/DG/C6/CP/C6/DG/BF. If your input program has trouble with this,
youwillneedto insert /C6/CP/C6’s yourself.
This may seem easy enough: /D7/BB/DG /DG/BB/DG/C6/CP/C6/DG/BB/CV . But there is a catch: you will need
to run your substitution twice, because regular expression parsers will not over-
lap their matches. We expect the input /DG /DG /DGto invoke two replacements to form/DG/C6/CP/C6/DG/C6/CP/C6/DG , but the regular expressionparserwill match the ﬁrst two pi pes, leav-
ingonlyasingle /DGforlatermatches;intheend,youwillhave /DG/C6/CP/C6/DG /DGintheoutput.
Byrunningthe replacementtwice,youguaranteethateveryp ipeﬁndsits pair.
sed−i~dataﬁle−e ’s/||/|NaN|/g’−e ’s/||/|NaN|/g’
16Thesolution at the root of the problem is to avoid using white space as adelimiter. I recommend the pipe, |,
as adelimiter, since it is virtually never used in human text or other data.
gsl_stats March24,2009
TEXT PROCESSING 417
Text to database The /CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/D8/D3/CN/CS/CQ command line program (and its corre-
spondingC function) can take input from /D7/D8/CS/CX/D2. Thus,you can
put it at the end of any of the above streams to directly dump da ta to an SQLite
database.
For many POSIX programs that typically take ﬁle input, the tr aditional way to
indicate that you are sending data from /D7/D8/CS/CX/D2instead of a text ﬁle is to use /B9as
the ﬁle name. For example, after you did all that work in the ex ercise above to
convert data to SQL commands, here is one way to do it using /CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/D8/D3/CN/B9/CS/CQ:17
sed ’/#/ d’ data−classroom |apop_text_to_db ’ −’friends classes.db/CV/D2/D9/D4/D0/D3/D8
Database to plot Apophenia includes the command-line program /CP/D4/D3/D4/CN/D4/D0/D3/D8/CN/B9/D5/D9/CT/D6/DD,whichtakesin aqueryandoutputsaGnuplottableﬁle.It
providessomeextrapower:the /B9/C0optionwillbinthedataintoahistogrambefore
plotting, andyou canusefunctionssuchas /DA/CP/D6that SQLite doesnotsupport.But
formanyinstances,this is unnecessary.
SQLitewill readaqueryﬁleeitheronthecommandline orfrom apipe,andGnu-
plot will read in a formatted ﬁle via a pipe. As you saw in Chapt er 5, turning a
column of numbers (or a matrix) into a Gnuplottable ﬁle simpl y requires putting/D4/D0/D3/D8 /B3/B9/B3above the data. If there is a query in the ﬁle /D5/D9/CT/D6/DD/CU/CX/D0/CT , then the se-
quenceis:
sqlite3−separator " "data.db< queryﬁle | sed"1iset key off\nplot ’ −’"|gnuplot−persist
The /B9/D7/CT/D4/CP/D6/CP/D8/D3/D6 Ꜽ Ꜽclause is necessarybecauseGnuplotdoes not like pipes as
a delimiter. Of course, if you did not have that option availa ble via sqlite3, you
couldjustadd /B9/CT Ꜽ/D7/BB/DG/BB /BBꜼto thesedcommand.
QB.13Write a single command line to plot the yearly index of surfac e temper-
ature anomalies (the /DD/CT/CP/D6and /D8/CT/D1/D4columns from the /D8/CT/D1/D4table of the/CS/CP/D8/CP/B9/D0/CX/D1/CP/D8/CT/BA/CS/CQ database).
17Even this is unnecessary, because the program knows to read l ines matching ˆ /AZas comments. But the
example would bealittle too boring as just /CP/D4/D3/D4/CN/D8/CT/DC/D8/CN/D8/D3/CN/CS/CQ /CS/CP/D8/CP/B9/D0/CP/D7/D7/D6/D3/D3/D1 /CU/D6/CX/CT/D2/CS/D7 /D0/CP/D7/D7/CT/D7/BA/CS/CQ .
gsl_stats March24,2009
418 APPENDIX B
UNIX versus Windows: the end of the line If your ﬁle is all one long line with
nobreaksbutafewfunnycharacters
interspersed,orhas ˆ /C4’sallovertheplace,thenyouhavejustfoundyourselfinthe
crossﬁreof a long-standingwar overhow lines shouldend. In the style of manual
typewriters, starting a new line actually consists of two op erations: moving hori-
zontallyto thebeginningoftheline(acarriagereturn, CR) ,andmovingvertically
down a line (a line feed, LF). The ASCII character for CR is <ctrl-M >, which
often appears on-screen as the single character ˆ /C5; the ASCII character for LF is
ˆ /C4.
The designers of AT&T UNIX decided that it is sufﬁcient to end a line with just
a LF,ˆ /C4, while the designers of Microsoft DOS decided that a line sho uld end
with a CR/LF pair, ˆ /C5ˆ /C4. When you open a DOS ﬁle on a POSIX system, it will
recognize ˆ /C4asthe end-of-line,butconsiderthe ˆ /C5to begarbage,whichit leaves
in the ﬁle. Whenyouopena POSIX ﬁle in Windows, it can’tﬁndan yˆ /C5ˆ /C4pairs,
so none of the lines end.18As further frustration, some programs auto-correct the
line endings while others do not, meaning that the ﬁle may loo k OK in your text
editorbutfall apartin yourstats package.
Recall from page 61 that \ /D6is a CR and \ /D2is a LF. Going from DOS to UNIX
means removing a single CR from each line, going from UNIX to D OS means
addinga CRto eachline, andbothofthesearesimple /D7/CT/CScommands:
#Convert a DOSﬁletoUNIX:
sed−i~’s/\r$//’ dos_ﬁle
#Convert a UNIXﬁletoDOS:
sed−i~’s/$/\r/’ unix_ﬁle
Somesystemshave /CS/D3/D7/BE/D9/D2/CX/DC and /D9/D2/CX/DC/BE/CS/D3/D7 commandsthatdothisforyou,19but
theyareoftenmissing,andyoucanseethatthesecommandsba sicallyrunasingle
line of /D7/CT/CS.
18Typing ˆand then /C5will not produce a CR. ˆ /C5is a single special character confusingly represented on-
screen with two characters. In most shells, <ctrl-V>means ‘insert the next character exactly as I type it,’ so
the sequence <ctrl-V> <ctrl-M >will insert the single CR character which appears on the scre en asˆ /C5; and
<ctrl-V> <ctrl-L>will similarly produce aLF.
19Perhaps ask your package manager for the /CS/D3/D7/D9/D8/CX/D0/D7 package.
gsl_stats March24,2009
C: GLOSSARY
Seealsothelist ofnotation andsymbolsonpage12.
Acronyms
ANSI: American National Standards
Institute
ASCII: American Standard Code for
Information Interchange
ANOVA:analysisofvariance[p 312]
BLAS:BasicLinearAlgebraSystem
BLUE: best linear unbiased estimator
[p 221]
BRE:basicregularexpression[p403]
CDF: cumulative density function [p
236]
CMF:cumulativemassfunction[p236]
CLT:centrallimit theorem[p 296]
df:degree(s)offreedom
ERE: extended regular expression [p
403]erf:errorfunction[p 284]
GCC:GNUCompilerCollection[p48]
GDP:grossdomesticproduct
GLS:generalizedleastsquares[p 277]
GNU:GNU’s NotUNIX
GSL:GNUScientiﬁcLibrary [p 113]
GUI:graphicaluserinterface
IDE: integrated development environ-
ment
IEC: International Electrotechnical
Commission
IEEE: Institute of Electrical and Elec-
tronicsEngineers
IIA:independenceofirrelevantalterna-
tives[p286]
gsl_stats March24,2009
420 APPENDIX C
iid: independent and identically dis-
tributed [p 326]
ISO: International Standards Organiza-
tion
IV:instrumentalvariable[p275]
LR:likelihoodratio [p 351]
MAR:missingatrandom[p 345]
MCAR: missing completely at random
[p 345]
MCMC: markov chain Monte Carlo [p
372]
ML:maximumlikelihood
MLE: maximum likelihood estima-
tion/estimate[p 325]
MNAR:missingnotatrandom[p 345]
MSE:meansquarederror [p 223]
OLS:ordinaryleastsquares[p 270]
PCA: principal component analysis [p
265]
PCRE:Perl-compatible regularexpres-
sion[p 403]PDF: probability density function [p
236]
PDF:portabledocumentformat
PRNG: pseudorandom number genera-
tor[p 357]
PMF:probabilitymassfunction[p236]
RNG: random number generator [p
357]
SSE:sumofsquarederrors [p 227]
SSR:sumofsquaredresiduals[p 227]
SST:total sumofsquares[p 227]
SQL: Structured Query Language [p
74]
SVD: singular value decomposition [p
265]
TLA:three-letteracronym
UNIX: not an acronym; see main glos-
sary
WLS:weightedleastsquares[p 277]
Terms
afﬁneprojection :Alinearprojectioncanalwaysbeexpressedasamatrix Tsuch
thatxtransformedis xT.Butanysuchprojectionmaps 0to0.Anafﬁneprojection
addsaconstant,transforming xtoxT+k,so0nowtransformstoanonzerovalue.
[p 280]
ANOVA: “The analysis of variance is a body of statistical methods o f analyzing
measurementsassumedtobeofthestructure[ yi=x1iβ1+x2iβ2+···+xpiβp+ei,
i= 1,2,... ,n],wherethecoefﬁcients {xji}areintegersusually0or1”(Scheffé,
1959)[p 312]
apophenia :Thehumantendencyto seepatternsin static.[p 1]
array:Asequenceofelements,allofthesametype.Anarrayoftext charactersis
calledastring.[p 30]
gsl_stats March24,2009
GLOSSARY 421
arguments :Theinputsto afunction.[p 36]
assertion : A statement in a program used to test for errors. The stateme nt does
nothing,but shouldalwaysevaluateto beingtrue; if it does not, the program halts
with a messageaboutthefailed assertion.[p 71]
bandwidth : Most distribution-smoothing techniques, including some kernelden-
sity estimates , gatherdata points from a ﬁxedrange around the point being e valu-
ated.Thespanoverwhichdatapointsaregatheredistheband width.Forcaseslike
the Normal kernel density estimator, whose tails always spa n(−∞,∞), the term
is still used to indicate that as bandwidth gets larger, more far-reaching data will
havemoreofaneffect. [p 261]
Bernoulli draw : A single draw from a ﬁxed process that produces a one with
probability pandazerowith probability 1−p.[p 237]
bias: The distance between the expected value of an estimator of βandβ’s true
value,|E(ˆβ)−β|. Seeunbiasedstatistic . [p 220]
binary tree : A set of structures, similar to a linked list , where each structure con-
sists of data and two pointers, one to a next-left structure a nd one to a next-right
structure. You can typically go from the head of the tree to an arbitrary element
muchmorequicklythanif thesamedatawereorganizedasa linkedlist . [p 200]
BLUE:TheEstimator ˆβis aLinearfunction,Unbiased,andBestinthesensethat
var(ˆβ)≤var(˜β)foralllinearunbiasedestimators ˜β. [p 221]
bootstrap : Repeated sampling with replacement from a population prod uces a
sequence of artiﬁcial samples, which can be used to produce a sequence of iid
statistics. The Central Limit Theorem then applies, and you can ﬁnd the expected
value and variance of the statistic for the entire data set us ing the set of iid draws
of the statistic. The name implies that using samples from th e data to learn about
thedataisabitlikepullingoneselfupbythebootstraps.Se ealsojackknife andthe
bootstrapprinciple .[p 367]
bootstrap principle : The claim that samples from your data sample will have
propertiesmatchingsamplesfrom the population.[p 296]
call-by-address : When calling a function, sending to the function a copy of an
inputvariable’slocation(as opposedto its value).[p 54]
call-by-value :Whencallingafunction,sendingtothefunctionacopyofan input
variable’svalue.[p 39]
gsl_stats March24,2009
422 APPENDIX C
Cauchy–Schwarzinequality : Given the correlation coefﬁcient between any two
vectors xandy,ρxy, itholdsthat 0≤ρ2
xy≤1. [p 229]
CentralLimit Theorem :Givena setof means,eachbeing themeanofa setof n
iiddraws from a data set, the set of meanswill approacha Normal d istribution as
n→∞.[p 297]
central moments : Given a data vector xand mean x, thekthcentral moment
off(·)is1
n/summationtext
x∈x/parenleftig
f(x)−f(x)/parenrightigk
. In the continuous case, if xhas distribution
p(x), then the kthcentral moment of f(x)is/integraltext∞
−∞/parenleftig
f(x)−f(x)/parenrightigk
p(x)dx. In
both cases, the ﬁrst central moment is always zero (but see noncentral moment ).
Thesecondis knownasthe variance,thethird as skew,andthefourth as kurtosis.
[p 230]
closed-formexpression :Anexpression,say x2+y3,thatcanbewrittendownus-
ingonlyalineortwoofnotationandcanbemanipulatedusing theusualalgebraic
rules. This is in contrast to a function algorithm or an empir ical distribution that
canbedescribedonlyvia alongcodelisting, ahistogram,or adataset.
compiler : A non-interactive program (e.g., /CV) to translate code from a human-
readablesourceﬁle toacomputer-readable objectﬁle .Thecompilerisoftenclosely
intertwined with the preprocessor andlinker, to the point that the preprocessor/-
compiler/linker amalgam is usually just called the compile r. Compare with inter-
preter.[p 18]
conjugate distributions : A prior/likelihood pair such that if the prior is updated
using the likelihood, the posterior has the same form as the p rior (but updated
parameters).Forexample,givenaBetadistributionpriora ndaBinomiallikelihood
function, the posterior will be a Beta distribution. Unrela ted to conjugategradient
methods.[p 374]
consistent estimator : An estimator ˆβ(x)is consistent if, for some constant c,
limn→∞P(|ˆβ(x)−c|> ǫ) = 0, for any ǫ >0. That is, as the sample size
grows,the valueof ˆβ(x)convergesin probability to thesinglevalue c. [p221]
consistenttest :A testisconsistentifthe power→1asn→∞. [p 335]
contrast:Ahypothesisaboutalinearcombinationofcoefﬁcients,li ke3β1−2β2=
0. [p 309]
correlation coefﬁcient : Given the square roots of the covariance andvariances ,
σxy,σx,andσy, thecorrelation coefﬁcient ρxy≡σxy
σxσx.[p 229]
gsl_stats March24,2009
GLOSSARY 423
covariance :Fortwo datavectors xandy,σ2
xy≡1
n/summationtext
i(xi−x)(yi−y). [p 228]
Cramér–Raolowerbound :Theelementsofthecovariancematrixoftheestimate
ofa parametervectormustbe equalto orgreaterthan a limit t hatis constantfor a
given PDF, as in Equation 10.1.7 (page 333). For an MLE, the CR LB reduces to
1/(nI), where Iis theinformation matrix .[p 333]
crosstab:A two-dimensionaltable,whereeachrow representsvalues ofonevari-
able (y), each column represents values of another variable ( x), and each (row,
column) entry provides some summary statistic of the subset of data where yhas
the givenrow valueand xhasthe givencolumn value.See page101 foran exam-
ple. [p 101]
cumulative density function : The integral of a PDF. Its value at any given point
indicates the likelihood that a draw from the distribution w ill be equal to or less
thanthegivenpoint.SincethePDFisalwaysnon-negative,t heCDFismonotoni-
callynondecreasing.At −∞,theCDFisalwayszero,andat ∞theCDFisalways
one.[p 236]
cumulative mass function : The integral of a PMF. That is, a CDF when the dis-
tribution isoverdiscretevalues.[p 236]
data mining : Formerly a synonymfor data snooping ,but in current usage,meth-
odsofcategorizingobservationsintoasmallsetof(typica llynested)bins,suchas
generatingtreesorseparatinghyperplanes.
datasnooping :Beforeformallytestingahypothesis,tryingaseriesofpr eliminary
teststoselecttheformoftheﬁnaltest.Suchbehaviorcanta intinferentialstatistics
becausethestatistic parameterfromonetest hasaverydifferentdistribution from
thestatistic mostfavorableparameterfromﬁfty tests .[p 316]
debugger : A standalone program that runs a program, allowing the user to halt
the program at any point, view the stackofframes,and query the program for the
valueofa variableatthatpointin the program’sexecution. [p 43]
declaration :Aline ofcodethatindicatesthe typeofavariableorfunction.[p28]
degrees of freedom : The number of dimensions along which a data set varies. If
allndata points are independent, then d f=n, but if there are restrictions that
reduce the data’s dimensionality, d f < n. You can often think of the d fas the
numberofindependentpiecesofinformation. [p 222]
dependency :Astatementinamakeﬁleindicatingthatoneﬁledependsona nother,
such as an object ﬁle that depends on a source ﬁle . When the depended-on ﬁle
changes,thedependentﬁle will needto bere-produced.[p 38 8]
gsl_stats March24,2009
424 APPENDIX C
descriptivestatistics :Thehalfofprobabilityandstatisticsaimedatﬁlteringus eful
patterns out of a world of overwhelminginformation. The oth er half is inferential
statistics.[p 1]
dummy variable : A variable that takes on discrete values (usually just zero or
one)to indicatethecategoryin whichanobservationlies.[ p 281]
efﬁciency : A parameter estimate that comes as close as possible to achi eving the
Cramér–Raolowerbound ,andthushasassmalla varianceaspossible,is dubbed
anefﬁcientestimate.[p 220]
errorfunction :TheCDFoftheNormal(0, 1)distribution. [p 284]
environment variable : A set of variables maintained by the system and passed
to all child programs. They are typically set from the shell’s /CT/DC/D4/D3/D6/D8or /D7/CT/D8/CT/D2/DA
command.[p381]
expectedvalue :Theﬁrst noncentralmoment ,akathemeanoraverage.[p 221]
frame: A collection of a function and all of the variables that are i nscopefor the
function.[p 37]
GCC: The GNU Compiler Collection, which reads source ﬁles in a variety of
languagesand produces objectﬁles accordingly.This book usesonly its ability to
readandcompile Ccode.[p 48]
GeneralizedLeastSquares :TheOrdinaryLeastSquares modelassumesthatthe
covariance matrix among the observations is Σ = σ2I(i.e., a scalar times the
identity matrix ). A GLS model is any model that otherwise conforms to the OLS
assumptions,butallows Σto takeona differentform. [p 277]
globbing: The limited regular expression parsing provided by a shell, such as ex-
panding /B6/BAto the full list of ﬁle names ending in /BA. Uses an entirely different
syntaxfrom standardregularexpressionparsers.[p 407]
graph: A set of nodes, connected by edges. The edges may be directio nal, thus
forming adirectionalgraph.Notto beconfusedwith a plot. [p 182]
gridsearch :Dividethespaceofinputstoafunctionintoagrid,andwrit edownthe
value of the function at every point on the grid. Such an exhau stivewalk through
the space can be used to get a picture of the function (this is w hat most graphing
packages do), or to ﬁnd the optimum of the function. However, it is a last resort
formostpurposes;thesearchandrandomdrawmethodsofChap ters10and11are
muchmore efﬁcientandprecise.[p 371]
gsl_stats March24,2009
GLOSSARY 425
hatmatrix :Pleasesee projectionmatrix .[p 272]
header ﬁle : A C ﬁle consisting entirely of declarations and type deﬁnit ions. By/AZ/CX/D2/D0/D9/CS/CT -ing itin multiple Cﬁles,the variables,functions,andtyp esdeclaredin
theheaderﬁlecanbedeﬁnedin oneﬁle andusedin many.[p 49]
Hessian:Thematrixofsecondderivativesofafunctionevaluatedat agivenpoint.
Givena log likelihoodfunction LL(θ), thenegationofits Hessianis the informa-
tion matrix .[p 341]
heteroskedasticity : When the errors associated with different observations ha ve
differentvariances,suchasobservationsontheconsumpti onratesofthe poorand
the wealthy. This violates an assumption of OLS, and can ther efore produce inef-
ﬁcientestimates; weightedleastsquares solvesthis problem.[p 277]
identically distributed : A situation where the process used to produce all of the
elements of a data set is considered to be identical. For exam ple, all data points
may be drawn from a Poisson(0.4) distribution, or may be indi viduals randomly
sampledfrom onepopulation.[p326]
identity matrix : A square matrix where every non-diagonal element is zero, a nd
everydiagonalelementis one.Its sizeis typicallydetermi nedbycontext,andit is
typically notated as I. There are really an inﬁnite number of identity matrices (a
1×1matrix, a 2×2matrix, a 3×3matrix,...),butthe customis to refertoany
oneofthemas theidentity matrix .
iff: If and only if. The following statements are equivalent: A⇐⇒ B;AiffB;
A≡B;Ais deﬁnedto be B;Bis deﬁnedto be A.
iid: Independentand identically distributed. Theseare the co nditionsfor the Cen-
tralLimit Theorem .Seeindependentdraws andidentically distributed .[p 326]
importancesampling :Ameansofmakingdrawsfromaneasy-to-draw-fromdis-
tribution tomakedrawsfrom amore difﬁcultdistribution. [ p 371]
independenceofirrelevantalternatives :Theratioof(likelihoodofchoice Abe-
ing selected)/(likelihood of choice Bbeing selected) does not depend on what
other options are available—adding or deleting choices C,D, and Ewill not
changethe ratio. [p 286]
independent draws : Two events x1andx2(such as draws from a data set) are
independent if P(x1∩x2)—that is, the probability of ( x1andx2)—is equal to
P(x1)·P(x2). [p 326]
gsl_stats March24,2009
426 APPENDIX C
inferentialstatistics :Thehalfofprobabilityandstatisticsaimedatﬁghtingaga inst
apophenia .Theotherhalfis descriptivestatistics . [p 1]
information matrix : The negation of the derivative of the Score. Put differently,
given a log likelihood function LL(θ), the information matrix is the negation of
itsHessianmatrix. Seealsothe Cramér–Raolowerbound .[p 326]
instrumental variable : If a variable is measured with error, then the OLS pa-
rameter estimate based on that variable will be biased. An instrumental variable
is a replacement variable that is highly correlated with the measured-with-error
variable. A variant of OLS using the instrumental variable w ill produce unbiased
parameterestimates.[p 275]
interaction :Anelementofamodelthatcontendsthatitisnot x1orx2thatcauses
anoutcome,butthecombinationofboth x1andx2simultaneously(or x1andnot
x2, or not x1butx2). This is typically represented in OLS regressions by simpl y
multiplying thetwo togetherto form anewvariable x3≡x1·x2. [p 281]
interpreter : A program to translate code from a human-readable language to a
computer’s object code or some other binary format. The user inputs individual
commands, typically one by one, and then the interpreter pro duces and executes
theappropriatemachinecodeforeachline.Gnuplotandthes qlite3command-line
programareinterpreters. Comparewith compiler.
jackknife :Arelativeofthe bootstrap .Asubsampleisformedbyremovingtheﬁrst
element, then estimating ˆβj1; the next subsample is formed by replacing the ﬁrst
elementandremovingthesecond,thenre-estimating ˆβj2,etcetera.Themultitude
ofˆβjn’s thus formed canbe usedto estimatethe varianceofthe over allparameter
estimate ˆβ. [p 131]
join: Combining two database tables to form a third, typically in cluding some
columns from the ﬁrst and some from the second. There is usual ly a column on
which the join is made; e.g., a ﬁrst table of names and heights and a second table
of names and weights would be joined by matching the names in b oth tables. [p
87]
kerneldensityestimate :Amethodofsmoothingadatasetbycenteringastandard
PDF (like the Normal) around every point. Summing together a ll the sub-PDFs
producesa smoothoverallPDF.[p 262]
kurtosis:Thefourth centralmoment .[p 230]
lexicographic order : Words in the dictionary are ﬁrst sorted using only the ﬁrst
letter, completelyignoringalltheothers.Then,wordsbeg inningwith Aaresorted
gsl_stats March24,2009
GLOSSARY 427
by their second letter. Those beginning with the same ﬁrst tw o letters (aandblom,
aard-wolf, aasvogel, ...) are sorted using their third lett er. Thus, a lexicographic
ordering sorts using only the ﬁrst characteristic, then bre aks ties with a second
characteristic,then breaksfurtherties with athird, ands oon.[p 91]
library:Asetoffunctionsandvariablesthatperformtasksrelated tosomespeciﬁc
task, such as numeric methods or linked list handling. The library is basically an
object ﬁle in a slightly different format, and is typically kept somewh ere on the
librarypath.[p 52]
likelihood function : The likelihood P(X,β)|Xis the probability that we’d have
theparameters βgivensomeobserveddata X.Thisisincontrasttotheprobability
of a data set given ﬁxed parameters, P(X,β)|β. See page 329 for discussion. [p
326]
likelihood ratio test : A test basedon a statistic of the form P1/P2. This is some-
times logged to LL1−LL2. Many tests that on their surface seem to not ﬁt this
form canbeshownto beequivalenttoanLR test. [p335]
linkedlist :Asetofstructures,whereeachstructureholdsdataandapo intertothe
nextstructure in the list. One could traverse the list by fol lowing the pointer from
the head element to the next element, then following that ele ment’s pointer to the
nextelement,etcetera.[p 198]
linker: A program that takes in a set of libraries andobject ﬁles and outputs an
executableprogram.[p 51]
Manhattanmetric :Givendistancesinseveraldimensions,say dx=|x1−x2|and
dy=|y1−y2|,thestandardEuclidianmetriccombinesthemtoﬁndastraig ht-line
distance via/radicalig
d2x+d2y. The Manhattan metric simply adds the distance on each
dimension, dx+dy.Thisisthedistanceonewouldtravelbyﬁrstgoingonlyalon g
East–Weststreets,thenonlyalongNorth–Southstreets.[p 150]
make:Aprogramthatkeepstrackof dependencies ,andrunscommands(speciﬁed
in a makeﬁle)as neededto keep all ﬁles up-to-date as their de pendencieschange.
Usuallyusedto produceexecutableswhentheir sourceﬁles change.[p 387]
macro: A rule to transform strings of text with a ﬁxed pattern. For e xample, a
preprocessor may replace every occurrence of /BZ/CB/C4/CN/C5/C1/C6/B4/CP/B8/CQ/B5 with /B4/B4/CP/B5 /BO /B4/CQ/B5/BR /B4/CP/B5 /BM /B4/CQ/B5/B5.[p 212]
metadata : Data about data. For example, a pointeris data about the location of
basedata,anda statisticis datasummarizingortransforming basedata.[p 128]
gsl_stats March24,2009
428 APPENDIX C
mean squared error : Given an estimate of βnamed ˆβ, the MSE is E(ˆβ−β)2.
Thiscanbeshowntobeequivalentto var(ˆβ) + bias2(ˆβ). [p 220]
memory leak : If you lose the address of space that you had allocated, then the
spaceremains reservedeventhough it is impossiblefor you t o use.Thus, the sys-
tem’susablememoryis effectivelysmaller.[p 62]
missing at random : Data for variable iis MAR if the incidence of missing data
points is unrelated to the existing data for variable i, given the other variables.
Generally,this meansthat there is an externalcause(notca usedby the valueof i)
thatcausesvaluesof ito bemissing.[p 346]
missing completely at random :Data for variable iare MCAR if there is no cor-
relation between the incidence of missing data and anything else in the data set.
Thatis, thecauseofmissingnessis entirelyexternalandha phazard.[p 346]
missing not at random : Data for variable iis MNAR if there is a correlation
between the incidence of missing data and the missing data’s value. That is, the
missingnessis causedbythe data’svalue.[p 346]
Monte Carlo method : Generating information about a distribution, such as pa-
rameter estimates, by repeatedly making random draws from t he distribution. [p
356]
multicollinearity : Given a data set Xconsisting of columns x1,x2, ..., if two
columns xiandxjare highly correlated, then the determinant of X′Xwill be
nearzeroand the valueof the inverse (X′X)−1unstable.As a result, OLS-family
estimateswill notbereliable. [p275]
noncentral moment : Given a data vector xand mean x, thekthnoncentral mo-
mentis1
n/summationtext
x∈xxk.Inthecontinuouscase,if xhasdistribution p(x),thenthe kth
noncentral moment of f(x)is/integraltext∞
−∞f(x)kp(x)dx. The only noncentral moment
anybodycaresaboutis theﬁrst—aka,themean.[p 230]
non-ignorablemissingness :Seemissingnotatrandom .[p 346]
non-parametric : A test or model is non-parametric if it does not rely on a clai m
that the statistics/parameters in question have a textbook distribution ( t,χ2, Nor-
mal, Bernoulli, et cetera). However, all non-parametric mo dels have parameters
to tune, and all non-parametric tests are based on a statisti c whose characteristics
mustbedetermined.
nullpointer :A specialpointerthatis deﬁnedto notpointto anything.[p 43]
gsl_stats March24,2009
GLOSSARY 429
object:Astructure,typicallyimplementedviaa /D7/D8/D6/D9/D8,plusanysupportingfunc-
tions that facilitate use of that structure, such as the /CV/D7/D0/CN/DA/CT/D8/D3/D6 plus the /CV/D7/D0/CN/B9/DA/CT/D8/D3/D6/CN/CP/CS/CS , /CV/D7/D0/CN/DA/CT/D8/D3/D6/CN/CS/CS/D3/D8 , ...,functions.
object ﬁle : A computer-readable ﬁle listing the variables, functions , and types
deﬁned in a /BAﬁle. Object ﬁles are not executablesuntil they go through linking.
Bearsnorelation to objectsorobject-orientedprogramming.[p51]
orderstatistic :Thevalueatagivenpositioninthesorteddata,suchasthel argest
number in a set, the second largest number, the median, the sm allest number, et
cetera.
Ordinary Least Squares : A model, fully speciﬁed on page 274, that contends
that a dependent variable is the linear combination of a numb er of independent
variables,plusanerrorterm.
overﬂowerror :Whenthevalueofavariableistoolargeforitstype,unpred ictable
things may occur. For example, on some systems, /C5/BT/CG/CN/C1/C6/CC /B7 /BD /BP/BP /B9/C5/BT/CG/CN/C1/C6/CC .
TheIEEEstandardspeciﬁesthatifa /CU/D0/D3/CP/D8or /CS/D3/D9/CQ/D0/CTvariableoverﬂows,itbeset
to aspecialpatternindicatinginﬁnity. Seealso underﬂowerror .[p 137]
path: A list of directories along which the computer will search f or ﬁles. Most
shells have a /C8/BT/CC/C0environment variable along which they search for executabl e
programs. Similarly, the preprocessor searches for header ﬁles (e.g., /AZ/CX/D2/D0/D9/CS/CT/BO/D7/D8/CS/D0/CX/CQ/BA/CW/BQ ) along the directories in the /C1/C6/BV/C4/CD/BW/BX/C8/BT/CC/C0 environment variable,
whichcanbeextendedusingthe /B9/C1ﬂagonthecompilercommandline.Thelinker
searchesforlibrariesto includeusingalibpathanditsext ensionsspeciﬁedviathe/B9/C4compilerﬂag.[p 385]
pipe:Aconnectionthatdirectlyredirectstheoutputfromonepr ogramtotheinput
of another. In the shell, a pipe is formed by putting a |between two programs; in
C, itis formedusingthe /D4/D3/D4/CT/D2function.[p 395]
pivottable :Seecrosstab.[p101]
plot:Agraphicwithtwoorthreeaxesandfunctionvaluesmarkedr elativetothose
axes.Notto beconfusedwith a graph.[p 158]
pointer:A variableholdingthelocationofapieceofdata.[p 53]
POSIX: The Portable Operating System Interface standard. By the m id-1980s, a
multitudeofvariantsonthe UNIXoperatingsystemappeared;theInstituteofElec-
tricalandElectronicsEngineersconvenedapaneltowritet hisstandardsothatpro-
gramswrittenononeﬂavorofUNIXcouldbemoreeasilyported toanotherﬂavor.
Santa Cruz Operation’s UNIX, International Business Machi nes’ AIX, Hewlett-
gsl_stats March24,2009
430 APPENDIX C
Packard’s HP-UX, Linux, Sun’s Solaris, some members of Micr osoft’s Windows
family, andothersallmoreorlesscomplywith this standard .
power: The likelihood of rejecting a false null. That is, if there i s a signiﬁcant
effect,whataretheoddsthatthetestwilldetectit?Thisis oneminusthelikelihood
ofaTypeIIerror .[p 335]
prime numbers :Prime numbers are what is left when you havetaken all the pat -
ternsaway.(Haddon,2003,p12)[p 61]
principal component analysis : A projection of data Xonto a basis space con-
sisting of neigenvalues of X′X, which has a number of desirable properties. [p
265]
probability density function : The total area under a PDF for any given range is
equaltotheprobabilitythatadrawfromthedistributionwi llfallinthatrange.The
PDF is always nonnegative.E.g., the familiar bell curve of a Normal distribution.
Comparewith cumulativedensityfunction . [p236]
probability mass function : The distribution of probabilities that a given discrete
value will be drawn. I.e., a PDF when the distribution is over discrete values. [p
236]
projection matrix :XP≡X(X′X)−1X′.XPvequals the projection of vonto
thecolumnspaceof X.[p 272]
proﬁler:Aprogramthatexecutesotherprograms,anddetermineshow muchtime
is spent in each of the program’s various functions. It can th us be used to ﬁnd the
bottlenecksina slow-runningprogram.[p 215]
pseudorandomnumber generator :A function that produces a deterministic se-
quence of numbers that seem to have no pattern. Initializing the PRNG with a
differentseedproducesa differentstreamsofnumbers.[p357]
query: Any command to a database. Typically, the command uses the /D7/CT/D0/CT/D8
keywordtorequestdatafromthedatabase,butaquerymayals obeanon-question
command, such as a command to create a new table, drop an index , et cetera. [p
74]
randomnumbergenerator :Seepseudorandomnumbergenerator .[p 357]
regularexpressions :Astringusedtodescribepatternsoftext,suchas‘two num-
bersfollowedbyaletter’. [p 403]
gsl_stats March24,2009
GLOSSARY 431
scope:Thesectionofcodethatisabletorefertoavariable.Forva riablesdeclared
outsideofafunction,thescopeiseverythinginaﬁleaftert hedeclaration;forvari-
ables declared inside a block, the scope is everything after the declaration inside
theblock.[p 41]
score:Givena log likelihoodfunction lnP(θ), its scoreisthevectorofits deriva-
tives:S= (∂lnP/∂θ). [p326]
seed: The value with which a pseudorandom number generator is initialized. [p
357]
segfault:Anaffectionateabbreviationfor segmentationfault . [p 43]
segmentation fault : An error wherein the program attempts to access a part of
the computer’s memory that was not allocated to the program. If reading from
unauthorized memory, this is a security hole; if writing to u nauthorized memory,
this could destroy data or create system instability. There fore, the system catches
segfaultsandhaltsthe programimmediatelywhentheyoccur .[p 43]
shell: A program whose primary purpose is to facilitate running ot her programs.
Whenyoulogintomosttext-drivensystems,youareimmediat elyputattheshell’s
inputprompt.Mostshellsincludefacilitiesforsettingva riablesandwritingscripts.
[p 393]
singular value decomposition : Given an m×ndata matrix X(where typically
m >> n), one can ﬁnd the neigenvectors associatedwith the nlargest eigenval-
ues.20This may be done as the ﬁrst step in a principal component analysis . SVD
as currently practiced also includes a number of further tec hniques to transform
theeigenvectorsasappropriate. [p 265]
skew: The third central moment , used as an indication of whether a distribution
leansto the leftorright ofthe mean.[p 230]
source code : The human-readable version of a program. It will be convert ed into
objectcodefor thecomputerto execute.
stack: Each function runs in its own frame. When a program starts, it begins by
establishinga /D1/CP/CX/D2frame, and then if /D1/CP/CX/D2calls anotherfunction, thatfunction’s
frameisthoughtofasbeinglaidontopofthe /D1/CP/CX/D2frame.Similarlyforsubsequent
functions, so pending frames pile up to form a stack of frames . When the stack is
empty,theprogram terminates.[p 38]
20This is assuming that X′Xhas full rank.
gsl_stats March24,2009
432 APPENDIX C
standarddeviation :Thesquarerootofthevarianceofavariable,oftennotated as
σ.IfthevariableisNormallydistributed,weusuallycompar eapoint’sdistanceto
themeanagainst 1σ,2σ,....FordistributionsthatarenotNormal(oratleastbell -
shaped), σis of limited descriptive utility. See also standard error andvariance.
[p 222]
standarderror :An abbreviationforthestandarddeviationoftheerror. [p 367]
statistic: A function that takes data as an input, such as the mean of x; the vari-
ance of the error term of a regression of Xony, or the OLS parameter ˆβ=
(X′X)−1X′y. [p 219]
string: An array of characters. Because the string is an array, it is handled using
pointer-typeoperations,buttherearealsofunctionstoprintthes tringliketheplain
textit represents.[p 65]
structure :Asetofvariablesthatareintendedtocollectivelyrepres entoneobject,
suchasaperson(comprising,e.g.,aname,height,andweigh t)orabird(compris-
ing,e.g.,atypeand pointersto offspring). [p 31]
Structured Query Language :A standard language for writing database queries.
[p 74]
switches: As with physical machinery, switches are options to affect a program’s
operation.Theyare usuallysetonthe commandline, andare u suallymarkedbya
dash,like /B9/DC.[p 208]
trimean:(ﬁrstquartile+twotimesthemedian+thirdquartile)/4.( Tukey,1977,p
46)[p 234]
threading : On many modern computers, the processor(s) can execute mul tiple
chains of commands at once. For example, the data regarding t wo independent
events could be simultaneously processed by two processors . In such a case, the
singlethreadofprograminstructionscanbesplitintomult iplethreads,whichmust
begatheredtogetherbeforetheprogramcompletes.[p 119]
type: The class of data a variable is intended to represent, such a s an integer,
character,or structure (which is anamalgamationofsubtypes).[p 27]
typecasting :Convertingavariablefrom one typeto another.[p 33]
TypeIerror :Rejectingthe nullwhenit is true.[p 335]
TypeIIerror :Acceptingthe nullwhenit is false.Seealso power.[p 335]
gsl_stats March24,2009
GLOSSARY 433
unbiasedstatistic :Theexpectedvalue ofthestatistic ˆβequalsthetruepopulation
value: E(ˆβ) =β. [p 220]
unbiased estimator : Letαbe a test’s Type Ierror, and let βbe itsType IIerror.
A test is unbiasedif (1−β)≥αfor all valuesof the parameter. I.e., you are less
likely to acceptthenullwhenitis false thanwhenit is true. [p 335]
underﬂowerror :Occurswhenthevalueofavariableissmallerthanthesmall est
numberthe system canrepresent. For example,on any current system with ﬁnite-
precisionarithmetic, 2−10,000is simplyzero.Seealso overﬂowerror .[p 137]
UNIX:AnoperatingsystemdevelopedatBellLabs.ManycallanyUN IX-likeop-
eratingsystembythisname(oftenbytheplural,Unices),bu tUNIXproperlyrefers
onlytothecodewrittenbyBellLabs,whichhasevolvedintoc odeownedbySanta
CruzOperation.Others arecorrectly called POSIX-compliant.Thenamedoesnot
standforanything,butisa punon apredecessoroperatingsy stem,Multics.
variance:Thesecond centralmoment ,usuallynotatedas σ2. [p 222]
Weighted Least Squares : A type of GLSmethod wherein different observations
are givendifferent weights. Theweights canbe for anyreaso n,suchasproducing
a representative survey sample, but the method is often used forheteroskedastic
data.[p 277]
gsl_stats March 24,2009
gsl_stats March24,2009
BIBLIOGRAPHY
Abelson, Harold, Sussman, Gerald Jay, & Sussman, Julie. 198 5.Structure and
InterpretationofComputerPrograms . MIT Press.
Albee,Edward.1960. TheAmericanDreamandZooStory . Signet.
Allison, Paul D. 2002. Missing Data . Quantitative Applications in the Social
Sciences. SagePublications.
Amemiya, Takeshi. 1981. Qualitative Response Models: A Sur vey.Journal of
EconomicLiterature ,19(4), 1483–1536.
Amemiya, Takeshi. 1994. Introduction to Statistics and Econometrics . Harvard
UniversityPress.
Avriel, Mordecai. 2003. Nonlinear Programming: Analysis and Methods . Dover
Press.
Axtell, Robert. 2006. Firm Sizes: Facts, Formulae, Fables a nd Fantasies. Center
onSocialandEconomicDynamicsWorkingPapers ,44(Feb.).
Barron,AndrewR,&Sheu,Chyong-Hwa.1991. Approximationo fDensityFunc-
tions by Sequences of Exponential Families. The Annals of Statistics ,19(3),
1347–1369.
Baum,AE, Akula,N, Cabanero,M,Cardona,I, Corona,W,Kleme ns,B, Schulze,
TG,Cichon,S,Rietschel,M,Nathen,MM,Georgi,A,Schumach er,J,Schwarz,
M,Jamra,RAbou,Hofels,S,Propping,P,Satagopan,J,Conso rtium,NIMHGe-
neticsInitiativeBipolarDisorder,Detera-Wadleigh,SD, Hardy,J,&McMahon,
gsl_stats March24,2009
436 BIBLIOGRAPHY
FJ.2008. Agenome-wideassociationstudyimplicatesdiacy lglycerolkinaseeta
(DGKH) and severalother genesin the etiology of bipolardis order.Molecular
Psychiatry ,13(2),197–207.
Benford, Frank. 1938. The Law of Anomalous Numbers. Proceedings of the
AmericanPhilosophicalSociety ,78(4), 551–572.
Bowman, K O, & Shenton, L R. 1975. Omnibus Test Contours for De partures
from Normality Basedon√b1andb2.Biometrika ,62(2),243–250.
Casella,George,& Berger, RogerL.1990. StatisticalInference . DuxburyPress.
Chamberlin,ThomasChrowder.1890. TheMethodofMultipleW orkingHypothe-
ses.Science,15(366),10–11.
Cheng, Simon, & Long, J Scott. 2007. Testing for IIA in the Mul tinomial Logit
Model.SociologicalMethodsResearch ,35(4), 583–600.
Chung,J H, & Fraser,D A S. 1958. RandomizationTestsfor a Mul tivariate Two-
SampleProblem. JournaloftheAmericanStatisticalAssociation ,53(283),729–
735.
Chwe, Michael Suk-Young. 2001. Rational Ritual: Culture, Coordination, and
CommonKnowledge . PrincetonUniversityPress.
Cleveland,William S,&McGill, Robert.1985. GraphicalPer ceptionandGraphi-
calMethodsfor AnalyzingScientiﬁcData. Science,229(4716),828–833.
Codd, Edgar F. 1970. A Relational Model of Data for Large Shar ed Data Banks.
Communicationsofthe ACM ,13(6), 377–387.
Conover,WJ.1980. PracticalNonparametricStatistics .2ndedn. Wiley.
Cook,RDennis.1977. DetectionofInﬂuentialObservations inLinearRegression.
Technometrics ,19(1), 15–18.
Cox, D R. 1962. Further Results on Tests of Separate Families of Hypotheses.
Journalof theRoyalStatistical Society.SeriesB (Methodo logical),24(2), 406–
424.
Cropper, Maureen L, Deck, Leland, Kishor, Nalin, & McConnel l, Kenneth E.
1993. Valuing Product Attributes Using Single Market Data: A Comparison of
HedonicandDiscreteChoiceApproaches. ReviewofEconomicsandStatistics ,
75(2),225–232.
Dempster, A P, Laird, N M, & Rubin, D B. 1977. Maximum Likeliho od from
IncompleteDataviatheEMAlgorithm. JournaloftheRoyalStatisticalSociety.
SeriesB(Methodological) ,39(1), 1–38.
gsl_stats March24,2009
BIBLIOGRAPHY 437
Efron, Bradley, & Hinkley, David V. 1978. Assessing the Accu racy of the Max-
imum Likelihood Estimator: Observed Versus Expected Fishe r Information.
Biometrika ,65(3), 457–482.
Efron, Bradley, & Tibshirani, Robert J. 1993. An Introduction to the Bootstrap .
MonographsonStatistics andProbability, no. 57. Chapmana ndHall.
Eliason, Scott R. 1993. Maximum Likelihood Estimation: Logic and Practice .
QuantitativeApplicationsin theSocialSciences. SagePub lications.
Epstein, Joshua M, & Axtell, Robert. 1996. Growing Artiﬁcial Societies: Social
SciencefromtheBottom Up . BrookingsInstitution PressandMIT Press.
Fein,Sidney,Paz,Victoria,Rao,Nyapati,&LaGrassa,Jose ph.1988. TheCombi-
nationofLithiumCarbonateandanMAOIinRefractoryDepres sions.American
JournalofPsychiatry ,145(2),249–250.
Feller,William. 1966. AnIntroductiontoProbabilityTheoryandItsApplications .
Wiley.
Fisher,RA.1934. TwoNewPropertiesofMathematicalLikeli hood.Proceedings
ofthe RoyalSocietyofLondon.SeriesA,Containing Paperso f aMathematical
andPhysicalCharacter ,144(852),285–307.
Fisher, Ronald Aylmer. 1922. On the Interpretation of χ2from Contingency Ta-
bles, and the Calculation of P.Journal of the Royal Statistical Society ,85(1),
87–94.
Fisher, Ronald Aylmer. 1956. Statistical Methods andScientiﬁc Inference . Oliver
& Boyd.
Freedman,DavidA.1983. ANoteonScreeningRegressionEqua tions.TheAmer-
icanStatistician ,37(2),152–155.
Friedl, Jeffrey E F. 2002. Mastering Regular Expressions .2ndedn. O’Reilly
Media.
Frisch,Æleen.1995. EssentialSystemAdministration . O’Reilly & Associates.
Fry, Tim R L, & Harris, Mark N. 1996. A Monte Carlo Study of Test s for the
IndependenceofIrrelevantAlternativesProperty. TransportationResearchPart
B:Methodological ,30(1),19–30.
Gardner, Martin. 1983. Wheels,Life, andOtherMathematicalAmusements . W H
Freeman.
Gelman, Andrew, & Hill, Jennifer. 2007. Data Analysis Using Regression and
Multilevel/HierarchicalModels . CambridgeUniversityPress.
gsl_stats March24,2009
438 BIBLIOGRAPHY
Gelman,Andrew,Carlin,JohnB,Stern,HalS,&Rubin,Donald B.1995.Bayesian
DataAnalysis .2ndedn. Chapman&HallTextsinStatisticalScience.Chapman
& Hall/CRC.
Gentle,JamesE.2002. ElementsofComputationalStatistics . StatisticsandCom-
puting. Springer.
Gentleman, Robert, & Ihaka, Ross. 2000. Lexical Scope and St atistical Comput-
ing.JournalofComputationalandGraphicalStatistics ,9(3),491–508.
Gibbard,Ben.2003. Lightness . BarsukRecords. InDeathCabforCutie, Transat-
lanticism.
Gibrat, Robert. 1931. Les Inégalités Économiques; Applications: Aux Inégalités
des Richesses, a la Concentration des Entreprises, aux Popu lations des Villes,
auxStatistiquesdesFamilles,etc.,d’uneLoiNouvelle,la LoideL’effetPropor-
tionnel. Librarie duRecueilSirey.
Gigerenzer,Gerd.2004. MindlessStatistics. TheJournalofSocio-Economics ,33,
587–606.
Gill, Philip E, Murray, Waler, & Wright, Margaret H. 1981. Practical Optimiza-
tion. AcademicPress.
Givens, Geof H, & Hoeting, Jennifer A. 2005. Computational Statistics . Wiley
Seriesin ProbabilityandStatistics. Wiley.
Glaeser, Edward L, Sacerdote, Bruce, & Scheinkman, Jose A. 1 996. Crime and
SocialInteractions. TheQuarterlyJournalofEconomics ,111(2), 507–48.
Goldberg, David. 1991. What Every Computer Scientist Shoul d Know about
Floating-pointArithmetic. ACMComputingSurveys ,23(1), 5–48.
Gonick,Larry, & Smith, Woollcott.1994. CartoonGuideto Statistics . Collins.
Good, Irving John. 1972. Random Thoughts about Randomness. PSA: Proceed-
ings of the Biennial Meeting of the Philosophy of Science Ass ociation,1972,
117–135.
Gough, Brian (ed). 2003. GNU Scientiﬁc Library Reference Manual .2ndedn.
NetworkTheory,Ltd.
Greene,William H.1990. EconometricAnalysis .2ndedn. PrenticeHall.
Haddon,Mark.2003. TheCuriousIncidentoftheDogintheNight-time . Vintage.
Huber,PeterJ. 2000. Languagesfor Statistics andData Anal ysis.Jouralof Com-
putationalandGraphicalStatistics ,9(3), 600–620.
Huff, Darrell, & Geis, Irving. 1954. How to Lie With Statistics . W. W. Norton &
Company.
gsl_stats March24,2009
BIBLIOGRAPHY 439
Hunter,JohnE,&Schmidt,FrankL.2004. MethodsofMeta-Analysis:Correcting
ErrorandBias in ResearchFindings .2ndedn. SagePublications.
InternalRevenueService.2007. 2007FederalTaxRateSchedules . Departmentof
theTreasury.
Kahneman, Daniel, Slovic, Paul, & Tversky,Amos. 1982. JudgementUnder Un-
certainty:HeuristicsandBiases . CambridgeUniversityPress.
Karlquist, A (ed). 1978. Spatial Interaction Theory and Residential Location .
North Holland.
Kernighan,BrianW,&Pike,Rob.1999. ThePracticeofProgramming . Addison-
WesleyProfessional.
Kernighan,Brian W,& Ritchie, DennisM. 1988. TheCProgrammingLanguage .
2ndedn. PrenticeHallPTR.
Klemens,Ben.2007. FindingOptimalAgent-basedModels . BrookingsCenteron
SocialandEconomicDynamicsWorkingPaper#49.
Kline, Morris. 1980. Mathematics: The Loss of Certainty . Oxford University
Press.
Kmenta, Jan. 1986. Elements of Econometrics .2ndedn. Macmillan Publishing
Company.
Knuth, Donald Ervin. 1997. The Art of ComputerProgramming .3rdedn. Vol. 1:
FundamentalAlgorithms. Addison-Wesley.
Kolmogorov, Andrey Nikolaevich. 1933. Sulla determinazio ne empirica di una
leggedidistributione. Giornaledell’Istituto Italiano degliAttuari ,4, 83–91.
Laumann, Anne E, & Derick, Amy J. 2006. Tattoos and body pierc ings in the
United States: A National Data Set. Journalof the American Academy of Der-
matologists ,55(3),413–21.
Lehmann, E L, & Stein, C. 1949. On the Theory of Some Non-Param etric Hy-
potheses. TheAnnalsofMathematicalStatistics ,20(1),28–45.
Maddala,G S.1977. Econometrics . McGraw-Hill.
McFadden, Daniel. 1973. Conditional Logit Analysis of Qualitative Choice Be-
havior.In:Zarembka(1973). Chap.4,pages105–142.
McFadden, Daniel. 1978. Modelling the Choice of Residential Location .
In:Karlquist(1978). Pages75–96.
Nabokov,Vladimir. 1962. PaleFire. G P Putnams’sSons.
gsl_stats March24,2009
440 BIBLIOGRAPHY
National Election Studies. 2000. The 2000 National Election Study [dataset] .
UniversityofMichigan,CenterforPoliticalStudies.
Newman,JamesR (ed).1956. TheWorldofMathematics . SimonandSchuster.
Neyman,J, & Pearson, E S. 1928a. On the Use and Interpretatio n of Certain Test
CriteriaforPurposesofStatisticalInference:PartI. Biometrika ,20A(1/2),175–
240.
Neyman, J, & Pearson, E S. 1928b. On the Use and Interpretatio n of Certain
TestCriteriaforPurposesofStatisticalInference:PartI I.Biometrika ,20A(3/4),
263–294.
Orwell, George.1949. 1984. SeckerandWarburg.
Papadimitriou, Christos H, & Steiglitz, Kenneth. 1998. Combinatorial Optimiza-
tion:AlgorithmsandComplexity . Dover.
Paulos, John Allen. 1988. Innumeracy: Mathematical Illiteracy and its Conse-
quences. HillandWang.
Pawitan, Yudi. 2001. In All Likelihood:Statistical Modeling and InferenceUsin g
Likelihood . Oxford UniversityPress.
Pearson, Karl. 1900. On the Criterion that a given System of D eviations from
the Probable in the Case of a Correlated System of Variables i s Such That it
CanbeReasonablySupposedtoHaveArisenfromRandomSampli ng.London,
Edinburgh and Dublin Philosophical Magazine and Journal of Science, July,
157–175. Reprintedin Pearson(1948,pp339–357).
Pearson,Karl.1948. KarlPearson’sEarlyStatistical Papers . Cambridge.
Peek, Jerry, Todino-Gonguet, Grace, & Strang, John. 2002. Learning the UNIX
OperatingSystem .5thedn. O’Reilly & Associates.
Perl, Judea.2000. Causality . CambridgeUniversityPress.
Pierce, John R. 1980. An Introduction to Information Theory: Symbols, Signals,
andNoise . Dover.
Poincaré, Henri. 1913. Chance. In Newman (1956), translated by George Bruce
Halsted. Pages1380–1394.
Polhill, J Gary, Izquierdo, Luis R, & Gotts, Nicholas M. 2005 . The Ghost in the
Model (and Other Effects of Floating Point Arithmetic). Journal of Artiﬁcial
SocietiesandSocialSimulation ,8(1).
Poole,Keith T, & Rosenthal,Howard.1985. ASpatialModelfo r LegislativeRoll
CallAnalysis. AmericanJournalofPolitical Science ,29(2), 357–384.
gsl_stats March24,2009
BIBLIOGRAPHY 441
Press, William H, Flannery, Brian P, Teukolsky, Saul A, & Vet terling, William T.
1988.Numerical Recipes in C: The Art of Scientiﬁc Computing . Cambridge
UniversityPress.
Price,Roger,& Stern, Leonard.1988. MadLibs . Price Stern Sloan.
Rumi, Jelaluddin. 2004. The Essential Rumi . Penguin. Translated by Coleman
Barks.
Särndal,Carl-Erik,Swensson,Bengt,&Wretman,Jan.1992. ModelAssistedSur-
veySampling . SpringerSeriesin Statistics. Springer-Verlag.
Scheffé,Henry.1959. TheAnalysisofVariance . Wiley.
Shepard,RogerN,&Cooper,LynnA.1992.RepresentationofC olorsintheBlind,
Color-Blind, andNormally Sighted. PsychologicalScience ,3(2), 97–104.
Silverman,B W.1985. Some AspectsoftheSpline SmoothingAp proachto Non-
Parametric Regression Curve Fitting. Journal of the Royal Statistical Society.
SeriesB (Methodological) ,47(1), 1–52.
Silverman,BernardW.1981. UsingKernelDensityEstimates to InvestigateMul-
timodality. Journalof the Royal Statistical Society, Series B (Methodo logical),
43,97–99.
Smith, Thomas M, & Reynolds, Richard W. 2005. A Global Merged Land Air
andSea SurfaceTemperatureReconstructionBasedon Histor ical Observations
(1880–1997). JournalofClimate ,18,2021–2036.
Snedecor, George W, & Cochran, Willian G. 1976. Statistical Methods .6thedn.
IowaState UniversityPress.
Stallman, Richard M, Pesch, Roland H, & Shebs, Stan. 2002. Debugging with
GDB:TheGNUSource-levelDebugger . FreeSoftware Foundation.
Stravinsky, Igor. 1942. Poetics of Music in the Form of Six Lessons:The Charles
EliotNortonLectures . HarvardUniversityPress.
Stroustrup,Bjarne.1986. TheC++ProgrammingLanguage . Addison-Wesley.
Student.1927. Errors ofRoutineAnalysis. Biometrika ,19(1/2),151–164.
Thomson,William.2001. AGuidefortheYoungEconomist:WritingandSpeaking
Effectively aboutEconomics . MIT Press.
Train, Kenneth E. 2003. Discrete Choice Methods with Simulation . Cambridge
UniversityPress.
Tukey,JohnW.1977. ExploratoryDataAnalysis . Addison-Wesley.
gsl_stats March24,2009
442 BIBLIOGRAPHY
Vuong, Quang H. 1989. Likelihood Ratio Tests for Model Selec tion and Non-
NestedHypotheses. Econometrica ,57(2),307–333.
Wolfram, Stephen.2003. TheMathematicaBook .5thedn. Wolfram Media.
Zarembka,P(ed). 1973. Frontiersin Econometrics . AcademicPress.
gsl_stats March24,2009
INDEX/AX(C),20
π, 136/B9/BQ(C),60/BO,395/BO(C),20/BP(C),19/BP/BP(C),20/BQ(C),20/BQ /CU/CX/D0/CT/D2/CP/D1/CT ,394/BQ/BQ,395/AZ/CS/CT/CU/CX/D2/CT,116/AZ/CX/CU/D2/CS/CT/CU,see /CX/CU/D2/CS/CT/CU/AZ/CX/D2/D0/D9/CS/CT ,see /CX/D2/D0/D9/CS/CT/B1(C),19
&,57/B2/B2(C),20
ˆ(caret)
in regexbrackets
(negation),404
outofregexbrackets
(headofline),407/F4, 11/DG/DG(C),20/BC/DC,54
Abelsonet al.(1985),xi
afﬁneprojection,280, 420agent-basedmodeling,178
Agents
assigningRNGs, 363
Albee(1960),xii
Allison (2002),105,346
Amemiya(1981),287
Amemiya(1994),310,336
analysisofvariance,312
and,see /B2/B2
animation,177
anonymousstructures,353
ANOVA,224,226,312,
316,419,420
comparisontoOLS, 316
fordescription,224–227
fortesting,312–315
ANSI,419/CP/D4/D3/D4/CN/BA/BA/BA/BY/CN/D8/CT/D7/D8,311,312/C1/CE,278/CP/D2/D3/DA/CP,226/CP/D6/D6/CP/DD/CN/D8/D3/CN/D1/CP/D8/D6/CX/DC ,125/CP/D6/D6/CP/DD/CN/D8/D3/CN/DA/CT/D8/D3/D6 ,125/CQ/CT/D8/CP/CN/CU/D6/D3/D1/CN/D1/CT/CP/D2/CN /DA/CP/D6,
358/D6/D3/D7/D7/D8/CP/CQ/CN/D8/D3/CN/CS/CQ ,
100–102
/CS/CP/D8/CP/CN/CP/D0/D0/D3 ,120/CS/CP/D8/CP/CN/D3/D4/DD ,122/CS/CP/D8/CP/CN/D3/D6/D6/CT/D0/CP/D8/CX/D3/D2 ,
229,231/CS/CP/D8/CP/CN/CU/CX/D0/D0 ,310/CS/CP/D8/CP/CN/CV/CT/D8/BA/BA/BA ,110,121/CS/CP/D8/CP/CN/D0/CX/D7/D8/DB/CX/D7/CT/CN/B9/CS/CT/D0/CT/D8/CT,
347/CS/CP/D8/CP/CN/D1/CT/D1/D4/DD ,125/CS/CP/D8/CP/CN/D4/D6/CX/D2/D8 ,99,100,
126/CS/CP/D8/CP/CN/D4/D8/D6/BA/BA/BA ,121/CS/CP/D8/CP/CN/D4/D8/D6 ,359/CS/CP/D8/CP/CN/D7/CT/D8/BA/BA/BA ,121/CS/CP/D8/CP/CN/D7/CW/D3/DB ,99,231/CS/CP/D8/CP/CN/D7/D3/D6/D8 ,233/CS/CP/D8/CP/CN/D7/D8/CP/CZ ,282/CS/CP/D8/CP/CN/D7/D9/D1/D1/CP/D6/CX/DE/CT ,232/CS/CP/D8/CP/CN/D8/D3/CN/CS/D9/D1/D1/CX/CT/D7 ,110,
111,123,281,283/CS/CP/D8/CP,104,120–130,232/CS/CQ/CN/D1/CT/D6/CV/CT/CN/D8/CP/CQ/D0/CT ,102/CS/CQ/CN/D1/CT/D6/CV/CT ,102/CS/CQ/CN/D6/D2/CV/CN/CX/D2/CX/D8 ,84/CS/CQ/CN/D8/D3/CN/D6/D3/D7/D7/D8/CP/CQ ,81,
100–102
gsl_stats March24,2009
444 INDEX/CS/CT/D8/CN/CP/D2/CS/CN/CX/D2/DA ,134/CS/D3/D8,129,267/CS/D6/CP/DB,359/CT/D7/D8/CX/D1/CP/D8/CT/CN/D6/CT/D7/D8/CP/D6/D8 ,
150,345/CT/D7/D8/CX/D1/CP/D8/CT ,150,257,
273,323/CT/DC/D4/D3/D2/CT/D2/D8/CX/CP/D0 ,374/CV/CP/D1/D1/CP,374/CW/CX/D7/D8/D3/CV/D6/CP/D1/D7/CN/D8/CT/D7/D8/CN /B9/CV/D3/D3/CS/D2/CT/D7/D7/CN/D3/CU/CN/CU/CX/D8 ,
323/CW/CX/D7/D8/D3/CV/D6/CP/D1/CN/D1/D3/CS/CT/D0/CN /B9/D6/CT/D7/CT/D8,
323/CW/CX/D7/D8/D3/CV/D6/CP/D1/CN/DA/CT/D8/D3/D6 /CN/B9/D6/CT/D7/CT/D8,
323/CW/CX/D7/D8/D3/CV/D6/CP/D1 ,323/CY/CP/CZ/CZ/D2/CX/CU/CT/CN/D3/DA ,131/D0/CX/D2/CT/CN/D8/D3/CN/CS/CP/D8/CP ,125,353/D0/CX/D2/CT/CN/D8/D3/CN/D1/CP/D8/D6/CX/DC ,125/D0/CX/D2/CT/CP/D6/CN/D3/D2/D7/D8/D6/CP/CX/D2 /D8,
151/D0/CX/D2/CT/CP/D6/CN/D3/D2/D7/D8/D6/CP/CX/D2 /D8,
152,353/D0/D3/CV/CX/D8,284/D0/D3/D3/CZ/D9/D4,252,304/D1/CP/D8/D6/CX/DC/CN/BA/BA/BA/CN/CP/D0/D0 ,119/D1/CP/D8/D6/CX/DC/CN/BA/BA/BA ,119/D1/CP/D8/D6/CX/DC/CN/CS/CT/D8/CT/D6/D1/CX/D2/CP /D2/D8,
134/D1/CP/D8/D6/CX/DC/CN/CX/D2/DA/CT/D6/D7/CT ,134/D1/CP/D8/D6/CX/DC/CN/D1/CP/D4/CN/CP/D0/D0/CN/D7 /D9/D1,
119/D1/CP/D8/D6/CX/DC/CN/D1/CP/D4 ,100/D1/CP/D8/D6/CX/DC/CN/D2/D3/D6/D1/CP/D0/CX/DE/CT ,274/D1/CP/D8/D6/CX/DC/CN/D4/CP ,269/D1/CP/D8/D6/CX/DC/CN/D4/D6/CX/D2/D8 ,100,
126,167,168/D1/CP/D8/D6/CX/DC/CN/D7/D9/D1/D1/CP/D6/CX/DE/CT ,231/D1/CP/D8/D6/CX/DC/CN/D8/D3/CN/CS/CP/D8/CP ,120,
125/D1/CP/DC/CX/D1/D9/D1/CN/D0/CX/CZ/CT/D0/CX/CW/D3 /D3/CS,
325,337–340/D1/CT/D6/CV/CT/CN/CS/CQ/D7 ,98/D1/D3/CS/CT/D0,32,143ff, 273,
337,339,359
/D1/D9/D0/D8/CX/D2/D3/D1/CX/CP/D0/CN/D4/D6/D3 /CQ/CX /D8,
285/D2/D3/D6/D1/CP/D0/CX/DE/CT/CN/CU/D3/D6/CN/D7 /DA/CS,
267/D3/D0/D7,279/D3/D4/CT/D2/CN/CS/CQ,98/D3/D4/D8/D7,see /CP/D4/D3/D4/CN/D3/D4/D8/D7 for
speciﬁcoptions/D4/CP/CX/D6/CT/CS/CN/D8/CN/D8/CT/D7/D8 ,309/D4/D0/D3/D8/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1 ,358/D4/D0/D3/D8/CN/CW/CX/D7/D8/D3/CV/D6/CP/D1 ,172/D4/D0/D3/D8/CN/D5/D5,320/D4/D0/D3/D8/CN/D5/D9/CT/D6/DD ,98,417/D5/D9/CT/D6/DD/CN/D8/D3/CN/CS/CP/D8/CP ,99,
120,127/D5/D9/CT/D6/DD/CN/D8/D3/CN/CU/D0/D3/CP/D8 ,99/D5/D9/CT/D6/DD/CN/D8/D3/CN/D1/CP/D8/D6/CX/DC ,99,
127/D5/D9/CT/D6/DD/CN/D8/D3/CN/D1/CX/DC/CT/CS/CN /CS/CP /D8/CP,
104/D5/D9/CT/D6/DD/CN/D8/D3/CN/D8/CT/DC/D8 ,93,99,
121/D5/D9/CT/D6/DD/CN/D8/D3/CN/DA/CT/D8/D3/D6 ,99,
127/D5/D9/CT/D6/DD,98,127/D6/D2/CV/CN/CP/D0/D0/D3 ,252,357/D7/DD/D7/D8/CT/D1,125,397/D8/CN/D8/CT/D7/D8,110/D8/CP/CQ/D0/CT/CN/CT/DC/CX/D7/D8/D7 ,85,108/D8/CT/D7/D8/CN/CP/D2/D3/DA/CP/CN/B9/CX/D2/CS/CT/D4/CT/D2/CS/CT/D2/CT ,
313/D8/CT/D7/D8/CN/CU/CX/D7/CW/CT/D6/CN/CT/DC/CP /D8,
314/D8/CT/D7/D8/CN/CZ/D3/D0/D1/D3/CV/D3/D6/D3/DA ,323/D8/CT/DC/D8/CN/D8/D3/CN/CS/CP/D8/CP ,125/D8/CT/DC/D8/CN/D8/D3/CN/CS/CQ ,85,98,
107,125,206,417/D9/D4/CS/CP/D8/CT,259,361,373,
374/DA/CT/D8/D3/D6/CN/BA/BA/BA ,119/DA/CT/D8/D3/D6/CN/CP/D4/D4/D0/DD ,119/DA/CT/D8/D3/D6/CN/D3/D6/D6/CT/D0/CP/D8 /CX/D3 /D2,
231/DA/CT/D8/D3/D6/CN/CS/CX/D7/D8/CP/D2/CT ,150/DA/CT/D8/D3/D6/CN/CT/DC/D4 ,83/DA/CT/D8/D3/D6/CN/CV/D6/CX/CS/CN/B9/CS/CX/D7/D8/CP/D2/CT ,150/DA/CT/D8/D3/D6/CN/CZ/D9/D6/D8/D3/D7/CX/D7 ,230,
365/DA/CT/D8/D3/D6/CN/D0/D3/CV/BD/BC ,117,174/DA/CT/D8/D3/D6/CN/D0/D3/CV ,83,117/DA/CT/D8/D3/D6/CN/D1/CP/D4 ,119/DA/CT/D8/D3/D6/CN/D1/CT/CP/D2 ,231/DA/CT/D8/D3/D6/CN/D1/D3/DA/CX/D2/CV/CN/B9/CP/DA/CT/D6/CP/CV/CT,
262/DA/CT/D8/D3/D6/CN/D4/CT/D6/CT/D2/D8/CX/D0 /CT/D7,
233/DA/CT/D8/D3/D6/CN/D4/D6/CX/D2/D8 ,126/DA/CT/D8/D3/D6/CN/D7/CZ/CT/DB ,83,230,
231/DA/CT/D8/D3/D6/CN/D8/D3/CN/CS/CP/D8/CP ,120,
125/DA/CT/D8/D3/D6/CN/D8/D3/CN/D1/CP/D8/D6/CX/DC ,125/DA/CT/D8/D3/D6/CN/DA/CP/D6 ,83,230,
231/DA/CT/D8/D3/D6/CN/DB/CT/CX/CV/CW/D8/CT/CS/CN /B9/D1/CT/CP/D2,
232/DA/CT/D8/D3/D6/CN/DB/CT/CX/CV/CW/D8/CT/CS/CN /DA/CP /D6,
232/DB/D0/D7,278/DE/CX/D4/CU,149/BT/C8/C7/C8/CN/BV/C7/C4 ,142/BT/C8/C7/C8/CN/BW/BU/CN/BX/C6/BZ/C1/C6/BX ,106/BT/D4/D3/D4/CN/D1/CP/D8/D6/CX/DC/CN/D6/D3/DB ,114/CP/D4/D3/D4/CN/D3/D4/D8/D7/BA/BA/BA/BA/CS/CQ/CN/D2/CP/D1/CT/CN/D3/D0/D9/D1/D2 ,100,
120/CS/CQ/CN/D2/CP/D2,108/D3/D9/D8/D4/D9/D8/CN/CP/D4/D4/CT/D2/CS ,167/D3/D9/D8/D4/D9/D8/CN/D4/CX/D4/CT ,126,169/D3/D9/D8/D4/D9/D8/CN/D8/DD/D4/CT ,126/D8/CW/D6/CT/CP/CS/CN/D3/D9/D2/D8 ,119/BT/C8/C7/C8/CN/CA/C7/CF ,142/BT/C8/C7/C8/CN/CB/CD/BU/C5/BT/CC/CA/C1/CG ,142
apophenia,1, 420
arbitraryprecision,138/CP/D6/CV,206/CP/D6/CV/D4,208
arguments,36, 420/CP/D6/CV/DA,206/BT/D6/CX/D8/CW/D1/CT/D8/CX /CT/DC/CT/D4/D8/CX/D3/D2/B4/D3/D6/CT /CS/D9/D1/D4/CT/CS/B5,135
gsl_stats March24,2009
INDEX 445
arithmeticin C, 19
array,30,59, 420
arrays,125
ASCII,419/CP/D7/D4/D6/CX/D2/D8/CU ,67,111/CP/D7/D7/CT/D6/D8,71
assertion, 421
assignment, see /BP
asymptoticefﬁciency,221/CP/D8/D3/CU,29,208/CP/D8/D3/CX,208/CP/D8/D3/D0,208
Avriel(2003),150,340/CP/DB/CZ(POSIX),403
Axtell(2006),252
aymptoticunbiasedness,
221
bandwidth,261,262,376,
421
barchart,164
Barron& Sheu(1991),331
bash,41,382/CQ/CP/D7/CW(POSIX),187,382
Baumet al.(2008),93,376
Bayes’srule,258,336
Bayesian,330
Bayesianupdating,144,
258,372/CQ/CT/CV/CX/D2(SQL),84
Benford’slaw,173
Benford(1938),173
Bernoulli,327
Bernoullidistribution, 237,
358/CV/D7/D0/CN/D6/CP/D2/CN/B9/CQ/CT/D6/D2/D3/D9/D0/D0/CX/B4/CN/D4/CS/CU/B5 ,
237
Bernoullidraw,237,260,
421
Beta distribution,249,259,
331,358/CV/D7/D0/CN/CS/CU/CN/CQ/CT/D8/CP/CN/B4/C8/B8/C9 /B5,
249/CV/D7/D0/CN/D6/CP/D2/CN/CQ/CT/D8/CP/B4/CN/D4/CS/CU /B5,
249
Beta function,249/CQ/CT/D8/DB/CT/CT/D2 (SQL),79BFGS algorithm, see
Broyden-Fletcher-
Goldfarb-Shanno
Conjugategradient
algorithm
bias, 220, 421
binarytree,200, 421
Binomialdistribution, 237,
260,331,358/CV/D7/D0/CN/D6/CP/D2/CN/CQ/CX/D2/D3/D1/CX/CP /D0/B4/CN /B9/D4/CS/CU/B5,
238
birthdayparadox,23
BLAS,419
blockscope,41
BLUE, 221, 419,421
Bonferronicorrection,319
Booleanexpressions,20
bootstrap,367, 421
bootstrapprinciple,296,
421
Bourneshell,382
Bowman&Shenton
(1975),320
bracketexpressions
inregexes,404
BRE, 403, 419
breakingvia <ctrl-c>,61,
363
Broyden–Fletcher–
Goldfarb–Shanno
Conjugategradient
algorithm,341
buffer,169
C keywords/AX,20/B9/BQ,60/BO,20/BP/BP,20/BP,19/BQ,20/B1,19/B2/B2,20/CW/CP/D6,29/D3/D2/D7/D8,65/CS/D3/D9/CQ/D0/CT,29,135/CS/D3,23
/CT/D0/D7/CT,21/CT/DC/D8/CT/D6/D2,51/CU/D0/D3/CP/D8,29,135/CU/D3/D6,23,118/CU/D6/CT/CT,58/CX/CU/D2/CS/CT/CU,354/CX/CU,21,211/CX/D2/D0/D9/CS/CT,49–50,385/CX/D2/D8,29/D0/D3/D2/CV,29/D7/D8/CP/D8/CX,39,147,153,
357/D7/D8/D6/D9/D8,31,60/D8/DD/D4/CT/CS/CT/CU,31,191/D9/D2/CX/D3/D2,121/DA/D3/CX/CS,36/DB/CW/CX/D0/CT,23/DG/DG,20
Cshell,382
C++,42
call-by-address,54, 421
call-by-value,39,54, 421/CP/D0/D0/D3,57
carriagereturn,61,418/CP/D7/CT(SQL),110
Casella &Berger(1990),
221,331,334/CP/D7/D8(SQL),78
casting,seetypecasting/CP/D8(POSIX),399,400
Cauchydistribution,303,
365
Cauchy–Schwarz
inequality,229,333,
421
causality,271/CS(POSIX),399
CDF, 236, 419,see
cumulativedensity
function
cellularautomaton,178
CentralLimitTheorem,
295,297, 422
centralmoments,230, 422
Chamberlin(1890),317/CW/CP/D6(C),29
Chebychev’sinequality,
221
gsl_stats March24,2009
446 INDEX
Cheng& Long(2007),287
χ2distribution,301,358/CV/D7/D0/CN/CS/CU/CN/CW/CX/D7/D5/CN/C8 ,305/CV/D7/D0/CN/CS/CU/CN/CW/CX/D7/D5/CN/C8/CX /D2/DA,
306
χ2test, 309
goodness-of-ﬁt,321
scaling,314/CW/D1/D3/CS(POSIX),160
choose/CV/D7/D0/CN/D7/CU/CN/CW/D3/D3/D7/CT ,238
Chung&Fraser(1958),
375
Chwe(2001),262
Cleveland&McGill
(1985),180
closed-formexpression,
422
CLT,296, 419
clustering,289–291
CMF, 236, 419,see
cumulativemass
function
Codd(1970),95
coefﬁcientof
determination,228
color,180/D3/D0/D9/D1/D2(POSIX),399,402
command-lineutilities, 98
combinatorialoptimization,
338
Commandline
argumentson,203
command-lineprograms,
seePOSIX commands
commentingout,25
comments
inC, 25–26
inGnuplot,160
inSQL, 78/D3/D1/D1/CX/D8(SQL),84
comparativestatics, 152
compilation,48,51
compiler,18, 422
conditionalprobability,258
conditionals,20
conﬁgurationﬁles, 383conjugatedistributions,
374,422
conjugategradient,341
Conover(1980),323,376
consistentestimator,221,
422
consistenttest, 335, 422/D3/D2/D7/D8(C),65
constrainedoptimization,
151
contourplot,162
contrast,309, 422
Conway,John,178
Cook’sdistance,131
Cook(1977),131
correlationcoefﬁcient,229,
422
countingwords,401
covariance,228, 422
Cox(1962),354/D4(POSIX),399
Cramér–RaoInequality,
335
Cramér–Raolowerbound,
221,229,333, 423/D6/CT/CP/D8/CT(SQL),84
Cropperet al.(1993),283
crosstab,101, 423/D7/CW
redirecting /D7/D8/CS/CT/D6/D6,396/D7/CW(POSIX),382
cumulativedensity
function,236, 423
cumulativemassfunction,
236,423
currentdirectoryattack,
385/D9/D8(POSIX),399,401
CVS,seesubversion
data
conditioning,139
format,75,147
datamining,316, 423
datasnooping,316, 423
datastructures,193
deFinetti, 330
debugger,43, 423debugging,43–47
decile,seequantile
declaration, 423
offunctions,36
of /CV/D7/D0/CN/D1/CP/D8/D6/CX/DC ,114
of /CV/D7/D0/CN/DA/CT/D8/D3/D6 ,114
ofpointers,57
oftypes,31
ofvariables,28–33
degreesoffreedom,222,
423/CS/CT/D0/CT/D8/CT(SQL),86
Dempster et al.(1977),347
dependency, 423
dereferencing,43/CS/CT/D7(SQL),83
descriptivestatistics, 1, 423
designatedinitializers,32,
353
df,419/CS/CX/CU/CU(POSIX),399,402
discardsqualiﬁersfrom
pointertargettype,201
discretedata,123/CS/CX/D7/D8/CX/D2/D8 ,80,81/CS/D3(C),23/CS/D3/D7/BE/D9/D2/CX/DC (POSIX),418
dotﬁles,383
dotproduct,129
dot,graphingprogram,182/CS/D3/D9/CQ/D0/CT(C),29,135/CS/D3/DC/DD/CV/CT/D2 (POSIX),185/CS/D6/D3/D4(SQL),85,86
dummyvariable,110–111,
123,281–283,316,424
e,136/CT/CS(POSIX),403,404
efﬁciency,220,334, 424
Efron& Hinkley(1978),
13,349
Efron& Tibshirani(1993),
231/CT/CV/D6/CT/D4(POSIX),403,406
eigenvectors,267
Einstein,Albert,4
ElectricFence,214
Eliason(1993),xi
gsl_stats March24,2009
INDEX 447/CT/D0/D7/CT(C),21/BX/C5/BT/BV/CB(POSIX),387,402,
403/CT/D2/DA(POSIX),381,382
environmentvariable,381,
424
Epstein&Axtell(1996),
178
ERE,403, 419
erf,284,419
errorfunction,284, 424
Euler’sconstant,136/CT/DA/CT/D6/DD(Gnuplot),175/CT/DC/CT/D4/D8(SQL),94
excessvariance,239/CT/DC/CX/D8,166
expectedvalue,221, 424
Exponentialdistribution,
247/CV/D7/D0/CN/CS/CU/CN/B9/CT/DC/D4/D3/D2/CT/D2/D8/CX/CP/D0/CN/B4/C8/B8 /C9/B5,
247/CV/D7/D0/CN/D6/CP/D2/CN/B9/CT/DC/D4/D3/D2/CT/D2/D8/CX/CP/D0/B4/CN/D4/CS /CU/B5,
247
exponentialfamily,349/CT/DC/D4/D3/D6/D8(POSIX),382,424/CT/DC/D8/CT/D6/D2(C),51
ExtremeValuedistribution,
284
Fdistribution,304,358/CV/D7/D0/CN/CS/CU/CN/CU/CS/CX/D7/D8/CN/C8 ,305
Ftest,309/CP/D4/D3/D4/CN/BY/CN/D8/CT/D7/D8 ,310
factoranalysis,265/CU/D0/D3/D7/CT,169
Feinet al.(1988),254
Feller(1966),229
Fermat’spolygonalnumber
theorem,47/CU/CU/D0/D9/D7/CW,61,169/CU/CV/CT/D8/D7,203,394
Fibonaccisequence,30
ﬁles
hidden,383/CU/CX/D2/CS(POSIX),386
Fisherexacttest, 8,314Fisher,RA, 308
onlikelihood,329
Fisher (1922),313
Fisher (1934),329
Fisher (1956),308
Flat distribution, see
Uniformdistribution
ﬂat distribution,358
Fletcher–ReevesConjugate
gradientalgorithm,341/CU/D0/D3/CP/D8(C),29,135/CU/D3/D4/CT/D2,167,394/CU/D3/D6(C),23,118
FORTRAN, 10/CU/D3/D6/D8/D9/D2/CT (POSIX),397/CU/D4/D6/CX/D2/D8/CU,70,166,396
frame,37–39,54, 424/CU/D6/CT/CT(C), 58
Freedman(1983),316
frequentist,329
Friedl (2002),403
Frisch (1995),385/CU/D6/D3/D1(SQL),77
Fry& Harris(1996),287
fullouterjoin,106
functionpointers,190/CV/CN/CZ/CT/DD/CN/CU/CX/D0/CT/CN/CV/CT/D8/BA/BA/BA ,205
GameofLife,178
Gammadistribution,144,
246,331/CV/D7/D0/CN/CS/CU/CN/CV/CP/D1/D1/CP/CN/B4 /C8/B8/C9 /B5,
246/CV/D7/D0/CN/D6/CP/D2/CN/CV/CP/D1/D1/CP/B4/CN /D4/CS/CU /B5,
246
Gammafunction,244,246
Gardner(1983),178
Gaussian distribution,358,
seeNormaldistribution
GCC, 48, 419,424/CV,18,216/CV(POSIX),41,214/CV/CS/CQ,seedebugging/CV/CS/CQ(POSIX),44,387
GDP,419
Gelman&Hill (2007),xi,
95,290,292
Gelmanet al.(1995),373GeneralizedLeastSquares,
277,424
Gentleman&Ihaka(2000),
145/CV/CT/D8/CT/D2/DA,384/CV/CT/D8/D7,394
Gibbard(2003),295
Gibrat(1931),252
GIF, 177
Gigerenzer(2004),308
Gillet al.(1981),340
Givens&Hoeting(2005),
261
Glaeseret al.(1996),225
Glib,65,193
globalinformation,325
globalvariables
initializing,29,211
globbing,407, 424
GLS,277, 419,see
GeneralizedLeast
Squares
GNU,419
GNUScientiﬁc Library,7,
113
Gnuplot
comments,160/CV/D2/D9/D4/D0/D3/D8 (POSIX),
157–180,417
comments,160
Gnuplotkeywords/CT/DA/CT/D6/DD,175/D4/D0/D3/D8,160/D6/CT/D4/D0/D3/D8,160,170/D6/CT/D7/CT/D8,168/D7/D4/D0/D3/D8,161
Gnuplotsettings/CZ/CT/DD,165/D3/D9/D8,159/D4/D1/BF/CS,161,165/D8/CT/D6/D1,159/D8/CX/D8/D0/CT,164/DC/D0/CP/CQ/CT/D0,164/DC/D8/CX/D7,165/DD/D0/CP/CQ/CT/D0,164/DD/D8/CX/D7,165
Goldberg(1991),139
goldenratio,30
gsl_stats March24,2009
448 INDEX
Gonick&Smith(1994),
xiii
Good(1972),357
goodnessofﬁt, 319
Gough(2003),113
graph,182, 424
graphing, seeGnuplot, see
Graphviz
ﬂowcharts,182
nodes,182
Graphviz,182–185
Greene(1990),256,271,
281,286,315,346/CV/D6/CT/D4(POSIX),382,395,
403,404–408/CV/D6/CT/D4/BB/CT/CV/D6/CT/D4 (POSIX),399
gridsearch,371, 424/CV/D6/D3/D9/D4 /CQ/DD,81,91
GSL,113, 419,seeGNU
ScientiﬁcLibrary/CV/D7/D0/CN/BA/BA/BA/CQ/D0/CP/D7/CN/CS/CS/D3/D8 ,130/CS/CU/CN/BA/BA/BA,305/CS/CU/CN/CQ/CT/D8/CP/CN/B4/C8/B8/C9/B5 ,249/CS/CU/CN/CT/DC/D4/D3/D2/CT/D2/D8/CX/CP/D0/CN /B9/B4/C8/B8/C9/B5,
247/CS/CU/CN/CU/D0/CP/D8/CN/B4/C8/B8/C9/B5 ,251/CS/CU/CN/CV/CP/D1/D1/CP/CN/B4/C8/B8/C9/B5 ,246/CS/CU/CN/CV/CP/D9/D7/D7/CX/CP/D2/CN/B4/C8/B8 /C9/B5,
241/CS/CU/CN/D0/D3/CV/D2/D3/D6/D1/CP/D0/CN/B4/C8 /B8/C9/B5,
243/CS/CU/CN/D2/CT/CV/CP/D8/CX/DA/CT/CN/B9/CQ/CX/D2/D3/D1/CX/CP/D0/CN/B4/C8/B8/C9/B5 ,
244/D0/CX/D2/CP/D0/CV/CN/C0/C0/CN/D7/D3/D0/DA/CT ,134/D0/CX/D2/CP/D0/CV/CN/CB/CE/CN/CS/CT/D3/D1/D4 ,269/D1/CP/D8/D6/CX/DC/CN/CP/CS/CS/CN/D3/D2/D7/D8 /CP/D2/D8,
117/D1/CP/D8/D6/CX/DC/CN/CP/CS/CS ,117/D1/CP/D8/D6/CX/DC/CN/CP/D0/D0/D3 ,114/D1/CP/D8/D6/CX/DC/CN/CS/CX/DA/CN/CT/D0/CT/D1/CT /D2/D8/D7,
117/D1/CP/D8/D6/CX/DC/CN/CU/D6/CT/CT ,114/D1/CP/D8/D6/CX/DC/CN/CV/CT/D8 ,116/D1/CP/D8/D6/CX/DC/CN/D1/CT/D1/D4/DD ,125,
132
/D1/CP/D8/D6/CX/DC/CN/D1/D9/D0/CN/CT/D0/CT/D1 /CT/D2 /D8/D7,
117/D1/CP/D8/D6/CX/DC/CN/D4/D8/D6 ,122,359/D1/CP/D8/D6/CX/DC/CN/D6/D3/DB ,142/D1/CP/D8/D6/CX/DC/CN/D7/CP/D0/CT ,117/D1/CP/D8/D6/CX/DC/CN/D7/CT/D8/CN/CP/D0/D0 ,114/D1/CP/D8/D6/CX/DC/CN/D7/CT/D8/CN/D3/D0 ,114/D1/CP/D8/D6/CX/DC/CN/D7/CT/D8/CN/D6/D3/DB ,114/D1/CP/D8/D6/CX/DC/CN/D7/CT/D8 ,116/D1/CP/D8/D6/CX/DC/CN/D7/D9/CQ ,117/D1/CP/D8/D6/CX/DC/CN/D8/D6/CP/D2/D7/D4/D3/D7 /CT/CN /B9/D1/CT/D1/D4/DD,
149/D1/CP/D8/D6/CX/DC,99,114,120,
140/D4/D3/DB/CN/BE,132/D4/D3/DB/CN/CX/D2/D8,132/D6/CP/D2/CN/BA/BA/BA,358/D6/CP/D2/CN/CQ/CT/D6/D2/D3/D9/D0/D0/CX/B4/CN /D4/CS /CU/B5,
237/D6/CP/D2/CN/CQ/CT/D8/CP/B4/CN/D4/CS/CU/B5 ,249/D6/CP/D2/CN/CQ/CX/D2/D3/D1/CX/CP/D0/B4/CN/D4 /CS/CU /B5,
238/D6/CP/D2/CN/CT/DC/D4/D3/D2/CT/D2/D8/CX/CP/D0 /B4/CN /B9/D4/CS/CU/B5,
247/D6/CP/D2/CN/CU/D0/CP/D8/B4/CN/D4/CS/CU/B5 ,251/D6/CP/D2/CN/CV/CP/D1/D1/CP/B4/CN/D4/CS/CU/B5 ,246/D6/CP/D2/CN/CV/CP/D9/D7/D7/CX/CP/D2/B4/CN/D4 /CS/CU /B5,
241/D6/CP/D2/CN/B9/CW/DD/D4/CT/D6/CV/CT/D3/D1/CT/D8/D6/CX/B4/CN /B9/D4/CS/CU/B5,
239/D6/CP/D2/CN/D0/D3/CV/D2/D3/D6/D1/CP/D0/B4/CN /D4/CS /CU/B5,
243/D6/CP/D2/CN/D1/CP/DC,363/D6/CP/D2/CN/D1/D9/D0/D8/CX/D2/D3/D1/CX/CP/D0 /B4/CN /B9/D4/CS/CU/B5,
240/D6/CP/D2/CN/D2/CT/CV/CP/D8/CX/DA/CT/CN/B9/CQ/CX/D2/D3/D1/CX/CP/D0/B4/CN/D4/CS/CU/B5 ,
244/D6/CP/D2/CN/D2/CT/CV/CP/D8/CX/DA/CT/CN/B9/CQ/CX/D2/D3/D1/CX/CP/D0 ,
244/D6/CP/D2/CN/D4/D3/CX/D7/D7/D3/D2/B4/CN/D4/CS /CU/B5,
244
/D6/D2/CV/CN/CT/D2/DA/CN/D7/CT/D8/D9/D4 ,357/D6/D2/CV/CN/D9/D2/CX/CU/D3/D6/D1/CN/CX/D2/D8 ,297,
361,369/D6/D2/CV/CN/D9/D2/CX/CU/D3/D6/D1 ,251,358/D6/D2/CV,357/D7/CU/CN/CQ/CT/D8/CP,249/D7/CU/CN/CW/D3/D3/D7/CT ,238/D7/CU/CN/CV/CP/D1/D1/CP ,244/D7/D3/D6/D8/CN/DA/CT/D8/D3/D6/CN/B9/D0/CP/D6/CV/CT/D7/D8/CN/CX/D2/CS/CT/DC ,
268/D7/D8/CP/D8/D7/CN/DA/CP/D6/CX/CP/D2/CT ,230/DA/CT/D8/D3/D6/CN/CP/CS/CS/CN/D3/D2/D7/D8 /CP/D2 /D8,
117/DA/CT/D8/D3/D6/CN/CP/CS/CS ,117/DA/CT/D8/D3/D6/CN/CS/CX/DA ,117/DA/CT/D8/D3/D6/CN/CU/D6/CT/CT ,114/DA/CT/D8/D3/D6/CN/CV/CT/D8 ,116/DA/CT/D8/D3/D6/CN/D1/CT/D1/D4/DD ,125/DA/CT/D8/D3/D6/CN/D1/D9/D0 ,117/DA/CT/D8/D3/D6/CN/D4/D8/D6 ,122,359/DA/CT/D8/D3/D6/CN/D7/CP/D0/CT ,117/DA/CT/D8/D3/D6/CN/D7/CT/D8 ,116/DA/CT/D8/D3/D6/CN/D7/D3/D6/D8 ,233/DA/CT/D8/D3/D6/CN/D7/D9/CQ ,117/DA/CT/D8/D3/D6,119,120,140,
142/BZ/CB/C4/CN/C1/CB/CN/BX/CE/BX/C6 ,19/BZ/CB/C4/CN/C1/CB/CN/C7/BW/BW ,19/BZ/CB/C4/CN/C5/BT/CG,212/BZ/CB/C4/CN/C5/C1/C6,212/BZ/CB/C4/CN/C6/BT/C6,135/BZ/CB/C4/CN/C6/BX/BZ/C1/C6/BY ,135/BZ/CB/C4/CN/C8/C7/CB/C1/C6/BY ,135
GUI,419
GuinnessBrewery,303
Gumbeldistribution,283
Haddon(2003),430
halflife,255
haltingvia <ctrl-c>,61,
363
hashtable,193
hatmatrix,272, 424/CW/CP/DA/CX/D2/CV(SQL),82/CW/CT/CP/CS(POSIX),399,400
headerﬁle,49, 425
aggregation,50
gsl_stats March24,2009
INDEX 449
variablesin,50
hedonicpricingmodel,283
help
with command-line
switches, see /D1/CP/D2
withinGnuplot,163
Hessian,341, 425
heteroskedasticity,277, 425
hiddenﬁles, 383
hierarchicalmodel, see
multilevelmodel
Hipp,D Richard,75
histograms
drawingfrom,361–362
plotting,172
testing with,321–324
Householder
solver,134
transformations,280
HowtoLie withStatistics,
181
Huber(2000),7
Huff& Geis(1954),181
Hunter& Schmidt(2004),
336
Hybridmethod,342
Hypergeometric
distribution, 239/CV/D7/D0/CN/D6/CP/D2/CN/CW/DD/D4/CT/D6/CV/CT/D3/B9/D1/CT/D8/D6/CX/B4/CN/D4/CS/CU/B5 ,
239
IDE,18,419
identicaldraws,326
identicallydistributed, 425
identitymatrix, 425
IEC,419
IEC60559ﬂoating-point
standard,135
IEEE,419
IEEE754ﬂoating-point
standard,135/CX/CU(C),21,211
iff,425/CX/CU/D2/CS/CT/CU(C),354
IIA,286, 419
iid,326,419,425importancesampling,371,
425
imputation,maximum
likelihood,347/CX/D2(SQL),79/CX/D2/D0/D9/CS/CT (C),49–50,385
includepath,49
incrementing,20
independenceofirrelevant
alternatives,286, 425
independentdraws,326,
425/CX/D2/CS/CT/DC(SQL),90
indices,90
internalrepresentation,
200
inferentialstatistics, 1, 425/C1/C6/BY/C1/C6/C1/CC/CH ,135
inﬁnity,135
informationequality,332
informationmatrix,326,
426
initializers,designated,32/CX/D2/D7/CT/D6/D8(SQL),84,86
instrumentalvariable,275,
426/CX/D2/D8(C),29
interaction,281, 426
InternalRevenueService
(2007),117
interpreter, 426/CX/D2/D8/CT/D6/D7/CT/D8 (SQL),94
invarianceprinciple,351/CX/D7/CU/CX/D2/CX/D8/CT ,135/CX/D7/CX/D2/CU,135/CX/D7/D2/CP/D2,135
ISO,420
IV, 275,420,see
instrumentalvariables
jackknife,131, 426
jittering,175
join,426
command-lineprogram,
398
database,87–91Kahneman et al.(1982),
222
kerneldensityestimate,
262,426
Kernighan&Pike (1999),
64,193
Kernighan&Ritchie
(1988),18,126,210/CZ/CT/DD(Gnuplot),165
keyﬁles, 204
keyvalue,200
Klemens(2007),349
Kline(1980),325
Kmenta(1986),271,277,
320,370
Knuth,Donald,73
Knuth(1997),200
Kolmogorov(1933),323
kurtosis,230,365, 426
LATEX, 185
lattices, 171
Laumann& Derick(2006),
14
layersofabstraction,5/D0/CS/CT/DC/D4,137
leadingdigit,173
least squares
seeOrdinaryLeast
Squares227
leftouterjoin,106
legend,plot,165
Lehmann& Stein(1949),
375
leptokurtic,230,231,306/D0/CT/D7/D7(POSIX),399,400,
403
lexicographicorder,91,
426
libraries,6
library,52, 427
Life,Gameof,178/D0/CX/CZ/CT,79
likelihoodfunction,326,
427
philosophical
implications,329
likelihoodratio,336 ff
gsl_stats March24,2009
450 INDEX
likelihoodratiotest, 151,
335,351, 427/D0/CX/D1/CX/D8(SQL),83
linefeed,61,418
linenumbers,401
linkedlist, 198, 427
linker,51, 427
listwise deletion,105,347/C4/C7/BT/BW(SQL),107
localinformation,325
loglikelihoodfunction,326
logplots,174/D0/D3/CV/BD/BC,173,174
logicalexpressions,20
logisticmodel,283, see
logitmodel
logit,144, 283–292,328
nested,286,291
Lognormaldistribution/CV/D7/D0/CN/D6/CP/D2/CN/B9/D0/D3/CV/D2/D3/D6/D1/CP/D0/B4/CN/D4/CS/CU/B5 ,
243
lognormaldistribution,242/D0/D3/D2/CV(C),29/D0/D3/D2/CV /CS/D3/D9/CQ/D0/CT/D4/D6/CX/D2/D8/CUformatspeciﬁer,
138
love
blindnessof,317
LR,351, 420/D0/D7(POSIX),399
macro,212, 427
Maddala(1977),271,275/D1/CP/CX/D2,40
make,427/D1/CP/CZ/CT(POSIX),48,188,
387–391/D1/CP/D0/D0/D3,57ff, 214/C5/BT/C4/C4/C7/BV/CN/BV/C0/BX/BV/C3/CN ,214/D1/CP/D2(POSIX),399,400
Manhattanmetric,150, 427
MAR,420
marginalchange,285
MarkovChainMonte
Carlo,372
mathlibrary,52/D1/CP/D8/CW/BA/CW,52matrices
determinants,134
dotproduct,129
inversion,134
views,128
max,see /BZ/CB/C4/CN/C5/BT/CG
maximumlikelihood
tracingthepath,340
maximumlikelihood
estimation,325 ff
MCAR,420
McFadden(1973),284
McFadden(1978),292
MCMC,420
meansquarederror,220,
223,427
median,233–234/D1/CT/D1/D4/DD,124/D1/CT/D1/D1/D3/DA/CT,124,198
memorydebugger,214
memoryleak,62, 428
mesokurtic,231
metadata,128, 427
inthedatabase,86
metastudies,260
methodofmoments,256
Metropolis–Hastings,372
min,see /BZ/CB/C4/CN/C5/C1/C6
missingat random,346,
428
missingcompletelyat
random,346, 428
missingdata,104,105,345
missingnotat random,346,
428/D1/CZ/CS/CX/D6(POSIX),399
ML,420
MLE,325, 420,see
maximumlikelihood
estimation
MNAR,420
modulo,see /B1
momentgenerating
functions,xii
moments,229
MonteCarlomethod,356,
428/D1/D3/D6/CT(POSIX),399,400MSE,420
multicollinearity,275, 428
multilevelmodel,288 ff
multilevelmodels,288
Multinomialdistribution,
240
multinomialdistribution/CV/D7/D0/CN/D6/CP/D2/CN/B9/D1/D9/D0/D8/CX/D2/D3/D1/CX/CP/D0/B4/CN/D4/CS /CU/B5,
240
multinomiallogit,284
multipletestingproblem,
257,316–319
MultivariateNormal
distribution,347
multivariateNormal
distribution,144,242/D1/DA(POSIX),399
mySQL,75, 106/D1/DD/D7/D5/D0/D7/CW/D3/DB ,107
Nabokov(1962),1
namingfunctions,115/C6/BT/C6,104,135, seenota
number
NationalElectionStudies
(2000),286
Negativebinomial
distribution,244/CV/D7/D0/CN/CS/CU/CN/D2/CT/CV/CP/D8/CX/DA/CT /CN/B9/CQ/CX/D2/D3/D1/CX/CP/D0/CN/B4/C8/B8/C9/B5 ,
244/CV/D7/D0/CN/D6/CP/D2/CN/D2/CT/CV/CP/D8/CX/DA/CT /CN/B9/CQ/CX/D2/D3/D1/CX/CP/D0/B4/CN/D4/CS/CU/B5 ,
244
negativedeﬁnite,269
Negativeexponential
distribution,248
negativesemideﬁnite,269
Nelder–Meadsimplex
algorithm,341
nestedlogit,291
networkanalysis,147
networks
graphing,183
Newton’smethod,342
Neyman& Pearson
(1928a),335
gsl_stats March24,2009
INDEX 451
Neyman&Pearson
(1928b),335
Neyman–Pearsonlemma,
335,350/D2/D0(POSIX),399,401
non-ignorablemissingness,
346,428
non-parametric, 428
noncentralmoment,230,
428
Normaldistribution,144,
241,301,331/CV/D7/D0/CN/CS/CU/CN/CV/CP/D9/D7/D7/CX/CP/D2/CN /B9/B4/C8/B8/C9/B5,
241/CV/D7/D0/CN/D6/CP/D2/CN/CV/CP/D9/D7/D7/CX/CP/D2/B4 /CN/B9/D4/CS/CU/B5,
241/CV/D7/D0/CN/CS/CU/CN/CV/CP/D9/D7/D7/CX/CP/D2/CN /C8,
305
varianceof,370
normality
tests for,319,323,370
not,see!
notanumber,104,135/D2/D9/D0/D0(SQL),97,105
nullpointer,43, 428
object,428
objectﬁle,51, 429
object-oriented
programming,42,121/D3/CU/CU/D7/CT/D8,83
OLS,270, 420,see
OrdinaryLeast Squares
optimization,216
constrained,150
or,see /DG/DG/D3/D6/CS/CT/D6 /CQ/DD(SQL),83
orderstatistic, 250, 429
orderstatistics, 318
OrdinaryLeast Squares,2,
144,264, 274–275,
315,429
decomposingitsvariance,
227
Orwell(1949),42/D3/D9/D8(Gnuplot),159
/D3/D9/D8/CT/D6 /CY/D3/CX/D2(SQL),106
outliers
spotting,134
overﬂowerror,137, 429
pairwisedeletion,348
Papadimitriou& Steiglitz
(1998),338
parameterﬁles, 204
partitionedmatrices,122/D4/CP/D7/D8/CT(POSIX),399,401
path,385, 429
Paulos(1988),23
Pawitan(2001),xi,329,
351
PCA, 265, 420/D4/D0/D3/D7/CT,396
PCRE, 403, 420
PDF, 236, 420,see
probabilitydensity
function
Pearsoncorrelation
coefﬁcient,229
Pearson(1900),301
Peeketal.(2002),398
penaltyfunction,150
percentile, seequantile/D4/CT/D6/D0(POSIX),399,408,
408–418
Perl (2000),271
permutationtest, 375
π, 136
Pierce (1980),193
pipe,167,395, 429
pivottable,101, 429
platykurtic,230,231
plot,429/D4/D0/D3/D8(Gnuplot),160
plotting,seeGnuplot/D4/D1/BF/CS(Gnuplot),161,165
PMF, 236, 420,see
probabilitymass
function
Poincaré(1913),264
pointer,53 ff,429
declaration,57
function,190
null,43Poissondistribution,144,
245,246,331/CV/D7/D0/CN/D6/CP/D2/CN/D4/D3/CX/D7/D7/D3/D2/B4/CN /B9/D4/CS/CU/B5,
244
Polak–RibiereConjugate
gradientalgorithm,341
Polhillet al.(2005),139
Poole&Rosenthal(1985),
265/D4/D3/D4/CT/D2,167,394,396,429
positivedeﬁnite,269
positivesemideﬁnite,269
POSIX,381, 429
POSIXcommands/BX/C5/BT/BV/CB,387,402,403/CP/DB/CZ,403/CQ/CP/D7/CW,187,382/CP/D8,399,400/CS,399/CW/D1/D3/CS,160/D3/D0/D9/D1/D2,399,402/D4,399/D7/CW,382/D9/D8,399,401/CS/CX/CU/CU,399,402/CS/D3/D7/BE/D9/D2/CX/DC ,418/CS/D3/DC/DD/CV/CT/D2,185/CT/CS,403,404/CT/CV/D6/CT/D4,403,406/CT/D2/DA,381,382/CT/DC/D4/D3/D6/D8,382,424/CU/CX/D2/CS,386/CU/D3/D6/D8/D9/D2/CT,397/CV,41,214/CV/CS/CQ,44,387/CV/D2/D9/D4/D0/D3/D8,157–180,417/CV/D6/CT/D4/BB/CT/CV/D6/CT/D4 ,399/CV/D6/CT/D4,382,395,403,
404–408/CW/CT/CP/CS,399,400/D0/CT/D7/D7,399,400,403/D0/D7,399/D1/CP/CZ/CT,48,188,387–391/D1/CP/D2,399,400/D1/CZ/CS/CX/D6,399/D1/D3/D6/CT,399,400/D1/DA,399
gsl_stats March24,2009
452 INDEX/D2/D0,399,401/D4/CP/D7/D8/CT,399,401/D4/CT/D6/D0,399,408, 408–418/D4/D7/BE/D4/CS/CU,160/D6/D1/CS/CX/D6,399/D6/D1,399/D7/CT/CS,394,399,400,403,
408–418/D7/CT/D8/CT/D2/DA,424/D7/D3/D6/D8,399,400/D8/CP/CX/D0,399,400/D8/D3/D9/CW,389/D8/D6,407/D9/D2/CX/D5,399,402/D9/D2/CX/DC/BE/CS/D3/D7 ,418/DA/CX/D1,402/DA/CX,387,403/DB,399,401
posteriordistribution,258
Postscript,159,185,
187–188/D4/D3/DB,23,132
power,306,335, 430
precision,numerical,136
preprocessor,49–50,213
Pressetal.(1988),xiii,
340,341
Price&Stern(1988),26
primenumbers,61, 430
principalcomponent
analysis,265,275, 430/D4/D6/CX/D2/D8/CU,28,137,138
printing,see /D4/D6/CX/D2/D8/CU
prisoner’sdilemma,194
PRNG, 357, 420
probabilitydensity
function,236, 430
probabilitymassfunction,
236,430
probit,144, 283–292,
328–329
probitmodel,284
proﬁler,215, 430
programs, seePOSIX
commands
projectionmatrix,272, 430/D4/D7/BE/D4/CS/CU(POSIX),160pseudorandomnumber
generator, 430
Python,11,403
Q–Qplot,319
quantile,232,319
query,74, 430
R2, 311
Ramsey,330/D6/CP/D2/CS,84,363/D6/CP/D2/CS/D3/D1(SQL),84
randomnumbergenerator,
430
randomnumbers,357–364
fromSQL,84
ranks,147,253/D6/CT/CP/D0/D0/D3,196
regression,315
regularexpressions,403 ff,
430
bracketexpressions,404
casesensitivity,405
whitespace,407/D6/CT/D4/D0/D3/D8(Gnuplot),160,
170/D6/CT/D7/CT/D8(Gnuplot),168
revisioncontrol, see
subversion
rightouterjoin,106/D6/CX/D2/D8,33/D6/D1(POSIX),399/D6/D1/CS/CX/D6(POSIX),399
RNG, 357, 420/D6/D3/D9/D2/CS,81
rounding,33/D6/D3/DB/CX/CS,401/D6/D3/DB/CX/CS(SQL),85
Ruby,11
Rumi (2004),74
Särndaletal.(1992),232
samplecode/C5/CP/CZ/CT/CU/CX/D0/CT/BA/D8/CT/DC ,188/CA/D8/CX/D1/CT/CU/CX/D7/CW/CT/D6 ,9/CP/CV/CT/D2/D8/CV/D6/CX/CS/BA/CV/D2/D9/D4/D0 /D3/D8,
161/CP/D1/D3/D2/CV/DB/CX/D8/CW/CX/D2/BA ,225
/CP/D6/CV/DA/BA,207/CP/D6/D6/CP/DD/CU/D0/D3/CZ/BA ,197/CQ/CS/CP/DD/CU/D2/D7/BA ,35/CQ/CS/CP/DD/D7/D8/D6/D9/D8/BA ,32/CQ/CX/D1/D3/CS/CP/D0/CX/D8/DD ,378/CQ/CX/D6/CS/D7/BA,195/CQ/CX/D6/D8/CW/CS/CP/DD/BA ,24/CP/D0/D0/CQ/DD/CP/CS/CS/BA ,56/CP/D0/D0/CQ/DD/DA/CP/D0/BA ,38/CP/D2/CS/CX/CS/CP/D8/CT/D7/BA ,292/D0/D8/CS/CT/D1/D3/BA ,298/D3/D3/CZ/D7/BA,133/D3/D6/D6/D9/D4/D8/BA ,348/CS/CP/D8/CP/CQ/D3/D3/D8/BA ,368/CS/D6/CP/DB/CQ/CT/D8/CP/BA ,359/CS/D6/CP/DB/CU/D6/D3/D1/D4/D3/D4/BA ,361/CS/D9/D1/D1/CX/CT/D7/BA ,282/CT/D3/D2/BD/BC/BD/BA/CP/D2/CP/D0/DD/D8/CX /BA,
154/CT/D3/D2/BD/BC/BD/BA ,153/CT/D3/D2/BD/BC/BD/BA/D1/CP/CX/D2/BA ,155/CT/CX/CV/CT/D2/CQ/D3/DC/BA ,267/CT/CX/CV/CT/D2/CT/CP/D7/DD/BA ,269/CT/CX/CV/CT/D2/CW/CP/D6/CS/BA ,268/CT/D2/DA/BA,384/CT/D6/D6/D3/D6/CQ/CP/D6/D7/BA ,173/CU/CX/D7/CW/CT/D6/BA ,314/CU/D0/D3/DB/BA,22/CU/D3/D6/D8/D9/D2/CP/D8/CT/BA ,397/CU/D8/CT/D7/D8/BA,311/CU/D9/DE/DE/BA,140/CV/CT/D8/D3/D4/D8/BA ,209/CV/CT/D8/D7/D8/D6/CX/D2/CV/BA ,204/CV/CZ/CT/DD/D7/BA,205/CV/D0/CX/CQ/BA/D3/D2/CU/CX/CV ,205/CV/D3/D3/CS/CU/CX/D8/BA ,322/CY/CP/CZ/CX/D8/CT/D6/CP/D8/CX/D3/D2/BA ,132/CY/CX/D8/D8/CT/D6/BA ,175/D0/CP/D8/D8/CX/CT/BA ,171/D0/CX/CU/CT/BA,179/D0/CX/D7/D8/CU/D0/D3/CZ/BA ,199/D0/D3/CP/D0/D1/CP/DC/BA ,339/D0/D6/D2/D3/D2/D2/CT/D7/D8/BA ,354/D0/D6/D8/CT/D7/D8/BA ,352/D1/CP/D3/CX/BA,254/D1/CP/D6/CZ/D3/DA/BA ,129/D1/CT/D8/D6/D3/CP/D2/D3/DA/CP/BA ,226
gsl_stats March24,2009
INDEX 453/D1/D9/D0/D8/CX/D4/D0/CX/CP/D8/CX/D3/D2/D8/CP/CQ /D0/CT /BA,
114/D2/CT/DB/D3/D0/D7/BA ,146/D2/D3/D6/D1/CP/D0/CQ/D3/D3/D8/BA ,369/D2/D3/D6/D1/CP/D0/CV/D6/D3/DB/D8/CW/BA ,253/D2/D3/D6/D1/CP/D0/D0/D6/BA ,151/D2/D3/D6/D1/CP/D0/D8/CP/CQ/D0/CT/BA ,252/D2/D3/D8/CP/D2/D9/D1/CQ/CT/D6/BA ,135/D3/D2/CT/CQ/D3/D3/D8/BA ,368/D4/CX/D4/CT/D4/D0/D3/D8/BA ,168/D4/D0/D3/D8/CP/CU/D9/D2/D8/CX/D3/D2/BA ,191/D4/D3/DB/CT/D6/D7/D3/CU/D8/DB/D3/BA ,138/D4/D6/CX/D1/CT/D7/BA ,62/D4/D6/CX/D1/CT/D7/BE/BA ,63/D4/D6/D3/CQ/CX/D8/D0/CT/DA/CT/D0/D7/BA ,293/D4/D6/D3/CY/CT/D8/CX/D3/D2/BA ,273/D4/D6/D3/CY/CT/D8/CX/D3/D2/D8/DB/D3/BA ,279/D5/D5/D4/D0/D3/D8/BA ,320/D6/CX/CS/CT/D6/D7/CW/CX/D4/BA ,289/D7/CT/D0/CU/CT/DC/CT/D9/D8/CT/BA ,170/D7/CX/D1/D4/D0/CT/D7/CW/CT/D0/D0/BA ,40/D7/CX/D2/D7/D5/BA,338/D7/D1/D3/D3/D8/CW/CX/D2/CV/BA ,263/D7/D5/D9/CP/D6/CT/D7/BA ,59/D7/D8/CP/D8/CT/CS/D9/D1/D1/CX/CT/D7/BA ,112/D8/CP/DC/CT/D7/BA,118/D8/CS/CX/D7/D8/CZ/D9/D6/D8/D3/D7/CX/D7/BA ,366/D8/CX/D1/CT/BA,363/D8/CX/D1/CT/CU/CX/D7/CW/CT/D6/BA ,9/D8/D6/CT/CT/CU/D0/D3/CZ/BA ,201/D8/D8/CT/D7/D8/BA,111/D8/D8/CT/D7/D8/BA/D0/D3/D2/CV/BA ,110/DB/CQ/D8/D3/CS/CP/D8/CP/BA ,100
sampledistributions,235
Sampling
fromanartiﬁcial
population,361
Savage,330/D7/CP/D2/CU,203
Scheffé(1959),312,420
scientiﬁcnotation,136
scope,41–42, 430
global,50
score,326, 431/D7/CT/CS(POSIX),394,399,
400,403, 408–418
seed,357, 431segfault,43, 431,see
segmentationfault
segmentationfault,43,214,
431/D7/CT/D0/CT/D8(SQL),77 ff/D7/CT/D8/CT/D2/DA,384/D7/CT/D8/CT/D2/DA(POSIX),424
settings
for /CP/D4/D3/D4/CN/D1/D3/CS/CT/D0/D7 ,339
shell, 393, 431
Shepard& Cooper(1992),
265/CB/C1/BZ/C1/C6/CC,61
Silverman(1981),377
Silverman(1985),263
simulatedannealing,343,
373
singularvalue
decomposition,265,
431/D7/CX/DE/CT/D3/CU,125,300
skew,230, 431
Slutskytheorem,364
Smith &Reynolds(2005),
89
Snedecor&Cochran
(1976),301
snowﬂakeproblem,4,270,
288/D7/D2/D4/D6/CX/D2/D8/CU ,67/D7/D3/D6/D8(POSIX),399,400
sorting/D7/D3/D6/D8/CN/DA/CT/D8/D3/D6/CN/B9/D0/CP/D6/CV/CT/D7/D8/CN/CX/D2/CS/CT/DC ,
268
databaseoutput,83
of /CV/D7/D0/CN/DA/CT/D8/D3/D6 sand/CP/D4/D3/D4/CN/CS/CP/D8/CP s,233
sourcecode, 431
spectraldecomposition,
265/D7/D4/D0/D3/D8(Gnuplot),161/D7/D4/D6/CX/D2/D8/CU,67
SQL, 6,74, 420
comments,78
SQL keywords/C4/C7/BT/BW,107/CQ/CT/CV/CX/D2,84
/CQ/CT/D8/DB/CT/CT/D2,79/CP/D7/CT,110/CP/D7/D8,78/D3/D1/D1/CX/D8,84/D6/CT/CP/D8/CT,84/CS/CT/D0/CT/D8/CT,86/CS/CT/D7,83/CS/D6/D3/D4,85,86/CT/DC/CT/D4/D8,94/CU/D6/D3/D1,77/CW/CP/DA/CX/D2/CV,82/CX/D2/CS/CT/DC,90/CX/D2/D7/CT/D6/D8,84,86/CX/D2/D8/CT/D6/D7/CT/D8 ,94/CX/D2,79/D0/CX/D1/CX/D8,83/D2/D9/D0/D0,97,105/D3/D6/CS/CT/D6 /CQ/DD,83/D3/D9/D8/CT/D6 /CY/D3/CX/D2,106/D6/CP/D2/CS/D3/D1,84/D6/D3/DB/CX/CS,85/D7/CT/D0/CT/D8,77ff/D9/D2/CX/D3/D2 /CP/D0/D0,94/D9/D2/CX/D3/D2,94/D9/D4/CS/CP/D8/CT,87/DB/CW/CT/D6/CT,78
SQLite,75/D7/D5/D0/CX/D8/CT/CN/D1/CP/D7/D8/CT/D6 ,86/D7/D5/D6/D8,23,52/D7/D6/CP/D2/CS,363
SSE,227,311, 420
SSR, 227,311, 420
SST,227, 420
stack,38,44, 431
Stallman et al.(2002),44
standarddeviation,222,
431
standarderror,367, 432/D7/D8/CP/D8/CX(C),39,147,153,
357
static variables,39
initializing,29,211
statistic, 219, 432
statistics packages
rantsregarding,8–11/D7/D8/CS/CT/D6/D6,70,267,394,396/D7/D8/CS/CX/D2,394/D7/D8/CS/D3/D9/D8,215,267,394
gsl_stats March24,2009
454 INDEX
stoppingvia <ctrl-c>,61,
363
Stravinsky(1942),113,123/D7/D8/D6/D1/D4,68/D7/D8/D6/D4/DD,67
stride,142
string,432
strings,65 ff/CV/D0/CX/CQlibrary,193/D7/D8/D6/D0/CT/D2,66/D7/D8/D6/D2/CP/D8,66/D7/D8/D6/D2/D4/DD,66
Stroustrup(1986),42/D7/D8/D6/D9/D8(C),31,60
structuralequation
modeling,271
structure, 432,see /D7/D8/D6/D9/D8
anonymous,353
StructuredQuery
Language,74, 432
Student,231,303
Student’s tdistribution,230
Student(1927),231
subjectivist,330
subqueries,91
subversion,214–215
surfaceplots,161
SVD,265, 420
switches,208, 432
syntaxerror,19/D7/DD/D7/D8/CT/D1,125,397
t distribution,365
tdistribution,302,358,365/CV/D7/D0/CN/CS/CU/CN/D8/CS/CX/D7/D8/CN/C8 ,305/CV/D7/D0/CN/CS/CU/CN/D8/CS/CX/D7/D8/CN/C8/CX /D2/DA,
306
ttest, 109–110, 308–309/CP/D4/D3/D4/CN/D4/CP/CX/D6/CT/CS/CN/D8/CN/D8/CT /D7/D8,
308/CP/D4/D3/D4/CN/D8/CN/D8/CT/D7/D8 ,308/D8/CP/CX/D0(POSIX),399,400Taylorexpansion,350/D8/CT/D6/D1(Gnuplot),159
test functions,72
TEX, 185
Thomson(2001),7
threading,119, 432/D8/CX/D1/CT,362/D8/CX/D8/D0/CT(Gnuplot),164
TLA,420/D8/D3/D9/CW(POSIX),389/D8/D6(POSIX),407
Train(2003),371
transitionmatrix,129
transposition, see/CV/D7/D0/CN/D1/CP/D8/D6/CX/DC/CN/B9/D8/D6/CP/D2/D7/D4/D3/D7/CT/CN/D1/CT/D1/D4/DD
indotproducts,129
tree,seebinarytree
trimean,234, 432
Tukey(1977),157,234,
432
type,27,432
typecasting,33–34, 432
TypeIerror,335, 335,432
TypeIIerror,335, 335,432/D8/DD/D4/CT/CS/CT/CU (C),31,191
unbiasedestimator,335,
433
unbiasedstatistic, 220, 432
underﬂowerror,137, 433
Uniformdistribution,250,
251,358/CV/D7/D0/CN/CS/CU/CN/CU/D0/CP/D8/CN/B4/C8 /B8/C9 /B5,
251/CV/D7/D0/CN/D6/CP/D2/CN/CU/D0/CP/D8/B4/CN/D4 /CS/CU /B5,
251/D9/D2/CX/D3/D2(C),121/D9/D2/CX/D3/D2(SQL),94/D9/D2/CX/D3/D2 /CP/D0/D0(SQL),94/D9/D2/CX/D5(POSIX),399,402
UnitedStatesofAmericanationaldebtanddeﬁcit,
181
UNIX,420,433/D9/D2/CX/DC/BE/CS/D3/D7 (POSIX),418/D9/D4/CS/CP/D8/CT(SQL),87
utilitymaximization,152
utils,193/DA/CP/D9/D9/D1,108
value-at-risk,306
variance,222,228, 433/DA/CX(POSIX),387,403
views,128/DA/CX/D1(POSIX),402/DA/D3/CX/CS(C),36
voidpointers,199
Vuong(1989),354/DB(POSIX),399,401
WeightedLeastSquares,
144,277, 433/DB/CW/CT/D6/CT(SQL),78/DB/CW/CX/CW,168/DB/CW/CX/D0/CT(C),23
WilliamS Gosset, 231,303
Windows,381
WLS,277, 420
Wolfram(2003),115
wordcount,401/DC/D0/CP/CQ/CT/D0(Gnuplot),164/DC/D8/CX/D7(Gnuplot),165/DD/D0/CP/CQ/CT/D0(Gnuplot),164/DD/D8/CX/D7(Gnuplot),165
zdistribution,308
ztest, 307
Zipfdistribution,144
Zipf’slaw,252
